<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] how to get mencoder en mplayer working with uvc v4l2 webcams
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2009-March/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20how%20to%20get%20mencoder%20en%20mplayer%20working%20with%0A%20uvc%20v4l2%20webcams&In-Reply-To=%3C49BE542D.2030706%40powercraft.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004653.html">
   <LINK REL="Next"  HREF="004656.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] how to get mencoder en mplayer working with uvc v4l2 webcams</H1>
    <B>Jelle de Jong</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20how%20to%20get%20mencoder%20en%20mplayer%20working%20with%0A%20uvc%20v4l2%20webcams&In-Reply-To=%3C49BE542D.2030706%40powercraft.nl%3E"
       TITLE="[Linux-uvc-devel] how to get mencoder en mplayer working with uvc v4l2 webcams">jelledejong at powercraft.nl
       </A><BR>
    <I>Mon Mar 16 14:29:17 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004653.html">[Linux-uvc-devel] how to get mencoder en mplayer working with	uvc v4l2 webcams
</A></li>
        <LI>Next message: <A HREF="004656.html">[Linux-uvc-devel] Logitech Quickcam Notebook Pro for Business
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4655">[ date ]</a>
              <a href="thread.html#4655">[ thread ]</a>
              <a href="subject.html#4655">[ subject ]</a>
              <a href="author.html#4655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Paulo, thank you for the reports,

Why can't gmail sent plain test to mailinglist? ;-)

Paulo Assis wrote:
&gt;<i> Jelle,
</I>&gt;<i> 
</I>&gt;<i> 2009/3/15 Jelle de Jong &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">jelledejong at powercraft.nl</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">jelledejong at powercraft.nl</A>&gt;&gt;
</I>&gt;<i> 
</I>&gt;<i>     Hi Paulo and thank you for the help,
</I>&gt;<i> 
</I>&gt;<i>     Paulo Assis wrote:
</I>&gt;<i>     &gt; Mplayer works fine with the following command:
</I>&gt;<i>     &gt; &#65533;mplayer <A HREF="tv://">tv://</A> -tv
</I>&gt;<i>     &gt; driver=v4l2:device=/dev/video0:width=800:height=600:fps=25
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; see mplayer.log
</I>&gt;<i> 
</I>&gt;<i>     It seems mplayer does not! work fine, see the resolution, it is
</I>&gt;<i>     unable to
</I>&gt;<i>     render 800x600 it keep sticking at 640x480.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Yes I notice that :-)
</I>
yes it is not working.

&gt;<i>     Could you or somebody else try this command and show the full report:
</I>&gt;<i>     mplayer -identify -benchmark -v <A HREF="tv://">tv://</A> -tv
</I>&gt;<i>     driver=v4l2:device=/dev/video0:width=800:height=600:fps=25
</I>&gt;<i> 
</I>&gt;<i> see mplayer_1.log
</I>
thanks, again only 640x480 max, the strange thing is that is does
response to fps and resolution settings below this resolution.

&gt;<i>     &gt; but fails for the ones below.
</I>&gt;<i>     &gt; see mplayer_1.log
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>&gt;<i>     Thank you, it seems mplayer dies on your system when trying to
</I>&gt;<i>     access the
</I>&gt;<i>     sound of the webcam I will report this back to mplayer developers
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> /dev/dsp1 is the audio card (OSS) for ALSA the same card is  hw:0,0
</I>&gt;<i> for what I know usb audio is not very well supported under OSS.
</I>&gt;<i>  
</I>
It can happen, you also use alsa devices for recording, but audio in
linux is a big mess in general.

&lt;snip&gt;

&gt;<i>     could you please test ;-) and show the full report
</I>&gt;<i> 
</I>&gt;<i>     mencoder <A HREF="tv://">tv://</A> -tv
</I>&gt;<i>     driver=v4l2:device=/dev/video0:width=800:height=600:fps=25 -of rawvideo
</I>&gt;<i>     -nosound -ovc lavc -lavcopts vcodec=mpeg4:threads=4 -of lavf -lavfopts
</I>&gt;<i>     format=avi -o output0.avi
</I>&gt;<i> 
</I>&gt;<i> See mencoder.log 
</I>&gt;<i> 
</I>
Thanks this has real info, as you can see the fps is only going to be
15fps and it has a strange long startup swing making it impossible to
record in sync audio and video with a fixed fps. This situation is really
bad and need fixing.

&gt;<i> 
</I>&gt;<i>     &gt; I could only get 640x480, this limit seems to be hardcoded in mplayer.
</I>&gt;<i> 
</I>&gt;<i>     The mplayer developer tell me it is not hardcoded and is looking up v4l2
</I>&gt;<i>     stuff. I don't know what is exactly going on here ...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> In that case it can only mean that mplayer has a bug when looking up
</I>&gt;<i> frame-rate and resolution.
</I>&gt;<i> The uvc driver enumerates all resolutions and frame rates just as
</I>&gt;<i> defined by v4l2.
</I>&gt;<i> 
</I>
$ sudo v4l-info /dev/video0

this command shows me a lot of errors about the provided v4l fields, it
would not suppris me that because of all these errors mplayer fails. But
somebody need to test mplayer with a device that is fully supported and
has correct v4l flags.

And yes gstreamer, vlc and guvciewer are able to show higher resolutions
but I am unable to record them at the correct fps with synchronized video
and audio.

&gt;<i>     &gt; Like I said live video mpeg encoding requires a lot of cpu power, you
</I>&gt;<i>     &gt; wont find many apps out there that can deliver this, with the quality
</I>&gt;<i>     &gt; you want.
</I>&gt;<i> 
</I>&gt;<i>     My system is powerful enough to do live recordings with mpeg4 with only
</I>&gt;<i>     20% cpu load with mencoder on the 640x480 15fps stream... thats why I
</I>&gt;<i>     need mencoder and mplayer to be able to view the 800x600 at 25 fps
</I>&gt;<i>     streams so I can record them with mencoder and have a more then powerful
</I>&gt;<i>     engough system. mjpeg does not use treading and is very heavy for a dual
</I>&gt;<i>     threaded designed/optimized atom cpu.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I'm confused mjpeg is heavy but not mpeg4 ?
</I>&gt;<i> mjpeg is, in a very simplistic way, a I frame only mpeg4, if you set
</I>&gt;<i> your camera to stream mjpeg instead of yuyv, you won't even need to
</I>&gt;<i> compress, just have to store the frames to disk.
</I>&gt;<i> 
</I>&gt;<i> Here's a good test:
</I>&gt;<i> in guvcview disable sound and set the camera stream to MJPG instead of
</I>&gt;<i> YUYV, then capture some video, if you notice a fps drop when recording
</I>&gt;<i> this is only due to Disk IO, not CPU since there is no extra processing.
</I>
MJPG uses a singe thread non cpu optimized process that seems to heavy
for real time processing, the mpeg4 uses threading and has some cpu
optimization making it run at 20% load. So if possible please optimize
the MJPG. The storage throughput is a issue, even since my end systems
are going to write video to SDHC storage with a absolute max of 15MB/s.


Are these test done with a full supported bcdDevice 0.09 device, so
latest hardware and software version?

Are there Logitech engineers on this list that can response to the issue
and what the future can bring for usb video devices?

And is there a real hardware difference between all these 2MP+ webcam in
the market or are they all from the same ASIC but with different packages
and marketing? And how can one tell a webcam has hardware auto focus or
software autofocus.

Well after 7 days of experimenting I have to come to the conclusion its
currently impossible to use a Linux system for real time minimal 800x600
25fps video recording with standard Debian experimental multimedia
software packages on a headless 1GB DDR2 1.6GHz Atom N270.

If somebody want to create a usb video camera out of a small laptop or
embedded system please feel free to contact me.

I just soled all my 2MP+ webcams, but if somebody can show me they got it
working I will buy some new webcams for testing.

Best regards,

Jelle de Jong
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)

iJwEAQECAAYFAkm+VCsACgkQ1WclBW9j5HnvNwP+MmOCXnt8Ezgn4zz5CvnHnSLA
olVZTB+W6movSnd9KvPrO4Vq9OY75eo/sMdI1GgBG+QCMrD5LPRa46ixitXwJ74a
RjcHOX4zVKvMnL96ZRmKoCGQGjsf8ASoEISYYjnR5CCVT3abFIGvzyoEqBYQV2eE
a0FvG+Obqn9g/xHjDRc=
=TDmO
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004653.html">[Linux-uvc-devel] how to get mencoder en mplayer working with	uvc v4l2 webcams
</A></li>
	<LI>Next message: <A HREF="004656.html">[Linux-uvc-devel] Logitech Quickcam Notebook Pro for Business
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4655">[ date ]</a>
              <a href="thread.html#4655">[ thread ]</a>
              <a href="subject.html#4655">[ subject ]</a>
              <a href="author.html#4655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
