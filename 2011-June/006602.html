<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Quanta integrated webcam
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2011-June/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Quanta%20integrated%20webcam&In-Reply-To=%3Calpine.LNX.2.00.1106132201500.17792%40tristan%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006598.html">
   <LINK REL="Next"  HREF="006603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Quanta integrated webcam</H1>
    <B>Carl Michal</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Quanta%20integrated%20webcam&In-Reply-To=%3Calpine.LNX.2.00.1106132201500.17792%40tristan%3E"
       TITLE="[Linux-uvc-devel] Quanta integrated webcam">michal at physics.ubc.ca
       </A><BR>
    <I>Tue Jun 14 07:48:49 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="006598.html">[Linux-uvc-devel] Quanta integrated webcam
</A></li>
        <LI>Next message: <A HREF="006603.html">[Linux-uvc-devel] Quanta integrated webcam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6602">[ date ]</a>
              <a href="thread.html#6602">[ thread ]</a>
              <a href="subject.html#6602">[ subject ]</a>
              <a href="author.html#6602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 13 Jun 2011, Carl Michal wrote:

&gt;<i> On Mon, 13 Jun 2011, Alexey Fisher wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>  On So, 2011-06-12 at 21:05 -0700, Carl Michal wrote:
</I>&gt;&gt;<i> &gt;  On Sun, 12 Jun 2011, Alexey Fisher wrote:
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; &gt;  Am Samstag, den 11.06.2011, 23:33 -0700 schrieb Carl Michal:
</I>&gt;&gt;<i> &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt;  On Sun, 12 Jun 2011, Alexey Fisher wrote:
</I>&gt;&gt;<i> &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  On Sa, 2011-06-11 at 21:55 -0700, Carl Michal wrote:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   2011/6/7 Alexey Fisher &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">bug-track at fisher-privat.net</A>&gt;:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   On Mo, 2011-06-06 at 17:31 -0700, Carl Michal wrote:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   Hello,
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   I'm having some trouble with a Quanta integrated 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   webcam.  It
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   identifies
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   itself as: Laptop_Integrated_Webcam_2HDM, usbid: 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   0408:2fb1.  This is
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   built
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   in to a Dell XPS-15 (L501X).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   The uvcvideo module works, but the video stutters and 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   has some
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   distortions, even at low resolutions and frame rates.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   With the Camera Output set to MJPG (in guvcview) 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   &quot;Ignoring empty
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   buffer ...&quot;
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   messages occur with most glitches.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   I would say the camera is not returning the full frame (or 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   maybe empty
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   ones) for same reason.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   If the output is set to YV12, the errors look like:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   VIDIOC_DQBUF - Unable to dequeue buffer : Input/output 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   error
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   Error grabbing image
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   libv4l2: error converting / decoding frame data: 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   v4l-convert: error
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   parsing JPEG header: Not a JPG file ?
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   YV12 is a format returned by libv4l, and it's obtained by
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   decompressing the MJPG stream, so in fact the camera is 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   still in MJPG
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   format like above.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   With cheese, the video preview looks ok, but video 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   capture is
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   unusable - the video stutters badly at low resolution, 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   and the capture
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   hangs at high resolution (the program doesn't hang, but 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   after a couple
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   of
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   frames no more get captured).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   Probably the same situation as above (incomplete or empty 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   frames)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   You should also increase uvc video verbosity and check 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   dmesg for errors.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   From the looks of it I would say you are having some 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   hardware sync
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   issues, did you try all possible resolutions and frame 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   rates ?
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   Do these issues happen in all formats
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   Regards,
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;   Paulo
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  I've looked through the traces I've gotten with this webcam a 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  little and
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  noticed something that may help.  The out of sync errors are 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  always starts
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  with a sequence like this:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Frame complete (EOF found) buf: 1, 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  bytes: 64684.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: EOF in empty payload.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Dequeuing buffer 1 (4, 64684 bytes).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Queuing buffer 1.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Frame complete (EOF found) buf: 2, 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  bytes: 64728.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: EOF in empty payload.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Dequeuing buffer 2 (4, 64728 bytes).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Queuing buffer 2.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Frame complete (FID bit toggled) buf: 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  3, bytes: 63504.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Frame complete (EOF found) buf: 0, 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  bytes: 1072.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: EOF in empty payload.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Dequeuing buffer 3 (4, 63504 bytes).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Queuing buffer 3.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Dequeuing buffer 0 (4, 1072 bytes).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Queuing buffer 0.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Dropping payload (out of sync).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Jun 11 21:41:59 uvcvideo: Dropping payload (out of sync).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  I've added a couple of fields to the frame complete messages to 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  indicate
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  which buffer is marked as complete and how many bytes were 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  delivered to
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  it.
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Most frames are terminated with EOF, but occasionally an FID and 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  EOF
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  are found in the same packet. So two buffers are marked as 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  completed, but
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  the second one shouldn't be (I don't think).
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; &gt;  Any advice on where to look next?
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  Try fid quirk:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  uvcvideo quirks=0x10
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  for more quirks see:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  grep QUIRK linux-2.6/drivers/media/video/uvc/uvcvideo.h
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_STATUS_INTERVAL 0x00000001
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_PROBE_MINMAX 0x00000002
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_PROBE_EXTRAFIELDS 0x00000004
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_BUILTIN_ISIGHT 0x00000008
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_STREAM_NO_FID 0x00000010
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_IGNORE_SELECTOR_UNIT 0x00000020
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_FIX_BANDWIDTH 0x00000080
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_PROBE_DEF 0x00000100
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  UVC_QUIRK_RESTRICT_FRAME_RATE 0x00000200
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  --
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;  Regards,
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;         Alexey
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt;  the fid quirk actually makes it quite a bit worse - many more out of 
</I>&gt;&gt;<i> &gt; &gt; &gt;  sync
</I>&gt;&gt;<i> &gt; &gt; &gt;  errors.  None of the other quirks (individually) solve the issue.
</I>&gt;&gt;<i> &gt; &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; &gt;  I stuck in a crude hack to ignore the EOF that is found in the same 
</I>&gt;&gt;<i> &gt; &gt; &gt;  packet
</I>&gt;&gt;<i> &gt; &gt; &gt;  as the fid toggle, and then the number of sync errors is 
</I>&gt;&gt;<i> &gt; &gt; &gt;  dramatically
</I>&gt;&gt;<i> &gt; &gt; &gt;  reduced, but there are still some bad frames.  What next?
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt;  Am i correct, your trace is for mjpeg format?
</I>&gt;&gt;<i> &gt; &gt;  Becouse buffers have different size, with uncompressed stream should 
</I>&gt;&gt;<i> &gt; &gt;  get
</I>&gt;&gt;<i> &gt; &gt;  always same size.
</I>&gt;&gt;<i> &gt; &gt;  There are two way to mark frame as complete, at frame beginning (FID) 
</I>&gt;&gt;<i> &gt; &gt;  or
</I>&gt;&gt;<i> &gt; &gt;  at frame end (EOF). EOF is optional, FID is important. Some cams do 
</I>&gt;&gt;<i> &gt; &gt;  not
</I>&gt;&gt;<i> &gt; &gt;  do FID or brake it, in this case we use QUIRK_NO_FID, so EOF is used.
</I>&gt;&gt;<i> &gt; &gt;  But we do not have EOF quirk. Let us try to ignore EOF, there is
</I>&gt;&gt;<i> &gt; &gt;  attached patch.
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt;  --
</I>&gt;&gt;<i> &gt; &gt;  Regards,
</I>&gt;&gt;<i> &gt; &gt;         Alexey
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt;  Hi,
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt;  With your patch the sync errors are almost completely gone, but there 
</I>&gt;&gt;<i> &gt;  are
</I>&gt;&gt;<i> &gt;  still corrupt frames - YUYV output is much worse than before (yes - the
</I>&gt;&gt;<i> &gt;  earlier traces were MJPG).
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt;  This is from YUYV at 640x480, 30fps
</I>&gt;&gt;<i> &gt;  things are good for a while but then:
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Frame complete (FID bit toggled) buf: 3. 
</I>&gt;&gt;<i> &gt;  bytes: 614400
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Dequeuing buffer 3 (4, 614400 bytes).
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Queuing buffer 3.
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Frame complete (FID bit toggled) buf: 0. 
</I>&gt;&gt;<i> &gt;  bytes: 150952
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Frame complete (FID bit toggled) buf: 1. 
</I>&gt;&gt;<i> &gt;  bytes: 2024
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Dequeuing buffer 0 (4, 150952 bytes).
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Queuing buffer 0.
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Dequeuing buffer 1 (4, 2024 bytes).
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Queuing buffer 1.
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Frame complete (FID bit toggled) buf: 2. 
</I>&gt;&gt;<i> &gt;  bytes: 461400
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Dequeuing buffer 2 (4, 461400 bytes).
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Queuing buffer 2.
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: uvc_v4l2_poll
</I>&gt;&gt;<i> &gt;  Jun 12 09:36:14 uvcvideo: Frame complete (FID bit toggled) buf: 3. 
</I>&gt;&gt;<i> &gt;  bytes: 614400
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt;  where interestingly - the 150952+2024+461400 = 614376, which is 24 bytes
</I>&gt;&gt;<i> &gt;  short of 614400.  The headers are 12 bytes long.  Seems like a weird 
</I>&gt;&gt;<i> &gt;  conincidence.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  &quot;Dropping payload (out of sync)&quot; say nothing but: FID was not tugged at
</I>&gt;&gt;<i>  the time we was expecting it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  I just realized: NO_FID quirk, do not disables FID handling if there is
</I>&gt;&gt;<i>  some wrong FID bit appear. It assume webcam do not use FID bit at all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Try attached patch and load module with NO_FID quirk - quirks=0x10
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  --
</I>&gt;&gt;<i>  Regards,
</I>&gt;&gt;<i>         Alexey
</I>&gt;&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I think you nailed it.  Every frame looks perfect now.  The trace shows a few 
</I>&gt;<i> of these:
</I>&gt;<i>
</I>&gt;<i> Jun 13 09:24:24 uvcvideo: Dropping payload (error bit set)
</I>&gt;<i>
</I>&gt;<i> but I don't see corrupt frames any more in either MJPG or YUYV (at 640x480 
</I>&gt;<i> anyway) - in MJPG all the frames have the right size.
</I>&gt;<i>
</I>&gt;<i> There is a some weirdness with frame rates depending on the exposure setting: 
</I>&gt;<i> 1) Exposure, auto gives 4 options: auto priority mode, manual mode, shutter 
</I>&gt;<i> priority mode, and aperture priority mode.  Auto and shutter don't seem to be 
</I>&gt;<i> settable (errors from guvcview when chosen). There is also an &quot;Exposure, auto 
</I>&gt;<i> priority&quot; checkbox.
</I>&gt;<i>
</I>&gt;<i> Frame rates drop dramatically in manual mode (to 10-15fps from 30).
</I>&gt;<i>
</I>&gt;<i> But I can't really complain at this point - the corrupt frames are gone.
</I>&gt;<i> Will that quirk be added to the driver (usb id is: 0408:2fb1)?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Carl
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Linux-uvc-devel mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">Linux-uvc-devel at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">https://lists.berlios.de/mailman/listinfo/linux-uvc-devel</A>
</I>&gt;<i>
</I>
Hi,

it seems like I am much better off by fully disabling FID (with your 
patch) than before.  With the patch, YUYV frames are _always_ the right 
size.  There are still some problems:

1) corrupt frames - with part of the image missing or the image displaced. 
Sometimes (but definitely not always) these occur at the same time as a 
trace message saying the error bit is set.

2) sometimes the camera just won't start.  when guvcview (or luvcview) is 
started, no frames come back from the camera.  There is a light next to 
the camera that comes on to indicate it should be active, but no frames 
arrive.  There seems to be a fairly strong correlation with using luvcview 
(which from the traces seems to use some different mechanism to get frames from 
the driver from guvcview.  guvcview polls, luvcview doesn't).  Sometimes 
just restarting guvcview several times will work and the camera eventually 
starts.  Sometimes just changing resolution or frame rates succeeds in 
starting the camera.  I haven't found anything reproducible.  I do not 
think this is related to your patch, as it did happen once before your 
patch was applied. Unloading and reloading the uvcvideo and ehci_hcd 
modules does not consistently solve it. guvcview just lists:

  Could not grab image (select timeout): Resource temporarily unavailable

and the trace shows guvcview polling, but nothing else going on.

I have tried adding the other quirks to the FID quirk, but haven't seen 
any improvement with any others.

Thanks for you help -

Carl

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006598.html">[Linux-uvc-devel] Quanta integrated webcam
</A></li>
	<LI>Next message: <A HREF="006603.html">[Linux-uvc-devel] Quanta integrated webcam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6602">[ date ]</a>
              <a href="thread.html#6602">[ thread ]</a>
              <a href="subject.html#6602">[ subject ]</a>
              <a href="author.html#6602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
