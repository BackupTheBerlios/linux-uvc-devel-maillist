From bug-track at fisher-privat.net  Mon Aug  1 08:16:42 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 01 Aug 2011 08:16:42 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
 Cam Socialize HD
In-Reply-To: <201107311828.27977.laurent.pinchart@ideasonboard.com>
References: <1312030286-sup-231@midna.zekjur.net>
	<201107311828.27977.laurent.pinchart@ideasonboard.com>
Message-ID: <4E3644CA.3050306@fisher-privat.net>

Am 31.07.2011 18:28, schrieb Laurent Pinchart:
> Hi Michael,
> 
> On Saturday 30 July 2011 15:08:14 Michael Stapelberg wrote:
>> Hi,
>>
>> I recently bought a Creative Live! Cam Socialize HD (ID 041e:4080) after
>> verifying that it is a device supported by the uvcvideo driver.
>>
>> The device basically works, but to get 30 fps (at 640x480, but also with
>> higher resolutions), I need to set the 'Exposure, Auto' setting to 1
>> (Manual Mode). Afterwards, I can set the 'Exposure (Absolute)' setting to
>> one of the values 39, 78, 156, 312, 625, 1250, 2500, ?. All other values
>> lead to a heavily over-exposed picture. This effect was already mentioned
>> on this list for a different cam [1]. I wonder what we can do about it, as
>> the step size for this setting is reported as '1' while in reality it
>> seems logarithmic ? with the exception of the step 312 to 625.
> 
> Those values are 2500 / 64, 32, 16, 8, 4, 2 and 1. There's unfortunately no 
> way for the driver to know that other values will lead to bad results. I've 
> seen bad firmware bugs, but this one is high on the list.
> 
>> So, I can live with changing the configuration after plugging in the cam,
>> which I would automate with udev.
>>
>> However, I have noticed that I need to have an active video capture
>> running, otherwise setting these values with uvcdynctrl has no effect. I
>> tested it like this:
>>
>> 1) Plug in the camera, wait until the white LED (which indicates capturing)
>>    goes off. This takes about 5 seconds.
>> 2) Use uvcdynctrl -s 'Exposure, Auto' 1
>> 3) Verify the result with uvcdynctrl -g 'Exposure, Auto', which also
>> returns 1 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
>> 5) Use gst-launch v4l2src ! xvimagesink
>> ?  The video is at 5 fps instead of 30 fps
>>
>> If I do it like this, it works:
>>
>> 1) Plug in the camera, wait until the white LED (which indicates capturing)
>>    goes off. This takes about 5 seconds.
>> 2) Use gst-launch v4l2src ! xvimagesink, leave it open
>> 3) Use uvcdynctrl -s 'Exposure, Auto' 1, verify it
>> 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
>> ?  The video works correctly
> 
> That's weird. I'm wondering if the camera doesn't just reset all controls when 
> the video stream is started. What happens in the second case if you stop the 
> video stream and restart it ? Are exposure settings correct, or do they go 
> back to bad values ?

How about usbautosuspend? Will it store the settings if you disables
usbautosuspend?

Regards,
Alexey


From laurent.pinchart at ideasonboard.com  Mon Aug  1 13:27:33 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Mon, 1 Aug 2011 13:27:33 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
	Cam Socialize HD
In-Reply-To: <4E3643B7.6020707@gmx.net>
References: <1312030286-sup-231@midna.zekjur.net>
	<201107311828.27977.laurent.pinchart@ideasonboard.com>
	<4E3643B7.6020707@gmx.net>
Message-ID: <201108011327.34170.laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Monday 01 August 2011 08:12:07 Alexey Rempel wrote:
> Am 31.07.2011 18:28, schrieb Laurent Pinchart:
> > On Saturday 30 July 2011 15:08:14 Michael Stapelberg wrote:
> >> Hi,
> >> 
> >> I recently bought a Creative Live! Cam Socialize HD (ID 041e:4080) after
> >> verifying that it is a device supported by the uvcvideo driver.
> >> 
> >> The device basically works, but to get 30 fps (at 640x480, but also with
> >> higher resolutions), I need to set the 'Exposure, Auto' setting to 1
> >> (Manual Mode). Afterwards, I can set the 'Exposure (Absolute)' setting
> >> to one of the values 39, 78, 156, 312, 625, 1250, 2500, ?. All other
> >> values lead to a heavily over-exposed picture. This effect was already
> >> mentioned on this list for a different cam [1]. I wonder what we can do
> >> about it, as the step size for this setting is reported as '1' while in
> >> reality it seems logarithmic ? with the exception of the step 312 to
> >> 625.
> > 
> > Those values are 2500 / 64, 32, 16, 8, 4, 2 and 1. There's unfortunately
> > no way for the driver to know that other values will lead to bad
> > results. I've seen bad firmware bugs, but this one is high on the list.
> > 
> >> So, I can live with changing the configuration after plugging in the
> >> cam, which I would automate with udev.
> >> 
> >> However, I have noticed that I need to have an active video capture
> >> running, otherwise setting these values with uvcdynctrl has no effect. I
> >> tested it like this:
> >> 
> >> 1) Plug in the camera, wait until the white LED (which indicates
> >> capturing)
> >> 
> >>    goes off. This takes about 5 seconds.
> >> 
> >> 2) Use uvcdynctrl -s 'Exposure, Auto' 1
> >> 3) Verify the result with uvcdynctrl -g 'Exposure, Auto', which also
> >> returns 1 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
> >> 5) Use gst-launch v4l2src ! xvimagesink
> >> ?  The video is at 5 fps instead of 30 fps
> >> 
> >> If I do it like this, it works:
> >> 
> >> 1) Plug in the camera, wait until the white LED (which indicates
> >> capturing)
> >> 
> >>    goes off. This takes about 5 seconds.
> >> 
> >> 2) Use gst-launch v4l2src ! xvimagesink, leave it open
> >> 3) Use uvcdynctrl -s 'Exposure, Auto' 1, verify it
> >> 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
> >> ?  The video works correctly
> > 
> > That's weird. I'm wondering if the camera doesn't just reset all controls
> > when the video stream is started. What happens in the second case if you
> > stop the video stream and restart it ? Are exposure settings correct, or
> > do they go back to bad values ?
> 
> How about usb autosuspend? well be settings stored if usbautosupend is
> disabled, at least for the cam?

The uvcvideo restores controls at resume time, so this shouldn't be an issue.

-- 
Regards,

Laurent Pinchart


From michael+uvc at stapelberg.de  Mon Aug  1 23:53:41 2011
From: michael+uvc at stapelberg.de (Michael Stapelberg)
Date: Mon, 01 Aug 2011 23:53:41 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
	Cam Socialize HD
In-Reply-To: <201107311828.27977.laurent.pinchart@ideasonboard.com>
References: <1312030286-sup-231@midna.zekjur.net>
	<201107311828.27977.laurent.pinchart@ideasonboard.com>
Message-ID: <1312235408-sup-4435@midna.zekjur.net>

Hi Laurent,

Thanks for your reply.

Excerpts from Laurent Pinchart's message of 2011-07-31 18:28:27 +0200:
> Those values are 2500 / 64, 32, 16, 8, 4, 2 and 1. There's unfortunately no 
> way for the driver to know that other values will lead to bad results. I've 
> seen bad firmware bugs, but this one is high on the list.
Hm, ok. Maybe we could add a quirk for the specific models? But that won?t help
us with the 'step' value, because it?s not flexible enough for 2500/x, right?

> That's weird. I'm wondering if the camera doesn't just reset all controls when 
> the video stream is started. What happens in the second case if you stop the 
> video stream and restart it ? Are exposure settings correct, or do they go 
> back to bad values ?
When I stop the video stream and restart it, I can see about half a second of
the 'Exposure, Auto' == 3 capture, then it switches to my settings (without
auto exposure). If you want me too, I can make a video of this.

> Probably in the camera firmware. The device queries the camera for default and 
> current values, and I wouldn't be surprised if the camera reported a default 
> value that it doesn't use as a default.
So, I guess a quirk would be the way to go in this case? Are you interested in
patches for this issue?

> How do you mean ? On non-broken cameras you can just set the control to any 
> legal value and things will work :-)
Yes, but I expect to just plug in my camera and start a video chat in Pidgin.
Where do you usually configure your exposure settings? I mean, you don?t do it
by hand every time you plug in your camera, right?

Best regards,
Michael


From michael+uvc at stapelberg.de  Tue Aug  2 00:05:47 2011
From: michael+uvc at stapelberg.de (Michael Stapelberg)
Date: Tue, 02 Aug 2011 00:05:47 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
	Cam Socialize HD
In-Reply-To: <4E3644CA.3050306@fisher-privat.net>
References: <1312030286-sup-231@midna.zekjur.net>
	<201107311828.27977.laurent.pinchart@ideasonboard.com>
	<4E3644CA.3050306@fisher-privat.net>
Message-ID: <1312236197-sup-8561@midna.zekjur.net>

Hi Alexey,

Excerpts from Alexey Fisher's message of 2011-08-01 08:16:42 +0200:
> How about usbautosuspend? Will it store the settings if you disables
> usbautosuspend?
Good hint, but no. Disabling autosuspend does not help for this issue.

However, I found out that I do not have to let the video output running while
setting the parameters. So, the following works, too:

1) Plug in the webcam
2) Start video using gst-launch v4l2src ! xvimagesink
3) Stop video
4) uvcdynctrl -s 'Exposure, Auto' 1
5) uvcdynctrl -s 'Exposure (Absolute)' 625
6) All video from now on is correct

Best regards,
Michael


From laurent.pinchart at ideasonboard.com  Tue Aug  2 01:39:31 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 2 Aug 2011 01:39:31 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
	Cam Socialize HD
In-Reply-To: <1312236197-sup-8561@midna.zekjur.net>
References: <1312030286-sup-231@midna.zekjur.net>
	<4E3644CA.3050306@fisher-privat.net>
	<1312236197-sup-8561@midna.zekjur.net>
Message-ID: <201108020139.32256.laurent.pinchart@ideasonboard.com>

Hi Michael,

On Tuesday 02 August 2011 00:05:47 Michael Stapelberg wrote:
> Hi Alexey,
> 
> Excerpts from Alexey Fisher's message of 2011-08-01 08:16:42 +0200:
> > How about usbautosuspend? Will it store the settings if you disables
> > usbautosuspend?
> 
> Good hint, but no. Disabling autosuspend does not help for this issue.
> 
> However, I found out that I do not have to let the video output running
> while setting the parameters. So, the following works, too:
> 
> 1) Plug in the webcam
> 2) Start video using gst-launch v4l2src ! xvimagesink
> 3) Stop video
> 4) uvcdynctrl -s 'Exposure, Auto' 1
> 5) uvcdynctrl -s 'Exposure (Absolute)' 625
> 6) All video from now on is correct

Maybe the webcam just ignores all set control requests before the first 
stream-on ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Tue Aug  2 01:49:20 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 2 Aug 2011 01:49:20 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
	Cam Socialize HD
In-Reply-To: <1312235408-sup-4435@midna.zekjur.net>
References: <1312030286-sup-231@midna.zekjur.net>
	<201107311828.27977.laurent.pinchart@ideasonboard.com>
	<1312235408-sup-4435@midna.zekjur.net>
Message-ID: <201108020149.20779.laurent.pinchart@ideasonboard.com>

Hi Michael,

On Monday 01 August 2011 23:53:41 Michael Stapelberg wrote:
> Excerpts from Laurent Pinchart's message of 2011-07-31 18:28:27 +0200:
> > Those values are 2500 / 64, 32, 16, 8, 4, 2 and 1. There's unfortunately
> > no way for the driver to know that other values will lead to bad
> > results. I've seen bad firmware bugs, but this one is high on the list.
> 
> Hm, ok. Maybe we could add a quirk for the specific models? But that won?t
> help us with the 'step' value, because it?s not flexible enough for
> 2500/x, right?

You could still set step to 1, and fixup the value in the driver.

> > That's weird. I'm wondering if the camera doesn't just reset all controls
> > when the video stream is started. What happens in the second case if you
> > stop the video stream and restart it ? Are exposure settings correct, or
> > do they go back to bad values ?
> 
> When I stop the video stream and restart it, I can see about half a second
> of the 'Exposure, Auto' == 3 capture, then it switches to my settings
> (without auto exposure). If you want me too, I can make a video of this.

Some firmware developers should be banned from using a computer forever...

> > Probably in the camera firmware. The device queries the camera for
> > default and current values, and I wouldn't be surprised if the camera
> > reported a default value that it doesn't use as a default.
> 
> So, I guess a quirk would be the way to go in this case? Are you interested
> in patches for this issue?

A quirk could fix the manual exposure control values issue, but it won't fix 
the other problem(s) you got with that device.

> > How do you mean ? On non-broken cameras you can just set the control to
> > any legal value and things will work :-)
> 
> Yes, but I expect to just plug in my camera and start a video chat in
> Pidgin. Where do you usually configure your exposure settings? I mean, you
> don?t do it by hand every time you plug in your camera, right?

To be honest I don't use webcams for video conferencing much :-) When I do I 
just leave the default control values, that works pretty well on the webcams I 
use.

Maybe libv4l could help there. There has been some discussions about adding 
control save/restore features to the library. I don't know if that has been 
implemented.

-- 
Regards,

Laurent Pinchart


From michal at physics.ubc.ca  Tue Aug  2 07:29:47 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Mon, 1 Aug 2011 22:29:47 -0700 (PDT)
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
Message-ID: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>

Hi Laurent,

I understand there were changes made in the exposure settings 
in 3.0.  I just installed 3.0 and have some new/different issues here.

I have two cameras available: a quanta integrated webcam in a dell XPS 15 
and a logitech C910.

For either camera, guvcview used to give me a drop-down menu with 4 
exposure options in addition to an auto priority checkbox and a slider to 
manually set the exposure. Two of the drop-down settings didn't seem to 
work, but two of them did. With a 3.0 kernel, there is only an auto 
exposure check-box and manual exposure slider - but the exposure slider no 
longer works and guvcview says:
control id: 0x009a0902 failed to set (error -1) (for the quanta)
or
control id: 0x009a0902 failed to set (error -1) (for the logitech)

Carl








From max.lapshin at gmail.com  Tue Aug  2 12:12:44 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Tue, 2 Aug 2011 14:12:44 +0400
Subject: [Linux-uvc-devel] Logitech 910 working excelently
Message-ID: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>

I want to thank those who have created uvc project. It is working excelently.

I've took Logitech 910 camera and it made my day, because it give
picture better than IP H264 surveillance cameras, that costs 10 times
more.

Video is capturing excelently (1280x720 at 24) and audio also (via alsa).

Thank you again.


From gianluca.cecchi at gmail.com  Tue Aug  2 12:18:13 2011
From: gianluca.cecchi at gmail.com (Gianluca Cecchi)
Date: Tue, 2 Aug 2011 12:18:13 +0200
Subject: [Linux-uvc-devel] [OT] Re:  Logitech 910 working excelently
In-Reply-To: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>
References: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>
Message-ID: <CAG2kNCyGovK2U_=jEpoXiLqNZ9N6VhMNT0WeJ=PJS5pUHoikRQ@mail.gmail.com>

On Tue, Aug 2, 2011 at 12:12 PM, Max Lapshin <max.lapshin at gmail.com> wrote:
> I want to thank those who have created uvc project. It is working excelently.
>
> I've took Logitech 910 camera and it made my day, because it give
> picture better than IP H264 surveillance cameras, that costs 10 times
> more.
>
> Video is capturing excelently (1280x720 at 24) and audio also (via alsa).
>

btw (OT): what kind of sw do you use then to manage all the
"surveillance" related operations?
A custom one or any project you would suggest?

Thanks,
Gianluca


From max.lapshin at gmail.com  Tue Aug  2 12:30:06 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Tue, 2 Aug 2011 14:30:06 +0400
Subject: [Linux-uvc-devel] [OT] Re:  Logitech 910 working excelently
In-Reply-To: <CAG2kNCyGovK2U_=jEpoXiLqNZ9N6VhMNT0WeJ=PJS5pUHoikRQ@mail.gmail.com>
References: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>
	<CAG2kNCyGovK2U_=jEpoXiLqNZ9N6VhMNT0WeJ=PJS5pUHoikRQ@mail.gmail.com>
Message-ID: <CAMxVRxD4CeexOtSPWurHJ8MBqEO0_6py=_u-rpjkbZkNWV2=Yw@mail.gmail.com>

On Tue, Aug 2, 2011 at 2:18 PM, Gianluca Cecchi
<gianluca.cecchi at gmail.com> wrote:
>
> btw (OT): what kind of sw do you use then to manage all the
> "surveillance" related operations?
> A custom one or any project you would suggest?
>

I'm author of erlyvideo ( http://erlyvideo.org/ ) and will use these
cameras to stream video to my server.
So, it is not for surveillance, but for videostreaming.


From laurent.pinchart at ideasonboard.com  Tue Aug  2 16:02:24 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 2 Aug 2011 16:02:24 +0200
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
Message-ID: <201108021602.24839.laurent.pinchart@ideasonboard.com>

Hi Carl,

On Tuesday 02 August 2011 07:29:47 Carl Michal wrote:
> Hi Laurent,
> 
> I understand there were changes made in the exposure settings
> in 3.0.  I just installed 3.0 and have some new/different issues here.
> 
> I have two cameras available: a quanta integrated webcam in a dell XPS 15
> and a logitech C910.
> 
> For either camera, guvcview used to give me a drop-down menu with 4
> exposure options in addition to an auto priority checkbox and a slider to
> manually set the exposure. Two of the drop-down settings didn't seem to
> work, but two of them did. With a 3.0 kernel, there is only an auto
> exposure check-box and manual exposure slider - but the exposure slider no
> longer works and guvcview says:
> control id: 0x009a0902 failed to set (error -1) (for the quanta)
> or
> control id: 0x009a0902 failed to set (error -1) (for the logitech)

So pretty much the same error for both :-)

Could you try listing the controls with v4l2-ctl or yavta ? The auto-exposure 
control should still be a menu (I expect guvcview to convert it to a boolean 
control automatically for some reason, maybe because it has two values only), 
and if the values reported by the driver match the two values that worked 
before ?

yavta -l /dev/video0 reports

control 0x009a0901 `Exposure, Auto' min 0 max 3 step 1 default 3 current 3.
  1: Manual Mode
  3: Aperture Priority Mode

on my C905. Writing to the Exposure (Absolute) control when Exposure, Auto is 
set to 3 fails with EIO, and succeeds if Exposure, Auto is set to 1.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Tue Aug  2 16:03:43 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 2 Aug 2011 16:03:43 +0200
Subject: [Linux-uvc-devel] Logitech 910 working excelently
In-Reply-To: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>
References: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>
Message-ID: <201108021603.43462.laurent.pinchart@ideasonboard.com>

Hi Max,

On Tuesday 02 August 2011 12:12:44 Max Lapshin wrote:
> I want to thank those who have created uvc project. It is working
> excelently.
> 
> I've took Logitech 910 camera and it made my day, because it give
> picture better than IP H264 surveillance cameras, that costs 10 times
> more.
> 
> Video is capturing excelently (1280x720 at 24) and audio also (via alsa).
> 
> Thank you again.

You're welcome. I'm always happy to hear that the driver works fine for at 
least a couple of users :-)

-- 
Regards,

Laurent Pinchart


From pj.assis at gmail.com  Tue Aug  2 18:50:30 2011
From: pj.assis at gmail.com (Paulo Assis)
Date: Tue, 2 Aug 2011 17:50:30 +0100
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <201108021602.24839.laurent.pinchart@ideasonboard.com>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
	<201108021602.24839.laurent.pinchart@ideasonboard.com>
Message-ID: <CAPueXH781vTojTgccgihhBget108OD3TsqQa0eh3y0aS4uNedA@mail.gmail.com>

Hi,

2011/8/2 Laurent Pinchart <laurent.pinchart at ideasonboard.com>:
> Hi Carl,
>
> On Tuesday 02 August 2011 07:29:47 Carl Michal wrote:
>> Hi Laurent,
>>
>> I understand there were changes made in the exposure settings
>> in 3.0. ?I just installed 3.0 and have some new/different issues here.
>>
>> I have two cameras available: a quanta integrated webcam in a dell XPS 15
>> and a logitech C910.
>>
>> For either camera, guvcview used to give me a drop-down menu with 4
>> exposure options in addition to an auto priority checkbox and a slider to
>> manually set the exposure. Two of the drop-down settings didn't seem to
>> work, but two of them did. With a 3.0 kernel, there is only an auto
>> exposure check-box and manual exposure slider - but the exposure slider no
>> longer works and guvcview says:
>> control id: 0x009a0902 failed to set (error -1) (for the quanta)
>> or
>> control id: 0x009a0902 failed to set (error -1) (for the logitech)
>
> So pretty much the same error for both :-)
>
> Could you try listing the controls with v4l2-ctl or yavta ? The auto-exposure
> control should still be a menu (I expect guvcview to convert it to a boolean
> control automatically for some reason, maybe because it has two values only),

No, if a menu control is reported, then guvcview (1.4.5 at least)
displays a drop down box,
the only special cases are for some integer controls (pan/tilt and led
mode - logitech extension control).
Unless libv4l is doing some magic on this specific control, if a
checkbox is being displayed by guvcview then it means is being
reported as a boolean control.

Regards,
Paulo

> and if the values reported by the driver match the two values that worked
> before ?
>
> yavta -l /dev/video0 reports
>
> control 0x009a0901 `Exposure, Auto' min 0 max 3 step 1 default 3 current 3.
> ?1: Manual Mode
> ?3: Aperture Priority Mode
>
> on my C905. Writing to the Exposure (Absolute) control when Exposure, Auto is
> set to 3 fails with EIO, and succeeds if Exposure, Auto is set to 1.
>
> --
> Regards,
>
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>


From bug-track at fisher-privat.net  Tue Aug  2 18:54:41 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Tue, 02 Aug 2011 18:54:41 +0200
Subject: [Linux-uvc-devel] [OT] Re:  Logitech 910 working excelently
In-Reply-To: <CAMxVRxD4CeexOtSPWurHJ8MBqEO0_6py=_u-rpjkbZkNWV2=Yw@mail.gmail.com>
References: <CAMxVRxDJ91QutfoFkRQmZnUHj6W2EK+QMvUAdX+FYD5zfOXW8Q@mail.gmail.com>
	<CAG2kNCyGovK2U_=jEpoXiLqNZ9N6VhMNT0WeJ=PJS5pUHoikRQ@mail.gmail.com>
	<CAMxVRxD4CeexOtSPWurHJ8MBqEO0_6py=_u-rpjkbZkNWV2=Yw@mail.gmail.com>
Message-ID: <4E382BD1.7040001@fisher-privat.net>

Am 02.08.2011 12:30, schrieb Max Lapshin:
> On Tue, Aug 2, 2011 at 2:18 PM, Gianluca Cecchi
> <gianluca.cecchi at gmail.com> wrote:
>>
>> btw (OT): what kind of sw do you use then to manage all the
>> "surveillance" related operations?
>> A custom one or any project you would suggest?
>>
> 
> I'm author of erlyvideo ( http://erlyvideo.org/ ) and will use these
> cameras to stream video to my server.
> So, it is not for surveillance, but for videostreaming.

The probably it will interest you:
https://docs.google.com/document/pub?id=1d5LHu8v-f2LZVv7VxGPrKpL_ldUDiJNGwVxZjlvfqUk

I hope you can read this link. There is a small research about webcams.
May be you can add some thing to it.

Regards,
Alexey


From michal at physics.ubc.ca  Wed Aug  3 08:29:56 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Tue, 2 Aug 2011 23:29:56 -0700 (PDT)
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <201108021602.24839.laurent.pinchart@ideasonboard.com>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
	<201108021602.24839.laurent.pinchart@ideasonboard.com>
Message-ID: <alpine.LNX.2.00.1108022237150.7732@tristan>

Hi,

On Tue, 2 Aug 2011, Laurent Pinchart wrote:

> Hi Carl,
>
> On Tuesday 02 August 2011 07:29:47 Carl Michal wrote:
>> Hi Laurent,
>>
>> I understand there were changes made in the exposure settings
>> in 3.0.  I just installed 3.0 and have some new/different issues here.
>>
>> I have two cameras available: a quanta integrated webcam in a dell XPS 15
>> and a logitech C910.
>>
>> For either camera, guvcview used to give me a drop-down menu with 4
>> exposure options in addition to an auto priority checkbox and a slider to
>> manually set the exposure. Two of the drop-down settings didn't seem to
>> work, but two of them did. With a 3.0 kernel, there is only an auto
>> exposure check-box and manual exposure slider - but the exposure slider no
>> longer works and guvcview says:
>> control id: 0x009a0902 failed to set (error -1) (for the quanta)
>> or
>> control id: 0x009a0902 failed to set (error -1) (for the logitech)
>
> So pretty much the same error for both :-)

err - somehow they looked a little less identical when I went to paste 
the second one in.  Blame that on the new baby...

>
> Could you try listing the controls with v4l2-ctl or yavta ? The auto-exposure
> control should still be a menu (I expect guvcview to convert it to a boolean
> control automatically for some reason, maybe because it has two values only),
> and if the values reported by the driver match the two values that worked
> before ?
>

yavta -l for either camera lists three exposure controls (with different 
values for the min, max and default):

control 0x009a0901 `Exposure, Auto' min 0 max 3 step 1 default 3 current 3.
   1: Manual Mode
   3: Aperture Priority Mode
control 0x009a0902 `Exposure (Absolute)' min 3 max 2047 step 1 default 166 current 166.
control 0x009a0903 `Exposure, Auto Priority' min 0 max 1 step 1 default 0 current 0.

The two values reported for the 'Exposure, Auto' control are the two 
values in the drop down that worked before. But that control isn't drawn 
by guvcview at all now (tried guvcview: 1.4.2, 1.4.4 or 1.4.5).

Interesting though, luvcview (0.2.6) draws the first two of those controls 
(but not the third). So - I turned off the auto exposure in luvcview and now 
the manual exposure setting works.  But - now I can't turn auto exposure 
back on. luvcview says either:

Auto Exposure set to 1
or
Set Auto Exposure off error

It looks like luvcview wants to set values of either 0 or 1, when the 
legal values are 1 or 3.

with v4l2-ctl, I can set the Auto Exposure control to 1 or 3 and it seems 
to work correctly. So looks like the driver does the right thing but maybe 
both guvcview and luvcview are confused by the available values?

Carl




From laurent.pinchart at ideasonboard.com  Wed Aug  3 10:11:18 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 3 Aug 2011 10:11:18 +0200
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <alpine.LNX.2.00.1108022237150.7732@tristan>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
	<201108021602.24839.laurent.pinchart@ideasonboard.com>
	<alpine.LNX.2.00.1108022237150.7732@tristan>
Message-ID: <201108031011.18387.laurent.pinchart@ideasonboard.com>

Hi Carl,

On Wednesday 03 August 2011 08:29:56 Carl Michal wrote:
> On Tue, 2 Aug 2011, Laurent Pinchart wrote:
> > On Tuesday 02 August 2011 07:29:47 Carl Michal wrote:
> >> Hi Laurent,
> >> 
> >> I understand there were changes made in the exposure settings
> >> in 3.0.  I just installed 3.0 and have some new/different issues here.
> >> 
> >> I have two cameras available: a quanta integrated webcam in a dell XPS
> >> 15 and a logitech C910.
> >> 
> >> For either camera, guvcview used to give me a drop-down menu with 4
> >> exposure options in addition to an auto priority checkbox and a slider
> >> to manually set the exposure. Two of the drop-down settings didn't seem
> >> to work, but two of them did. With a 3.0 kernel, there is only an auto
> >> exposure check-box and manual exposure slider - but the exposure slider
> >> no longer works and guvcview says:
> >> control id: 0x009a0902 failed to set (error -1) (for the quanta)
> >> or
> >> control id: 0x009a0902 failed to set (error -1) (for the logitech)
> > 
> > So pretty much the same error for both :-)
> 
> err - somehow they looked a little less identical when I went to paste
> the second one in.  Blame that on the new baby...
> 
> > Could you try listing the controls with v4l2-ctl or yavta ? The
> > auto-exposure control should still be a menu (I expect guvcview to
> > convert it to a boolean control automatically for some reason, maybe
> > because it has two values only), and if the values reported by the
> > driver match the two values that worked before ?
> 
> yavta -l for either camera lists three exposure controls (with different
> values for the min, max and default):
> 
> control 0x009a0901 `Exposure, Auto' min 0 max 3 step 1 default 3 current 3.
>    1: Manual Mode
>    3: Aperture Priority Mode
> control 0x009a0902 `Exposure (Absolute)' min 3 max 2047 step 1 default 166
> current 166. control 0x009a0903 `Exposure, Auto Priority' min 0 max 1 step
> 1 default 0 current 0.
> 
> The two values reported for the 'Exposure, Auto' control are the two
> values in the drop down that worked before. But that control isn't drawn
> by guvcview at all now (tried guvcview: 1.4.2, 1.4.4 or 1.4.5).
> 
> Interesting though, luvcview (0.2.6) draws the first two of those controls
> (but not the third). So - I turned off the auto exposure in luvcview and
> now the manual exposure setting works.  But - now I can't turn auto
> exposure back on. luvcview says either:
> 
> Auto Exposure set to 1
> or
> Set Auto Exposure off error
> 
> It looks like luvcview wants to set values of either 0 or 1, when the
> legal values are 1 or 3.
> 
> with v4l2-ctl, I can set the Auto Exposure control to 1 or 3 and it seems
> to work correctly. So looks like the driver does the right thing but maybe
> both guvcview and luvcview are confused by the available values?

That's quite likely. Do you want to have a try at fixing them ? :-)

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug  3 11:08:43 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 3 Aug 2011 11:08:43 +0200
Subject: [Linux-uvc-devel] luvcview and Cheese on SLC6
In-Reply-To: <4E381091.3080005@cern.ch>
References: <4E381091.3080005@cern.ch>
Message-ID: <201108031108.45725.laurent.pinchart@ideasonboard.com>

Hi Dusan,

On Tuesday 02 August 2011 16:58:25 bruncko wrote:
> Hello,
> 
> I have SLC6,
> uname -ra
> Linux acer-ntbk 2.6.32-131.6.1.el6.x86_64 #1 SMP Tue Jul 12 17:14:50 CDT
> 2011 x86_64 x86_64 x86_64 GNU/Linux
> 
> My problem is following:  I can run luvciew or Cheese, all going well,
> but I see the picture flip over 180 degree.
> 
> Can you help me?

Flipping the image is handled by libv4l in userspace. Is the image correct if 
you use a libv4l-aware application (or LD_PRELOAD libv4lconvert into luvcview 
or Cheese) ?

-- 
Regards,

Laurent Pinchart


From pj.assis at gmail.com  Wed Aug  3 12:57:21 2011
From: pj.assis at gmail.com (Paulo Assis)
Date: Wed, 3 Aug 2011 11:57:21 +0100
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <201108031011.18387.laurent.pinchart@ideasonboard.com>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
	<201108021602.24839.laurent.pinchart@ideasonboard.com>
	<alpine.LNX.2.00.1108022237150.7732@tristan>
	<201108031011.18387.laurent.pinchart@ideasonboard.com>
Message-ID: <CAPueXH7NBcHsOSp28GVgR9uiMCycxpGWwM5EM4275r79v2ynJw@mail.gmail.com>

Hi,
guvcview had a little problem when handling menu control indexes, it
was using the combo box index instead of the real control menu index.
This should be fixed in svn (svn://svn.berlios.de/guvcview/trunk) if
you care to test it.

This worked fine for sequential menu indexes, but this specific case
revealed the bug.

In any case I can't see how it turned a menu combo into a check box,
It just hasn't that type of code.

Regards,
Paulo

2011/8/3 Laurent Pinchart <laurent.pinchart at ideasonboard.com>:
> Hi Carl,
>
> On Wednesday 03 August 2011 08:29:56 Carl Michal wrote:
>> On Tue, 2 Aug 2011, Laurent Pinchart wrote:
>> > On Tuesday 02 August 2011 07:29:47 Carl Michal wrote:
>> >> Hi Laurent,
>> >>
>> >> I understand there were changes made in the exposure settings
>> >> in 3.0. ?I just installed 3.0 and have some new/different issues here.
>> >>
>> >> I have two cameras available: a quanta integrated webcam in a dell XPS
>> >> 15 and a logitech C910.
>> >>
>> >> For either camera, guvcview used to give me a drop-down menu with 4
>> >> exposure options in addition to an auto priority checkbox and a slider
>> >> to manually set the exposure. Two of the drop-down settings didn't seem
>> >> to work, but two of them did. With a 3.0 kernel, there is only an auto
>> >> exposure check-box and manual exposure slider - but the exposure slider
>> >> no longer works and guvcview says:
>> >> control id: 0x009a0902 failed to set (error -1) (for the quanta)
>> >> or
>> >> control id: 0x009a0902 failed to set (error -1) (for the logitech)
>> >
>> > So pretty much the same error for both :-)
>>
>> err - somehow they looked a little less identical when I went to paste
>> the second one in. ?Blame that on the new baby...
>>
>> > Could you try listing the controls with v4l2-ctl or yavta ? The
>> > auto-exposure control should still be a menu (I expect guvcview to
>> > convert it to a boolean control automatically for some reason, maybe
>> > because it has two values only), and if the values reported by the
>> > driver match the two values that worked before ?
>>
>> yavta -l for either camera lists three exposure controls (with different
>> values for the min, max and default):
>>
>> control 0x009a0901 `Exposure, Auto' min 0 max 3 step 1 default 3 current 3.
>> ? ?1: Manual Mode
>> ? ?3: Aperture Priority Mode
>> control 0x009a0902 `Exposure (Absolute)' min 3 max 2047 step 1 default 166
>> current 166. control 0x009a0903 `Exposure, Auto Priority' min 0 max 1 step
>> 1 default 0 current 0.
>>
>> The two values reported for the 'Exposure, Auto' control are the two
>> values in the drop down that worked before. But that control isn't drawn
>> by guvcview at all now (tried guvcview: 1.4.2, 1.4.4 or 1.4.5).
>>
>> Interesting though, luvcview (0.2.6) draws the first two of those controls
>> (but not the third). So - I turned off the auto exposure in luvcview and
>> now the manual exposure setting works. ?But - now I can't turn auto
>> exposure back on. luvcview says either:
>>
>> Auto Exposure set to 1
>> or
>> Set Auto Exposure off error
>>
>> It looks like luvcview wants to set values of either 0 or 1, when the
>> legal values are 1 or 3.
>>
>> with v4l2-ctl, I can set the Auto Exposure control to 1 or 3 and it seems
>> to work correctly. So looks like the driver does the right thing but maybe
>> both guvcview and luvcview are confused by the available values?
>
> That's quite likely. Do you want to have a try at fixing them ? :-)
>
> --
> Regards,
>
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>


From pj.assis at gmail.com  Wed Aug  3 17:20:03 2011
From: pj.assis at gmail.com (Paulo Assis)
Date: Wed, 3 Aug 2011 16:20:03 +0100
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <CAPueXH7NBcHsOSp28GVgR9uiMCycxpGWwM5EM4275r79v2ynJw@mail.gmail.com>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
	<201108021602.24839.laurent.pinchart@ideasonboard.com>
	<alpine.LNX.2.00.1108022237150.7732@tristan>
	<201108031011.18387.laurent.pinchart@ideasonboard.com>
	<CAPueXH7NBcHsOSp28GVgR9uiMCycxpGWwM5EM4275r79v2ynJw@mail.gmail.com>
Message-ID: <CAPueXH6jF_BZ_ibk-wgypNEyM5x1Q7=gA38qgfwNWEKgT190iQ@mail.gmail.com>

OK, I've just test it under 3.0 and it seems to be working fine now.
The way menu entries were listed was causing it to misbehave, when
querying for the menu items if one happened to fail then the loop
would break, not listing the remaining entries. Now we just continue
until the last index (maximum value).

Regards,
Paulo

2011/8/3 Paulo Assis <pj.assis at gmail.com>:
> Hi,
> guvcview had a little problem when handling menu control indexes, it
> was using the combo box index instead of the real control menu index.
> This should be fixed in svn (svn://svn.berlios.de/guvcview/trunk) if
> you care to test it.
>
> This worked fine for sequential menu indexes, but this specific case
> revealed the bug.
>
> In any case I can't see how it turned a menu combo into a check box,
> It just hasn't that type of code.
>
> Regards,
> Paulo
>
> 2011/8/3 Laurent Pinchart <laurent.pinchart at ideasonboard.com>:
>> Hi Carl,
>>
>> On Wednesday 03 August 2011 08:29:56 Carl Michal wrote:
>>> On Tue, 2 Aug 2011, Laurent Pinchart wrote:
>>> > On Tuesday 02 August 2011 07:29:47 Carl Michal wrote:
>>> >> Hi Laurent,
>>> >>
>>> >> I understand there were changes made in the exposure settings
>>> >> in 3.0. ?I just installed 3.0 and have some new/different issues here.
>>> >>
>>> >> I have two cameras available: a quanta integrated webcam in a dell XPS
>>> >> 15 and a logitech C910.
>>> >>
>>> >> For either camera, guvcview used to give me a drop-down menu with 4
>>> >> exposure options in addition to an auto priority checkbox and a slider
>>> >> to manually set the exposure. Two of the drop-down settings didn't seem
>>> >> to work, but two of them did. With a 3.0 kernel, there is only an auto
>>> >> exposure check-box and manual exposure slider - but the exposure slider
>>> >> no longer works and guvcview says:
>>> >> control id: 0x009a0902 failed to set (error -1) (for the quanta)
>>> >> or
>>> >> control id: 0x009a0902 failed to set (error -1) (for the logitech)
>>> >
>>> > So pretty much the same error for both :-)
>>>
>>> err - somehow they looked a little less identical when I went to paste
>>> the second one in. ?Blame that on the new baby...
>>>
>>> > Could you try listing the controls with v4l2-ctl or yavta ? The
>>> > auto-exposure control should still be a menu (I expect guvcview to
>>> > convert it to a boolean control automatically for some reason, maybe
>>> > because it has two values only), and if the values reported by the
>>> > driver match the two values that worked before ?
>>>
>>> yavta -l for either camera lists three exposure controls (with different
>>> values for the min, max and default):
>>>
>>> control 0x009a0901 `Exposure, Auto' min 0 max 3 step 1 default 3 current 3.
>>> ? ?1: Manual Mode
>>> ? ?3: Aperture Priority Mode
>>> control 0x009a0902 `Exposure (Absolute)' min 3 max 2047 step 1 default 166
>>> current 166. control 0x009a0903 `Exposure, Auto Priority' min 0 max 1 step
>>> 1 default 0 current 0.
>>>
>>> The two values reported for the 'Exposure, Auto' control are the two
>>> values in the drop down that worked before. But that control isn't drawn
>>> by guvcview at all now (tried guvcview: 1.4.2, 1.4.4 or 1.4.5).
>>>
>>> Interesting though, luvcview (0.2.6) draws the first two of those controls
>>> (but not the third). So - I turned off the auto exposure in luvcview and
>>> now the manual exposure setting works. ?But - now I can't turn auto
>>> exposure back on. luvcview says either:
>>>
>>> Auto Exposure set to 1
>>> or
>>> Set Auto Exposure off error
>>>
>>> It looks like luvcview wants to set values of either 0 or 1, when the
>>> legal values are 1 or 3.
>>>
>>> with v4l2-ctl, I can set the Auto Exposure control to 1 or 3 and it seems
>>> to work correctly. So looks like the driver does the right thing but maybe
>>> both guvcview and luvcview are confused by the available values?
>>
>> That's quite likely. Do you want to have a try at fixing them ? :-)
>>
>> --
>> Regards,
>>
>> Laurent Pinchart
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>
>


From lambchop468 at gmail.com  Wed Aug  3 23:13:01 2011
From: lambchop468 at gmail.com (Alexander Lam)
Date: Wed, 3 Aug 2011 17:13:01 -0400
Subject: [Linux-uvc-devel] User Pointer Streaming Patch / ARM jpeg corruption
Message-ID: <CACWwPivREwp5NowOVOESSchmgZUzCUUp5tHCBC-CZHXzF9KyAQ@mail.gmail.com>

Hi all,

I'm getting the same issues with JPEG corruption as in (
http://lists.berlios.de/pipermail/linux-uvc-devel/2010-July/005835.html).

I don't know if using user pointer streaming would fix it, but if it would
(or if it is worth a try), can someone point me to the patch mentioned here
(http://lists.berlios.de/pipermail/linux-uvc-devel/2010-May/005756.html)


Thanks,

-- 
Alexander Lam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110803/e66f6313/attachment.html>

From michal at physics.ubc.ca  Thu Aug  4 08:24:50 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Wed, 3 Aug 2011 23:24:50 -0700 (PDT)
Subject: [Linux-uvc-devel] 3.0 - exposure settings.
In-Reply-To: <201108031011.18387.laurent.pinchart@ideasonboard.com>
References: <alpine.LNX.2.00.1108012213290.21433@spider.phas.ubc.ca>
	<201108021602.24839.laurent.pinchart@ideasonboard.com>
	<alpine.LNX.2.00.1108022237150.7732@tristan>
	<201108031011.18387.laurent.pinchart@ideasonboard.com>
Message-ID: <alpine.LNX.2.00.1108032320340.21211@tristan>

On Wed, 3 Aug 2011, Laurent Pinchart wrote:

>> exposure back on. luvcview says either:
>>
>> Auto Exposure set to 1
>> or
>> Set Auto Exposure off error
>>
>> It looks like luvcview wants to set values of either 0 or 1, when the
>> legal values are 1 or 3.
>>
>> with v4l2-ctl, I can set the Auto Exposure control to 1 or 3 and it seems
>> to work correctly. So looks like the driver does the right thing but maybe
>> both guvcview and luvcview are confused by the available values?
>
> That's quite likely. Do you want to have a try at fixing them ? :-)

It sounds like Paulo has already dealt with guvcview.  luvcview looks to 
be fairly trivial to "fix." The values are hardcoded - they were actually 
1 and 8 in the source - which probably didn't work for my cameras before, 
but changing them to 3 and 1 makes it work for me.  Not the most elegant 
solution, but there you go...

Carl



--- luvcview.c~	2011-08-03 23:17:17.362307573 -0700
+++ luvcview.c	2011-08-03 23:18:35.870305604 -0700
@@ -829,7 +829,7 @@
  					break;
  				case A_EXPOSURE_ON:
  					control.id    =V4L2_CID_EXPOSURE_AUTO;
-					control.value =1;
+					control.value =3;
  					if ((value = ioctl(videoIn->fd, VIDIOC_S_CTRL, &control)) < 0)
  						printf("Set Auto Exposure on error\n");
  					else
@@ -837,7 +837,7 @@
  					break;
  				case A_EXPOSURE_OFF:
  					control.id    =V4L2_CID_EXPOSURE_AUTO;
-					control.value =8;
+					control.value =1;
  					if ((value = ioctl(videoIn->fd, VIDIOC_S_CTRL, &control)) < 0)
  						printf("Set Auto Exposure off error\n");
  					else




From laurent.pinchart at ideasonboard.com  Thu Aug  4 13:02:58 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 4 Aug 2011 13:02:58 +0200
Subject: [Linux-uvc-devel] luvcview and Cheese on SLC6
In-Reply-To: <4E3A7A72.9030500@cern.ch>
References: <4E381091.3080005@cern.ch>
	<201108031108.45725.laurent.pinchart@ideasonboard.com>
	<4E3A7A72.9030500@cern.ch>
Message-ID: <201108041302.58896.laurent.pinchart@ideasonboard.com>

Hi Dusan,

On Thursday 04 August 2011 12:54:42 Dusan Bruncko wrote:
> Dear Laurent,
> 
> no, unfortnately no....
> I did try e.g. following command:
> 
> bash -c 'LD_PRELOAD=/usr/lib64/libv4lconvert.so.0 /usr/bin/cheese'
> 
> or
> 
> bash -c 'LD_PRELOAD=/usr/lib64/libv4lconvert.so.0 luvcview -f yuv'
> 
> but any effect....

Could you please send me the lsusb -v output for your camera, as well as the 
dmidecode output ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Aug  4 13:16:31 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 4 Aug 2011 13:16:31 +0200
Subject: [Linux-uvc-devel] luvcview and Cheese on SLC6
In-Reply-To: <4E3A7F31.3040108@cern.ch>
References: <4E381091.3080005@cern.ch>
	<201108041302.58896.laurent.pinchart@ideasonboard.com>
	<4E3A7F31.3040108@cern.ch>
Message-ID: <201108041316.32244.laurent.pinchart@ideasonboard.com>

Hi Dusan,

On Thursday 04 August 2011 13:14:57 Dusan Bruncko wrote:
> Dear Laurent,
> 
> my camera:  USB2.0 UVC 2M WebCam
> 
> and please look attachment.

Thanks, but I've asked for lsusb -v (run as root if possible), not lspci :-)

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Aug  4 13:50:43 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 4 Aug 2011 13:50:43 +0200
Subject: [Linux-uvc-devel] luvcview and Cheese on SLC6
In-Reply-To: <4E3A8136.7010901@cern.ch>
References: <4E381091.3080005@cern.ch>
	<201108041316.32244.laurent.pinchart@ideasonboard.com>
	<4E3A8136.7010901@cern.ch>
Message-ID: <201108041350.43666.laurent.pinchart@ideasonboard.com>

Hi Dunsan,

On Thursday 04 August 2011 13:23:34 Dusan Bruncko wrote:
> Sorry,
> 
> lsusb output is in attachment.

Thanks. I've forwarded the information to the libv4l author. The next version 
should support your webcam.

-- 
Regards,

Laurent Pinchart


From narukajsingh at gmail.com  Fri Aug  5 07:14:01 2011
From: narukajsingh at gmail.com (JITENDRA SINGH)
Date: Fri, 5 Aug 2011 10:44:01 +0530
Subject: [Linux-uvc-devel] uvc webcam does not support 640*480 on arm9
	board
In-Reply-To: <201107311810.59424.laurent.pinchart@ideasonboard.com>
References: <BANLkTikHsNjPdgB0L=W+Y-mOd_czdUd0KA@mail.gmail.com>
	<201107311810.59424.laurent.pinchart@ideasonboard.com>
Message-ID: <CAM1ai8p1AeAf2QR6-MrObWSRwfjPhn2yo3CAO3om0dj8VOv5Wg@mail.gmail.com>

Hey thanks Laurent..so far I am good with capturing 320x240... will try ur
suggestion of upgrading the kernel... I was using  technologic's 7255
board....

On Sun, Jul 31, 2011 at 9:40 PM, Laurent Pinchart <
laurent.pinchart at ideasonboard.com> wrote:

> Hi,
>
> On Wednesday 08 June 2011 14:31:59 JITENDRA SINGH wrote:
> > Hi all,
> >
> > I am able to "uvccapture" 320*240 jpgs using this webcam on arm9 board,
> but
> > it fails when I try to capture 640*480 stills, it hangs while trying to
> > exit:
>
> [snip]
>
> > dmesg error when uvccapture didnt work:
> > [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
> > [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
> > [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
> > [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
>
> 45 is EL2NSYNC. A quick grep in drivers/usb shows only one driver returning
> that error code, and that's for a gadget device, not a host controller.
>
> I suspect an issue in your board's USB host controller driver. What ARM9
> SoC
> are you using ? Can you try upgrading it to a more recent kernel ?
>
> --
> Regards,
>
> Laurent Pinchart
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110805/6c752c9a/attachment.html>

From harsh at datawaysolution.com  Fri Aug  5 14:43:50 2011
From: harsh at datawaysolution.com (Harsh Chauhan)
Date: Fri, 5 Aug 2011 08:43:50 -0400
Subject: [Linux-uvc-devel] LUVCVIEW : Segmentation fault on arm board
Message-ID: <CAPgz_b15aAo6j3XpPtascY-iFjk7-at1JKzO6O+EFfANvVmdWA@mail.gmail.com>

Hi

I have cross compiled luvcview application for arm based board (DM3730) . I
am using an USB plug and play camera which is getting detected correctly on
board .
But when I run luvcview it is showing segmentation fault.
Following is the log :
*./luvcview -d /dev/video9 -f yuv -s 320x240*
*uvcview verion 0.1.4 *
*Video driver: fbcon*
*Hardware surfaces are available (600K video memory)*
*video /dev/video9*
*Segmentation fault*

Is resolution can be a problem because i have already tried 640x480 and
160x120 .  Please help me  to solve this issue.

Thanks
Harsh

-- 
*
Thanks & Regards

Harsh Chauhan*
Dataway Solution <http://www.datawaysolution.com> | Software Engineer | R &
D
"BR ARCADE", 1st Floor, No. 2C-324, 2nd Cross, OMBR Layout, OPP-CMR Law
College Bangalore - 560 043, INDIA
(O) +91 - 80 - 25452733 (M) +91 ? 96 863 32095 (F) +91 - 80 - 25454496
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110805/dd1f4f96/attachment.html>

From laurent.pinchart at ideasonboard.com  Mon Aug  8 12:26:40 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Mon, 8 Aug 2011 12:26:40 +0200
Subject: [Linux-uvc-devel] [uvc] Can I have your UserPointer streaming
	patch
In-Reply-To: <CACWwPiu5qMCo0uJHwMjg7yi-YoNzsvm97F5vwicc3-RoD0pZjg@mail.gmail.com>
References: <CACWwPiu5qMCo0uJHwMjg7yi-YoNzsvm97F5vwicc3-RoD0pZjg@mail.gmail.com>
Message-ID: <201108081226.41316.laurent.pinchart@ideasonboard.com>

Hi Alexander,

On Friday 05 August 2011 18:54:19 Alexander Lam wrote:
> Hi,
> 
> If you could, can you please send me the patch mentioned in this
> linux-uvc-devel discssion:
> http://lists.berlios.de/pipermail/linux-uvc-devel/2010-May/005756.html
> 
> You don't need to update it to the latest kernel, I can handle that.
> 
> (I am attempting to fix a uvc-on-arm corruption issue)

Here's the latest version, already rebased on top of v3.0. I haven't tested it 
for that kernel though.

I've CCed the linux-uvc-devel list as this can be of interest to other people.

-- 
Regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-uvcvideo-Add-user-pointer-streaming-mode.patch
Type: text/x-patch
Size: 14261 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110808/dbaf7767/attachment.bin>

From bug-track at fisher-privat.net  Tue Aug  9 12:44:51 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Tue, 09 Aug 2011 12:44:51 +0200
Subject: [Linux-uvc-devel] error proofing mjpeg stream
Message-ID: <4E410FA3.70304@fisher-privat.net>

Hall all, Laurent, Carl,

i just was looking on how my webcam do mjpeg stream and created some 
"visualisation" patch. I got some interesting results (may be it can 
help you Carl with your webcam).

The idea is as fallow, use jpeg bits for error corection. According to 
uvc documentation, webcam should set SOI (start of image) and EOI (end 
of image) magic. In some situations it is possible to use it if FID is 
brocken.

I got fallowing result (N - mean header is ok, but no data is present; 
!SOI - mean new SOI without EOI; * - image data):

[ 5132.744070] [FID 19]NNNNNNNNNNNNNNN
[SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**N![SOI]NNNNNN**NNNNNN***NNNNNN**NNNNNN****NNNNN***NNNNNN***N![SOI]NNNN***NNNNNN***NNNNN***NNNNNN***NNNNN*****NNNN****NN![SOI]NNN****NNNN***NNNNNN***NNNNN****NNNNN***NNNNNN***NNNNN![SOI]**NNNNNNN**NNNNNN***NNNNNN**NNNNNNN*[EOI]
[ 5132.812069] N
[ 5132.812072] [FID 20]NNNNNNNNNNNNNNN
[SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**N![SOI]NNNNNN**NNNNNN***NNNNNN**NNNNNN****NNNNN***NNNNNN***N![SOI]NNNN****NNNNN***NNNNN***NNNNNN***NNNNNN****NNNN****NN![SOI]NNN****NNNN***NNNNNN***NNNNN****NNNNN***NNNNNN***NNNNN![SOI]**NNNNNNN**NNNNNN***NNNNNN**NNNNNNN*[EOI]
[ 5132.876082] N
[ 5132.876085] [FID 21]NNNNNNNNNNNNNNN
[SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**N![SOI]NNNNNN**NNNNNN***NNNNNN**NNNNNN****NNNNN***NNNNNN***N![SOI]NNNN***NNNNNN***NNNNN***NNNNNN***NNNNNN****NNNN****NN![SOI]NNN****NNNN***NNNNNN***NNNNNN***NNNNN***NNNNNN***NNNNN![SOI]***NNNNNN**NNNNNN***NNNNNN**NNNNNNN*[EOI]
[ 5132.944079] N


As you can see, my webcam try to resent SOI lots of times and only last 
try is correct. For next example i added logic to send ENODATA on each 
packet with correct header but no data. Here is the result:


[ 6080.694075] [FID 17]
[SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNNN**NNNNNN**NNNNNNN*
*NNNNNN***NNNNNN**NNNNNNN***NNNNN***NNNNNN***NNNNN****NNNNN***
NNNNN***NNNNNN****NNNNN****NNNN****NNNNN****NNNN****NNNNN***NNNNNN***
NNNNN***NNNNNN***NNNNN***NNNNNN**NNNNNNN**NNNNNN**NNNNNNN*[EOI]
[ 6080.726076] 
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
[ 6080.762070] [FID 18]
[SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**
NNNNNN***NNNNNN**NNNNNNN***NNNNN***NNNNNN***NNNNN****NNNNN***
NNNNN****NNNNN****NNNNN****NNNN****NNNNN****NNNN****NNNNN***NNNNNN***
NNNNN***NNNNNN***NNNNN***NNNNNN**NNNNNNN**NNNNNN**NNNNNNN*[EOI]
[ 6080.790084] 
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
[ 6080.826075] [FID 19]
[SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**
NNNNNN***NNNNNN**NNNNNNN***NNNNN***NNNNNN***NNNNN****NNNNN***NNNNNN
***NNNNN****NNNNN****NNNN****NNNNN****NNNN****NNNNN***NNNNNN***NNNNN
***NNNNNN***NNNNN***NNNNNN**NNNNNNN**NNNNNN**NNNNNNN*[EOI]


Now the stream seems to be less erroneous. I wonder if we actually 
should do it all the time, i mean send -ENODATA on empty packets.

Regards,
Alexey
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tmp.diff
Type: text/x-patch
Size: 2295 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110809/b6333fd7/attachment.bin>

From lambchop468 at gmail.com  Wed Aug 10 05:27:23 2011
From: lambchop468 at gmail.com (Alexander Lam)
Date: Tue, 9 Aug 2011 23:27:23 -0400
Subject: [Linux-uvc-devel] [uvc] Can I have your UserPointer streaming
	patch
In-Reply-To: <201108081226.41316.laurent.pinchart@ideasonboard.com>
References: <CACWwPiu5qMCo0uJHwMjg7yi-YoNzsvm97F5vwicc3-RoD0pZjg@mail.gmail.com>
	<201108081226.41316.laurent.pinchart@ideasonboard.com>
Message-ID: <CACWwPismAPFBMbeLoSu4bOcS9rcaVPWy7QR4VTN14fAcCQ7deA@mail.gmail.com>

Hi Laurent,

Thanks a lot for the patch. FYI, I can confirm it works (after light
testing) on 2.6.39.3 (applied without modifications).

On Mon, Aug 8, 2011 at 6:26 AM, Laurent Pinchart <
laurent.pinchart at ideasonboard.com> wrote:

> Hi Alexander,
>
> On Friday 05 August 2011 18:54:19 Alexander Lam wrote:
> > Hi,
> >
> > If you could, can you please send me the patch mentioned in this
> > linux-uvc-devel discssion:
> > http://lists.berlios.de/pipermail/linux-uvc-devel/2010-May/005756.html
> >
> > You don't need to update it to the latest kernel, I can handle that.
> >
> > (I am attempting to fix a uvc-on-arm corruption issue)
>
> Here's the latest version, already rebased on top of v3.0. I haven't tested
> it
> for that kernel though.
>
> I've CCed the linux-uvc-devel list as this can be of interest to other
> people.
>
> --
> Regards,
>
> Laurent Pinchart
>



-- 
Alexander Lam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110809/7f9b22c2/attachment.html>

From rafael.piazenski at gmail.com  Wed Aug 10 15:11:22 2011
From: rafael.piazenski at gmail.com (Rafael Piazenski)
Date: Wed, 10 Aug 2011 10:11:22 -0300
Subject: [Linux-uvc-devel] Microdia Sonix id 0c45:6310
Message-ID: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>

Hello people!
First of all, thanks for your help!
I have this webcam on my ubuntu 11.04 in a HP TX2500 (2540br).
My webcam is recognized, but there is no /dev/video0 for it.
Can you help me solve this issue?
Thanks a lot!
Rafael Piazenski

Bus 002 Device 004: ID 0c45:6310 Microdia Sonix USB 2.0 Camera

lsusb -d 0c45:6310 -v | grep "14 Video"
can't get device qualifier: Operation not permitted
can't get debug descriptor: Operation not permitted
cannot read device status, Operation not permitted (1)
      bFunctionClass         14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video
      bInterfaceClass        14 Video



From bug-track at fisher-privat.net  Wed Aug 10 15:27:24 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 10 Aug 2011 15:27:24 +0200
Subject: [Linux-uvc-devel] Microdia Sonix id 0c45:6310
In-Reply-To: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>
References: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>
Message-ID: <4E42873C.80706@fisher-privat.net>

On 10.08.2011 15:11, Rafael Piazenski wrote:
> Hello people!
> First of all, thanks for your help!
> I have this webcam on my ubuntu 11.04 in a HP TX2500 (2540br).
> My webcam is recognized, but there is no /dev/video0 for it.
> Can you help me solve this issue?
> Thanks a lot!
> Rafael Piazenski
> 
> Bus 002 Device 004: ID 0c45:6310 Microdia Sonix USB 2.0 Camera
> 
> lsusb -d 0c45:6310 -v | grep "14 Video"
> can't get device qualifier: Operation not permitted
> can't get debug descriptor: Operation not permitted
> cannot read device status, Operation not permitted (1)
>       bFunctionClass         14 Video

Please attach complete lsusb output.
Use: sudo lsusb -vd 0c45:6310 > lsusb

Then reload uvc module with debug options:
sudo rmmod uvcvideo && sudo modpprobe uvcvideo trace=0xfff

play some thing, for example:
gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink

this will capture only 3 frames. And after this attach dmesg output as well.

Regards,
	Alexey


From michal at physics.ubc.ca  Wed Aug 10 19:20:49 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Wed, 10 Aug 2011 10:20:49 -0700 (PDT)
Subject: [Linux-uvc-devel] error proofing mjpeg stream
In-Reply-To: <4E410FA3.70304@fisher-privat.net>
References: <4E410FA3.70304@fisher-privat.net>
Message-ID: <alpine.LNX.2.00.1108100949570.27345@spider.phas.ubc.ca>

Hi Alexey,


On Tue, 9 Aug 2011, Alexey Fisher wrote:

> Hall all, Laurent, Carl,
>
> i just was looking on how my webcam do mjpeg stream and created some 
> "visualisation" patch. I got some interesting results (may be it can help you 
> Carl with your webcam).
>
> The idea is as fallow, use jpeg bits for error corection. According to uvc 
> documentation, webcam should set SOI (start of image) and EOI (end of image) 
> magic. In some situations it is possible to use it if FID is brocken.
>
> I got fallowing result (N - mean header is ok, but no data is present; !SOI - 
> mean new SOI without EOI; * - image data):
>
> [ 5132.744070] [FID 19]NNNNNNNNNNNNNNN
> [SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**N![SOI]NNNNNN**NNNNNN***NNNNNN**NNNNNN****NNNNN***NNNNNN***N![SOI]NNNN***NNNNNN***NNNNN***NNNNNN***NNNNN*****NNNN****NN![SOI]NNN****NNNN***NNNNNN***NNNNN****NNNNN***NNNNNN***NNNNN![SOI]**NNNNNNN**NNNNNN***NNNNNN**NNNNNNN*[EOI]
> [ 5132.812069] N
> [ 5132.812072] [FID 20]NNNNNNNNNNNNNNN
> [SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**N![SOI]NNNNNN**NNNNNN***NNNNNN**NNNNNN****NNNNN***NNNNNN***N![SOI]NNNN****NNNNN***NNNNN***NNNNNN***NNNNNN****NNNN****NN![SOI]NNN****NNNN***NNNNNN***NNNNN****NNNNN***NNNNNN***NNNNN![SOI]**NNNNNNN**NNNNNN***NNNNNN**NNNNNNN*[EOI]
> [ 5132.876082] N
> [ 5132.876085] [FID 21]NNNNNNNNNNNNNNN
> [SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN![SOI]**NNNNNN**NNNNNNN*NNNNNNN**NNNNNNN**NNNNNN***NNNNNN**N![SOI]NNNNNN**NNNNNN***NNNNNN**NNNNNN****NNNNN***NNNNNN***N![SOI]NNNN***NNNNNN***NNNNN***NNNNNN***NNNNNN****NNNN****NN![SOI]NNN****NNNN***NNNNNN***NNNNNN***NNNNN***NNNNNN***NNNNN![SOI]***NNNNNN**NNNNNN***NNNNNN**NNNNNNN*[EOI]
> [ 5132.944079] N
>

>
> As you can see, my webcam try to resent SOI lots of times and only last 
> try is correct. For next example i added logic to send ENODATA on each 
> packet with correct header but no data. Here is the result:
>

Your camera sounds weirder than mine!

One potential issue to make sure of if you want to throw away packets with 
valid headers but no data:  my camera (Quanta integrated webcam: 
0408:2fb1, sends EOF (usually) in an empty packet - I think you want to 
make sure that this is looked for before discarding the packet. This maybe 
what happens with your filter - I didn't look closely enough to see.

My camera actually works more or less perfectly now with the patch I sent 
in earlier.  My camera has several distinct problems:

1) In YUV mode the camera sometimes gives up on a frame part way through, 
when this happens it doesn't give an EOF, but toggles FID.  The 
released driver checks the length of YUV frames if the frame is 
terminated with EOF but it doesn't if the frame is terminated with FID.
So I check that uncompressed frames terminated with FID are the correct 
length.  This is something that should probably be added globally.

2) In MJPG mode the camera sometimes toggles FID one or two packets early. 
Fortunately EOF is reliable in MJPG, so in MJPG I ignore FID fully 
(based on a patch you supplied).

Sadly I need EOF for MJPG and need FID in YUV...

3) Sometimes payload packets get broken in chunks that are 1/3 or 2/3 
their proper size. This is bad - since the later chunks don't have 
headers, and left uncorrected the raw image data gets interpreted by the 
driver as header - and all sorts of random things happen.  It turns out to 
be not so difficult to reassemble these packets though, just based on 
lengths.

4) The camera sometimes doesn't start. This turns out to be a problem 
people have seen in windows too. Somebody finally figured out a 
work-around - if the camera doesn't start, you can just point it at a 
light and then it starts.

The very strange thing about all of this is that none of these issues 
appear to be universal.  Many people have complained of #4, but other 
linux users do not appear to have problems 1, 2, or 3.

5) The camera lies about the frame rates it can do in high resolution YUV. 
It says it can do 30fps at 1600x1200 (and 1280x720 and 1024x768) yuv - but 
that's way more bits than USB 2 can carry. I don't think this causes any 
real problems though - you just don't get the frame rate advertised.

Carl



From bug-track at fisher-privat.net  Wed Aug 10 20:39:59 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 10 Aug 2011 20:39:59 +0200
Subject: [Linux-uvc-devel] error proofing mjpeg stream
In-Reply-To: <alpine.LNX.2.00.1108100949570.27345@spider.phas.ubc.ca>
References: <4E410FA3.70304@fisher-privat.net>
	<alpine.LNX.2.00.1108100949570.27345@spider.phas.ubc.ca>
Message-ID: <4E42D07F.2050809@fisher-privat.net>

Am 10.08.2011 19:20, schrieb Carl Michal:
> Hi Alexey,
>
>
> On Tue, 9 Aug 2011, Alexey Fisher wrote:
>
>> Hall all, Laurent, Carl,
>>
>> i just was looking on how my webcam do mjpeg stream and created some
>> "visualisation" patch. I got some interesting results (may be it can
>> help you Carl with your webcam).
>>
>> The idea is as fallow, use jpeg bits for error corection. According to
>> uvc documentation, webcam should set SOI (start of image) and EOI (end
>> of image) magic. In some situations it is possible to use it if FID is
>> brocken.
>>
>> I got fallowing result (N - mean header is ok, but no data is present;
>> !SOI - mean new SOI without EOI; * - image data):
>>

>> [ 5132.944079] N
>>
>
>>
>> As you can see, my webcam try to resent SOI lots of times and only
>> last try is correct. For next example i added logic to send ENODATA on
>> each packet with correct header but no data. Here is the result:
>>
>
> Your camera sounds weirder than mine!
>
> One potential issue to make sure of if you want to throw away packets
> with valid headers but no data: my camera (Quanta integrated webcam:
> 0408:2fb1, sends EOF (usually) in an empty packet - I think you want to
> make sure that this is looked for before discarding the packet. This
> maybe what happens with your filter - I didn't look closely enough to see.
>
> My camera actually works more or less perfectly now with the patch I
> sent in earlier. My camera has several distinct problems:
>
> 1) In YUV mode the camera sometimes gives up on a frame part way
> through, when this happens it doesn't give an EOF, but toggles FID. The
> released driver checks the length of YUV frames if the frame is
> terminated with EOF but it doesn't if the frame is terminated with FID.
> So I check that uncompressed frames terminated with FID are the correct
> length. This is something that should probably be added globally.
>
> 2) In MJPG mode the camera sometimes toggles FID one or two packets
> early. Fortunately EOF is reliable in MJPG, so in MJPG I ignore FID
> fully (based on a patch you supplied).
>
> Sadly I need EOF for MJPG and need FID in YUV...
>
> 3) Sometimes payload packets get broken in chunks that are 1/3 or 2/3
> their proper size. This is bad - since the later chunks don't have
> headers, and left uncorrected the raw image data gets interpreted by the
> driver as header - and all sorts of random things happen. It turns out
> to be not so difficult to reassemble these packets though, just based on
> lengths.

I'll send you one more patch to visualize some info from header, may be 
we can filter some thing.

> 4) The camera sometimes doesn't start. This turns out to be a problem
> people have seen in windows too. Somebody finally figured out a
> work-around - if the camera doesn't start, you can just point it at a
> light and then it starts.
>
> The very strange thing about all of this is that none of these issues
> appear to be universal. Many people have complained of #4, but other
> linux users do not appear to have problems 1, 2, or 3.
>
> 5) The camera lies about the frame rates it can do in high resolution
> YUV. It says it can do 30fps at 1600x1200 (and 1280x720 and 1024x768)
> yuv - but that's way more bits than USB 2 can carry. I don't think this
> causes any real problems though - you just don't get the frame rate
> advertised.
>
> Carl

We can do size check for yuv, but nothing for jpeg. Jpeg stream has 
really good chance to be more error proof, since jpeg has markers on the 
start and end of image. The idea is to use this jpeg markers instead of 
FID or EOF. In my patch this markers are not used, but displayed. SOI 
and EOI are jpeg marker for start and end of image.

Since your webcam is so brocken, it is a good test case :) Can you 
please send me dmesg with output from my patch by capturing jpeg stream.


From michal at physics.ubc.ca  Wed Aug 10 21:19:05 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Wed, 10 Aug 2011 12:19:05 -0700 (PDT)
Subject: [Linux-uvc-devel] error proofing mjpeg stream
In-Reply-To: <4E42D07F.2050809@fisher-privat.net>
References: <4E410FA3.70304@fisher-privat.net>
	<alpine.LNX.2.00.1108100949570.27345@spider.phas.ubc.ca>
	<4E42D07F.2050809@fisher-privat.net>
Message-ID: <alpine.LNX.2.00.1108101202130.27345@spider.phas.ubc.ca>

Hi Alexey,

On Wed, 10 Aug 2011, Alexey Fisher wrote:

> Am 10.08.2011 19:20, schrieb Carl Michal:
>>  Hi Alexey,
>> 
>>
>>  On Tue, 9 Aug 2011, Alexey Fisher wrote:
>> 
>> >  Hall all, Laurent, Carl,
>> > 
>> >  i just was looking on how my webcam do mjpeg stream and created some
>> >  "visualisation" patch. I got some interesting results (may be it can
>> >  help you Carl with your webcam).
>> > 
>> >  The idea is as fallow, use jpeg bits for error corection. According to
>> >  uvc documentation, webcam should set SOI (start of image) and EOI (end
>> >  of image) magic. In some situations it is possible to use it if FID is
>> >  brocken.
>> > 
>> >  I got fallowing result (N - mean header is ok, but no data is present;
>> >  !SOI - mean new SOI without EOI; * - image data):
>> > 
>
>> >  [ 5132.944079] N
>> > 
>> 
>> > 
>> >  As you can see, my webcam try to resent SOI lots of times and only
>> >  last try is correct. For next example i added logic to send ENODATA on
>> >  each packet with correct header but no data. Here is the result:
>> > 
>>
>>  Your camera sounds weirder than mine!
>>
>>  One potential issue to make sure of if you want to throw away packets
>>  with valid headers but no data: my camera (Quanta integrated webcam:
>>  0408:2fb1, sends EOF (usually) in an empty packet - I think you want to
>>  make sure that this is looked for before discarding the packet. This
>>  maybe what happens with your filter - I didn't look closely enough to see.
>>
>>  My camera actually works more or less perfectly now with the patch I
>>  sent in earlier. My camera has several distinct problems:
>>
>>  1) In YUV mode the camera sometimes gives up on a frame part way
>>  through, when this happens it doesn't give an EOF, but toggles FID. The
>>  released driver checks the length of YUV frames if the frame is
>>  terminated with EOF but it doesn't if the frame is terminated with FID.
>>  So I check that uncompressed frames terminated with FID are the correct
>>  length. This is something that should probably be added globally.
>>
>>  2) In MJPG mode the camera sometimes toggles FID one or two packets
>>  early. Fortunately EOF is reliable in MJPG, so in MJPG I ignore FID
>>  fully (based on a patch you supplied).
>>
>>  Sadly I need EOF for MJPG and need FID in YUV...
>>
>>  3) Sometimes payload packets get broken in chunks that are 1/3 or 2/3
>>  their proper size. This is bad - since the later chunks don't have
>>  headers, and left uncorrected the raw image data gets interpreted by the
>>  driver as header - and all sorts of random things happen. It turns out
>>  to be not so difficult to reassemble these packets though, just based on
>>  lengths.
>
> I'll send you one more patch to visualize some info from header, may be we 
> can filter some thing.
>
>>  4) The camera sometimes doesn't start. This turns out to be a problem
>>  people have seen in windows too. Somebody finally figured out a
>>  work-around - if the camera doesn't start, you can just point it at a
>>  light and then it starts.
>>
>>  The very strange thing about all of this is that none of these issues
>>  appear to be universal. Many people have complained of #4, but other
>>  linux users do not appear to have problems 1, 2, or 3.
>>
>>  5) The camera lies about the frame rates it can do in high resolution
>>  YUV. It says it can do 30fps at 1600x1200 (and 1280x720 and 1024x768)
>>  yuv - but that's way more bits than USB 2 can carry. I don't think this
>>  causes any real problems though - you just don't get the frame rate
>>  advertised.
>>
>>  Carl
>
> We can do size check for yuv, but nothing for jpeg. Jpeg stream has really 
> good chance to be more error proof, since jpeg has markers on the start and 
> end of image. The idea is to use this jpeg markers instead of FID or EOF. In 
> my patch this markers are not used, but displayed. SOI and EOI are jpeg 
> marker for start and end of image.
>
> Since your webcam is so brocken, it is a good test case :) Can you please 
> send me dmesg with output from my patch by capturing jpeg stream.
>


The length check I mention is for yuv: but the current driver only does 
that length check when it sees EOF - it doesn't do it if the frame is 
terminated by FID - so I added that check.

I can try your patch (not now - dont have that computer here) but without 
the reconstruction I already do I can't imagine it helping - because 
without the reconstruction, the driver chops off some of the mjpg or yuv 
data interpreting it as header.  Each time that happens, 12 bytes get 
chopped out of the middle of the frame, and random bits get interpreted as 
FID, EOF, ERROR etc...

My guess is that if I apply your checks with my stream reconstruction 
it will find that every frame is fine.  Without my stream reconstruction, 
there will still be corrupt frames because some image data will be 
interpreted as header. Just searching for SOI and EOI won't help because 
they will generally be there in the right place, but a few bytes from the 
middle of the stream get removed (and misinterpreted).

Its true what you propose might help with one of my problems: the fact 
that FID is sometimes toggled a packet or two early in MJPG.  But for me 
that doesn't matter since EOF is reliable.

Carl












From chrelad at gmail.com  Thu Aug 11 03:15:34 2011
From: chrelad at gmail.com (Christopher Dale)
Date: Wed, 10 Aug 2011 20:15:34 -0500
Subject: [Linux-uvc-devel] Looking for upside down uvc cams
In-Reply-To: <1313024957.3256.1.camel@laptop>
References: <4A39F219.10301@redhat.com>
	<1313024957.3256.1.camel@laptop>
Message-ID: <CADQnX_cfVG_KVhS4QYCh2-cYvzQCmWWvOLgZuv2fhO4-h0OR_A@mail.gmail.com>

Hi there Hans,

Not sure if you are still interested in webcams that are flipped for
UVCVideo. If you are, here are the details for my webcam :) Hopefully it
can be dropped into this magic list!

If you need any other information, please let me know :D

Thanks :)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmi.log
Type: text/x-log
Size: 12052 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110810/c53e621e/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lsusb.log
Type: text/x-log
Size: 549 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110810/c53e621e/attachment-0001.bin>

From philip at gladstonefamily.net  Fri Aug 12 03:19:21 2011
From: philip at gladstonefamily.net (Philip Gladstone)
Date: Thu, 11 Aug 2011 21:19:21 -0400
Subject: [Linux-uvc-devel] Logitech C910 camera problems
Message-ID: <4E447F99.2030003@gladstonefamily.net>

I'm running the latest UVC driver and I find that the auto-exposure 
doesn't work when I use the UVC driver on linux. The controls (as 
reported by fswebcam) are:

Available Controls        Current Value   Range

------------------        -------------   -----

Brightness                128 (50%)       0 - 255

Contrast                  32 (12%)        0 - 255

Saturation                32 (12%)        0 - 255

White Balance Temperature, Auto True            True | False

Gain                      64 (25%)        0 - 255

Power Line Frequency      60 Hz           Disabled | 50 Hz | 60 Hz

White Balance Temperature 4000 (32%)      2800 - 6500

Sharpness                 72 (28%)        0 - 255

Backlight Compensation    0               0 - 1

Exposure, Auto            Aperture Priority Mode Manual Mode | Aperture Priority Mode

Exposure (Absolute)       166 (7%)        3 - 2047

Exposure, Auto Priority   True            True | False

Pan (Absolute)            0 (50%)         -36000 - 36000

Tilt (Absolute)           0 (50%)         -36000 - 36000

Focus (absolute)          68 (26%)        0 - 255

Focus, Auto               True            True | False

Zoom, Absolute            1               1 - 5



I'm grabbing images in MJPG format and I wonder if that fact is 
confusing the camera. Under windows you can watch it adjust exposure and 
gain until the image looks good (when in auto mode).

The values above appear to be the default values after a power cycle of 
the camera (plug and unplug the USB).

Does anyone have any idea what is going on? I'd rather not have to put 
the camera in the manual exposure mode and then control it in software.....

Philip



From michal at physics.ubc.ca  Fri Aug 12 06:35:04 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Thu, 11 Aug 2011 21:35:04 -0700 (PDT)
Subject: [Linux-uvc-devel] Logitech C910 camera problems
In-Reply-To: <4E447F99.2030003@gladstonefamily.net>
References: <4E447F99.2030003@gladstonefamily.net>
Message-ID: <alpine.LNX.2.00.1108112132240.7206@tristan>

Hi Philip,

Laurent can correct me if I've got this wrong - but in the latest uvc 
driver there are some changes in how the exposure settings are reported. 
Before the driver would report settings that the camera wouldn't support. 
That is now fixed, but unfortunately the way it works now seems to confuse 
a lot of software. Both guvcview and luvcview are confused by the new 
driver as well and won't let you properly turn on or off the auto 
exposure as well.

In luvcview the fix is trivial, and apparently guvcview has been fixed 
upstream.  There is some disscussion of this in the list archives a few 
weeks ago.

Carl


On Thu, 11 Aug 2011, Philip Gladstone wrote:

> I'm running the latest UVC driver and I find that the auto-exposure doesn't 
> work when I use the UVC driver on linux. The controls (as reported by 
> fswebcam) are:
>
> Available Controls        Current Value   Range
>
> ------------------        -------------   -----
>
> Brightness                128 (50%)       0 - 255
>
> Contrast                  32 (12%)        0 - 255
>
> Saturation                32 (12%)        0 - 255
>
> White Balance Temperature, Auto True            True | False
>
> Gain                      64 (25%)        0 - 255
>
> Power Line Frequency      60 Hz           Disabled | 50 Hz | 60 Hz
>
> White Balance Temperature 4000 (32%)      2800 - 6500
>
> Sharpness                 72 (28%)        0 - 255
>
> Backlight Compensation    0               0 - 1
>
> Exposure, Auto            Aperture Priority Mode Manual Mode | Aperture 
> Priority Mode
>
> Exposure (Absolute)       166 (7%)        3 - 2047
>
> Exposure, Auto Priority   True            True | False
>
> Pan (Absolute)            0 (50%)         -36000 - 36000
>
> Tilt (Absolute)           0 (50%)         -36000 - 36000
>
> Focus (absolute)          68 (26%)        0 - 255
>
> Focus, Auto               True            True | False
>
> Zoom, Absolute            1               1 - 5
>
>
>
> I'm grabbing images in MJPG format and I wonder if that fact is confusing the 
> camera. Under windows you can watch it adjust exposure and gain until the 
> image looks good (when in auto mode).
>
> The values above appear to be the default values after a power cycle of the 
> camera (plug and unplug the USB).
>
> Does anyone have any idea what is going on? I'd rather not have to put the 
> camera in the manual exposure mode and then control it in software.....
>
> Philip
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
>


From ajay.bhargav at einfochips.com  Fri Aug 12 07:48:05 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Fri, 12 Aug 2011 11:18:05 +0530
Subject: [Linux-uvc-devel] MJPEG camera
Message-ID: <4E44BE95.1030506@einfochips.com>

Hi Everyone,

I am looking for a camera which supports MJPEG output format. Can anyone 
please provide me list?

Thanks & Regards,
Ajay Bhargav


From bug-track at fisher-privat.net  Fri Aug 12 08:07:27 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 12 Aug 2011 08:07:27 +0200
Subject: [Linux-uvc-devel] MJPEG camera
In-Reply-To: <4E44BE95.1030506@einfochips.com>
References: <4E44BE95.1030506@einfochips.com>
Message-ID: <4E44C31F.1020104@fisher-privat.net>

On 12.08.2011 07:48, Ajay Bhargav wrote:
> Hi Everyone,
> 
> I am looking for a camera which supports MJPEG output format. Can anyone
> please provide me list?
> 

Most/all uvc Logitech webcams support mjpeg.


From bug-track at fisher-privat.net  Fri Aug 12 09:21:41 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 12 Aug 2011 09:21:41 +0200
Subject: [Linux-uvc-devel] error proofing mjpeg stream
In-Reply-To: <alpine.LNX.2.00.1108112141380.7206@tristan>
References: <4E410FA3.70304@fisher-privat.net>
	<alpine.LNX.2.00.1108100949570.27345@spider.phas.ubc.ca>
	<4E42D07F.2050809@fisher-privat.net>
	<alpine.LNX.2.00.1108101202130.27345@spider.phas.ubc.ca>
	<4E44276F.80304@fisher-privat.net>
	<alpine.LNX.2.00.1108112141380.7206@tristan>
Message-ID: <4E44D485.7050003@fisher-privat.net>

On 12.08.2011 08:24, Carl Michal wrote:
> 
> On Thu, 11 Aug 2011, Alexey Fisher wrote:
> 
>> On 10.08.2011 21:19, Carl Michal wrote:
>>> Hi Alexey,
>>>
>>> On Wed, 10 Aug 2011, Alexey Fisher wrote:
>>>
>>>> Am 10.08.2011 19:20, schrieb Carl Michal:
>>>>>  Hi Alexey,
>>>>>
>>>>>
>>>>>  On Tue, 9 Aug 2011, Alexey Fisher wrote:
>>>>>
>>>>>>  Hall all, Laurent, Carl,
>>>>>>>  i just was looking on how my webcam do mjpeg stream and created
>>>>> some
>>>>>>  "visualisation" patch. I got some interesting results (may be it can
>>>>>>  help you Carl with your webcam).
>>>>>>>  The idea is as fallow, use jpeg bits for error corection.
>>>>> According to
>>>>>>  uvc documentation, webcam should set SOI (start of image) and EOI
>>>>> (end
>>>>>>  of image) magic. In some situations it is possible to use it if
>>>>> FID is
>>>>>>  brocken.
>>>>>>>  I got fallowing result (N - mean header is ok, but no data is
>>>>> present;
>>>>>>  !SOI - mean new SOI without EOI; * - image data):
>>>>>>
>>>>
>>>>>>  [ 5132.944079] N
>>>>>>
>>>>>>>  As you can see, my webcam try to resent SOI lots of times and only
>>>>>>  last try is correct. For next example i added logic to send
>>>>> ENODATA on
>>>>>>  each packet with correct header but no data. Here is the result:
>>>>>>
>>>>>  Your camera sounds weirder than mine!
>>>>>
>>>>>  One potential issue to make sure of if you want to throw away packets
>>>>>  with valid headers but no data: my camera (Quanta integrated webcam:
>>>>>  0408:2fb1, sends EOF (usually) in an empty packet - I think you
>>>>> want to
>>>>>  make sure that this is looked for before discarding the packet. This
>>>>>  maybe what happens with your filter - I didn't look closely enough
>>>>> to see.
>>>>>
>>>>>  My camera actually works more or less perfectly now with the patch I
>>>>>  sent in earlier. My camera has several distinct problems:
>>>>>
>>>>>  1) In YUV mode the camera sometimes gives up on a frame part way
>>>>>  through, when this happens it doesn't give an EOF, but toggles
>>>>> FID. The
>>>>>  released driver checks the length of YUV frames if the frame is
>>>>>  terminated with EOF but it doesn't if the frame is terminated with
>>>>> FID.
>>>>>  So I check that uncompressed frames terminated with FID are the
>>>>> correct
>>>>>  length. This is something that should probably be added globally.
>>>>>
>>>>>  2) In MJPG mode the camera sometimes toggles FID one or two packets
>>>>>  early. Fortunately EOF is reliable in MJPG, so in MJPG I ignore FID
>>>>>  fully (based on a patch you supplied).
>>>>>
>>>>>  Sadly I need EOF for MJPG and need FID in YUV...
>>>>>
>>>>>  3) Sometimes payload packets get broken in chunks that are 1/3 or 2/3
>>>>>  their proper size. This is bad - since the later chunks don't have
>>>>>  headers, and left uncorrected the raw image data gets interpreted by
>>>>> the
>>>>>  driver as header - and all sorts of random things happen. It turns
>>>>> out
>>>>>  to be not so difficult to reassemble these packets though, just
>>>>> based on
>>>>>  lengths.
>>>>
>>>> I'll send you one more patch to visualize some info from header, may
>>>> be we can filter some thing.
>>>>
>>>>>  4) The camera sometimes doesn't start. This turns out to be a problem
>>>>>  people have seen in windows too. Somebody finally figured out a
>>>>>  work-around - if the camera doesn't start, you can just point it at a
>>>>>  light and then it starts.
>>>>>
>>>>>  The very strange thing about all of this is that none of these issues
>>>>>  appear to be universal. Many people have complained of #4, but other
>>>>>  linux users do not appear to have problems 1, 2, or 3.
>>>>>
>>>>>  5) The camera lies about the frame rates it can do in high resolution
>>>>>  YUV. It says it can do 30fps at 1600x1200 (and 1280x720 and 1024x768)
>>>>>  yuv - but that's way more bits than USB 2 can carry. I don't think
>>>>> this
>>>>>  causes any real problems though - you just don't get the frame rate
>>>>>  advertised.
>>>>>
>>>>>  Carl
>>>>
>>>> We can do size check for yuv, but nothing for jpeg. Jpeg stream has
>>>> really good chance to be more error proof, since jpeg has markers on
>>>> the start and end of image. The idea is to use this jpeg markers
>>>> instead of FID or EOF. In my patch this markers are not used, but
>>>> displayed. SOI and EOI are jpeg marker for start and end of image.
>>>>
>>>> Since your webcam is so brocken, it is a good test case :) Can you
>>>> please send me dmesg with output from my patch by capturing jpeg
>>>> stream.
>>>>
>>>
>>>
>>> The length check I mention is for yuv: but the current driver only does
>>> that length check when it sees EOF - it doesn't do it if the frame is
>>> terminated by FID - so I added that check.
>>>
>>> I can try your patch (not now - dont have that computer here) but
>>> without the reconstruction I already do I can't imagine it helping -
>>> because without the reconstruction, the driver chops off some of the
>>> mjpg or yuv data interpreting it as header.  Each time that happens, 12
>>> bytes get chopped out of the middle of the frame, and random bits get
>>> interpreted as FID, EOF, ERROR etc...
>>>
>>> My guess is that if I apply your checks with my stream reconstruction it
>>> will find that every frame is fine.  Without my stream reconstruction,
>>> there will still be corrupt frames because some image data will be
>>> interpreted as header. Just searching for SOI and EOI won't help because
>>> they will generally be there in the right place, but a few bytes from
>>> the middle of the stream get removed (and misinterpreted).
>>>
>>> Its true what you propose might help with one of my problems: the fact
>>> that FID is sometimes toggled a packet or two early in MJPG.  But for me
>>> that doesn't matter since EOF is reliable.
>>>
>>
>>
>> Hi Carl,
>> i was reading your patch and there is some questions.
>> Are there only problems with payload of  this size: 3*760, 3*1024?
>>
>> Can you please take a look what URB size making problems? I think
>> urb->number_of_packets is always 32. In your webcams usb descriptor you
>> can find some thing like this:
>>
>>    Interface Descriptor:
>>      bLength                 9
>>      bDescriptorType         4
>>      bInterfaceNumber        1
>>      bAlternateSetting       2 <---- !!!
>>      bNumEndpoints           1
>>      bInterfaceClass        14 Video
>>      bInterfaceSubClass      2 Video Streaming
>>      bInterfaceProtocol      0
>>      iInterface              0
>>      Endpoint Descriptor:
>>        bLength                 7
>>        bDescriptorType         5
>>        bEndpointAddress     0x82  EP 2 IN   <----!!!
>>        bmAttributes            5
>>          Transfer Type            Isochronous
>>          Synch Type               Asynchronous
>>          Usage Type               Data
>>        wMaxPacketSize     0x12f8  3x 760 bytes <----!!!
>>        bInterval               1
>>
>>
>> I marked parts i'd like to know. What AlternateSetting and
>> bEndpointAddress uvc driver is using.
>>
>>
> 
> Alexey,
> 
> 
> Below that I'll put in what your 'visualization patch' gives, both with
> and without my stream fixing.
> 
> it uses alternate setting 2:
> Aug 11 22:32:30 tristan kernel: uvcvideo: Device requested 2280 B/frame
> bandwidth.
> Aug 11 22:32:30 tristan kernel: uvcvideo: Selecting alternate setting 2
> (2280 B/frame bandwidth).
> Aug 11 22:32:30 tristan kernel: uvcvideo: Allocated 5 URB buffers of
> 32x2280 bytes each.
> 
> I only have problems with 3*760 and 3*1024 bytes, but that makes sense,
> those are the only packet sizes the camera sends that could get split
> incorrectly.
> 
> the whole output of lsusb -v -d 0408:2fb1.
> 
> Bus 001 Device 004: ID 0408:2fb1 Quanta Computer, Inc. Device Descriptor:
>   bLength                18
>   bDescriptorType         1
>   bcdUSB               2.00
>   bDeviceClass          239 Miscellaneous Device
>   bDeviceSubClass         2 ?
>   bDeviceProtocol         1 Interface Association
>   bMaxPacketSize0        64
>   idVendor           0x0408 Quanta Computer, Inc.
>   idProduct          0x2fb1
>   bcdDevice            9.01
>   iManufacturer           3 CN07CN2C7866411I1870A00
>   iProduct                2 Laptop_Integrated_Webcam_2HDM
>   iSerial                 0
>   bNumConfigurations      1
>   Configuration Descriptor:
>     bLength                 9
>     bDescriptorType         2
>     wTotalLength         1457
>     bNumInterfaces          3
>     bConfigurationValue     1
>     iConfiguration          2 Laptop_Integrated_Webcam_2HDM
>     bmAttributes         0x80
>       (Bus Powered)
>     MaxPower              250mA
>     ** UNRECOGNIZED:  24 ff 42 49 53 54 00 01 05 02 10 00 00 00 00 00 01
> 05 d0 07 02 06 d0 07 03 07 d0 07 04 08 d0 07 05 09 d0 07
>     Interface Association:
>       bLength                 8
>       bDescriptorType        11
>       bFirstInterface         0
>       bInterfaceCount         3
>       bFunctionClass         14 Video
>       bFunctionSubClass       3 Video Interface Collection
>       bFunctionProtocol       0
>       iFunction               4 Integrated Webcam
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        0
>       bAlternateSetting       0
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      1 Video Control
>       bInterfaceProtocol      0
>       iInterface              4 Integrated Webcam
>       VideoControl Interface Descriptor:
>         bLength                14
>         bDescriptorType        36
>         bDescriptorSubtype      1 (HEADER)
>         bcdUVC               1.00
>         wTotalLength          113
>         dwClockFrequency       75.000000MHz
>         bInCollection           2
>         baInterfaceNr( 0)       1
>         baInterfaceNr( 1)       2
>       VideoControl Interface Descriptor:
>         bLength                18
>         bDescriptorType        36
>         bDescriptorSubtype      2 (INPUT_TERMINAL)
>         bTerminalID             1
>         wTerminalType      0x0201 Camera Sensor
>         bAssocTerminal          0
>         iTerminal               0
>         wObjectiveFocalLengthMin      0
>         wObjectiveFocalLengthMax      0
>         wOcularFocalLength            0
>         bControlSize                  3
>         bmControls           0x0000000e
>           Auto-Exposure Mode
>           Auto-Exposure Priority
>           Exposure Time (Absolute)
>       VideoControl Interface Descriptor:
>         bLength                11
>         bDescriptorType        36
>         bDescriptorSubtype      5 (PROCESSING_UNIT)
>       Warning: Descriptor too short
>         bUnitID                 2
>         bSourceID               1
>         wMaxMultiplier          0
>         bControlSize            2
>         bmControls     0x0000157f
>           Brightness
> 3          Contrast
>           Hue
>           Saturation
>           Sharpness
>           Gamma
>           White Balance Temperature
>           Backlight Compensation
>           Power Line Frequency
>           White Balance Temperature, Auto
>         iProcessing             0
>         bmVideoStandards     0x1a
>           NTSC - 525/60
>           SECAM - 625/50
>           NTSC - 625/50
>       VideoControl Interface Descriptor:
>         bLength                26
>         bDescriptorType        36
>         bDescriptorSubtype      6 (EXTENSION_UNIT)
>         bUnitID                 3
>         guidExtensionCode         {28179e5d-8dab-a94f-9acb-f6d56dbc05a6}
>         bNumControl             8
>         bNrPins                 1
>         baSourceID( 0)          2
>         bControlSize            1
>         bmControls( 0)       0x1f
>         iExtension              0
>       VideoControl Interface Descriptor:
>         bLength                26
>         bDescriptorType        36
>         bDescriptorSubtype      6 (EXTENSION_UNIT)
>         bUnitID                 4
>         guidExtensionCode         {c385b80f-c268-4745-90f7-8f47579d95fc}
>         bNumControl             4
>         bNrPins                 1
>         baSourceID( 0)          3
>         bControlSize            1
>         bmControls( 0)       0x0f
>         iExtension              0
>       VideoControl Interface Descriptor:
>         bLength                 9
>         bDescriptorType        36
>         bDescriptorSubtype      3 (OUTPUT_TERMINAL)
>         bTerminalID             5
>         wTerminalType      0x0101 USB Streaming
>         bAssocTerminal          0
>         bSourceID               4
>         iTerminal               0
>       VideoControl Interface Descriptor:
>         bLength                 9
>         bDescriptorType        36
>         bDescriptorSubtype      3 (OUTPUT_TERMINAL)
>         bTerminalID             6
>         wTerminalType      0x0101 USB Streaming
>         bAssocTerminal          0
>         bSourceID               4
>         iTerminal               0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x81  EP 1 IN
>         bmAttributes            3
>           Transfer Type            Interrupt
>           Synch Type               None
>           Usage Type               Data
>         wMaxPacketSize     0x0020  1x 32 bytes
>         bInterval               6
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        1
>       bAlternateSetting       0
>       bNumEndpoints           0
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       VideoStreaming Interface Descriptor:
>         bLength                            15
>         bDescriptorType                    36
>         bDescriptorSubtype                  1 (INPUT_HEADER)
>         bNumFormats                         2
>         wTotalLength                     1135
>         bEndPointAddress                  130
>         bmInfo                              0
>         bTerminalLink                       5
>         bStillCaptureMethod                 1
>         bTriggerSupport                     0
>         bTriggerUsage                       0
>         bControlSize                        1
>         bmaControls( 0)                    27
>         bmaControls( 1)                    27
>       VideoStreaming Interface Descriptor:
>         bLength                            27
>         bDescriptorType                    36
>         bDescriptorSubtype                  4 (FORMAT_UNCOMPRESSED)
>         bFormatIndex                        1
>         bNumFrameDescriptors               13
>         guidFormat                           
> {59555932-0000-1000-8000-00aa00389b71}
>         bBitsPerPixel                      16
>         bDefaultFrameIndex                  1
>         bAspectRatioX                       0
>         bAspectRatioY                       0
>         bmInterlaceFlags                 0x00
>           Interlaced stream or variable: No
>           Fields per frame: 2 fields
>           Field 1 first: No
>           Field pattern: Field 1 only
>           bCopyProtect                      0
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         1
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            640
>         wHeight                           480
>         dwMinBitRate                 24576000
>         dwMaxBitRate                147456000
>         dwMaxVideoFrameBufferSize      614400
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         2
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            640
>         wHeight                           400
>         dwMinBitRate                 20480000
>         dwMaxBitRate                122880000
>         dwMaxVideoFrameBufferSize      512000
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         3
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            384
>         wHeight                           216
>         dwMinBitRate                  6635520
>         dwMaxBitRate                 39813120
>         dwMaxVideoFrameBufferSize      165888
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         4
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            352
>         wHeight                           288
>         dwMinBitRate                  8110080
>         dwMaxBitRate                 48660480
>         dwMaxVideoFrameBufferSize      202752
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         5
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            320
>         wHeight                           240
>         dwMinBitRate                  6144000
>         dwMaxBitRate                 36864000
>         dwMaxVideoFrameBufferSize      153600
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         6
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            176
>         wHeight                           144
>         dwMinBitRate                  2027520
>         dwMaxBitRate                 12165120
>         dwMaxVideoFrameBufferSize       50688
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         7
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            160
>         wHeight                           120
>         dwMinBitRate                  1536000
>         dwMaxBitRate                  9216000
>         dwMaxVideoFrameBufferSize       38400
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         8
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            160
>         wHeight                           128
>         dwMinBitRate                  1638400
>         dwMaxBitRate                  9830400
>         dwMaxVideoFrameBufferSize       40960
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                         9
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            768
>         wHeight                           480
>         dwMinBitRate                 29491200
>         dwMaxBitRate                176947200
>         dwMaxVideoFrameBufferSize      737280
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            30
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                        10
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1024
>         wHeight                           768
>         dwMinBitRate                377487360
>         dwMaxBitRate                377487360
>         dwMaxVideoFrameBufferSize     1572864
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  1
>         dwFrameInterval( 0)            333333
>       VideoStreaming Interface Descriptor:
>         bLength                            30
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                        11
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1280
>         wHeight                           720
>         dwMinBitRate                442368000
>         dwMaxBitRate                442368000
>         dwMaxVideoFrameBufferSize     1843200
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  1
>         dwFrameInterval( 0)            333333
>       VideoStreaming Interface Descriptor:
>         bLength                            30
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                        12
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1280
>         wHeight                          1024
>         dwMinBitRate                629145600
>         dwMaxBitRate                629145600
>         dwMaxVideoFrameBufferSize     2621440
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  1
>         dwFrameInterval( 0)            333333
>       VideoStreaming Interface Descriptor:
>         bLength                            30
>         bDescriptorType                    36
>         bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
>         bFrameIndex                        13
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1600
>         wHeight                          1200
>         dwMinBitRate                921600000
>         dwMaxBitRate                921600000
>         dwMaxVideoFrameBufferSize     3840000
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  1
>         dwFrameInterval( 0)            333333
>       VideoStreaming Interface Descriptor:
>         bLength                             6
>         bDescriptorType                    36
>         bDescriptorSubtype                 13 (COLORFORMAT)
>         bColorPrimaries                     1 (BT.709,sRGB)
>         bTransferCharacteristics            1 (BT.709)
>         bMatrixCoefficients                 4 (SMPTE 170M (BT.601))
>       VideoStreaming Interface Descriptor:
>         bLength                            11
>         bDescriptorType                    36
>         bDescriptorSubtype                  6 (FORMAT_MJPEG)
>         bFormatIndex                        2
>         bNumFrameDescriptors               10
>         bFlags                              1
>           Fixed-size samples: Yes
>         bDefaultFrameIndex                  1
>         bAspectRatioX                       0
>         bAspectRatioY                       0
>         bmInterlaceFlags                 0x00
>           Interlaced stream or variable: No
>           Fields per frame: 1 fields
>           Field 1 first: No
>           Field pattern: Field 1 only
>           bCopyProtect                      0
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         1
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            640
>         wHeight                           480
>         dwMinBitRate                  2457600
>         dwMaxBitRate                 73728000
>         dwMaxVideoFrameBufferSize      307200
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         2
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            352
>         wHeight                           288
>         dwMinBitRate                   811008
>         dwMaxBitRate                 24330240
>         dwMaxVideoFrameBufferSize      101376
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         3
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            320
>         wHeight                           240
>         dwMinBitRate                   614400
>         dwMaxBitRate                 18432000
>         dwMaxVideoFrameBufferSize       76800
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         4
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            176
>         wHeight                           144
>         dwMinBitRate                   202752
>         dwMaxBitRate                  6082560
>         dwMaxVideoFrameBufferSize       25344
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         5
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            160
>         wHeight                           120
>         dwMinBitRate                   153600
>         dwMaxBitRate                  4608000
>         dwMaxVideoFrameBufferSize       19200
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         6
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                            768
>         wHeight                           480
>         dwMinBitRate                  2949120
>         dwMaxBitRate                 88473600
>         dwMaxVideoFrameBufferSize      368640
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         7
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1024
>         wHeight                           768
>         dwMinBitRate                  6291456
>         dwMaxBitRate                188743680
>         dwMaxVideoFrameBufferSize      786432
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         8
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1280
>         wHeight                           720
>         dwMinBitRate                  7372800
>         dwMaxBitRate                221184000
>         dwMaxVideoFrameBufferSize      921600
>         dwDefaultFrameInterval         333333
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            333333
>         dwFrameInterval( 1)            400000
>         dwFrameInterval( 2)            500000
>         dwFrameInterval( 3)            666666
>         dwFrameInterval( 4)           1000000
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                         9
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1280
>         wHeight                          1024
>         dwMinBitRate                 10485760
>         dwMaxBitRate                209715200
>         dwMaxVideoFrameBufferSize     1310720
>         dwDefaultFrameInterval         500000
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            500000
>         dwFrameInterval( 1)            666666
>         dwFrameInterval( 2)            833333
>         dwFrameInterval( 3)           1000000
>         dwFrameInterval( 4)           1111111
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                            50
>         bDescriptorType                    36
>         bDescriptorSubtype                  7 (FRAME_MJPEG)
>         bFrameIndex                        10
>         bmCapabilities                   0x00
>           Still image unsupported
>         wWidth                           1600
>         wHeight                          1200
>         dwMinBitRate                 15360000
>         dwMaxBitRate                230400000
>         dwMaxVideoFrameBufferSize     1920000
>         dwDefaultFrameInterval         666666
>         bFrameIntervalType                  6
>         dwFrameInterval( 0)            666666
>         dwFrameInterval( 1)            833333
>         dwFrameInterval( 2)           1000000
>         dwFrameInterval( 3)           1111111
>         dwFrameInterval( 4)           1428571
>         dwFrameInterval( 5)           2000000
>       VideoStreaming Interface Descriptor:
>         bLength                             6
>         bDescriptorType                    36
>         bDescriptorSubtype                 13 (COLORFORMAT)
>         bColorPrimaries                     1 (BT.709,sRGB)
>         bTransferCharacteristics            1 (BT.709)
>         bMatrixCoefficients                 4 (SMPTE 170M (BT.601))
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        1
>       bAlternateSetting       1
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x82  EP 2 IN
>         bmAttributes            5
>           Transfer Type            Isochronous
>           Synch Type               Asynchronous
>           Usage Type               Data
>         wMaxPacketSize     0x1400  3x 1024 bytes
>         bInterval               1
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        1
>       bAlternateSetting       2
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x82  EP 2 IN
>         bmAttributes            5
>           Transfer Type            Isochronous
>           Synch Type               Asynchronous
>           Usage Type               Data
>         wMaxPacketSize     0x12f8  3x 760 bytes
>         bInterval               1
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        1
>       bAlternateSetting       3
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x82  EP 2 IN
>         bmAttributes            5
>           Transfer Type            Isochronous
>           Synch Type               Asynchronous
>           Usage Type               Data
>         wMaxPacketSize     0x0400  1x 1024 bytes
>         bInterval               1
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        1
>       bAlternateSetting       4
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x82  EP 2 IN
>         bmAttributes            5
>           Transfer Type            Isochronous
>           Synch Type               Asynchronous
>           Usage Type               Data
>         wMaxPacketSize     0x0200  1x 512 bytes
>         bInterval               1
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        2
>       bAlternateSetting       0
>       bNumEndpoints           0
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       VideoStreaming Interface Descriptor:
>         bLength                            14
>         bDescriptorType                    36
>         bDescriptorSubtype                  1 (INPUT_HEADER)
>         bNumFormats                         1
>         wTotalLength                       21
>         bEndPointAddress                  131
>         bmInfo                              0
>         bTerminalLink                       6
>         bStillCaptureMethod                 1
>         bTriggerSupport                     0
>         bTriggerUsage                       0
>         bControlSize                        1
>         bmaControls( 0)                     7
>       VideoStreaming Interface Descriptor:
>         bLength                             7
>         bDescriptorType                    36
>         bDescriptorSubtype                 10 (FORMAT_MPEG2TS)
>         bFormatIndex                        1
>         bDataOffset                         0
>         bPacketLength                     188
>         bStrideLength                     188
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        2
>       bAlternateSetting       1
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x83  EP 3 IN
>         bmAttributes            5
>           Transfer Type            Isochronous
>           Synch Type               Asynchronous
>           Usage Type               Data
>         wMaxPacketSize     0x0318  1x 792 bytes
>         bInterval               1
>     Interface Descriptor:
>       bLength                 9
>       bDescriptorType         4
>       bInterfaceNumber        2
>       bAlternateSetting       2
>       bNumEndpoints           1
>       bInterfaceClass        14 Video
>       bInterfaceSubClass      2 Video Streaming
>       bInterfaceProtocol      0
>       iInterface              0
>       Endpoint Descriptor:
>         bLength                 7
>         bDescriptorType         5
>         bEndpointAddress     0x83  EP 3 IN
>         bmAttributes            5
>           Transfer Type            Isochronous
>           Synch Type               Asynchronous
>           Usage Type               Data
>         wMaxPacketSize     0x0100  1x 256 bytes
>         bInterval               1
> Device Qualifier (for other device speed):
>   bLength                10
>   bDescriptorType         6
>   bcdUSB               2.00
>   bDeviceClass          239 Miscellaneous Device
>   bDeviceSubClass         2 ?
>   bDeviceProtocol         1 Interface Association
>   bMaxPacketSize0        64
>   bNumConfigurations      1
> Device Status:     0x0000
>   (Bus Powered)
> 
> 
> 
> I modified your visualization patch to get rid of the I's (which my
> camera gives lots of, all over the place, but I think aren't so
> interesting) and to add a marker for EOF.  I also removed the -ENODATA
> for zero length packets because I rely on EOF.
> 
> Then, with my stream fixup patch I get:
> 
> [FID 50][SOI]**********[EOI]N[EOF]
> [FID 51][SOI]***********N[EOF]
> [FID 52]![SOI]************N[EOF]
> [FID 53]![SOI]***********N[EOF]
> [FID 54]![SOI]************N[EOF]
> [FID 55]![SOI]************N[EOF]
> [FID 56]![SOI]***********[EOI]N[EOF]
> [FID 57][SOI]************N[EOF]
> [FID 58]![SOI]************N[EOF]
> [FID 59]![SOI]************N[EOF]
> [FID 60]![SOI]************N[EOF]
> [FID 61]![SOI]***********[EOI]N[EOF]
> 
> 
> which renders perfectly - no corrupt frames at all. Either my camera is
> sloppy about doing EOI correctly, or maybe EOI sometimes isn't at the
> very end of a packet so your check doesn't see it?

It make no sense. If there is a end of image, no data should be applyed.
I wondaer if jpeg frames withouth EOI will be rendered at all. Can you
please dump jpg frames with luvcvier and check if there is same count of
frames in dump as in dmesg. And check if each dump has EOI signature on
the end of file? Use some script like:
for i in frame*.raw; do xxd $i | tail -n2; done

The very last two bytes should be 0xffd9

> But every packet here
> starts with FID, SOI and ends with EOF in an empty packet.  For this
> camera N (empty), and [EOF] are always the same packet.
> 
> 
> Without my stream fix (using your patch as supplied now - except for the
> I's removed) this is much worse, all sorts of nasty things happen:
> 
> Aug 11 22:21:01 tristan kernel: [FID 131]![SOI]*************************N
> Aug 11 22:21:01 tristan kernel: [FID 132]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 133]![SOI]*************************N
> Aug 11 22:21:01 tristan kernel: [FID 134]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 135]![SOI]*************************N
> Aug 11 22:21:01 tristan kernel: [FID 136]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 137]![SOI]*******E*****************
> Aug 11 22:21:01 tristan kernel: [FID 138]*
> Aug 11 22:21:01 tristan kernel: [FID 139]*N![SOI]************************N
> Aug 11 22:21:01 tristan kernel: [FID 140]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 141]![SOI]************************N
> Aug 11 22:21:01 tristan kernel: [FID 142]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 143]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 144]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 145]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 146]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 147]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 148]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 149]![SOI]*********************[EOI]
> Aug 11 22:21:01 tristan kernel: N
> Aug 11 22:21:01 tristan kernel: [FID 150][SOI]
> Aug 11 22:21:01 tristan kernel: [FID 151]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 152]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 153]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 154]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 155]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 156]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 157]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 158]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 159]![SOI]**********************N
> Aug 11 22:21:01 tristan kernel: [FID 160]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 161]![SOI]**********************
> Aug 11 22:21:01 tristan kernel: [FID 162]*
> Aug 11 22:21:01 tristan kernel: [FID 163]*N![SOI]***********************N
> Aug 11 22:21:01 tristan kernel: [FID 164]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 165]![SOI]**********************[EOI]
> Aug 11 22:21:01 tristan kernel: N
> Aug 11 22:21:01 tristan kernel: [FID 166][SOI]
> Aug 11 22:21:01 tristan kernel: [FID 167]![SOI]**********************
> Aug 11 22:21:01 tristan kernel: [FID 168][EOI]
> Aug 11 22:21:01 tristan kernel:
> Aug 11 22:21:01 tristan kernel: [FID 169][EOI]
> Aug 11 22:21:01 tristan kernel: N[SOI]***********************N
> Aug 11 22:21:01 tristan kernel: [FID 170]![SOI]
> Aug 11 22:21:01 tristan kernel: [FID 171]![SOI]*********************[EOI]
> Aug 11 22:21:01 tristan kernel: N
> Aug 11 22:21:01 tristan kernel: [FID 172][SOI]
> Aug 11 22:21:02 tristan kernel: [FID 173]![SOI]*********************[EOI]
> Aug 11 22:21:02 tristan kernel: N
> Aug 11 22:21:02 tristan kernel: [FID 174][SOI]
> Aug 11 22:21:02 tristan kernel: [FID 175]![SOI]**********************[EOI]
> 
> you can see at frame 138 and again at 162 the FID comes just before the
> empty packet that carries the (correct EOF). You don't see the EOF's
> here because of your return -ENODATA.
> 
> I don't like that at all - the header can carry valid information even
> if there is no data in the packet. I think it's unwise to throw it away
> - it would be a catastrophe for this camera.

It is not a big problem, just change the check to:
if (data[0] == len && !(data[1] & UVC_STREAM_EOF))
  return -ENODATA;

> I do like the idea of this for diagnosis - it might well have made
> figuring out what was going on with my camera a little easier.

It will be interesting to add it oficcially to the driver, but i do not
know if Laurent will be agree with it.

Can you combine your patch with visualisation patch and show what frames
was fragmented?
Add some stream->fragmented variable and tag it if you reconstruct
frame, and reset after processing it.

Regrads,
	Alexey



From bug-track at fisher-privat.net  Fri Aug 12 09:28:55 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 12 Aug 2011 09:28:55 +0200
Subject: [Linux-uvc-devel] Microdia Sonix id 0c45:6310
In-Reply-To: <CAPdm87r5VYdVCNw4p4-WF-qfhsHehecRQ7Fb=zzuc+6t5CgFRQ@mail.gmail.com>
References: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>	<4E42873C.80706@fisher-privat.net>
	<CAPdm87r5VYdVCNw4p4-WF-qfhsHehecRQ7Fb=zzuc+6t5CgFRQ@mail.gmail.com>
Message-ID: <4E44D637.9000004@fisher-privat.net>

On 10.08.2011 16:06, Rafael Piazenski wrote:
> Thanks again, for your help!
> 
> The file is attached!
> I receiver this output (sorry this is in portuguese, but I'll try to translate):
> 
> gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink
> 
> Definindo a fila de processamento para PAUSADO...
> ERRO: A fila do processamento n?o quer pausar.
> ERRO: do elemento /GstPipeline:pipeline0/GstV4l2Src:v4l2src0: O
> dispositivo "/dev/video0" n?o p?de ser identificado.
> Informa??o adicional de depura??o:
> v4l2_calls.c(493): gst_v4l2_open (): /GstPipeline:pipeline0/GstV4l2Src:v4l2src0:
> system error: Arquivo ou diret?rio n?o encontrado
> Definindo a fila de processamento para NULO...
> Liberando a fila de processamento...
> 
> Setting the queue processing to PAUSED ...
> ERROR: The queue does not want to pause processing.
> ERROR: from element / GstPipeline: pipeline0/GstV4l2Src: v4l2src0:
> Device "/ dev/video0" could not be identified.
> Additional information for debugging:
> v4l2_calls.c (493): gst_v4l2_open (): / GstPipeline:
> pipeline0/GstV4l2Src: v4l2src0:
> system error: File or directory not found
> Setting the processing queue to NULL ...
> Releasing the queue processing ...
> 
> Hope this can help!
> Rafael
> 
> 2011/8/10 Alexey Fisher <bug-track at fisher-privat.net>:
>> On 10.08.2011 15:11, Rafael Piazenski wrote:
>>> Hello people!
>>> First of all, thanks for your help!
>>> I have this webcam on my ubuntu 11.04 in a HP TX2500 (2540br).
>>> My webcam is recognized, but there is no /dev/video0 for it.
>>> Can you help me solve this issue?
>>> Thanks a lot!
>>> Rafael Piazenski
>>>
>>> Bus 002 Device 004: ID 0c45:6310 Microdia Sonix USB 2.0 Camera
>>>
>>> lsusb -d 0c45:6310 -v | grep "14 Video"
>>> can't get device qualifier: Operation not permitted
>>> can't get debug descriptor: Operation not permitted
>>> cannot read device status, Operation not permitted (1)
>>>       bFunctionClass         14 Video
>>
>> Please attach complete lsusb output.
>> Use: sudo lsusb -vd 0c45:6310 > lsusb
>>
>> Then reload uvc module with debug options:
>> sudo rmmod uvcvideo && sudo modpprobe uvcvideo trace=0xfff
>>
>> play some thing, for example:
>> gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink
>>
>> this will capture only 3 frames. And after this attach dmesg output as well.
>>
>> Regards,
>>        Alexey
>>

In dmesg you can see this part:
[11459.512425] uvcvideo: UVC non compliance - GET_DEF(PROBE) not
supported. Enabling workaround.
[11459.512829] uvcvideo: Failed to query (129) UVC probe control : -32
(exp. 26).
[11459.512837] uvcvideo: Failed to initialize the device (-5).

May be your can is really not uvc compliant.

I currently can't help you, if you able to compile kernel and wont to
try some hacks then you are wellkome, but most of the time you should
think and hack by your self.

Regards,
	Alexey


From chandrashekharla at gmail.com  Fri Aug 12 13:59:33 2011
From: chandrashekharla at gmail.com (Chandrashekhar Lavania)
Date: Fri, 12 Aug 2011 17:29:33 +0530
Subject: [Linux-uvc-devel] Interface between webcam driver and UVC
Message-ID: <CADmCyD2VxN8G_fbo-CuwuDiMJ9HTrxoFw94fDCk0Oji9tytz7g@mail.gmail.com>

Hi,

This might be a naive question, but I was wondering which uvc driver file
interacts with the actual webcam driver.
Also is there an architecture of the UVC driver for linux available which
highlights the mentioned interaction and interaction between various layers
of uvc driver.


Regards,
Shekhar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110812/b7e7bd8d/attachment.html>

From philip at gladstonefamily.net  Fri Aug 12 15:25:13 2011
From: philip at gladstonefamily.net (Philip Gladstone)
Date: Fri, 12 Aug 2011 09:25:13 -0400
Subject: [Linux-uvc-devel] Logitech C910 camera problems
In-Reply-To: <alpine.LNX.2.00.1108112132240.7206@tristan>
References: <4E447F99.2030003@gladstonefamily.net>
	<alpine.LNX.2.00.1108112132240.7206@tristan>
Message-ID: <4E4529B9.7030106@gladstonefamily.net>

In doing some digging, it also appears that the settings that I am 
interested in are also being cached by the driver, so I am not really 
getting the right values.

I suspect that for UVC_CT_EXPOSURE_TIME_ABSOLUTE_CONTROL, 
UVC_PU_GAIN_CONTROL (at least), I want the UVC_CTRL_FLAG_AUTO_UPDATE 
set. This won't (I doubt) improve the exposure of the image, but it will 
improve the reporting.

The output from v4l-ctl -l is

                      brightness (int)  : min=0 max=255 step=1 default=128 value=128

                        contrast (int)  : min=0 max=255 step=1 default=32 value=32

                      saturation (int)  : min=0 max=255 step=1 default=32 value=32

  white_balance_temperature_auto (bool) : default=1 value=1

                            gain (int)  : min=0 max=255 step=1 default=64 value=64

            power_line_frequency (menu) : min=0 max=2 default=2 value=2

       white_balance_temperature (int)  : min=2800 max=6500 step=1 default=4000 value=4000

                       sharpness (int)  : min=0 max=255 step=1 default=72 value=72

          backlight_compensation (int)  : min=0 max=1 step=1 default=0 value=0

                   exposure_auto (menu) : min=0 max=3 default=3 value=3

               exposure_absolute (int)  : min=3 max=2047 step=1 default=166 value=166

          exposure_auto_priority (bool) : default=0 value=1

                    pan_absolute (int)  : min=-36000 max=36000 step=3600 default=0 value=0

                   tilt_absolute (int)  : min=-36000 max=36000 step=3600 default=0 value=0

                  focus_absolute (int)  : min=0 max=255 step=17 default=68 value=68

                      focus_auto (bool) : default=1 value=1

                   zoom_absolute (int)  : min=1 max=5 step=1 default=1 value=1



Philip


On 12-Aug-11 12:35 AM, Carl Michal wrote:
> Hi Philip,
>
> Laurent can correct me if I've got this wrong - but in the latest uvc 
> driver there are some changes in how the exposure settings are 
> reported. Before the driver would report settings that the camera 
> wouldn't support. That is now fixed, but unfortunately the way it 
> works now seems to confuse a lot of software. Both guvcview and 
> luvcview are confused by the new driver as well and won't let you 
> properly turn on or off the auto exposure as well.
>
> In luvcview the fix is trivial, and apparently guvcview has been fixed 
> upstream.  There is some disscussion of this in the list archives a 
> few weeks ago.
>
> Carl
>
>
> On Thu, 11 Aug 2011, Philip Gladstone wrote:
>
>> I'm running the latest UVC driver and I find that the auto-exposure 
>> doesn't work when I use the UVC driver on linux. The controls (as 
>> reported by fswebcam) are:
>>
>> Available Controls        Current Value   Range
>>
>> ------------------        -------------   -----
>>
>> Brightness                128 (50%)       0 - 255
>>
>> Contrast                  32 (12%)        0 - 255
>>
>> Saturation                32 (12%)        0 - 255
>>
>> White Balance Temperature, Auto True            True | False
>>
>> Gain                      64 (25%)        0 - 255
>>
>> Power Line Frequency      60 Hz           Disabled | 50 Hz | 60 Hz
>>
>> White Balance Temperature 4000 (32%)      2800 - 6500
>>
>> Sharpness                 72 (28%)        0 - 255
>>
>> Backlight Compensation    0               0 - 1
>>
>> Exposure, Auto            Aperture Priority Mode Manual Mode | 
>> Aperture Priority Mode
>>
>> Exposure (Absolute)       166 (7%)        3 - 2047
>>
>> Exposure, Auto Priority   True            True | False
>>
>> Pan (Absolute)            0 (50%)         -36000 - 36000
>>
>> Tilt (Absolute)           0 (50%)         -36000 - 36000
>>
>> Focus (absolute)          68 (26%)        0 - 255
>>
>> Focus, Auto               True            True | False
>>
>> Zoom, Absolute            1               1 - 5
>>
>>
>>
>> I'm grabbing images in MJPG format and I wonder if that fact is 
>> confusing the camera. Under windows you can watch it adjust exposure 
>> and gain until the image looks good (when in auto mode).
>>
>> The values above appear to be the default values after a power cycle 
>> of the camera (plug and unplug the USB).
>>
>> Does anyone have any idea what is going on? I'd rather not have to 
>> put the camera in the manual exposure mode and then control it in 
>> software.....
>>
>> Philip
>>
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>
>>
>
>
>



From max.lapshin at gmail.com  Fri Aug 12 18:37:31 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Fri, 12 Aug 2011 20:37:31 +0400
Subject: [Linux-uvc-devel] Erlang capture for UVC
Message-ID: <CAMxVRxBs2JZPyyt-c9cRkNdQ5iN9xSTu4MU3TnMA0-EsZzDNOQ@mail.gmail.com>

Hi.  I've added erlang driver for UVC:  http://github.com/erlyvideo/uvc

This driver captures video from v4l and transforms it to erlang
messages. Mention adding huffman table to output jpeg.
Without it jpeg decoders can't take mjpeg from camera.

Thanks again for great linux driver!


This tool http://github.com/erlyvideo/jpeg uses turbojpeg library to
decode mjpeg stream to yuv stream.


From pj.assis at gmail.com  Sat Aug 13 00:03:34 2011
From: pj.assis at gmail.com (Paulo Assis)
Date: Fri, 12 Aug 2011 22:03:34 +0000
Subject: [Linux-uvc-devel] Logitech C910 camera problems
In-Reply-To: <4E4529B9.7030106@gladstonefamily.net>
References: <4E447F99.2030003@gladstonefamily.net>
	<alpine.LNX.2.00.1108112132240.7206@tristan>
	<4E4529B9.7030106@gladstonefamily.net>
Message-ID: <CAPueXH4=_grRfBE5tU+QQiqwDK=fuXjNOxS1trB7PR4Th6D49w@mail.gmail.com>

Hi,
The flag is think is UVC_CONTROL_AUTO_UPDATE

and in the case of extension controls you really need to set it to
disable control caching, this is specially evident for control like
pan/tilt, that behave badly if this flag is not set.

see:
http://www.spinics.net/lists/vfl/msg38717.html

in the case of exposure however this was never a problem.
in kernel 3.0 the auto exposure menu only reports the valid menu
values (2) instead of all 4, this was a problem for tools like
guvcview that didn't expect this. I've now fix it (1.5.0) and it is
working fine, you also may want to test some other control tool like
yavta instead.

Regards,
Paulo

2011/8/12 Philip Gladstone <philip at gladstonefamily.net>:
> In doing some digging, it also appears that the settings that I am
> interested in are also being cached by the driver, so I am not really
> getting the right values.
>
> I suspect that for UVC_CT_EXPOSURE_TIME_ABSOLUTE_CONTROL,
> UVC_PU_GAIN_CONTROL (at least), I want the UVC_CTRL_FLAG_AUTO_UPDATE set.
> This won't (I doubt) improve the exposure of the image, but it will improve
> the reporting.
>
> The output from v4l-ctl -l is
>
> ? ? ? ? ? ? ? ? ? ? brightness (int) ?: min=0 max=255 step=1 default=128
> value=128
>
> ? ? ? ? ? ? ? ? ? ? ? contrast (int) ?: min=0 max=255 step=1 default=32
> value=32
>
> ? ? ? ? ? ? ? ? ? ? saturation (int) ?: min=0 max=255 step=1 default=32
> value=32
>
> ?white_balance_temperature_auto (bool) : default=1 value=1
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? gain (int) ?: min=0 max=255 step=1 default=64
> value=64
>
> ? ? ? ? ? power_line_frequency (menu) : min=0 max=2 default=2 value=2
>
> ? ? ?white_balance_temperature (int) ?: min=2800 max=6500 step=1
> default=4000 value=4000
>
> ? ? ? ? ? ? ? ? ? ? ?sharpness (int) ?: min=0 max=255 step=1 default=72
> value=72
>
> ? ? ? ? backlight_compensation (int) ?: min=0 max=1 step=1 default=0 value=0
>
> ? ? ? ? ? ? ? ? ?exposure_auto (menu) : min=0 max=3 default=3 value=3
>
> ? ? ? ? ? ? ?exposure_absolute (int) ?: min=3 max=2047 step=1 default=166
> value=166
>
> ? ? ? ? exposure_auto_priority (bool) : default=0 value=1
>
> ? ? ? ? ? ? ? ? ? pan_absolute (int) ?: min=-36000 max=36000 step=3600
> default=0 value=0
>
> ? ? ? ? ? ? ? ? ?tilt_absolute (int) ?: min=-36000 max=36000 step=3600
> default=0 value=0
>
> ? ? ? ? ? ? ? ? focus_absolute (int) ?: min=0 max=255 step=17 default=68
> value=68
>
> ? ? ? ? ? ? ? ? ? ? focus_auto (bool) : default=1 value=1
>
> ? ? ? ? ? ? ? ? ?zoom_absolute (int) ?: min=1 max=5 step=1 default=1 value=1
>
>
>
> Philip
>
>
> On 12-Aug-11 12:35 AM, Carl Michal wrote:
>>
>> Hi Philip,
>>
>> Laurent can correct me if I've got this wrong - but in the latest uvc
>> driver there are some changes in how the exposure settings are reported.
>> Before the driver would report settings that the camera wouldn't support.
>> That is now fixed, but unfortunately the way it works now seems to confuse a
>> lot of software. Both guvcview and luvcview are confused by the new driver
>> as well and won't let you properly turn on or off the auto exposure as well.
>>
>> In luvcview the fix is trivial, and apparently guvcview has been fixed
>> upstream. ?There is some disscussion of this in the list archives a few
>> weeks ago.
>>
>> Carl
>>
>>
>> On Thu, 11 Aug 2011, Philip Gladstone wrote:
>>
>>> I'm running the latest UVC driver and I find that the auto-exposure
>>> doesn't work when I use the UVC driver on linux. The controls (as reported
>>> by fswebcam) are:
>>>
>>> Available Controls ? ? ? ?Current Value ? Range
>>>
>>> ------------------ ? ? ? ?------------- ? -----
>>>
>>> Brightness ? ? ? ? ? ? ? ?128 (50%) ? ? ? 0 - 255
>>>
>>> Contrast ? ? ? ? ? ? ? ? ?32 (12%) ? ? ? ?0 - 255
>>>
>>> Saturation ? ? ? ? ? ? ? ?32 (12%) ? ? ? ?0 - 255
>>>
>>> White Balance Temperature, Auto True ? ? ? ? ? ?True | False
>>>
>>> Gain ? ? ? ? ? ? ? ? ? ? ?64 (25%) ? ? ? ?0 - 255
>>>
>>> Power Line Frequency ? ? ?60 Hz ? ? ? ? ? Disabled | 50 Hz | 60 Hz
>>>
>>> White Balance Temperature 4000 (32%) ? ? ?2800 - 6500
>>>
>>> Sharpness ? ? ? ? ? ? ? ? 72 (28%) ? ? ? ?0 - 255
>>>
>>> Backlight Compensation ? ?0 ? ? ? ? ? ? ? 0 - 1
>>>
>>> Exposure, Auto ? ? ? ? ? ?Aperture Priority Mode Manual Mode | Aperture
>>> Priority Mode
>>>
>>> Exposure (Absolute) ? ? ? 166 (7%) ? ? ? ?3 - 2047
>>>
>>> Exposure, Auto Priority ? True ? ? ? ? ? ?True | False
>>>
>>> Pan (Absolute) ? ? ? ? ? ?0 (50%) ? ? ? ? -36000 - 36000
>>>
>>> Tilt (Absolute) ? ? ? ? ? 0 (50%) ? ? ? ? -36000 - 36000
>>>
>>> Focus (absolute) ? ? ? ? ?68 (26%) ? ? ? ?0 - 255
>>>
>>> Focus, Auto ? ? ? ? ? ? ? True ? ? ? ? ? ?True | False
>>>
>>> Zoom, Absolute ? ? ? ? ? ?1 ? ? ? ? ? ? ? 1 - 5
>>>
>>>
>>>
>>> I'm grabbing images in MJPG format and I wonder if that fact is confusing
>>> the camera. Under windows you can watch it adjust exposure and gain until
>>> the image looks good (when in auto mode).
>>>
>>> The values above appear to be the default values after a power cycle of
>>> the camera (plug and unplug the USB).
>>>
>>> Does anyone have any idea what is going on? I'd rather not have to put
>>> the camera in the manual exposure mode and then control it in software.....
>>>
>>> Philip
>>>
>>> _______________________________________________
>>> Linux-uvc-devel mailing list
>>> Linux-uvc-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>>
>>>
>>
>>
>>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>


From overclocked at yandex.ru  Sun Aug 14 10:20:12 2011
From: overclocked at yandex.ru (overclocked)
Date: Sun, 14 Aug 2011 10:20:12 +0200
Subject: [Linux-uvc-devel] 05c8:0403 listed as supported but is not working
Message-ID: <4E47853C.2060709@yandex.ru>

Dear ladies and gentlemen.

As I wrote before, the following webcam is NOT working on my HP 4720s 
laptop:

05c8:0403 Cheng Uei Precision Industry Co., Ltd (Foxlink).

I have installed (today) last version of the uvc driver. (from git clone 
git://linuxtv.org/media_build.git).

When I try to test it with 'guvcview' it works about 20 secons only. 
Then video freezes, webcam LED turns off.

guvcview writes the following to console output:

libv4l2: error dequeuing buf: No such device
VIDIOC_DQBUF - Unable to dequeue buffer : No such device
Error grabbing image
libv4l2: error dequeuing buf: No such device
VIDIOC_DQBUF - Unable to dequeue buffer : No such device
Error grabbing image
libv4l2: error dequeuing buf: No such device
VIDIOC_DQBUF - Unable to dequeue buffer : No such device
Error grabbing image
libv4l2: error dequeuing buf: No such device
VIDIOC_DQBUF - Unable to dequeue buffer : No such device
Error grabbing image
...

If I restart guvcview, it just shows same errors and black screen 
instead of video.

BUT!!! If I restart the driver using:

$ sudo modprobe -r uvcvideo
$ sudo modprobe uvcvideo

video in guvcview works again!!! (for about 20 seconds).

So I think that it's definitely a problem with UVC driver.

You have already answered me, that it works on HP Mini 5103 netbook. But 
if it works on your system, it does not always mean that it will work on 
others.

Thank You in advance,
Kind Regards,

-- 
Andrey Sapegin.



From bug-track at fisher-privat.net  Sun Aug 14 12:00:09 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sun, 14 Aug 2011 12:00:09 +0200
Subject: [Linux-uvc-devel] 05c8:0403 listed as supported but is not
	working
In-Reply-To: <4E47853C.2060709@yandex.ru>
References: <4E47853C.2060709@yandex.ru>
Message-ID: <4E479CA9.5030208@fisher-privat.net>

Hi,
can you please attach output of:
lsusb -vd 05c8:0403 > lsusb

also reload uvcvideo module with:
sudo rmmod uvcvideo && sudo modporbe uvcvideo trace=0xfff

capture video until it brakes and attach dmesg to email as well, please
send complete dmesg not just last part with error. You may gzip it.

Regards,
Alexey

On 14.08.2011 10:20, overclocked wrote:
> Dear ladies and gentlemen.
> 
> As I wrote before, the following webcam is NOT working on my HP 4720s
> laptop:
> 
> 05c8:0403 Cheng Uei Precision Industry Co., Ltd (Foxlink).
> 
> I have installed (today) last version of the uvc driver. (from git clone
> git://linuxtv.org/media_build.git).
> 
> When I try to test it with 'guvcview' it works about 20 secons only.
> Then video freezes, webcam LED turns off.
> 
> guvcview writes the following to console output:
> 
> libv4l2: error dequeuing buf: No such device
> VIDIOC_DQBUF - Unable to dequeue buffer : No such device
> Error grabbing image
> libv4l2: error dequeuing buf: No such device
> VIDIOC_DQBUF - Unable to dequeue buffer : No such device
> Error grabbing image
> libv4l2: error dequeuing buf: No such device
> VIDIOC_DQBUF - Unable to dequeue buffer : No such device
> Error grabbing image
> libv4l2: error dequeuing buf: No such device
> VIDIOC_DQBUF - Unable to dequeue buffer : No such device
> Error grabbing image
> ...
> 
> If I restart guvcview, it just shows same errors and black screen
> instead of video.
> 
> BUT!!! If I restart the driver using:
> 
> $ sudo modprobe -r uvcvideo
> $ sudo modprobe uvcvideo
> 
> video in guvcview works again!!! (for about 20 seconds).
> 
> So I think that it's definitely a problem with UVC driver.
> 
> You have already answered me, that it works on HP Mini 5103 netbook. But
> if it works on your system, it does not always mean that it will work on
> others.
> 
> Thank You in advance,
> Kind Regards,
> 



From bug-track at fisher-privat.net  Mon Aug 15 20:52:38 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 15 Aug 2011 20:52:38 +0200
Subject: [Linux-uvc-devel] 05c8:0403 listed as supported but is not
	working
In-Reply-To: <4E482B3B.1040708@yandex.ru>
References: <4E47853C.2060709@yandex.ru> <4E479CA9.5030208@fisher-privat.net>
	<4E47B86D.70701@yandex.ru> <4E47F3E1.3010603@fisher-privat.net>
	<4E482B3B.1040708@yandex.ru>
Message-ID: <4E496AF6.4060303@fisher-privat.net>

Hi,

i decoded your usbmon dump, here is how usually looks conversation
between webcam and pc:

1) webcam send some data, and the it get response from the host, to
confirm that data as recived, this is the confiramtion:
ffff8800844a0c00 0.000106 S Zi:1:033:1 -115:?:? 32
 512 =
0(-18:0:2688:0) 1(-18:2688:2688:0) 2(-18:5376:2688:0) 3(-18:8064:2688:0)
4(-18:10752:2688:0) 5(-18:13440:2688:0) 6(-18:16128:2688:0)
7(-18:18816:2688:0) 8(-18:21504:2688:0) 9(-18:24192:2688:0)
10(-18:26880:2688:0) 11(-18:29568:2688:0) 12(-18:32256:2688:0)
13(-18:34944:2688:0) 14(-18:37632:2688:0) 15(-18:40320:2688:0)
16(-18:43008:2688:0) 17(-18:45696:2688:0) 18(-18:48384:2688:0)
19(-18:51072:2688:0) 20(-18:53760:2688:0) 21(-18:56448:2688:0)
22(-18:59136:2688:0) 23(-18:61824:2688:0) 24(-18:64512:2688:0)
25(-18:67200:2688:0) 26(-18:69888:2688:0) 27(-18:72576:2688:0)
28(-18:75264:2688:0) 29(-18:77952:2688:0) 30(-18:80640:2688:0)
31(-18:83328:2688:0)

a) 0(-18:0:2688:0) -> 0 ist the packet number in usb buffer, -18 -
Cross-device link; 0 - memory offset in usb buffer; 2688 - maxPacketSize
2) the data from web cam usually looks almost like this:
ffff8800844a6800 0.003874 C Zi:1:033:1 0:?:? 32
 22028 =
0(0:0:12:0) :   <-- same like before, every thing is ok
0c8c48d99c282e1ede288a03  <-- uvc header, but no image data. (usually ok
too)
1(0:2688:12:0) :
0c8c48d99c288125de288b03
2(0:5376:12:0) :
0c8c48d99c28d42cde288b03
3(0:8064:12:0) :
0c8c48d99c282734de288b03
4(0:10752:12:0) :
0c8c48d99c287a3bde288b03
5(0:13440:12:0) :
0c8c48d99c28cd42de288b03
6(0:16128:12:0) :
0c8c48d99c28204ade288b03
7(0:18816:12:0) :
0c8c48d99c287351de288b03
8(0:21504:12:0) :
0c8c48d99c28c658de288b03
9(-71:24192:0:0)  <--- this is first bad packet. -71 - EPROTO, Protocol
error. At this stage no packet was or should be send by from pc to the
cam. It's mean the error source should be inside of the cam.
10(-71:26880:0:0) 11(-71:29568:0:0) 12(-71:32256:0:0) 13(-71:34944:0:0)
14(-71:37632:0:0) 15(-71:40320:0:0) 16(-71:43008:0:0) 17(-71:45696:0:0)
18(-71:48384:0:0) 19(-71:51072:0:0) 20(-71:53760:0:0) 21(-71:56448:0:0)
22(-71:59136:0:0) 23(-71:61824:0:0) 24(-71:64512:0:0) 25(-71:67200:0:0)
26(-71:69888:0:0) 27(-71:72576:0:0) 28(-71:75264:0:0) 29(-71:77952:0:0)
30(-71:80640:0:0) 31(-71:83328:0:0)

Before "USB Protocol error" your camera send about 640 packets without
video data, but with uvc headers. I assume it filed at this stage.

I do not see any reasons where uvcvideo driver made some error. I assume
that this webcam is broken.


On 14.08.2011 22:08, overclocked wrote:
> Hello,
> 
> unfortunately, I have no possibility to check webcam on Windows (I have
> only Ubuntu 11.04 on my laptop and currently do not have a storage to
> backup all and install Windows to check it).
> 
> I have used wireshark on Linux...
> 
> There are 2 usb interfaces:
> usbmon1 and usbmon2
> 
> I have captured the usbmon1... See  file attached.
> 
> I also have captured usbdump.
> It's 120 Mb, so I have used depositfiles for it:
> http://depositfiles.com/files/ssee74mok
> 
> Also I have noticed that after some time webcam disappears from lsusb...
> 
> Thank You in advance,
> Kind Regards,
> 
> Andrey.
> 
> 
> On 08/14/2011 06:12 PM, Alexey Fisher wrote:
>> Hi,
>>
>> can you confirm, this webcam do work on windows with uvcvideo driver?
>>
>> If yes, can you capture usb traffic like it described here:
>> http://lindi.iki.fi/lindi/usb/usbsnoop.txt
>>
>> As alternative you can use wireshark.
>> Your webcam located on Bus 001 Device 017, some times you need to know
>> it to capture usb dump.
>>
>> Also it will be good to have usb dump from linux, usbmon module should
>> be loaded/compiled.
>>
>> To capture you need:
>> cat /dev/usbmon1 > usbdump
>>
>> use Ctrl+C to stop it.
>>
>> gzip usbdump
>>
>> Actually you can use wireshark on linux as well.
>>
>> if it really big use rapidshare or filesonic or some thing like this
>> for upload.
>>
>>
>> Am 14.08.2011 13:58, schrieb overclocked:
>>> Yes, thank you for the answer.
>>>
>>> See files in the attachment.
>>
> 
> 



From overclocked at yandex.ru  Mon Aug 15 22:32:01 2011
From: overclocked at yandex.ru (overclocked)
Date: Mon, 15 Aug 2011 22:32:01 +0200
Subject: [Linux-uvc-devel] 05c8:0403 listed as supported but is not
	working
In-Reply-To: <4E496AF6.4060303@fisher-privat.net>
References: <4E47853C.2060709@yandex.ru> <4E479CA9.5030208@fisher-privat.net>
	<4E47B86D.70701@yandex.ru> <4E47F3E1.3010603@fisher-privat.net>
	<4E482B3B.1040708@yandex.ru> <4E496AF6.4060303@fisher-privat.net>
Message-ID: <4E498241.7040806@yandex.ru>

Dear Alexey,

Thank You very much for your reply and help...

I think now you are right that it's broken... Will try it under Windows 
within next month and repair if it will not work.

Sorry for the trouble and thank you very much again:)

Kind Regards,
Andrey.

On 08/15/2011 08:52 PM, Alexey Fisher wrote:
> Hi,
>
> i decoded your usbmon dump, here is how usually looks conversation
> between webcam and pc:
>
> 1) webcam send some data, and the it get response from the host, to
> confirm that data as recived, this is the confiramtion:
> ffff8800844a0c00 0.000106 S Zi:1:033:1 -115:?:? 32
>   512 =
> 0(-18:0:2688:0) 1(-18:2688:2688:0) 2(-18:5376:2688:0) 3(-18:8064:2688:0)
> 4(-18:10752:2688:0) 5(-18:13440:2688:0) 6(-18:16128:2688:0)
> 7(-18:18816:2688:0) 8(-18:21504:2688:0) 9(-18:24192:2688:0)
> 10(-18:26880:2688:0) 11(-18:29568:2688:0) 12(-18:32256:2688:0)
> 13(-18:34944:2688:0) 14(-18:37632:2688:0) 15(-18:40320:2688:0)
> 16(-18:43008:2688:0) 17(-18:45696:2688:0) 18(-18:48384:2688:0)
> 19(-18:51072:2688:0) 20(-18:53760:2688:0) 21(-18:56448:2688:0)
> 22(-18:59136:2688:0) 23(-18:61824:2688:0) 24(-18:64512:2688:0)
> 25(-18:67200:2688:0) 26(-18:69888:2688:0) 27(-18:72576:2688:0)
> 28(-18:75264:2688:0) 29(-18:77952:2688:0) 30(-18:80640:2688:0)
> 31(-18:83328:2688:0)
>
> a) 0(-18:0:2688:0) ->  0 ist the packet number in usb buffer, -18 -
> Cross-device link; 0 - memory offset in usb buffer; 2688 - maxPacketSize
> 2) the data from web cam usually looks almost like this:
> ffff8800844a6800 0.003874 C Zi:1:033:1 0:?:? 32
>   22028 =
> 0(0:0:12:0) :<-- same like before, every thing is ok
> 0c8c48d99c282e1ede288a03<-- uvc header, but no image data. (usually ok
> too)
> 1(0:2688:12:0) :
> 0c8c48d99c288125de288b03
> 2(0:5376:12:0) :
> 0c8c48d99c28d42cde288b03
> 3(0:8064:12:0) :
> 0c8c48d99c282734de288b03
> 4(0:10752:12:0) :
> 0c8c48d99c287a3bde288b03
> 5(0:13440:12:0) :
> 0c8c48d99c28cd42de288b03
> 6(0:16128:12:0) :
> 0c8c48d99c28204ade288b03
> 7(0:18816:12:0) :
> 0c8c48d99c287351de288b03
> 8(0:21504:12:0) :
> 0c8c48d99c28c658de288b03
> 9(-71:24192:0:0)<--- this is first bad packet. -71 - EPROTO, Protocol
> error. At this stage no packet was or should be send by from pc to the
> cam. It's mean the error source should be inside of the cam.
> 10(-71:26880:0:0) 11(-71:29568:0:0) 12(-71:32256:0:0) 13(-71:34944:0:0)
> 14(-71:37632:0:0) 15(-71:40320:0:0) 16(-71:43008:0:0) 17(-71:45696:0:0)
> 18(-71:48384:0:0) 19(-71:51072:0:0) 20(-71:53760:0:0) 21(-71:56448:0:0)
> 22(-71:59136:0:0) 23(-71:61824:0:0) 24(-71:64512:0:0) 25(-71:67200:0:0)
> 26(-71:69888:0:0) 27(-71:72576:0:0) 28(-71:75264:0:0) 29(-71:77952:0:0)
> 30(-71:80640:0:0) 31(-71:83328:0:0)
>
> Before "USB Protocol error" your camera send about 640 packets without
> video data, but with uvc headers. I assume it filed at this stage.
>
> I do not see any reasons where uvcvideo driver made some error. I assume
> that this webcam is broken.
>
>
> On 14.08.2011 22:08, overclocked wrote:
>> Hello,
>>
>> unfortunately, I have no possibility to check webcam on Windows (I have
>> only Ubuntu 11.04 on my laptop and currently do not have a storage to
>> backup all and install Windows to check it).
>>
>> I have used wireshark on Linux...
>>
>> There are 2 usb interfaces:
>> usbmon1 and usbmon2
>>
>> I have captured the usbmon1... See  file attached.
>>
>> I also have captured usbdump.
>> It's 120 Mb, so I have used depositfiles for it:
>> http://depositfiles.com/files/ssee74mok
>>
>> Also I have noticed that after some time webcam disappears from lsusb...
>>
>> Thank You in advance,
>> Kind Regards,
>>
>> Andrey.
>>
>>
>> On 08/14/2011 06:12 PM, Alexey Fisher wrote:
>>> Hi,
>>>
>>> can you confirm, this webcam do work on windows with uvcvideo driver?
>>>
>>> If yes, can you capture usb traffic like it described here:
>>> http://lindi.iki.fi/lindi/usb/usbsnoop.txt
>>>
>>> As alternative you can use wireshark.
>>> Your webcam located on Bus 001 Device 017, some times you need to know
>>> it to capture usb dump.
>>>
>>> Also it will be good to have usb dump from linux, usbmon module should
>>> be loaded/compiled.
>>>
>>> To capture you need:
>>> cat /dev/usbmon1>  usbdump
>>>
>>> use Ctrl+C to stop it.
>>>
>>> gzip usbdump
>>>
>>> Actually you can use wireshark on linux as well.
>>>
>>> if it really big use rapidshare or filesonic or some thing like this
>>> for upload.
>>>
>>>
>>> Am 14.08.2011 13:58, schrieb overclocked:
>>>> Yes, thank you for the answer.
>>>>
>>>> See files in the attachment.
>>


-- 
Andrey Sapegin,

PhD Student,
University of Leipzig,
Software Developer,
Unister GmbH,
+4915778339304,
andrey at sapegin.org.

Promotionstudent,
Universitaet Leipzig,
Software Entwickler,
Unister GmbH,
+4915778339304,
andrey at sapegin.org.



From rafael.piazenski at gmail.com  Wed Aug 10 16:06:21 2011
From: rafael.piazenski at gmail.com (Rafael Piazenski)
Date: Wed, 10 Aug 2011 11:06:21 -0300
Subject: [Linux-uvc-devel] Microdia Sonix id 0c45:6310
In-Reply-To: <4E42873C.80706@fisher-privat.net>
References: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>
	<4E42873C.80706@fisher-privat.net>
Message-ID: <CAPdm87r5VYdVCNw4p4-WF-qfhsHehecRQ7Fb=zzuc+6t5CgFRQ@mail.gmail.com>

Thanks again, for your help!

The file is attached!
I receiver this output (sorry this is in portuguese, but I'll try to translate):

gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink

Definindo a fila de processamento para PAUSADO...
ERRO: A fila do processamento n?o quer pausar.
ERRO: do elemento /GstPipeline:pipeline0/GstV4l2Src:v4l2src0: O
dispositivo "/dev/video0" n?o p?de ser identificado.
Informa??o adicional de depura??o:
v4l2_calls.c(493): gst_v4l2_open (): /GstPipeline:pipeline0/GstV4l2Src:v4l2src0:
system error: Arquivo ou diret?rio n?o encontrado
Definindo a fila de processamento para NULO...
Liberando a fila de processamento...

Setting the queue processing to PAUSED ...
ERROR: The queue does not want to pause processing.
ERROR: from element / GstPipeline: pipeline0/GstV4l2Src: v4l2src0:
Device "/ dev/video0" could not be identified.
Additional information for debugging:
v4l2_calls.c (493): gst_v4l2_open (): / GstPipeline:
pipeline0/GstV4l2Src: v4l2src0:
system error: File or directory not found
Setting the processing queue to NULL ...
Releasing the queue processing ...

Hope this can help!
Rafael

2011/8/10 Alexey Fisher <bug-track at fisher-privat.net>:
> On 10.08.2011 15:11, Rafael Piazenski wrote:
>> Hello people!
>> First of all, thanks for your help!
>> I have this webcam on my ubuntu 11.04 in a HP TX2500 (2540br).
>> My webcam is recognized, but there is no /dev/video0 for it.
>> Can you help me solve this issue?
>> Thanks a lot!
>> Rafael Piazenski
>>
>> Bus 002 Device 004: ID 0c45:6310 Microdia Sonix USB 2.0 Camera
>>
>> lsusb -d 0c45:6310 -v | grep "14 Video"
>> can't get device qualifier: Operation not permitted
>> can't get debug descriptor: Operation not permitted
>> cannot read device status, Operation not permitted (1)
>> ? ? ? bFunctionClass ? ? ? ? 14 Video
>
> Please attach complete lsusb output.
> Use: sudo lsusb -vd 0c45:6310 > lsusb
>
> Then reload uvc module with debug options:
> sudo rmmod uvcvideo && sudo modpprobe uvcvideo trace=0xfff
>
> play some thing, for example:
> gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink
>
> this will capture only 3 frames. And after this attach dmesg output as well.
>
> Regards,
> ? ? ? ?Alexey
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lsusb
Type: application/octet-stream
Size: 16112 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110810/79d6bef1/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmesg
Type: application/octet-stream
Size: 59625 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110810/79d6bef1/attachment-0001.obj>

From overclocked at yandex.ru  Sun Aug 14 15:39:09 2011
From: overclocked at yandex.ru (overclocked)
Date: Sun, 14 Aug 2011 15:39:09 +0200
Subject: [Linux-uvc-devel] Fwd: Re: 05c8:0403 listed as supported but is not
 working
Message-ID: <4E47CFFD.4050504@yandex.ru>

Yes, thank you for the answer.

See files in the attachment.

On 08/14/2011 12:00 PM, Alexey Fisher wrote:
>  Hi,
>  can you please attach output of:
>  lsusb -vd 05c8:0403>   lsusb
>
>  also reload uvcvideo module with:
>  sudo rmmod uvcvideo&&   sudo modporbe uvcvideo trace=0xfff
>
>  capture video until it brakes and attach dmesg to email as well, please
>  send complete dmesg not just last part with error. You may gzip it.
>
>  Regards,
>  Alexey
>
>  On 14.08.2011 10:20, overclocked wrote:
>>  Dear ladies and gentlemen.
>>
>>  As I wrote before, the following webcam is NOT working on my HP 4720s
>>  laptop:
>>
>>  05c8:0403 Cheng Uei Precision Industry Co., Ltd (Foxlink).
>>
>>  I have installed (today) last version of the uvc driver. (from git clone
>>  git://linuxtv.org/media_build.git).
>>
>>  When I try to test it with 'guvcview' it works about 20 secons only.
>>  Then video freezes, webcam LED turns off.
>>
>>  guvcview writes the following to console output:
>>
>>  libv4l2: error dequeuing buf: No such device
>>  VIDIOC_DQBUF - Unable to dequeue buffer : No such device
>>  Error grabbing image
>>  libv4l2: error dequeuing buf: No such device
>>  VIDIOC_DQBUF - Unable to dequeue buffer : No such device
>>  Error grabbing image
>>  libv4l2: error dequeuing buf: No such device
>>  VIDIOC_DQBUF - Unable to dequeue buffer : No such device
>>  Error grabbing image
>>  libv4l2: error dequeuing buf: No such device
>>  VIDIOC_DQBUF - Unable to dequeue buffer : No such device
>>  Error grabbing image
>>  ...
>>
>>  If I restart guvcview, it just shows same errors and black screen
>>  instead of video.
>>
>>  BUT!!! If I restart the driver using:
>>
>>  $ sudo modprobe -r uvcvideo
>>  $ sudo modprobe uvcvideo
>>
>>  video in guvcview works again!!! (for about 20 seconds).
>>
>>  So I think that it's definitely a problem with UVC driver.
>>
>>  You have already answered me, that it works on HP Mini 5103 netbook. But
>>  if it works on your system, it does not always mean that it will work on
>>  others.
>>
>>  Thank You in advance,
>>  Kind Regards,
>>

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110814/50272145/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lsusb
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110814/50272145/attachment-0001.ksh>

From overclocked at yandex.ru  Sun Aug 14 22:08:27 2011
From: overclocked at yandex.ru (overclocked)
Date: Sun, 14 Aug 2011 22:08:27 +0200
Subject: [Linux-uvc-devel] 05c8:0403 listed as supported but is not
	working
In-Reply-To: <4E47F3E1.3010603@fisher-privat.net>
References: <4E47853C.2060709@yandex.ru> <4E479CA9.5030208@fisher-privat.net>
	<4E47B86D.70701@yandex.ru> <4E47F3E1.3010603@fisher-privat.net>
Message-ID: <4E482B3B.1040708@yandex.ru>

Hello,

unfortunately, I have no possibility to check webcam on Windows (I have 
only Ubuntu 11.04 on my laptop and currently do not have a storage to 
backup all and install Windows to check it).

I have used wireshark on Linux...

There are 2 usb interfaces:
usbmon1 and usbmon2

I have captured the usbmon1... See  file attached.

I also have captured usbdump.
It's 120 Mb, so I have used depositfiles for it:
http://depositfiles.com/files/ssee74mok

Also I have noticed that after some time webcam disappears from lsusb...

Thank You in advance,
Kind Regards,

Andrey.


On 08/14/2011 06:12 PM, Alexey Fisher wrote:
> Hi,
>
> can you confirm, this webcam do work on windows with uvcvideo driver?
>
> If yes, can you capture usb traffic like it described here:
> http://lindi.iki.fi/lindi/usb/usbsnoop.txt
>
> As alternative you can use wireshark.
> Your webcam located on Bus 001 Device 017, some times you need to know 
> it to capture usb dump.
>
> Also it will be good to have usb dump from linux, usbmon module should 
> be loaded/compiled.
>
> To capture you need:
> cat /dev/usbmon1 > usbdump
>
> use Ctrl+C to stop it.
>
> gzip usbdump
>
> Actually you can use wireshark on linux as well.
>
> if it really big use rapidshare or filesonic or some thing like this 
> for upload.
>
>
> Am 14.08.2011 13:58, schrieb overclocked:
>> Yes, thank you for the answer.
>>
>> See files in the attachment.
>


-- 
Andrey Sapegin,

PhD Student,
University of Leipzig,
Software Developer,
Unister GmbH,
+4915778339304,
andrey at sapegin.org.

Promotionstudent,
Universitaet Leipzig,
Software Entwickler,
Unister GmbH,
+4915778339304,
andrey at sapegin.org.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: wireshark_usb001.tar.bz2
Type: application/x-bzip
Size: 78006 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110814/eb1f6280/attachment.bin>

From elsonidoq at gmail.com  Wed Aug 17 16:52:20 2011
From: elsonidoq at gmail.com (=?ISO-8859-1?Q?Pablo_Hern=E1n_Rodriguez_Zivic?=)
Date: Wed, 17 Aug 2011 11:52:20 -0300
Subject: [Linux-uvc-devel] UVC + Dell XPS 15 + Ubuntu 11.04
Message-ID: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>

Hello members of the list!

I have a what the subject says.
I tried to use de driver in de apt, and also I downloaded the driver from
the git repo http://git.linuxtv.org/media_build.git.

In either cases the problem appears to be a timeout in the select function
(after a lot of googling =p, but I don't really know what I'm talking
about).

The output of dmesg | grep uvc appears to be normal, or at least shared by a
lot of posts that doesn't claim to have this problem.

I'm running out of options...

Do anybody know what can I do?

Thanks!

Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110817/eeaf7b2f/attachment.html>

From michal at physics.ubc.ca  Wed Aug 17 20:26:54 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Wed, 17 Aug 2011 11:26:54 -0700 (PDT)
Subject: [Linux-uvc-devel] UVC + Dell XPS 15 + Ubuntu 11.04
In-Reply-To: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>
References: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>
Message-ID: <alpine.LNX.2.00.1108171122040.5545@spider.phas.ubc.ca>

Hi Pablo,

I have the same computer and the camera has given me lots of grief, but I 
have a patch to the stock uvc driver that makes the camera work more or 
less perfectly.

This patch adds a quirk for the camera and then repairs several different 
pathologies in the data stream that comes from the camera.

I'll be very interested to hear if it solves your problems.

One other problem I have sometimes with the camera is that occasionally it 
just won't start - in that case, the solution for me is just to point the 
camera at a light source.

Carl

On Wed, 17 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:

> Hello members of the list!
>
> I have a what the subject says.
> I tried to use de driver in de apt, and also I downloaded the driver from
> the git repo http://git.linuxtv.org/media_build.git.
>
> In either cases the problem appears to be a timeout in the select function
> (after a lot of googling =p, but I don't really know what I'm talking
> about).
>
> The output of dmesg | grep uvc appears to be normal, or at least shared by a
> lot of posts that doesn't claim to have this problem.
>
> I'm running out of options...
>
> Do anybody know what can I do?
>
> Thanks!
>
> Pablo
>
-------------- next part --------------
diff -ur linux-2.6.39/drivers/media/video/uvc//uvc_driver.c linux-2.6.39-gentoo-r1/drivers/media/video/uvc//uvc_driver.c
--- linux-2.6.39/drivers/media/video/uvc//uvc_driver.c	2011-05-18 21:06:34.000000000 -0700
+++ linux-2.6.39-gentoo-r1/drivers/media/video/uvc//uvc_driver.c	2011-07-11 23:29:15.852000885 -0700
@@ -2271,6 +2286,14 @@
 	  .bInterfaceProtocol	= 0,
 	  .driver_info		= UVC_QUIRK_PROBE_MINMAX
 				| UVC_QUIRK_IGNORE_SELECTOR_UNIT },
+	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
+				| USB_DEVICE_ID_MATCH_INT_INFO,
+	  .idVendor		= 0x0408,
+	  .idProduct		= 0x2fb1,
+	  .bInterfaceClass	= USB_CLASS_VIDEO,
+	  .bInterfaceSubClass	= 1,
+	  .bInterfaceProtocol	= 0,
+	  .driver_info		= UVC_QUIRK_QUANTA },
 	/* Generic USB Video Class */
 	{ USB_INTERFACE_INFO(USB_CLASS_VIDEO, 1, 0) },
 	{}
diff -ur linux-2.6.39/drivers/media/video/uvc//uvc_video.c linux-2.6.39-gentoo-r1/drivers/media/video/uvc//uvc_video.c
--- linux-2.6.39/drivers/media/video/uvc//uvc_video.c	2011-05-18 21:06:34.000000000 -0700
+++ linux-2.6.39-gentoo-r1/drivers/media/video/uvc//uvc_video.c	2011-07-11 22:40:11.854516550 -0700
@@ -426,7 +426,14 @@
 		return -ENODATA;
 	}
 
-	fid = data[1] & UVC_STREAM_FID;
+	/* Make sure, if we use NO_FID quirk, we really use no FID bit.
+	 */
+	if (stream->dev->quirks & UVC_QUIRK_STREAM_NO_FID ||
+	    ((stream->dev->quirks & UVC_QUIRK_QUANTA) && 
+	     (stream->cur_format->flags & UVC_FMT_FLAG_COMPRESSED) ))
+		fid = 0;
+	else
+		fid = data[1] & UVC_STREAM_FID;
 
 	/* Increase the sequence number regardless of any buffer states, so
 	 * that discontinuous sequence numbers always indicate lost frames.
@@ -456,9 +463,11 @@
 		if (fid == stream->last_fid) {
 			uvc_trace(UVC_TRACE_FRAME, "Dropping payload (out of "
 				"sync).\n");
-			if ((stream->dev->quirks & UVC_QUIRK_STREAM_NO_FID) &&
-			    (data[1] & UVC_STREAM_EOF))
-				stream->last_fid ^= UVC_STREAM_FID;
+			if  (data[1] & UVC_STREAM_EOF)
+			     if (stream->dev->quirks & UVC_QUIRK_STREAM_NO_FID ||
+				 ((stream->dev->quirks & UVC_QUIRK_QUANTA) && 
+				  (stream->cur_format->flags & UVC_FMT_FLAG_COMPRESSED) ))
+			          stream->last_fid ^= UVC_STREAM_FID;
 			return -ENODATA;
 		}
 
@@ -534,9 +543,14 @@
 		uvc_trace(UVC_TRACE_FRAME, "Frame complete (EOF found).\n");
 		if (data[0] == len)
 			uvc_trace(UVC_TRACE_FRAME, "EOF in empty payload.\n");
+		else
+		  uvc_trace(UVC_TRACE_FRAME,"EOF in NON_EMPTY payload, frame: %i, payload len: %d, bytes: %d\n",stream->sequence,len-data[0], buf->buf.bytesused);
 		buf->state = UVC_BUF_STATE_READY;
-		if (stream->dev->quirks & UVC_QUIRK_STREAM_NO_FID)
-			stream->last_fid ^= UVC_STREAM_FID;
+
+		if (stream->dev->quirks & UVC_QUIRK_STREAM_NO_FID ||
+		    ((stream->dev->quirks & UVC_QUIRK_QUANTA) && 
+		     (stream->cur_format->flags & UVC_FMT_FLAG_COMPRESSED) ))
+		     stream->last_fid ^= UVC_STREAM_FID;
 	}
 }
 
@@ -583,6 +597,94 @@
  * URB handling
  */
 
+/* filtering to repair fragmented packets from Quanta webcam */
+
+static void repair_quanta_stream(struct urb *urb, 
+				 struct uvc_streaming *stream, int fno)
+{
+  int psize;
+  static int qbytes=0;
+  static u8 qbuf[3072]; 
+
+  /* qbytes and qbuf should be per-stream - included in 
+   * uvc_streaming structure ?
+   */
+
+  psize = stream->urb_size / urb->number_of_packets;
+  /* repair only needed if the packet should be assembled from
+     three transfers */
+  if (psize != 3*760 && psize != 3*1024) return;
+  
+  /* If the packet is unfull but exactly 1/3 or 2/3 the full length, 
+   * assume it is fragmented.  If it turns out not to be, it gets
+   *  fixed later 
+   */
+
+  if ((urb->iso_frame_desc[fno].actual_length == psize/3 || 
+       urb->iso_frame_desc[fno].actual_length == 2*psize/3) && qbytes == 0 ){
+       uvc_trace(UVC_TRACE_FRAME,"starting fix, frame: %d\n",stream->sequence);
+       pr_info("starting fix, frame: %d\n",stream->sequence);
+       memcpy(qbuf,urb->transfer_buffer+urb->iso_frame_desc[fno].offset,
+	      urb->iso_frame_desc[fno].actual_length);
+       qbytes = urb->iso_frame_desc[fno].actual_length;
+       urb->iso_frame_desc[fno].actual_length = 0;
+  }
+  /* if we started filling our buffer, keep filling it. 
+   */
+  else if ( qbytes > 0 ){
+       if (urb->iso_frame_desc[fno].actual_length + qbytes <= psize ){
+	 /* But, if the next packet is a header, we shouldn't have done this.  This can happen
+	  * if the video frame ends with exactly 1/3 or 2/3 full packet.
+	  * 
+	  * The Quanta camera always sends empty payload packets with EOF.  This packet has
+	  * a length of 12. So test for empty packet, length of 12 and EOF set.
+	  *  
+	  * If the camera were to ever send a header that was not 12 bytes this would fail
+	  * looks like headers could in principle be 12, 8, 6, or 2 bytes. 
+	  */
+
+	    if (urb->iso_frame_desc[fno].actual_length == 12 && 
+	        ((u8 *) (urb->transfer_buffer+urb->iso_frame_desc[fno].offset))[0] == 12 &&
+		((u8 *) (urb->transfer_buffer+urb->iso_frame_desc[fno].offset))[1] & 
+		UVC_STREAM_EOF ){
+	      /* throw away the packet, but mark the previous with EOF 
+	       */
+	         urb->iso_frame_desc[fno].actual_length = 0;
+		 qbuf[1] |= UVC_STREAM_EOF;
+		 pr_info("coincidentally full packet followed by EOF, frame: %d\n",stream->sequence);
+	    }
+	    else{ 
+	      /*  continue filling our buffer  */
+	         memcpy(&qbuf[qbytes],urb->transfer_buffer+urb->iso_frame_desc[fno].offset,
+			urb->iso_frame_desc[fno].actual_length);
+		 qbytes += urb->iso_frame_desc[fno].actual_length;
+		 urb->iso_frame_desc[fno].actual_length = 0;
+	    }
+       }
+       else{ 
+	 /* We're here if adding the next packet would overfill our buffer.
+	  * This only seems to happen if the camera gives up on a frame 
+	  * and toggles fid. So we'll throw away what we've been 
+	  * assembling, because it's a broken frame anyway. 
+	  */
+	    uvc_trace(UVC_TRACE_FRAME,"repair_quanta: abandoned frame during repair? " 
+		      "buffer would overfill\n");
+	    qbytes = 0;
+       }
+  }
+  /* copy the buffer back into the stream if it's time */
+  if ((qbytes != 0 && qbytes != psize/3 && qbytes != 2*psize/3) || 
+      (qbuf[1] & UVC_STREAM_EOF && qbytes != 0)){
+       memcpy(urb->transfer_buffer+urb->iso_frame_desc[fno].offset,qbuf,qbytes);
+       uvc_trace(UVC_TRACE_FRAME,"fixing packet, frame: %i\n",stream->sequence);
+       urb->iso_frame_desc[fno].actual_length = qbytes;
+       qbuf[1] = 0;
+       qbytes =0;
+  }
+
+
+}
+
 /*
  * Completion handler for video URBs.
  */
@@ -602,14 +704,25 @@
 			continue;
 		}
 
+		/* Filter to repair fragmented packets for Quanta */
+		if (stream->dev->quirks & UVC_QUIRK_QUANTA)
+		  repair_quanta_stream(urb, stream, i);
+		    
+
 		/* Decode the payload header. */
 		mem = urb->transfer_buffer + urb->iso_frame_desc[i].offset;
 		do {
 			ret = uvc_video_decode_start(stream, buf, mem,
 				urb->iso_frame_desc[i].actual_length);
-			if (ret == -EAGAIN)
-				buf = uvc_queue_next_buffer(&stream->queue,
-							    buf);
+			if (ret == -EAGAIN){
+			    if (buf->buf.length != buf->buf.bytesused &&
+				  !(stream->cur_format->flags &
+				      UVC_FMT_FLAG_COMPRESSED))
+			        buf->error = 1;
+
+			    buf = uvc_queue_next_buffer(&stream->queue,
+							buf);
+			}
 		} while (ret == -EAGAIN);
 
 		if (ret < 0)
diff -ur linux-2.6.39/drivers/media/video/uvc//uvcvideo.h linux-2.6.39-gentoo-r1/drivers/media/video/uvc//uvcvideo.h
--- linux-2.6.39/drivers/media/video/uvc//uvcvideo.h	2011-05-18 21:06:34.000000000 -0700
+++ linux-2.6.39-gentoo-r1/drivers/media/video/uvc//uvcvideo.h	2011-06-25 22:50:03.732334446 -0700
@@ -1,3 +1,4 @@
+
 #ifndef _USB_VIDEO_H_
 #define _USB_VIDEO_H_
 
@@ -185,6 +186,7 @@
 #define UVC_QUIRK_FIX_BANDWIDTH		0x00000080
 #define UVC_QUIRK_PROBE_DEF		0x00000100
 #define UVC_QUIRK_RESTRICT_FRAME_RATE	0x00000200
+#define UVC_QUIRK_QUANTA               0x00000400
 
 /* Format flags */
 #define UVC_FMT_FLAG_COMPRESSED		0x00000001


From elsonidoq at gmail.com  Wed Aug 17 23:37:33 2011
From: elsonidoq at gmail.com (=?ISO-8859-1?Q?Pablo_Hern=E1n_Rodriguez_Zivic?=)
Date: Wed, 17 Aug 2011 18:37:33 -0300
Subject: [Linux-uvc-devel] UVC + Dell XPS 15 + Ubuntu 11.04
In-Reply-To: <alpine.LNX.2.00.1108171122040.5545@spider.phas.ubc.ca>
References: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>
	<alpine.LNX.2.00.1108171122040.5545@spider.phas.ubc.ca>
Message-ID: <CAA8nfK3ABucA=KrXm51gcJoDdDU4WNTL973nMkSjVhmquKkdFQ@mail.gmail.com>

I have a 2.6.38 kernel :S
You built it from the source?

2011/8/17 Carl Michal <michal at physics.ubc.ca>

> Hi Pablo,
>
> I have the same computer and the camera has given me lots of grief, but I
> have a patch to the stock uvc driver that makes the camera work more or less
> perfectly.
>
> This patch adds a quirk for the camera and then repairs several different
> pathologies in the data stream that comes from the camera.
>
> I'll be very interested to hear if it solves your problems.
>
> One other problem I have sometimes with the camera is that occasionally it
> just won't start - in that case, the solution for me is just to point the
> camera at a light source.
>
> Carl
>
>
> On Wed, 17 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:
>
>  Hello members of the list!
>>
>> I have a what the subject says.
>> I tried to use de driver in de apt, and also I downloaded the driver from
>> the git repo http://git.linuxtv.org/media_**build.git<http://git.linuxtv.org/media_build.git>
>> .
>>
>> In either cases the problem appears to be a timeout in the select function
>> (after a lot of googling =p, but I don't really know what I'm talking
>> about).
>>
>> The output of dmesg | grep uvc appears to be normal, or at least shared by
>> a
>> lot of posts that doesn't claim to have this problem.
>>
>> I'm running out of options...
>>
>> Do anybody know what can I do?
>>
>> Thanks!
>>
>> Pablo
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110817/b6080748/attachment.html>

From michal at physics.ubc.ca  Thu Aug 18 02:16:53 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Wed, 17 Aug 2011 17:16:53 -0700 (PDT)
Subject: [Linux-uvc-devel] UVC + Dell XPS 15 + Ubuntu 11.04
In-Reply-To: <CAA8nfK3ABucA=KrXm51gcJoDdDU4WNTL973nMkSjVhmquKkdFQ@mail.gmail.com>
References: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>
	<alpine.LNX.2.00.1108171122040.5545@spider.phas.ubc.ca>
	<CAA8nfK3ABucA=KrXm51gcJoDdDU4WNTL973nMkSjVhmquKkdFQ@mail.gmail.com>
Message-ID: <alpine.LNX.2.00.1108171708140.21701@spider.phas.ubc.ca>

On Wed, 17 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:

> I have a 2.6.38 kernel :S
> You built it from the source?
>

I've applied that patch to 2.6.39 and 3.0 it applies cleanly to either.  I 
haven't tried 2.6.38, but I think it should work.

You will need to build at least the uvcvideo module from source.  I'm no 
expect here, but I guess I would try applying this patch to the source 
from linuxtv so you don't have to build a whole kernel.

If that doesn't work, there are HOWTO's out there on how to build a kernel 
for ubuntu - I've never done it (I use Gentoo).

Carl




> 2011/8/17 Carl Michal <michal at physics.ubc.ca>
>
>> Hi Pablo,
>>
>> I have the same computer and the camera has given me lots of grief, but I
>> have a patch to the stock uvc driver that makes the camera work more or less
>> perfectly.
>>
>> This patch adds a quirk for the camera and then repairs several different
>> pathologies in the data stream that comes from the camera.
>>
>> I'll be very interested to hear if it solves your problems.
>>
>> One other problem I have sometimes with the camera is that occasionally it
>> just won't start - in that case, the solution for me is just to point the
>> camera at a light source.
>>
>> Carl
>>
>>
>> On Wed, 17 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:
>>
>>  Hello members of the list!
>>>
>>> I have a what the subject says.
>>> I tried to use de driver in de apt, and also I downloaded the driver from
>>> the git repo http://git.linuxtv.org/media_**build.git<http://git.linuxtv.org/media_build.git>
>>> .
>>>
>>> In either cases the problem appears to be a timeout in the select function
>>> (after a lot of googling =p, but I don't really know what I'm talking
>>> about).
>>>
>>> The output of dmesg | grep uvc appears to be normal, or at least shared by
>>> a
>>> lot of posts that doesn't claim to have this problem.
>>>
>>> I'm running out of options...
>>>
>>> Do anybody know what can I do?
>>>
>>> Thanks!
>>>
>>> Pablo
>>>
>>
>

From elsonidoq at gmail.com  Thu Aug 18 18:48:09 2011
From: elsonidoq at gmail.com (=?ISO-8859-1?Q?Pablo_Hern=E1n_Rodriguez_Zivic?=)
Date: Thu, 18 Aug 2011 13:48:09 -0300
Subject: [Linux-uvc-devel] UVC + Dell XPS 15 + Ubuntu 11.04
In-Reply-To: <alpine.LNX.2.00.1108171708140.21701@spider.phas.ubc.ca>
References: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>
	<alpine.LNX.2.00.1108171122040.5545@spider.phas.ubc.ca>
	<CAA8nfK3ABucA=KrXm51gcJoDdDU4WNTL973nMkSjVhmquKkdFQ@mail.gmail.com>
	<alpine.LNX.2.00.1108171708140.21701@spider.phas.ubc.ca>
Message-ID: <CAA8nfK1CmbbXNdm_MR5JcbczsYocSs_c69xjApiFUjg4g+otmg@mail.gmail.com>

Hello Carl!

I have just read the thing about the light source! It made the camera work.

Anyway, I made the patch and install it and it works, but I dont see any
changes, what should I notice?


2011/8/17 Carl Michal <michal at physics.ubc.ca>

> On Wed, 17 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:
>
>  I have a 2.6.38 kernel :S
>> You built it from the source?
>>
>>
> I've applied that patch to 2.6.39 and 3.0 it applies cleanly to either.  I
> haven't tried 2.6.38, but I think it should work.
>
> You will need to build at least the uvcvideo module from source.  I'm no
> expect here, but I guess I would try applying this patch to the source from
> linuxtv so you don't have to build a whole kernel.
>
> If that doesn't work, there are HOWTO's out there on how to build a kernel
> for ubuntu - I've never done it (I use Gentoo).
>
> Carl
>
>
>
>
>  2011/8/17 Carl Michal <michal at physics.ubc.ca>
>>
>>  Hi Pablo,
>>>
>>> I have the same computer and the camera has given me lots of grief, but I
>>> have a patch to the stock uvc driver that makes the camera work more or
>>> less
>>> perfectly.
>>>
>>> This patch adds a quirk for the camera and then repairs several different
>>> pathologies in the data stream that comes from the camera.
>>>
>>> I'll be very interested to hear if it solves your problems.
>>>
>>> One other problem I have sometimes with the camera is that occasionally
>>> it
>>> just won't start - in that case, the solution for me is just to point the
>>> camera at a light source.
>>>
>>> Carl
>>>
>>>
>>> On Wed, 17 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:
>>>
>>>  Hello members of the list!
>>>
>>>>
>>>> I have a what the subject says.
>>>> I tried to use de driver in de apt, and also I downloaded the driver
>>>> from
>>>> the git repo http://git.linuxtv.org/media_****build.git<http://git.linuxtv.org/media_**build.git>
>>>> <http://git.linuxtv.**org/media_build.git<http://git.linuxtv.org/media_build.git>
>>>> >
>>>>
>>>> .
>>>>
>>>> In either cases the problem appears to be a timeout in the select
>>>> function
>>>> (after a lot of googling =p, but I don't really know what I'm talking
>>>> about).
>>>>
>>>> The output of dmesg | grep uvc appears to be normal, or at least shared
>>>> by
>>>> a
>>>> lot of posts that doesn't claim to have this problem.
>>>>
>>>> I'm running out of options...
>>>>
>>>> Do anybody know what can I do?
>>>>
>>>> Thanks!
>>>>
>>>> Pablo
>>>>
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110818/b4e3b810/attachment.html>

From michal at physics.ubc.ca  Thu Aug 18 18:53:07 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Thu, 18 Aug 2011 09:53:07 -0700 (PDT)
Subject: [Linux-uvc-devel] UVC + Dell XPS 15 + Ubuntu 11.04
In-Reply-To: <CAA8nfK1CmbbXNdm_MR5JcbczsYocSs_c69xjApiFUjg4g+otmg@mail.gmail.com>
References: <CAA8nfK3nWK85wUKLnE+dgQn7ktrtXumWY_HcYQAjbnOxDufUAQ@mail.gmail.com>
	<alpine.LNX.2.00.1108171122040.5545@spider.phas.ubc.ca>
	<CAA8nfK3ABucA=KrXm51gcJoDdDU4WNTL973nMkSjVhmquKkdFQ@mail.gmail.com>
	<alpine.LNX.2.00.1108171708140.21701@spider.phas.ubc.ca>
	<CAA8nfK1CmbbXNdm_MR5JcbczsYocSs_c69xjApiFUjg4g+otmg@mail.gmail.com>
Message-ID: <alpine.LNX.2.00.1108180950470.5545@spider.phas.ubc.ca>

Hi Pablo,

On Thu, 18 Aug 2011, Pablo Hern?n Rodriguez Zivic wrote:

> Hello Carl!
>
> I have just read the thing about the light source! It made the camera work.
>
> Anyway, I made the patch and install it and it works, but I dont see any
> changes, what should I notice?
>

If your camera shows no obvious problems without the patch then you don't 
need it.

Without the patch I saw many corrupted frames, especially in higher 
resolution modes.

Carl


From utebachmeier at gmail.com  Thu Aug 18 22:28:29 2011
From: utebachmeier at gmail.com (Sabrina Friedman)
Date: Thu, 18 Aug 2011 23:28:29 +0300
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live! Cam
 Socialize HDfrom Sabrina
Message-ID: <CAJmcYhaG-EPiVeOUi4W6ym1n98rZM6fQQ0JNp6phUrHf7356mg@mail.gmail.com>

Hi Alexey,

On Monday 01 August 2011 08:12:07 Alexey Rempel wrote:
> Am 31.07.2011 18:28, schrieb Laurent Pinchart:
> > On Saturday 30 July 2011 15:08:14 Michael Stapelberg wrote:
> >> Hi,
> >>
> >> I recently bought a Creative Live! Cam Socialize HD (ID 041e:4080) after
> >> verifying that it is a device supported by the uvcvideo driver.
> >>
> >> The device basically works, but to get 30 fps (at 640x480, but also with
> >> higher resolutions), I need to set the 'Exposure, Auto' setting to 1
> >> (Manual Mode). Afterwards, I can set the 'Exposure (Absolute)' setting
> >> to one of the values 39, 78, 156, 312, 625, 1250, 2500, ?. All other
> >> values lead to a heavily over-exposed picture. This effect was already
> >> mentioned on this list for a different cam [1]. I wonder what we can do
> >> about it, as the step size for this setting is reported as '1' while in
> >> reality it seems logarithmic ? with the exception of the step 312 to
> >> 625.
> >
> > Those values are 2500 / 64, 32, 16, 8, 4, 2 and 1. There's unfortunately
> > no way for the driver to know that other values will lead to bad
> > results. I've seen bad firmware bugs, but this one is high on the list.
> >
> >> So, I can live with changing the configuration after plugging in the
> >> cam, which I would automate with udev.
> >>
> >> However, I have noticed that I need to have an active video capture
> >> running, otherwise setting these values with uvcdynctrl has no effect. I
> >> tested it like this:
> >>
> >> 1) Plug in the camera, wait until the white LED (which indicates
> >> capturing)
> >>
> >>    goes off. This takes about 5 seconds.
> >>
> >> 2) Use uvcdynctrl -s 'Exposure, Auto' 1
> >> 3) Verify the result with uvcdynctrl -g 'Exposure, Auto', which also
> >> returns 1 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
> >> 5) Use gst-launch v4l2src ! xvimagesink
> >> ?  The video is at 5 fps instead of 30 fps
> >>
> >> If I do it like this, it works:
> >>
> >> 1) Plug in the camera, wait until the white LED (which indicates
> >> capturing)
> >>
> >>    goes off. This takes about 5 seconds.
> >>
> >> 2) Use gst-launch v4l2src ! xvimagesink, leave it open
> >> 3) Use uvcdynctrl -s 'Exposure, Auto' 1, verify it
> >> 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
> >> ?  The video works correctly
> >
> > That's weird. I'm wondering if the camera doesn't just reset all controls
> > when the video stream is started. What happens in the second case if you
> > stop the video stream and restart it ? Are exposure settings correct, or
> > do they go back to bad values ?
>
> How about usb autosuspend? well be settings stored if usbautosupend is
> disabled, at least for the cam?

The uvcvideo restores controls at resume time, so this shouldn't be an issue.

-- 
Regards,

Laurent Pinchart


Sabrina Friedman
Billige Fl?ge Marketing GmbH
Emanuelstr. 3,
10317 Berlin
Deutschland
Telefon: +49 (33) 5310967
Email: utebachmeier at gmail.com
Site: http://flug.airego.de - Billige Fl?ge vergleichen


From useingubuntu at gmail.com  Sat Aug 20 01:23:11 2011
From: useingubuntu at gmail.com (useingubuntu at gmail.com)
Date: Fri, 19 Aug 2011 16:23:11 -0700
Subject: [Linux-uvc-devel] /dev/video0 disappears after 7 seconds
Message-ID: <20110819232311.GA4256@eniac>

Hi All,
When I run cheese like this:
sudo cheese &

After about 7 sec. the uvcvideo driver puts this message into dmesg:
[ 3108.326835] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3109.229746] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3109.231692] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.263669] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.295668] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.327663] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.359653] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.431646] 2:3:1: cannot get freq at ep 0x84

And reinitializes, causing /dev/video0 to disappear and /dev/video1 to appear
in its place. This confuses Cheese, causing it to print out this message:
libv4l2: error dequeuing buf: No such device

** (cheese:3798): WARNING **: Failed trying to get video frames from device '/dev/video1'.


** (cheese:3798): WARNING **: Internal data flow error.

And Cheese freezes. I've searched Google but haven't been able to find anyone
with a similar problem. I did, however, try doing the LD_PRELOAD trick. I got
the same result. Many thanks in advance for any help on this!
Full dmesg, lsusb, uname, etc. included below.

Thanks,
Matthew

Webcam Make and Model:
HP Deluxe Webcam Rev: 4.1A

uname -a:
Linux eniac 3.0-ARCH #1 SMP PREEMPT Tue Aug 16 07:25:56 UTC 2011 i686 AMD Athlon(TM) XP 1600+ AuthenticAMD GNU/Linux

lsusb:
Bus 001 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 002: ID 05e3:0608 Genesys Logic, Inc. USB-2.0 4-Port HUB
Bus 002 Device 002: ID 04f2:a13c Chicony Electronics Co., Ltd 
Bus 001 Device 003: ID 047d:105e Kensington Bluetooth EDR Dongle
Bus 001 Device 004: ID 13b1:0020 Linksys WUSB54GC v1 802.11g Adapter [Ralink RT73]

sudo cheese &:
(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkImage to a GtkToggleButton, but as a GtkBin subclass a GtkToggleButton can only contain one widget at a time; it already contains a widget of type GtkLabel

(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkImage to a GtkToggleButton, but as a GtkBin subclass a GtkToggleButton can only contain one widget at a time; it already contains a widget of type GtkLabel

(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkImage to a GtkToggleButton, but as a GtkBin subclass a GtkToggleButton can only contain one widget at a time; it already contains a widget of type GtkLabel

(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkHBox to a GtkButton, but as a GtkBin subclass a GtkButton can only contain one widget at a time; it already contains a widget of type GtkLabel

(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkImage to a GtkButton, but as a GtkBin subclass a GtkButton can only contain one widget at a time; it already contains a widget of type GtkLabel

(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkHBox to a GtkToggleButton, but as a GtkBin subclass a GtkToggleButton can only contain one widget at a time; it already contains a widget of type GtkLabel

(cheese:3798): Gtk-WARNING **: Attempting to add a widget with type GtkImage to a GtkButton, but as a GtkBin subclass a GtkButton can only contain one widget at a time; it already contains a widget of type GtkLabel
** Message: cheese-effects-manager.vala:84: Found Twirl (twirl)
** Message: cheese-effects-manager.vala:84: Found Sepia (coloreffects preset=sepia)
** Message: cheese-effects-manager.vala:84: Found Vertigo (vertigotv)
** Message: cheese-effects-manager.vala:84: Found Saturation (videobalance saturation=2)
** Message: cheese-effects-manager.vala:84: Found Pinch (pinch)
** Message: cheese-effects-manager.vala:84: Found Noir/Blanc (videobalance saturation=0)
** Message: cheese-effects-manager.vala:84: Found Distortion (frei0r-filter-distort0r)
** Message: cheese-effects-manager.vala:84: Found X-Ray (coloreffects preset=xray)
** Message: cheese-effects-manager.vala:84: Found Edge (edgetv)
** Message: cheese-effects-manager.vala:84: Found Che Guevara (frei0r-filter-twolay0r)
** Message: cheese-effects-manager.vala:84: Found Sobel (frei0r-filter-sobel)
** Message: cheese-effects-manager.vala:84: Found Mauve (videobalance saturation=1.5 hue=+0.5)
** Message: cheese-effects-manager.vala:84: Found Bulge (bulge)
** Message: cheese-effects-manager.vala:84: Found Kaleidoscope (kaleidoscope)
** Message: cheese-effects-manager.vala:84: Found Hulk (videobalance saturation=1.5 hue=-0.5)
** Message: cheese-effects-manager.vala:84: Found Warp (warptv)
** Message: cheese-effects-manager.vala:84: Found Time delay (frei0r-filter-delay0r delaytime=5)
** Message: cheese-effects-manager.vala:84: Found Ripple (rippletv)
** Message: cheese-effects-manager.vala:84: Found Kung-Fu (streaktv)
** Message: cheese-effects-manager.vala:84: Found Quark (quarktv)
** Message: cheese-effects-manager.vala:84: Found Waveform (revtv)
** Message: cheese-effects-manager.vala:84: Found Stretch (stretch)
** Message: cheese-effects-manager.vala:84: Found Radioactive (radioactv)
** Message: cheese-effects-manager.vala:84: Found Dice (dicetv)
** Message: cheese-effects-manager.vala:84: Found Heat (coloreffects preset=heat)
** Message: cheese-effects-manager.vala:84: Found Invertion (frei0r-filter-invert0r)
** Message: cheese-effects-manager.vala:84: Found Optical Illusion (optv)
** Message: cheese-effects-manager.vala:84: Found Chrome (frei0r-filter-color-distance)
** Message: cheese-effects-manager.vala:84: Found Cartoon (frei0r-filter-cartoon)
** Message: cheese-effects-manager.vala:84: Found Historical (videobalance saturation=0 ! agingtv)
** Message: cheese-effects-manager.vala:84: Found Square (square)
** Message: cheese-effects-manager.vala:84: Found Shagadelic (shagadelictv)
** Message: cheese-effects-manager.vala:84: Found Mirror (mirror)
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device
libv4l2: error dequeuing buf: No such device

** (cheese:3798): WARNING **: Failed trying to get video frames from device '/dev/video1'.


** (cheese:3798): WARNING **: Internal data flow error.

dmesg:
[    0.000000] Initializing cgroup subsys cpuset
[    0.000000] Initializing cgroup subsys cpu
[    0.000000] Linux version 3.0-ARCH (tobias at T-POWA-LX) (gcc version 4.6.1 (GCC) ) #1 SMP PREEMPT Tue Aug 16 07:25:56 UTC 2011
[    0.000000] BIOS-provided physical RAM map:
[    0.000000]  BIOS-e820: 0000000000000000 - 000000000009fc00 (usable)
[    0.000000]  BIOS-e820: 000000000009fc00 - 00000000000a0000 (reserved)
[    0.000000]  BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)
[    0.000000]  BIOS-e820: 0000000000100000 - 000000002f7ec000 (usable)
[    0.000000]  BIOS-e820: 000000002f7ec000 - 000000002f7ef000 (ACPI data)
[    0.000000]  BIOS-e820: 000000002f7ef000 - 000000002f7ff000 (reserved)
[    0.000000]  BIOS-e820: 000000002f7ff000 - 000000002f800000 (ACPI NVS)
[    0.000000]  BIOS-e820: 00000000fec00000 - 00000000fec01000 (reserved)
[    0.000000]  BIOS-e820: 00000000fee00000 - 00000000fee01000 (reserved)
[    0.000000]  BIOS-e820: 00000000ffff0000 - 0000000100000000 (reserved)
[    0.000000] Notice: NX (Execute Disable) protection missing in CPU!
[    0.000000] DMI 2.3 present.
[    0.000000] DMI: HP Pavilion 04 P9830A-ABA 322n/A7V-VE , BIOS 3.02 03/20/2002
[    0.000000] e820 update range: 0000000000000000 - 0000000000010000 (usable) ==> (reserved)
[    0.000000] e820 remove range: 00000000000a0000 - 0000000000100000 (usable)
[    0.000000] last_pfn = 0x2f7ec max_arch_pfn = 0x100000
[    0.000000] MTRR default type: uncachable
[    0.000000] MTRR fixed ranges enabled:
[    0.000000]   00000-9FFFF write-back
[    0.000000]   A0000-FFFFF uncachable
[    0.000000] MTRR variable ranges enabled:
[    0.000000]   0 base 000000000 mask FE0000000 write-back
[    0.000000]   1 base 020000000 mask FF8000000 write-back
[    0.000000]   2 base 028000000 mask FFC000000 write-back
[    0.000000]   3 base 02C000000 mask FFE000000 write-back
[    0.000000]   4 base 02E000000 mask FFF000000 write-back
[    0.000000]   5 base 02F000000 mask FFF800000 write-back
[    0.000000]   6 disabled
[    0.000000]   7 base 0F8000000 mask FFC000000 write-combining
[    0.000000] x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106
[    0.000000] initial memory mapped : 0 - 00c00000
[    0.000000] Base memory trampoline at [c009b000] 9b000 size 16384
[    0.000000] init_memory_mapping: 0000000000000000-000000002f7ec000
[    0.000000]  0000000000 - 0000400000 page 4k
[    0.000000]  0000400000 - 002f400000 page 2M
[    0.000000]  002f400000 - 002f7ec000 page 4k
[    0.000000] kernel direct mapping tables up to 2f7ec000 @ bfb000-c00000
[    0.000000] RAMDISK: 2f5d2000 - 2f7dc000
[    0.000000] ACPI: RSDP 000f87e0 00014 (v00 ASUS  )
[    0.000000] ACPI: RSDT 2f7ec000 00030 (v01 ASUS   A7V-VE   30303031 MSFT 31313031)
[    0.000000] ACPI: FACP 2f7ec100 00074 (v01 ASUS   A7V-VE   30303031 MSFT 31313031)
[    0.000000] ACPI: DSDT 2f7ec180 027E3 (v01   ASUS A7V-VE   00001000 MSFT 0100000B)
[    0.000000] ACPI: FACS 2f7ff000 00040
[    0.000000] ACPI: BOOT 2f7ec040 00028 (v01 ASUS   A7V-VE   30303031 MSFT 31313031)
[    0.000000] ACPI: APIC 2f7ec080 0005A (v01 ASUS   A7V-VE   30303031 MSFT 31313031)
[    0.000000] ACPI: Local APIC address 0xfee00000
[    0.000000] 0MB HIGHMEM available.
[    0.000000] 759MB LOWMEM available.
[    0.000000]   mapped low ram: 0 - 2f7ec000
[    0.000000]   low ram: 0 - 2f7ec000
[    0.000000] Zone PFN ranges:
[    0.000000]   DMA      0x00000010 -> 0x00001000
[    0.000000]   Normal   0x00001000 -> 0x0002f7ec
[    0.000000]   HighMem  empty
[    0.000000] Movable zone start PFN for each node
[    0.000000] early_node_map[2] active PFN ranges
[    0.000000]     0: 0x00000010 -> 0x0000009f
[    0.000000]     0: 0x00000100 -> 0x0002f7ec
[    0.000000] On node 0 totalpages: 194427
[    0.000000] free_area_init_node: node 0, pgdat c05adc80, node_mem_map eefe2200
[    0.000000]   DMA zone: 32 pages used for memmap
[    0.000000]   DMA zone: 0 pages reserved
[    0.000000]   DMA zone: 3951 pages, LIFO batch:0
[    0.000000]   Normal zone: 1488 pages used for memmap
[    0.000000]   Normal zone: 188956 pages, LIFO batch:31
[    0.000000] Using APIC driver default
[    0.000000] ACPI: PM-Timer IO Port: 0xe408
[    0.000000] ACPI: Local APIC address 0xfee00000
[    0.000000] ACPI: LAPIC (acpi_id[0x00] lapic_id[0x0e] enabled)
[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x03] high edge lint[0x1])
[    0.000000] ACPI: IOAPIC (id[0x01] address[0xfec00000] gsi_base[0])
[    0.000000] IOAPIC[0]: apic_id 1, version 2, address 0xfec00000, GSI 0-23
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl edge)
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 low level)
[    0.000000] ACPI: IRQ0 used by override.
[    0.000000] ACPI: IRQ2 used by override.
[    0.000000] ACPI: IRQ9 used by override.
[    0.000000] Using ACPI (MADT) for SMP configuration information
[    0.000000] SMP: Allowing 1 CPUs, 0 hotplug CPUs
[    0.000000] nr_irqs_gsi: 40
[    0.000000] PM: Registered nosave memory: 000000000009f000 - 00000000000a0000
[    0.000000] PM: Registered nosave memory: 00000000000a0000 - 00000000000f0000
[    0.000000] PM: Registered nosave memory: 00000000000f0000 - 0000000000100000
[    0.000000] Allocating PCI resources starting at 2f800000 (gap: 2f800000:cf400000)
[    0.000000] Booting paravirtualized kernel on bare hardware
[    0.000000] setup_percpu: NR_CPUS:8 nr_cpumask_bits:8 nr_cpu_ids:1 nr_node_ids:1
[    0.000000] PERCPU: Embedded 12 pages/cpu @ee800000 s25472 r0 d23680 u4194304
[    0.000000] pcpu-alloc: s25472 r0 d23680 u4194304 alloc=1*4194304
[    0.000000] pcpu-alloc: [0] 0 
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 192907
[    0.000000] Kernel command line: root=/dev/disk/by-uuid/7ed0c043-fa64-4926-a8c5-0bc49a9d37a9 ro
[    0.000000] PID hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Dentry cache hash table entries: 131072 (order: 7, 524288 bytes)
[    0.000000] Inode-cache hash table entries: 65536 (order: 6, 262144 bytes)
[    0.000000] Initializing CPU#0
[    0.000000] allocated 3112384 bytes of page_cgroup
[    0.000000] please try 'cgroup_disable=memory' option if you don't want memory cgroups
[    0.000000] Initializing HighMem for node 0 (00000000:00000000)
[    0.000000] Memory: 759352k/778160k available (3415k kernel code, 18356k reserved, 1406k data, 500k init, 0k highmem)
[    0.000000] virtual kernel memory layout:
[    0.000000]     fixmap  : 0xfff16000 - 0xfffff000   ( 932 kB)
[    0.000000]     pkmap   : 0xff800000 - 0xffc00000   (4096 kB)
[    0.000000]     vmalloc : 0xeffec000 - 0xff7fe000   ( 248 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xef7ec000   ( 759 MB)
[    0.000000]       .init : 0xc05b6000 - 0xc0633000   ( 500 kB)
[    0.000000]       .data : 0xc0455f95 - 0xc05b5980   (1406 kB)
[    0.000000]       .text : 0xc0100000 - 0xc0455f95   (3415 kB)
[    0.000000] Checking if this processor honours the WP bit even in supervisor mode...Ok.
[    0.000000] SLUB: Genslabs=15, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] Preemptible hierarchical RCU implementation.
[    0.000000] 	Verbose stalled-CPUs detection is disabled.
[    0.000000] NR_IRQS:512
[    0.000000] CPU 0 irqstacks, hard=ee40e000 soft=ee418000
[    0.000000] Console: colour VGA+ 80x25
[    0.000000] console [tty0] enabled
[    0.000000] Fast TSC calibration using PIT
[    0.000000] Detected 1399.426 MHz processor.
[    0.003339] Calibrating delay loop (skipped), value calculated using timer frequency.. 2799.47 BogoMIPS (lpj=4664753)
[    0.003350] pid_max: default: 32768 minimum: 301
[    0.003457] Security Framework initialized
[    0.003471] AppArmor: AppArmor disabled by boot time parameter
[    0.006706] Mount-cache hash table entries: 512
[    0.007194] Initializing cgroup subsys cpuacct
[    0.007225] Initializing cgroup subsys memory
[    0.007253] Initializing cgroup subsys devices
[    0.007260] Initializing cgroup subsys freezer
[    0.007266] Initializing cgroup subsys net_cls
[    0.007271] Initializing cgroup subsys blkio
[    0.007360] mce: CPU supports 4 MCE banks
[    0.007453] SMP alternatives: switching to UP code
[    0.014236] Freeing SMP alternatives: 16k freed
[    0.014276] ACPI: Core revision 20110413
[    0.017238] ftrace: allocating 15363 entries in 31 pages
[    0.020254] Enabling APIC mode:  Flat.  Using 1 I/O APICs
[    0.021433] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=-1 pin2=-1
[    0.055743] CPU0: AMD Athlon(TM) XP 1600+ stepping 02
[    0.056663] Performance Events: AMD PMU driver.
[    0.056663] ... version:                0
[    0.056663] ... bit width:              48
[    0.056663] ... generic registers:      4
[    0.056663] ... value mask:             0000ffffffffffff
[    0.056663] ... max period:             00007fffffffffff
[    0.056663] ... fixed-purpose events:   0
[    0.056663] ... event mask:             000000000000000f
[    0.073758] NMI watchdog enabled, takes one hw-pmu counter.
[    0.080004] Brought up 1 CPUs
[    0.080009] Total of 1 processors activated (2799.47 BogoMIPS).
[    0.081361] devtmpfs: initialized
[    0.081711] PM: Registering ACPI NVS region at 2f7ff000 (4096 bytes)
[    0.083724] print_constraints: dummy: 
[    0.083871] NET: Registered protocol family 16
[    0.084102] ACPI: bus type pci registered
[    0.085905] PCI: PCI BIOS revision 2.10 entry at 0xf0fa0, last bus=1
[    0.085909] PCI: Using configuration type 1 for base access
[    0.087086] bio: create slab <bio-0> at 0
[    0.087889] ACPI: EC: Look up EC in DSDT
[    0.090293] ACPI: Interpreter enabled
[    0.090302] ACPI: (supports S0 S1 S3 S4 S5)
[    0.090339] ACPI: Using IOAPIC for interrupt routing
[    0.099172] ACPI: No dock devices found.
[    0.099179] HEST: Table not found.
[    0.099188] PCI: Ignoring host bridge windows from ACPI; if necessary, use "pci=use_crs" and report a bug
[    0.099314] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])
[    0.099562] pci_root PNP0A03:00: host bridge window [io  0x0000-0x0cf7] (ignored)
[    0.099569] pci_root PNP0A03:00: host bridge window [io  0x0d00-0xffff] (ignored)
[    0.099574] pci_root PNP0A03:00: host bridge window [mem 0x000a0000-0x000bffff] (ignored)
[    0.099579] pci_root PNP0A03:00: host bridge window [mem 0x000c0000-0x000dffff] (ignored)
[    0.099584] pci_root PNP0A03:00: host bridge window [mem 0x30000000-0xffffffff] (ignored)
[    0.099612] pci 0000:00:00.0: [1106:3112] type 0 class 0x000600
[    0.099627] pci 0000:00:00.0: reg 10: [mem 0xf8000000-0xfbffffff pref]
[    0.099691] pci 0000:00:01.0: [1106:8305] type 1 class 0x000604
[    0.099725] pci 0000:00:01.0: supports D1
[    0.099751] pci 0000:00:07.0: [1106:0686] type 0 class 0x000601
[    0.099832] pci 0000:00:07.1: [1106:0571] type 0 class 0x000101
[    0.099869] pci 0000:00:07.1: reg 20: [io  0xd800-0xd80f]
[    0.099916] pci 0000:00:07.2: [1106:3038] type 0 class 0x000c03
[    0.099953] pci 0000:00:07.2: reg 20: [io  0xd400-0xd41f]
[    0.100017] pci 0000:00:07.3: [1106:3038] type 0 class 0x000c03
[    0.100055] pci 0000:00:07.3: reg 20: [io  0xd000-0xd01f]
[    0.100100] pci 0000:00:07.4: [1106:3057] type 0 class 0x000680
[    0.100160] pci 0000:00:07.4: quirk: [io  0xe200-0xe27f] claimed by vt82c686 HW-mon
[    0.100166] pci 0000:00:07.4: quirk: [io  0xe800-0xe80f] claimed by vt82c686 SMB
[    0.100198] pci 0000:00:07.5: [1106:3058] type 0 class 0x000401
[    0.100214] pci 0000:00:07.5: reg 10: [io  0xb800-0xb8ff]
[    0.100225] pci 0000:00:07.5: reg 14: [io  0xb400-0xb403]
[    0.100235] pci 0000:00:07.5: reg 18: [io  0xb000-0xb003]
[    0.100298] pci 0000:00:0d.0: [10de:0221] type 0 class 0x000300
[    0.100313] pci 0000:00:0d.0: reg 10: [mem 0xdd000000-0xddffffff]
[    0.100323] pci 0000:00:0d.0: reg 14: [mem 0xe0000000-0xefffffff pref]
[    0.100332] pci 0000:00:0d.0: reg 18: [mem 0xdc000000-0xdcffffff]
[    0.100358] pci 0000:00:0d.0: reg 30: [mem 0x000c0000-0x000dffff pref]
[    0.100391] pci 0000:00:0e.0: [11c1:044e] type 0 class 0x000780
[    0.100406] pci 0000:00:0e.0: reg 10: [mem 0xdb800000-0xdb8000ff]
[    0.100416] pci 0000:00:0e.0: reg 14: [io  0xa400-0xa407]
[    0.100426] pci 0000:00:0e.0: reg 18: [io  0xa000-0xa0ff]
[    0.100465] pci 0000:00:0e.0: supports D2
[    0.100470] pci 0000:00:0e.0: PME# supported from D2 D3hot D3cold
[    0.100476] pci 0000:00:0e.0: PME# disabled
[    0.100500] pci 0000:00:12.0: [10ec:8139] type 0 class 0x000200
[    0.100515] pci 0000:00:12.0: reg 10: [io  0x9800-0x98ff]
[    0.100525] pci 0000:00:12.0: reg 14: [mem 0xdb000000-0xdb0000ff]
[    0.100569] pci 0000:00:12.0: supports D1 D2
[    0.100573] pci 0000:00:12.0: PME# supported from D1 D2 D3hot D3cold
[    0.100579] pci 0000:00:12.0: PME# disabled
[    0.100632] pci 0000:01:00.0: [1023:8500] type 0 class 0x000300
[    0.100647] pci 0000:01:00.0: reg 10: [mem 0xdf000000-0xdf7fffff]
[    0.100657] pci 0000:01:00.0: reg 14: [mem 0xde800000-0xde81ffff]
[    0.100667] pci 0000:01:00.0: reg 18: [mem 0xde000000-0xde7fffff]
[    0.100691] pci 0000:01:00.0: reg 30: [mem 0xf7ff0000-0xf7ffffff pref]
[    0.100711] pci 0000:01:00.0: supports D1 D2
[    0.100745] pci 0000:00:01.0: PCI bridge to [bus 01-01]
[    0.100751] pci 0000:00:01.0:   bridge window [io  0xe000-0xd000] (disabled)
[    0.100757] pci 0000:00:01.0:   bridge window [mem 0xde000000-0xdfefffff]
[    0.100763] pci 0000:00:01.0:   bridge window [mem 0xf7f00000-0xf7ffffff pref]
[    0.100772] pci_bus 0000:00: on NUMA node 0
[    0.100779] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0._PRT]
[    0.100964] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0.PCI1._PRT]
[    0.101062]  pci0000:00: Unable to request _OSC control (_OSC support mask: 0x1e)
[    0.137716] ACPI: PCI Interrupt Link [LNKA] (IRQs 3 4 5 6 7 10 *11 12 14 15)
[    0.137809] ACPI: PCI Interrupt Link [LNKB] (IRQs 3 4 5 6 7 10 11 12 14 15) *0, disabled.
[    0.137896] ACPI: PCI Interrupt Link [LNKC] (IRQs 3 4 5 6 7 10 11 12 14 15) *9
[    0.137982] ACPI: PCI Interrupt Link [LNKD] (IRQs 3 4 5 6 7 10 11 12 14 15) *9
[    0.138204] vgaarb: device added: PCI:0000:00:0d.0,decodes=io+mem,owns=io+mem,locks=none
[    0.138213] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=none,locks=none
[    0.138217] vgaarb: loaded
[    0.138220] vgaarb: bridge control possible 0000:01:00.0
[    0.138222] vgaarb: bridge control possible 0000:00:0d.0
[    0.138432] PCI: Using ACPI for IRQ routing
[    0.138440] PCI: pci_cache_line_size set to 32 bytes
[    0.138498] reserve RAM buffer: 000000000009fc00 - 000000000009ffff 
[    0.138503] reserve RAM buffer: 000000002f7ec000 - 000000002fffffff 
[    0.138786] NetLabel: Initializing
[    0.138789] NetLabel:  domain hash size = 128
[    0.138792] NetLabel:  protocols = UNLABELED CIPSOv4
[    0.138820] NetLabel:  unlabeled traffic allowed by default
[    0.154545] pnp: PnP ACPI init
[    0.154597] ACPI: bus type pnp registered
[    0.154856] pnp 00:00: [mem 0x00000000-0x0009ffff]
[    0.154862] pnp 00:00: [mem 0x000e0000-0x000fffff]
[    0.154866] pnp 00:00: [mem 0x00100000-0x2f7fffff]
[    0.154871] pnp 00:00: [mem 0xfec00000-0xfec000ff]
[    0.154874] pnp 00:00: [mem 0xfee00000-0xfee00fff]
[    0.154878] pnp 00:00: [mem 0xfffe0000-0xffffffff]
[    0.154996] system 00:00: [mem 0x00000000-0x0009ffff] could not be reserved
[    0.155003] system 00:00: [mem 0x000e0000-0x000fffff] could not be reserved
[    0.155009] system 00:00: [mem 0x00100000-0x2f7fffff] could not be reserved
[    0.155015] system 00:00: [mem 0xfec00000-0xfec000ff] could not be reserved
[    0.155020] system 00:00: [mem 0xfee00000-0xfee00fff] has been reserved
[    0.155025] system 00:00: [mem 0xfffe0000-0xffffffff] could not be reserved
[    0.155035] system 00:00: Plug and Play ACPI device, IDs PNP0c01 (active)
[    0.155264] pnp 00:01: [bus 00-ff]
[    0.155270] pnp 00:01: [io  0x0cf8-0x0cff]
[    0.155275] pnp 00:01: [io  0x0000-0x0cf7 window]
[    0.155279] pnp 00:01: [io  0x0d00-0xffff window]
[    0.155284] pnp 00:01: [mem 0x000a0000-0x000bffff window]
[    0.155288] pnp 00:01: [mem 0x000c0000-0x000dffff window]
[    0.155292] pnp 00:01: [mem 0x30000000-0xffffffff window]
[    0.155378] pnp 00:01: Plug and Play ACPI device, IDs PNP0a03 (active)
[    0.155447] pnp 00:02: [io  0x0010-0x001f]
[    0.155451] pnp 00:02: [io  0x0022-0x002d]
[    0.155455] pnp 00:02: [io  0x0030-0x003f]
[    0.155459] pnp 00:02: [io  0x0044-0x005f]
[    0.155462] pnp 00:02: [io  0x0062-0x0063]
[    0.155466] pnp 00:02: [io  0x0065-0x006f]
[    0.155470] pnp 00:02: [io  0x0074-0x007f]
[    0.155473] pnp 00:02: [io  0x0091-0x0093]
[    0.155477] pnp 00:02: [io  0x00a2-0x00bf]
[    0.155480] pnp 00:02: [io  0x00e0-0x00ef]
[    0.155484] pnp 00:02: [io  0x03f0-0x03f1]
[    0.155488] pnp 00:02: [io  0x04d0-0x04d1]
[    0.155566] system 00:02: [io  0x03f0-0x03f1] has been reserved
[    0.155572] system 00:02: [io  0x04d0-0x04d1] has been reserved
[    0.155578] system 00:02: Plug and Play ACPI device, IDs PNP0c02 (active)
[    0.155631] pnp 00:03: [io  0xe400-0xe47f]
[    0.155635] pnp 00:03: [io  0xe800-0xe80f]
[    0.155639] pnp 00:03: [io  0xe200-0xe27f]
[    0.155706] system 00:03: [io  0xe400-0xe47f] has been reserved
[    0.155712] system 00:03: [io  0xe800-0xe80f] has been reserved
[    0.155717] system 00:03: [io  0xe200-0xe27f] has been reserved
[    0.155723] system 00:03: Plug and Play ACPI device, IDs PNP0c02 (active)
[    0.155808] pnp 00:04: [dma 4]
[    0.155812] pnp 00:04: [io  0x0000-0x000f]
[    0.155816] pnp 00:04: [io  0x0080-0x0090]
[    0.155820] pnp 00:04: [io  0x0094-0x009f]
[    0.155824] pnp 00:04: [io  0x00c0-0x00df]
[    0.155875] pnp 00:04: Plug and Play ACPI device, IDs PNP0200 (active)
[    0.155897] pnp 00:05: [io  0x0070-0x0073]
[    0.155928] pnp 00:05: [irq 8]
[    0.155980] pnp 00:05: Plug and Play ACPI device, IDs PNP0b00 (active)
[    0.155998] pnp 00:06: [io  0x0061]
[    0.156047] pnp 00:06: Plug and Play ACPI device, IDs PNP0800 (active)
[    0.156065] pnp 00:07: [io  0x00f0-0x00ff]
[    0.156075] pnp 00:07: [irq 13]
[    0.156137] pnp 00:07: Plug and Play ACPI device, IDs PNP0c04 (active)
[    0.156358] pnp 00:08: [io  0x03f2-0x03f5]
[    0.156363] pnp 00:08: [io  0x03f7]
[    0.156372] pnp 00:08: [irq 6]
[    0.156376] pnp 00:08: [dma 2]
[    0.156463] pnp 00:08: Plug and Play ACPI device, IDs PNP0700 (active)
[    0.157014] pnp 00:09: [io  0x0378-0x037f]
[    0.157019] pnp 00:09: [io  0x0778-0x077b]
[    0.157028] pnp 00:09: [irq 7]
[    0.157032] pnp 00:09: [dma 3]
[    0.157133] pnp 00:09: Plug and Play ACPI device, IDs PNP0401 (active)
[    0.157462] pnp 00:0a: [io  0x03f8-0x03ff]
[    0.157472] pnp 00:0a: [irq 4]
[    0.157578] pnp 00:0a: Plug and Play ACPI device, IDs PNP0501 (active)
[    0.157958] pnp 00:0b: [io  0x02f8-0x02ff]
[    0.157968] pnp 00:0b: [irq 3]
[    0.158075] pnp 00:0b: Plug and Play ACPI device, IDs PNP0501 (active)
[    0.158226] pnp 00:0c: [io  0x0060]
[    0.158230] pnp 00:0c: [io  0x0064]
[    0.158239] pnp 00:0c: [irq 1]
[    0.158294] pnp 00:0c: Plug and Play ACPI device, IDs PNP0303 (active)
[    0.158376] pnp 00:0d: [irq 12]
[    0.158434] pnp 00:0d: Plug and Play ACPI device, IDs PNP0f13 (active)
[    0.158537] pnp: PnP ACPI: found 14 devices
[    0.158540] ACPI: ACPI bus type pnp unregistered
[    0.196679] Switching to clocksource acpi_pm
[    0.196735] pci 0000:00:0d.0: address space collision: [mem 0x000c0000-0x000dffff pref] conflicts with Video ROM [mem 0x000c0000-0x000cedff]
[    0.196749] PCI: max bus depth: 1 pci_try_num: 2
[    0.196790] pci 0000:00:0d.0: BAR 6: assigned [mem 0x30000000-0x3001ffff pref]
[    0.196800] pci 0000:00:01.0: PCI bridge to [bus 01-01]
[    0.196804] pci 0000:00:01.0:   bridge window [io  disabled]
[    0.196812] pci 0000:00:01.0:   bridge window [mem 0xde000000-0xdfefffff]
[    0.196819] pci 0000:00:01.0:   bridge window [mem 0xf7f00000-0xf7ffffff pref]
[    0.196844] pci 0000:00:01.0: setting latency timer to 64
[    0.196852] pci_bus 0000:00: resource 0 [io  0x0000-0xffff]
[    0.196856] pci_bus 0000:00: resource 1 [mem 0x00000000-0xffffffff]
[    0.196861] pci_bus 0000:01: resource 1 [mem 0xde000000-0xdfefffff]
[    0.196866] pci_bus 0000:01: resource 2 [mem 0xf7f00000-0xf7ffffff pref]
[    0.197016] NET: Registered protocol family 2
[    0.197180] IP route cache hash table entries: 32768 (order: 5, 131072 bytes)
[    0.197977] TCP established hash table entries: 131072 (order: 8, 1048576 bytes)
[    0.200032] Switched to NOHz mode on CPU #0
[    0.201391] TCP bind hash table entries: 65536 (order: 7, 524288 bytes)
[    0.203104] TCP: Hash tables configured (established 131072 bind 65536)
[    0.203112] TCP reno registered
[    0.203123] UDP hash table entries: 512 (order: 2, 16384 bytes)
[    0.203184] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes)
[    0.203639] NET: Registered protocol family 1
[    0.203683] pci 0000:00:00.0: Applying VIA southbridge workaround
[    0.203694] pci 0000:00:01.0: disabling DAC on VIA PCI bridge
[    0.203702] pci 0000:00:07.0: Enabling VIA external APIC routing
[    0.203757] pci 0000:00:0d.0: Boot video device
[    0.203772] PCI: CLS 32 bytes, default 32
[    0.203938] Unpacking initramfs...
[    0.274714] Freeing initrd memory: 2088k freed
[    0.281814] Simple Boot Flag at 0x3a set to 0x1
[    0.282448] apm: BIOS version 1.2 Flags 0x03 (Driver version 1.16ac)
[    0.282455] apm: overridden by ACPI.
[    0.282846] audit: initializing netlink socket (disabled)
[    0.282882] type=2000 audit(1313765711.279:1): initialized
[    0.291226] HugeTLB registered 4 MB page size, pre-allocated 0 pages
[    0.310284] VFS: Disk quotas dquot_6.5.2
[    0.310461] Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
[    0.310688] msgmni has been set to 1487
[    0.311075] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)
[    0.311162] io scheduler noop registered
[    0.311166] io scheduler deadline registered
[    0.311188] io scheduler cfq registered (default)
[    0.311656] ERST: Table is not found!
[    0.311683] isapnp: Scanning for PnP cards...
[    0.669171] isapnp: No Plug & Play device found
[    0.669364] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled
[    0.690114] serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
[    0.717345] serial8250: ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A
[    0.757611] 00:0a: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
[    0.784067] 00:0b: ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A
[    0.790469] i8042: PNP: PS/2 Controller [PNP0303:PS2K,PNP0f13:PS2M] at 0x60,0x64 irq 1,12
[    0.791002] serio: i8042 KBD port at 0x60,0x64 irq 1
[    0.791076] serio: i8042 AUX port at 0x60,0x64 irq 12
[    0.791282] mousedev: PS/2 mouse device common for all mice
[    0.791479] rtc_cmos 00:05: RTC can wake from S4
[    0.791662] rtc_cmos 00:05: rtc core: registered rtc_cmos as rtc0
[    0.791718] rtc0: alarms up to one year, 242 bytes nvram
[    0.791764] cpuidle: using governor ladder
[    0.791768] cpuidle: using governor menu
[    0.792234] TCP cubic registered
[    0.792242] NET: Registered protocol family 17
[    0.792266] Registering the dns_resolver key type
[    0.792314] Using IPI No-Shortcut mode
[    0.792484] PM: Hibernation image not present or could not be loaded.
[    0.792503] registered taskstats version 1
[    0.800641] rtc_cmos 00:05: setting system clock to 2011-08-19 14:55:12 UTC (1313765712)
[    0.800723] Initializing network drop monitor service
[    0.800890] Freeing unused kernel memory: 500k freed
[    0.802310] Write protecting the kernel text: 3416k
[    0.802349] Write protecting the kernel read-only data: 1036k
[    0.814444] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input0
[    0.840901] input: Power Button as /devices/LNXSYSTM:00/device:00/PNP0C0C:00/input/input1
[    0.840920] ACPI: Power Button [PWRB]
[    0.841048] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input2
[    0.841055] ACPI: Power Button [PWRF]
[    0.842955] wmi: Mapper loaded
[    0.843854] udevd[43]: starting version 173
[    0.855953] Linux agpgart interface v0.103
[    0.882816] [drm] Initialized drm 1.1.0 20060810
[    0.930757] nouveau 0000:00:0d.0: PCI INT A -> GSI 16 (level, low) -> IRQ 16
[    0.936006] [drm] nouveau 0000:00:0d.0: Detected an NV40 generation card (0x04a100a1)
[    0.939492] [drm] nouveau 0000:00:0d.0: Attempting to load BIOS image from PRAMIN
[    1.050112] [drm] nouveau 0000:00:0d.0: ... appears to be valid
[    1.050119] [drm] nouveau 0000:00:0d.0: BIT BIOS found
[    1.050126] [drm] nouveau 0000:00:0d.0: Bios version 05.44.a2.10
[    1.050135] [drm] nouveau 0000:00:0d.0: TMDS table version 1.1
[    1.050139] [drm] nouveau 0000:00:0d.0: BIT table 'd' not found
[    1.050145] [drm] nouveau 0000:00:0d.0: Found Display Configuration Block version 3.0
[    1.050153] [drm] nouveau 0000:00:0d.0: Raw DCB entry 0: 01000300 00000028
[    1.050160] [drm] nouveau 0000:00:0d.0: Raw DCB entry 1: 01000302 00000020
[    1.050165] [drm] nouveau 0000:00:0d.0: Raw DCB entry 2: 02011310 00000028
[    1.050169] [drm] nouveau 0000:00:0d.0: Raw DCB entry 3: 020223f1 00c0c030
[    1.050176] [drm] nouveau 0000:00:0d.0: DCB connector table: VHER 0x30 5 7 2
[    1.050183] [drm] nouveau 0000:00:0d.0:   0: 0x00000000: type 0x00 idx 0 tag 0xff
[    1.050188] [drm] nouveau 0000:00:0d.0:   1: 0x00002230: type 0x30 idx 1 tag 0x08
[    1.050193] [drm] nouveau 0000:00:0d.0:   2: 0x00000110: type 0x10 idx 2 tag 0xff
[    1.050198] [drm] nouveau 0000:00:0d.0:   3: 0x00000111: type 0x11 idx 3 tag 0xff
[    1.050202] [drm] nouveau 0000:00:0d.0:   4: 0x00000113: type 0x13 idx 4 tag 0xff
[    1.050216] [drm] nouveau 0000:00:0d.0: Parsing VBIOS init table 0 at offset 0xDEB0
[    1.052827] [drm] nouveau 0000:00:0d.0: Parsing VBIOS init table 1 at offset 0xE19E
[    1.066075] [drm] nouveau 0000:00:0d.0: Parsing VBIOS init table 2 at offset 0xE6D8
[    1.066105] [drm] nouveau 0000:00:0d.0: Parsing VBIOS init table 3 at offset 0xE835
[    1.067246] [drm] nouveau 0000:00:0d.0: Parsing VBIOS init table 4 at offset 0xE9BE
[    1.067255] [drm] nouveau 0000:00:0d.0: mem timing table length unknown: 14
[    1.067343] [drm] nouveau 0000:00:0d.0: timingset 255 does not exist
[    1.088095] [drm] nouveau 0000:00:0d.0: 1 available performance level(s)
[    1.088108] [drm] nouveau 0000:00:0d.0: 0: memory 400MHz core 280MHz fanspeed 100%
[    1.088128] [drm] nouveau 0000:00:0d.0: c: memory 200MHz core 200MHz
[    1.088950] [TTM] Zone  kernel: Available graphics memory: 380978 kiB.
[    1.088956] [TTM] Initializing pool allocator.
[    1.088993] [drm] nouveau 0000:00:0d.0: Detected 256MiB VRAM
[    1.091885] [drm] nouveau 0000:00:0d.0: 64 MiB GART (aperture)
[    1.092036] [drm] nouveau 0000:00:0d.0: Saving VGA fonts
[    1.188878] [drm] Supports vblank timestamp caching Rev 1 (10.10.2010).
[    1.188887] [drm] No driver support for vblank timestamp query.
[    1.191501] [drm] nouveau 0000:00:0d.0: Setting dpms mode 3 on vga encoder (output 0)
[    1.191509] [drm] nouveau 0000:00:0d.0: Setting dpms mode 3 on tmds encoder (output 1)
[    1.191515] [drm] nouveau 0000:00:0d.0: Setting dpms mode 3 on vga encoder (output 2)
[    1.191521] [drm] nouveau 0000:00:0d.0: Setting dpms mode 3 on TV encoder (output 3)
[    1.293369] Refined TSC clocksource calibration: 1399.602 MHz.
[    1.293385] Switching to clocksource tsc
[    1.487854] [drm] nouveau 0000:00:0d.0: allocated 1600x900 fb: 0x49000, bo ed89ba00
[    1.488982] fbcon: nouveaufb (fb0) is primary device
[    1.502186] [drm] nouveau 0000:00:0d.0: 0xD2BA: Parsing digital output script table
[    1.552230] [drm] nouveau 0000:00:0d.0: Setting dpms mode 0 on tmds encoder (output 1)
[    1.552236] [drm] nouveau 0000:00:0d.0: Output DVI-I-1 is running on CRTC 0 using output A
[    1.558328] Console: switching to colour frame buffer device 200x56
[    1.565236] fb0: nouveaufb frame buffer device
[    1.565240] drm: registered panic notifier
[    1.565257] [drm] Initialized nouveau 0.0.16 20090420 for 0000:00:0d.0 on minor 0
[    1.746272] SCSI subsystem initialized
[    1.813995] libata version 3.00 loaded.
[    1.814953] pata_via 0000:00:07.1: version 0.3.4
[    1.815403] ACPI: PCI Interrupt Link [LNKA] enabled at IRQ 11
[    1.815431] pata_via 0000:00:07.1: PCI INT A -> Link[LNKA] -> GSI 11 (level, low) -> IRQ 11
[    1.815440] pata_via 0000:00:07.1: VIA VLink IRQ fixup, from 0 to 11
[    1.823852] scsi0 : pata_via
[    1.826819] scsi1 : pata_via
[    1.827648] ata1: PATA max UDMA/100 cmd 0x1f0 ctl 0x3f6 bmdma 0xd800 irq 14
[    1.827656] ata2: PATA max UDMA/100 cmd 0x170 ctl 0x376 bmdma 0xd808 irq 15
[    2.040548] ata1.00: ATA-6: ST380011A, 3.06, max UDMA/100
[    2.040557] ata1.00: 156301488 sectors, multi 16: LBA48 
[    2.053691] ata1.00: configured for UDMA/100
[    2.054037] scsi 0:0:0:0: Direct-Access     ATA      ST380011A        3.06 PQ: 0 ANSI: 5
[    2.206875] ata2.01: NODEV after polling detection
[    2.213729] ata2.00: ATAPI: CW058D ATAPI CD-R/RW, V110D, max UDMA/33
[    2.226910] ata2.00: configured for UDMA/33
[    2.228108] scsi 1:0:0:0: CD-ROM            CyberDrv CW058D CD-R/RW   110D PQ: 0 ANSI: 5
[    2.249600] sd 0:0:0:0: [sda] 156301488 512-byte logical blocks: (80.0 GB/74.5 GiB)
[    2.249708] sd 0:0:0:0: [sda] Write Protect is off
[    2.249714] sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
[    2.249759] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[    2.253058] sr0: scsi3-mmc drive: 4x/40x writer cd/rw xa/form2 cdda tray
[    2.253070] cdrom: Uniform CD-ROM driver Revision: 3.20
[    2.254234] sr 1:0:0:0: Attached scsi CD-ROM sr0
[    2.260906]  sda: sda1 sda2 sda3 sda4
[    2.261740] sd 0:0:0:0: [sda] Attached SCSI disk
[    2.849726] EXT3-fs: barriers not enabled
[    2.859746] EXT3-fs (sda3): mounted filesystem with ordered data mode
[    2.860391] kjournald starting.  Commit interval 5 seconds
[    4.506742] udevd[184]: starting version 173
[    4.787839] fuse init (API version 7.16)
[    5.331703] psmouse serio1: ID: 10 00 64
[    5.350745] agpgart: Detected VIA KLE133 chipset
[    5.357339] agpgart-via 0000:00:00.0: AGP aperture is 64M @ 0xf8000000
[    5.396277] logips2pp: Detected unknown logitech mouse model 60
[    5.507256] ACPI: acpi_idle registered with cpuidle
[    5.657993] input: PC Speaker as /devices/platform/pcspkr/input/input3
[    5.704751] sd 0:0:0:0: Attached scsi generic sg0 type 0
[    5.704833] sr 1:0:0:0: Attached scsi generic sg1 type 5
[    5.713668] pci_hotplug: PCI Hot Plug PCI Core version: 0.5
[    5.719572] shpchp: Standard Hot Plug PCI Controller Driver version: 0.4
[    5.721897] Floppy drive(s): fd0 is 1.44M
[    5.737084] FDC 0 is a post-1991 82077
[    5.906556] input: ImExPS/2 Logitech Explorer Mouse as /devices/platform/i8042/serio1/input/input4
[    5.909080] parport_pc: VIA 686A/8231 detected
[    5.909089] parport_pc: probing current configuration
[    5.909109] parport_pc: Current parallel port base: 0x378
[    5.909186] parport0: PC-style at 0x378 (0x778), irq 7, using FIFO [PCSPP,TRISTATE,COMPAT,ECP]
[    5.975323] 8139cp: 8139cp: 10/100 PCI Ethernet driver v1.3 (Mar 22, 2004)
[    5.975396] 8139cp 0000:00:12.0: This (id 10ec:8139 rev 10) is not an 8139C+ compatible chip, use 8139too
[    5.990146] parport_pc: VIA parallel port: io=0x378, irq=7
[    5.996922] 8139too: 8139too Fast Ethernet driver 0.9.28
[    5.997032] 8139too 0000:00:12.0: enabling device (0004 -> 0007)
[    5.997065] 8139too 0000:00:12.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17
[    6.003489] 8139too 0000:00:12.0: eth0: RealTek RTL8139 at 0xf0aac000, 00:e0:18:76:0c:8c, IRQ 17
[    6.168007] VIA 82xx Audio 0000:00:07.5: PCI INT C -> GSI 22 (level, low) -> IRQ 22
[    6.168197] VIA 82xx Audio 0000:00:07.5: setting latency timer to 64
[    6.202747] usbcore: registered new interface driver usbfs
[    6.203097] usbcore: registered new interface driver hub
[    6.206342] usbcore: registered new device driver usb
[    6.213226] ppdev: user-space parallel port driver
[    6.326457] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[    6.371912] uhci_hcd: USB Universal Host Controller Interface driver
[    6.683191] uhci_hcd 0000:00:07.2: PCI INT D -> GSI 21 (level, low) -> IRQ 21
[    6.683217] uhci_hcd 0000:00:07.2: UHCI Host Controller
[    6.683297] uhci_hcd 0000:00:07.2: new USB bus registered, assigned bus number 1
[    6.683437] uhci_hcd 0000:00:07.2: irq 21, io base 0x0000d400
[    6.683820] hub 1-0:1.0: USB hub found
[    6.683833] hub 1-0:1.0: 2 ports detected
[    6.685153] uhci_hcd 0000:00:07.3: PCI INT D -> GSI 21 (level, low) -> IRQ 21
[    6.685183] uhci_hcd 0000:00:07.3: UHCI Host Controller
[    6.685221] uhci_hcd 0000:00:07.3: new USB bus registered, assigned bus number 2
[    6.685280] uhci_hcd 0000:00:07.3: irq 21, io base 0x0000d000
[    6.687007] hub 2-0:1.0: USB hub found
[    6.687026] hub 2-0:1.0: 2 ports detected
[    6.990065] usb 1-1: new full speed USB device number 2 using uhci_hcd
[    7.145563] hub 1-1:1.0: USB hub found
[    7.147477] hub 1-1:1.0: 4 ports detected
[    7.260112] usb 2-2: new full speed USB device number 2 using uhci_hcd
[    7.535420] usb 1-1.2: new full speed USB device number 3 using uhci_hcd
[    7.594258] Linux media interface: v0.10
[    7.672966] Linux video capture interface: v2.00
[    7.725385] usb 1-1.3: new full speed USB device number 4 using uhci_hcd
[    7.749516] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[    7.760929] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input5
[    7.762425] usbcore: registered new interface driver uvcvideo
[    7.762435] USB Video Class driver (v1.1.0)
[    7.898529] input: HP Deluxe Webcam KQ246AA HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.4/input/input6
[    7.898919] generic-usb 0003:04F2:A13C.0001: input,hidraw0: USB HID v1.11 Joystick [HP Deluxe Webcam KQ246AA HP Deluxe Webcam KQ246AA] on usb-0000:00:07.3-2/input4
[    7.899471] usbcore: registered new interface driver usbhid
[    7.899477] usbhid: USB HID core driver
[    8.097736] Bluetooth: Core ver 2.16
[    8.098831] NET: Registered protocol family 31
[    8.098838] Bluetooth: HCI device and connection manager initialized
[    8.098846] Bluetooth: HCI socket layer initialized
[    8.098850] Bluetooth: L2CAP socket layer initialized
[    8.098989] Bluetooth: SCO socket layer initialized
[    8.128123] 2:3:1: cannot get freq at ep 0x84
[    8.129867] usbcore: registered new interface driver snd-usb-audio
[    8.197986] Bluetooth: Generic Bluetooth USB driver ver 0.6
[    8.199342] usbcore: registered new interface driver btusb
[    8.275248] cfg80211: Calling CRDA to update world regulatory domain
[    8.734101] ieee80211 phy0: Selected rate control algorithm 'minstrel_ht'
[    8.735373] Registered led device: rt73usb-phy0::radio
[    8.735459] Registered led device: rt73usb-phy0::assoc
[    8.735541] Registered led device: rt73usb-phy0::quality
[    8.737698] usbcore: registered new interface driver rt73usb
[    8.923370] end_request: I/O error, dev fd0, sector 0
[   77.377231] EXT3-fs (sda3): using internal journal
[   77.494240] EXT3-fs: barriers not enabled
[   77.508664] kjournald starting.  Commit interval 5 seconds
[   77.509021] EXT3-fs (sda4): using internal journal
[   77.509032] EXT3-fs (sda4): mounted filesystem with ordered data mode
[   77.548411] Adding 265068k swap on /dev/sda2.  Priority:-1 extents:1 across:265068k 
[   82.581088] NET: Registered protocol family 10
[   82.773196] ip_tables: (C) 2000-2006 Netfilter Core Team
[   82.802504] nf_conntrack version 0.5.0 (11905 buckets, 47620 max)
[  154.050564] vgaarb: device changed decodes: PCI:0000:00:0d.0,olddecodes=io+mem,decodes=none:owns=io+mem
[  154.050572] vgaarb: transferring owner from PCI:0000:00:0d.0 to PCI:0000:01:00.0
[  233.990440] uvcvideo: Non-zero status (-84) in status completion handler.
[  234.913363] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[  235.114249] 2:3:1: cannot get freq at ep 0x84
[  235.115726] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[  235.127624] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input7
[  289.638519] ipt_MASQUERADE: lo ate my IP address
[  289.638587] ipt_MASQUERADE: lo ate my IP address
[  289.638649] ipt_MASQUERADE: lo ate my IP address
[  289.638681] ipt_MASQUERADE: lo ate my IP address
[  289.639142] ipt_MASQUERADE: lo ate my IP address
[  289.639180] ipt_MASQUERADE: lo ate my IP address
[  289.639221] ipt_MASQUERADE: lo ate my IP address
[  289.639251] ipt_MASQUERADE: lo ate my IP address
[  290.275412] ipt_MASQUERADE: lo ate my IP address
[  295.621477] ipt_MASQUERADE: lo ate my IP address
[  302.063081] uvcvideo: Non-zero status (-84) in status completion handler.
[  302.576693] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[  302.592997] uvcvideo: Failed to resubmit video URB (-19).
[  302.624983] uvcvideo: Failed to resubmit video URB (-19).
[  302.656977] uvcvideo: Failed to resubmit video URB (-19).
[  302.688972] uvcvideo: Failed to resubmit video URB (-19).
[  302.720968] uvcvideo: Failed to resubmit video URB (-19).
[  302.778956] 2:3:1: cannot get freq at ep 0x84
[  302.780426] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[  302.793291] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input8
[  347.048997] ipt_MASQUERADE: lo ate my IP address
[  347.049058] ipt_MASQUERADE: lo ate my IP address
[  347.049114] ipt_MASQUERADE: lo ate my IP address
[  347.049144] ipt_MASQUERADE: lo ate my IP address
[  347.049932] ipt_MASQUERADE: lo ate my IP address
[  347.051895] ipt_MASQUERADE: lo ate my IP address
[  347.052034] ipt_MASQUERADE: lo ate my IP address
[  347.052084] ipt_MASQUERADE: lo ate my IP address
[  347.053005] ipt_MASQUERADE: lo ate my IP address
[  347.053049] ipt_MASQUERADE: lo ate my IP address
[  347.053090] ipt_MASQUERADE: lo ate my IP address
[  347.053120] ipt_MASQUERADE: lo ate my IP address
[  347.054851] ipt_MASQUERADE: lo ate my IP address
[  347.054902] ipt_MASQUERADE: lo ate my IP address
[  347.054943] ipt_MASQUERADE: lo ate my IP address
[  347.054974] ipt_MASQUERADE: lo ate my IP address
[  347.055685] ipt_MASQUERADE: lo ate my IP address
[  347.055730] ipt_MASQUERADE: lo ate my IP address
[  347.055769] ipt_MASQUERADE: lo ate my IP address
[  347.055799] ipt_MASQUERADE: lo ate my IP address
[  347.056408] ipt_MASQUERADE: lo ate my IP address
[  347.056450] ipt_MASQUERADE: lo ate my IP address
[  347.056491] ipt_MASQUERADE: lo ate my IP address
[  347.056521] ipt_MASQUERADE: lo ate my IP address
[  347.058622] ipt_MASQUERADE: lo ate my IP address
[  347.058675] ipt_MASQUERADE: lo ate my IP address
[  347.058717] ipt_MASQUERADE: lo ate my IP address
[  347.058748] ipt_MASQUERADE: lo ate my IP address
[  347.059425] ipt_MASQUERADE: lo ate my IP address
[  347.059468] ipt_MASQUERADE: lo ate my IP address
[  347.059507] ipt_MASQUERADE: lo ate my IP address
[  347.059537] ipt_MASQUERADE: lo ate my IP address
[  347.061367] ipt_MASQUERADE: lo ate my IP address
[  347.061418] ipt_MASQUERADE: lo ate my IP address
[  347.061462] ipt_MASQUERADE: lo ate my IP address
[  347.061493] ipt_MASQUERADE: lo ate my IP address
[  347.062260] ipt_MASQUERADE: lo ate my IP address
[  347.062305] ipt_MASQUERADE: lo ate my IP address
[  347.062343] ipt_MASQUERADE: lo ate my IP address
[  347.062375] ipt_MASQUERADE: lo ate my IP address
[  349.459954] ipt_MASQUERADE: lo ate my IP address
[  349.460868] ipt_MASQUERADE: lo ate my IP address
[  349.460953] ipt_MASQUERADE: lo ate my IP address
[  349.460986] ipt_MASQUERADE: lo ate my IP address
[  349.465673] ipt_MASQUERADE: lo ate my IP address
[  349.465744] ipt_MASQUERADE: lo ate my IP address
[  349.465789] ipt_MASQUERADE: lo ate my IP address
[  349.465820] ipt_MASQUERADE: lo ate my IP address
[  349.468076] ipt_MASQUERADE: lo ate my IP address
[  349.468126] ipt_MASQUERADE: lo ate my IP address
[  349.468169] ipt_MASQUERADE: lo ate my IP address
[  349.468199] ipt_MASQUERADE: lo ate my IP address
[  360.688532] 8139too 0000:00:12.0: eth0: link up, 100Mbps, full-duplex, lpa 0x45E1
[  370.909977] eth0: no IPv6 routers present
[  654.782676] device-mapper: uevent: version 1.0.3
[  654.782942] device-mapper: ioctl: 4.20.0-ioctl (2011-02-02) initialised: dm-devel at redhat.com
[ 1016.105808] [drm] nouveau 0000:00:0d.0: Setting dpms mode 3 on tmds encoder (output 1)
[ 2533.849076] [drm] nouveau 0000:00:0d.0: Setting dpms mode 0 on tmds encoder (output 1)
[ 2618.792534] uvcvideo: Non-zero status (-84) in status completion handler.
[ 2619.633106] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 2619.638376] uvcvideo: Failed to resubmit video URB (-19).
[ 2619.670381] uvcvideo: Failed to resubmit video URB (-19).
[ 2619.702362] uvcvideo: Failed to resubmit video URB (-19).
[ 2619.734353] uvcvideo: Failed to resubmit video URB (-19).
[ 2619.766341] uvcvideo: Failed to resubmit video URB (-19).
[ 2619.836338] 2:3:1: cannot get freq at ep 0x84
[ 2619.837850] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 2619.849715] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input9
[ 3031.051726] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3032.376401] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3032.387501] uvcvideo: Failed to resubmit video URB (-19).
[ 3032.419495] uvcvideo: Failed to resubmit video URB (-19).
[ 3032.451488] uvcvideo: Failed to resubmit video URB (-19).
[ 3032.483483] uvcvideo: Failed to resubmit video URB (-19).
[ 3032.515473] uvcvideo: Failed to resubmit video URB (-19).
[ 3032.574469] 2:3:1: cannot get freq at ep 0x84
[ 3032.575944] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3032.587827] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input10
[ 3062.438490] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3063.613104] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3063.624299] uvcvideo: Failed to resubmit video URB (-19).
[ 3063.656317] uvcvideo: Failed to resubmit video URB (-19).
[ 3063.688303] uvcvideo: Failed to resubmit video URB (-19).
[ 3063.720302] uvcvideo: Failed to resubmit video URB (-19).
[ 3063.752275] uvcvideo: Failed to resubmit video URB (-19).
[ 3063.815262] 2:3:1: cannot get freq at ep 0x84
[ 3063.816839] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3063.829635] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input11
[ 3108.326835] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3109.229746] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3109.231692] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.263669] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.295668] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.327663] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.359653] uvcvideo: Failed to resubmit video URB (-19).
[ 3109.431646] 2:3:1: cannot get freq at ep 0x84
[ 3109.433158] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3109.445999] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input12
[ 3186.577779] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3188.086383] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3188.111521] uvcvideo: Failed to resubmit video URB (-19).
[ 3188.143514] uvcvideo: Failed to resubmit video URB (-19).
[ 3188.175507] uvcvideo: Failed to resubmit video URB (-19).
[ 3188.207494] uvcvideo: Failed to resubmit video URB (-19).
[ 3188.239491] uvcvideo: Failed to resubmit video URB (-19).
[ 3188.287485] 2:3:1: cannot get freq at ep 0x84
[ 3188.288956] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3188.301839] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input13
[ 3209.481978] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3210.116403] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3210.147872] uvcvideo: Failed to resubmit video URB (-19).
[ 3210.179860] uvcvideo: Failed to resubmit video URB (-19).
[ 3210.211854] uvcvideo: Failed to resubmit video URB (-19).
[ 3210.243820] uvcvideo: Failed to resubmit video URB (-19).
[ 3210.275819] uvcvideo: Failed to resubmit video URB (-19).
[ 3210.318810] 2:3:1: cannot get freq at ep 0x84
[ 3210.320441] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3210.332169] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input14
[ 3218.104515] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3219.216411] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3219.220354] uvcvideo: Failed to resubmit video URB (-19).
[ 3219.252332] uvcvideo: Failed to resubmit video URB (-19).
[ 3219.284341] uvcvideo: Failed to resubmit video URB (-19).
[ 3219.316313] uvcvideo: Failed to resubmit video URB (-19).
[ 3219.348302] uvcvideo: Failed to resubmit video URB (-19).
[ 3219.418292] 2:3:1: cannot get freq at ep 0x84
[ 3219.419781] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3219.431651] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input15
[ 3227.354986] uvcvideo: Non-zero status (-84) in status completion handler.
[ 3228.526409] usb 2-2: reset full speed USB device number 2 using uhci_hcd
[ 3228.549794] uvcvideo: Failed to resubmit video URB (-19).
[ 3228.581791] uvcvideo: Failed to resubmit video URB (-19).
[ 3228.613775] uvcvideo: Failed to resubmit video URB (-19).
[ 3228.645754] uvcvideo: Failed to resubmit video URB (-19).
[ 3228.677745] uvcvideo: Failed to resubmit video URB (-19).
[ 3228.728738] 2:3:1: cannot get freq at ep 0x84
[ 3228.730447] uvcvideo: Found UVC 1.00 device HP Deluxe Webcam KQ246AA (04f2:a13c)
[ 3228.743117] input: HP Deluxe Webcam KQ246AA as /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/input/input16
[ 3974.561129] [drm] nouveau 0000:00:0d.0: Setting dpms mode 3 on tmds encoder (output 1)
[ 4000.992821] [drm] nouveau 0000:00:0d.0: Setting dpms mode 0 on tmds encoder (output 1)


From bug-track at fisher-privat.net  Fri Aug 19 09:23:45 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 19 Aug 2011 09:23:45 +0200
Subject: [Linux-uvc-devel] error proofing mjpeg stream
In-Reply-To: <alpine.LNX.2.00.1108182152030.11800@tristan>
References: <4E410FA3.70304@fisher-privat.net>
	<4E42D07F.2050809@fisher-privat.net>
	<alpine.LNX.2.00.1108101202130.27345@spider.phas.ubc.ca>
	<4E44276F.80304@fisher-privat.net>
	<alpine.LNX.2.00.1108112141380.7206@tristan>
	<4E44D485.7050003@fisher-privat.net>
	<alpine.LNX.2.00.1108121031450.27345@spider.phas.ubc.ca>
	<4E45748C.2040504@fisher-privat.net>
	<alpine.LNX.2.00.1108121201350.27345@spider.phas.ubc.ca>
	<4E458398.2050207@fisher-privat.net>
	<alpine.LNX.2.00.1108121749050.5900@tristan>
	<4E461F54.9010700@fisher-privat.net>
	<alpine.LNX.2.00.1108130005050.5432@tristan>
	<4E463B87.2050905@fisher-privat.net>
	<alpine.LNX.2.00.1108132248420.7133@tristan>
	<4E477E60.6060906@fisher-privat.net>
	<alpine.LNX.2.00.1108142053590.5280@tristan>
	<4E48C127.9080205@fisher-privat.net>
	<alpine.LNX.2.00.1108171131050.5545@spider.phas.ubc.ca>
	<4E4C197D.9010501@fisher-privat.net>
	<alpine.LNX.2.00.1108172314070.11832@tristan>
	<4E4D1934.3070902@fisher-privat.net>
	<alpine.LNX.2.00.1108182152030.11800@tristan>
Message-ID: <4E4E0F81.7040902@fisher-privat.net>

I continued to work on you usb dump for jpeg stream, here are some examples:

This is first frame:
0c8d41c4ce01e010ca042f04ffd8ff SOI
0c8d41c4ce015ca3ca042f04975271

This is end of first frame, start of second, and first issue.
0c8d41c4ce017b42ee044e046a1950
0c8c0f5fee041a67ee044e0496a246 FID togled, new uvc time, but actual EOI
is here.
0c8e0f5fee041a67ee044e04        actual EOF
0c8c0f5fee04961ef0045004ffd8ff SOI
for now this will be corrupt.

Second frame, every thing is fine.
0c8c0f5fee04315014056f04c74b75 EOI
0c8e0f5fee04d07414057004
0c8d1f801405ea5016057104ffd8ff SOI

frame 3.; FID is togled, no EOF, no EOI...
last part of this packet is corrupt, frame 2. is corrupt.
0c8d1f80140509f039059004666e79
0c8c34a13a05a05e3c059204ffd8ff SOI
It will be ipossible to fix, EOF probably lost, but FID is correct.

frame 3 is ok, start of frame 4.
0c8c34a13a053d906005b20497335d EOI
0c8e34a13a05dcb46005b204 EOF
0c8d7a576205556c6205b404ffd8ff SOI

frame 4 is ok
0c8d7a57620592c28605d3040c8f4a EOI
0c8e4fe3860531e78605d404 EOF
0c8c4fe38605aa9e8805d504ffd8ff SOI

no end of frame 4, FID togled and frame 5 started.
0c8c4fe38605c93dac05f4042515c4
0c8d5f04ad0501d1ae05f604ffd8ff SOI
may be some parts was not included in dump, or 4 is really corrupt.
Can't do any thing here, except only to check for EOI and SOI

Every thing is ok, here.
0c8d5f04ad059c02d3051605bd8d13 EOI
0c8f5f04ad059c02d3051605
0c8c6f25d305b6ded4051805ffd8ff SOI

OK:
0c8c6f25d305f034f9053705dcf952 EOI
0c8e6f25d305f034f9053705 EOF
0c8d2967fa050b11fb053905ffd8ff SOI

Not ok
0c8d2967fa054a421e065805e0ee50 no EOI, no EOF
0c8c94671f06c01e21065a05ffd8ff SOI and FID

Again, Fid is toggled too early.
0c8d9f884506b2826b069b051b3bb9
0c8cafa96b0651a76b069b05adcde2 EOI and FID
0c8eafa96b0651a76b069b05 EOF
0c8cafa96b06aacc6d069d05ffd8ff SOI

In this case will happen fallowing scenario,
1. frame 9f884506 will have corrupted end. (like you describe)
2. will be created new buffer, but this will contain only end of prev
frame. this will be stoped by EOF, but since FID == last_fid, then we
will get out of sync error and this buffer will be probably lost as well.

Let us concentrate on errors we can handle,
1. we can sort of reconstruct fragmented frames. But I do not really
like my previous patch, enay way let us keep it for now.
2. we can ignore FID,EOF,last_fid=fid problem by setting it to -1,
but this may brake other brocken cams. should think about this. or
collect more usb dumps.
3. We should defenetly check if new buffer with MJPEG stream, start with
jpeg header. I think this is important.

jpeg header is defined by uvc specification, it is always on same place.
Buffer is defenetly corrupt if there is no jpeg header [SOI] on start.
If ther is no EOI, we can still reconstruct part of image.

On 19.08.2011 06:52, Carl Michal wrote:
> Hi Alexey,
> 
> ok, if I take your patch, and add to it a check for frame length when
> when the frame is terminated with FID (patch below), then YUV appears to
> function well.  I haven't looked at the patch closely enough to see if
> it handles the case where a packet is split into 3 instead of just two.
> Those are quite infrequent - so it is possible that none occurred in my
> testing of your patch.
> 
> MJPG still has a couple of problems.  There are some mildly corrupt
> frames (just the bottom ~3% of the image) - I believe that's still from
> frames where FID comes a packet or two early.
> 
> Also, there is still a problem with empty buffer's returned: either
> guvcview or luvcview spits out:
> Ignoring empty buffer ...
> 
> about 1 time /second.  After four of those luvcview quits.
> 
> One last thing - there is minor typo in your patch leght should be length
> 
> Carl
> 
> Add frame length check to uncompressed frames terminated with FID:
> 
> --- uvc_video.c~    2011-08-18 21:35:53.664881826 -0700
> +++ uvc_video.c    2011-08-18 21:41:51.712872852 -0700
> @@ -627,10 +627,15 @@
>              do {
>                  ret = uvc_video_decode_start(stream, buf, mem,
>                      urb->iso_frame_desc[i].actual_length);
> -                if (ret == -EAGAIN)
> -                    buf =
> -                      uvc_queue_next_buffer(&stream->queue,
> -                                buf);
> +                if (ret == -EAGAIN){
> +                if (buf->buf.length != buf->buf.bytesused &&
> +                  !(stream->cur_format->flags &
> +                      UVC_FMT_FLAG_COMPRESSED))
> +                    buf->error = 1;
> +
> +                buf = uvc_queue_next_buffer(&stream->queue,
> +                            buf);
> +            }
>              } while (ret == -EAGAIN);
> 
>              if (ret < 0)
> 


From pierre.gronlier at gmail.com  Fri Aug 19 12:46:49 2011
From: pierre.gronlier at gmail.com (Pierre Gronlier)
Date: Fri, 19 Aug 2011 13:46:49 +0300
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
Message-ID: <CAOs7PLMwKJp2O9V60u40aYwQ_WL1go1RmyAtBN+Cb1ZNJz0pvQ@mail.gmail.com>

> Laurent Pinchart laurent.pinchart at ideasonboard.com
> Wed Jun 22 02:51:09 CEST 2011
>
> Hi,
>
> The official H.264 UVC specification isn't better. Its only purpose is to
> support Logitech webcams in Skype under Windows. Its quality is way below what
> I would expect from a USB-IF specification. I don't plan to implement support
> for that spec in the uvcvideo driver in the near future. I'll review patches,
> but I will NAK anything that isn't clean enough. And from reading the spec
> producing a clean implementation will be pretty difficult.

Hi,

Has any patch being merged since this last post ?

What should be the next step if I want to use the hardware encoding
feature of those Logitech webcams ?

Regards,

-- 
Pierre Gronlier


From member at linkedin.com  Fri Aug 19 15:20:09 2011
From: member at linkedin.com (Gerardo Luis Kilmurray via LinkedIn)
Date: Fri, 19 Aug 2011 13:20:09 +0000 (UTC)
Subject: [Linux-uvc-devel] Join my network on LinkedIn
Message-ID: <1671444791.1472466.1313760009375.JavaMail.app@ela4-app0135.prod>

LinkedIn
------------




    Gerardo Luis Kilmurray requested to add you as a connection on LinkedIn:
  
------------------------------------------

I'd like to add you to my professional network on LinkedIn.

Accept invitation from Gerardo Luis Kilmurray
http://www.linkedin.com/e/2d8m4g-grj6sewa-21/YhLeBtiJ1S_RPnQZ02mJgWFyYP4RYKjG0EhEfiqeMY29FTi7/blk/I148125145_13/1BpC5vrmRLoRZcjkkZt5YCpnlOt3RApnhMpmdzgmhxrSNBszYPclYRd34Rcz4Ud359bQhLoSdCiAdxbP8Mcz4SdP8NejcLrCBxbOYWrSlI/EML_comm_afe/

View invitation from Gerardo Luis Kilmurray
http://www.linkedin.com/e/2d8m4g-grj6sewa-21/YhLeBtiJ1S_RPnQZ02mJgWFyYP4RYKjG0EhEfiqeMY29FTi7/blk/I148125145_13/3cNnPkQcjkOcjwQckALqnpPbOYWrSlI/svi/

------------------------------------------ 
DID YOU KNOW your LinkedIn profile helps you control your public image when people search for you? Setting your profile as public means your LinkedIn profile will come up when people enter your name in leading search engines. Take control of your image! 
http://www.linkedin.com/e/2d8m4g-grj6sewa-21/ewp/inv-22/
 
-- 
(c) 2011, LinkedIn Corporation
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110819/fb0be57e/attachment.html>

From michal at physics.ubc.ca  Fri Aug 19 16:26:51 2011
From: michal at physics.ubc.ca (Carl Michal)
Date: Fri, 19 Aug 2011 07:26:51 -0700 (PDT)
Subject: [Linux-uvc-devel] error proofing mjpeg stream
In-Reply-To: <4E4E0F81.7040902@fisher-privat.net>
References: <4E410FA3.70304@fisher-privat.net>
	<4E44276F.80304@fisher-privat.net>
	<alpine.LNX.2.00.1108112141380.7206@tristan>
	<4E44D485.7050003@fisher-privat.net>
	<alpine.LNX.2.00.1108121031450.27345@spider.phas.ubc.ca>
	<4E45748C.2040504@fisher-privat.net>
	<alpine.LNX.2.00.1108121201350.27345@spider.phas.ubc.ca>
	<4E458398.2050207@fisher-privat.net>
	<alpine.LNX.2.00.1108121749050.5900@tristan>
	<4E461F54.9010700@fisher-privat.net>
	<alpine.LNX.2.00.1108130005050.5432@tristan>
	<4E463B87.2050905@fisher-privat.net>
	<alpine.LNX.2.00.1108132248420.7133@tristan>
	<4E477E60.6060906@fisher-privat.net>
	<alpine.LNX.2.00.1108142053590.5280@tristan>
	<4E48C127.9080205@fisher-privat.net>
	<alpine.LNX.2.00.1108171131050.5545@spider.phas.ubc.ca>
	<4E4C197D.9010501@fisher-privat.net>
	<alpine.LNX.2.00.1108172314070.11832@tristan>
	<4E4D1934.3070902@fisher-privat.net>
	<alpine.LNX.2.00.1108182152030.11800@tri stan>
	<4E4E0F81.7040902@fisher-privat.net>
Message-ID: <alpine.LNX.2.00.1108190723080.16623@tristan>

Hi Alexey,


On Fri, 19 Aug 2011, Alexey Fisher wrote:

> I continued to work on you usb dump for jpeg stream, here are some examples:
>
> This is first frame:
> 0c8d41c4ce01e010ca042f04ffd8ff SOI
> 0c8d41c4ce015ca3ca042f04975271
>
> This is end of first frame, start of second, and first issue.
> 0c8d41c4ce017b42ee044e046a1950
> 0c8c0f5fee041a67ee044e0496a246 FID togled, new uvc time, but actual EOI
> is here.
> 0c8e0f5fee041a67ee044e04        actual EOF
> 0c8c0f5fee04961ef0045004ffd8ff SOI
> for now this will be corrupt.
>
> Second frame, every thing is fine.
> 0c8c0f5fee04315014056f04c74b75 EOI
> 0c8e0f5fee04d07414057004
> 0c8d1f801405ea5016057104ffd8ff SOI
>
> frame 3.; FID is togled, no EOF, no EOI...
> last part of this packet is corrupt, frame 2. is corrupt.
> 0c8d1f80140509f039059004666e79
> 0c8c34a13a05a05e3c059204ffd8ff SOI
> It will be ipossible to fix, EOF probably lost, but FID is correct.
>
> frame 3 is ok, start of frame 4.
> 0c8c34a13a053d906005b20497335d EOI
> 0c8e34a13a05dcb46005b204 EOF
> 0c8d7a576205556c6205b404ffd8ff SOI
>
> frame 4 is ok
> 0c8d7a57620592c28605d3040c8f4a EOI
> 0c8e4fe3860531e78605d404 EOF
> 0c8c4fe38605aa9e8805d504ffd8ff SOI
>
> no end of frame 4, FID togled and frame 5 started.
> 0c8c4fe38605c93dac05f4042515c4
> 0c8d5f04ad0501d1ae05f604ffd8ff SOI
> may be some parts was not included in dump, or 4 is really corrupt.
> Can't do any thing here, except only to check for EOI and SOI
>
> Every thing is ok, here.
> 0c8d5f04ad059c02d3051605bd8d13 EOI
> 0c8f5f04ad059c02d3051605
> 0c8c6f25d305b6ded4051805ffd8ff SOI
>
> OK:
> 0c8c6f25d305f034f9053705dcf952 EOI
> 0c8e6f25d305f034f9053705 EOF
> 0c8d2967fa050b11fb053905ffd8ff SOI
>
> Not ok
> 0c8d2967fa054a421e065805e0ee50 no EOI, no EOF
> 0c8c94671f06c01e21065a05ffd8ff SOI and FID
>
> Again, Fid is toggled too early.
> 0c8d9f884506b2826b069b051b3bb9
> 0c8cafa96b0651a76b069b05adcde2 EOI and FID
> 0c8eafa96b0651a76b069b05 EOF
> 0c8cafa96b06aacc6d069d05ffd8ff SOI
>
> In this case will happen fallowing scenario,
> 1. frame 9f884506 will have corrupted end. (like you describe)
> 2. will be created new buffer, but this will contain only end of prev
> frame. this will be stoped by EOF, but since FID == last_fid, then we
> will get out of sync error and this buffer will be probably lost as well.
>
> Let us concentrate on errors we can handle,
> 1. we can sort of reconstruct fragmented frames. But I do not really
> like my previous patch, enay way let us keep it for now.
> 2. we can ignore FID,EOF,last_fid=fid problem by setting it to -1,
> but this may brake other brocken cams. should think about this. or
> collect more usb dumps.
> 3. We should defenetly check if new buffer with MJPEG stream, start with
> jpeg header. I think this is important.
>
> jpeg header is defined by uvc specification, it is always on same place.
> Buffer is defenetly corrupt if there is no jpeg header [SOI] on start.
> If ther is no EOI, we can still reconstruct part of image.
>
> On 19.08.2011 06:52, Carl Michal wrote:
>> Hi Alexey,
>>
>> ok, if I take your patch, and add to it a check for frame length when
>> when the frame is terminated with FID (patch below), then YUV appears to
>> function well.  I haven't looked at the patch closely enough to see if
>> it handles the case where a packet is split into 3 instead of just two.
>> Those are quite infrequent - so it is possible that none occurred in my
>> testing of your patch.
>>
>> MJPG still has a couple of problems.  There are some mildly corrupt
>> frames (just the bottom ~3% of the image) - I believe that's still from
>> frames where FID comes a packet or two early.
>>
>> Also, there is still a problem with empty buffer's returned: either
>> guvcview or luvcview spits out:
>> Ignoring empty buffer ...
>>
>> about 1 time /second.  After four of those luvcview quits.
>>
>> One last thing - there is minor typo in your patch leght should be length
>>
>> Carl
>>
>> Add frame length check to uncompressed frames terminated with FID:
>>
>> --- uvc_video.c~    2011-08-18 21:35:53.664881826 -0700
>> +++ uvc_video.c    2011-08-18 21:41:51.712872852 -0700
>> @@ -627,10 +627,15 @@
>>              do {
>>                  ret = uvc_video_decode_start(stream, buf, mem,
>>                      urb->iso_frame_desc[i].actual_length);
>> -                if (ret == -EAGAIN)
>> -                    buf =
>> -                      uvc_queue_next_buffer(&stream->queue,
>> -                                buf);
>> +                if (ret == -EAGAIN){
>> +                if (buf->buf.length != buf->buf.bytesused &&
>> +                  !(stream->cur_format->flags &
>> +                      UVC_FMT_FLAG_COMPRESSED))
>> +                    buf->error = 1;
>> +
>> +                buf = uvc_queue_next_buffer(&stream->queue,
>> +                            buf);
>> +            }
>>              } while (ret == -EAGAIN);
>>
>>              if (ret < 0)
>>
>


my patch repairs the stream from my camera essentially perfectly.
As I said a long time ago - FID is broken in MJPG output - you have to 
ignore it completely and only trust EOF.  With YUV output though, you 
can't just rely on EOF because sometimes the camera gives up on a frame 
part way through and the only way that is indicated is with FID (and a new 
SOI).

So I think if you ignore FID when in MJPG mode your patch should work 
well.

Carl



From bug-track at fisher-privat.net  Sat Aug 20 09:42:30 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sat, 20 Aug 2011 09:42:30 +0200
Subject: [Linux-uvc-devel] /dev/video0 disappears after 7 seconds
In-Reply-To: <20110819232311.GA4256@eniac>
References: <20110819232311.GA4256@eniac>
Message-ID: <4E4F6566.4080104@fisher-privat.net>

On 20.08.2011 01:23, useingubuntu at gmail.com wrote:
> Hi All,
> When I run cheese like this:
> sudo cheese &
> 
> After about 7 sec. the uvcvideo driver puts this message into dmesg:
> [ 3108.326835] uvcvideo: Non-zero status (-84) in status completion handler.
> [ 3109.229746] usb 2-2: reset full speed USB device number 2 using uhci_hcd
> [ 3109.231692] uvcvideo: Failed to resubmit video URB (-19).
> [ 3109.263669] uvcvideo: Failed to resubmit video URB (-19).
> [ 3109.295668] uvcvideo: Failed to resubmit video URB (-19).
> [ 3109.327663] uvcvideo: Failed to resubmit video URB (-19).
> [ 3109.359653] uvcvideo: Failed to resubmit video URB (-19).
> [ 3109.431646] 2:3:1: cannot get freq at ep 0x84
> 
> And reinitializes, causing /dev/video0 to disappear and /dev/video1 to appear
> in its place. This confuses Cheese, causing it to print out this message:
> libv4l2: error dequeuing buf: No such device

There is nothing we can do about this,
Non-zero status (-84) - see:
grep 84 include/asm-generic/errno.h
#define	EILSEQ		84	/* Illegal byte sequence */

what mean:
./Documentation/usb/error-codes.txt
-EILSEQ (*, **)         a) CRC mismatch
                        b) no response packet received within the
                           prescribed bus turn-around time
                        c) unknown USB error

                        Note that often the controller hardware does not
                        distinguish among cases a), b), and c), so a
                        driver cannot tell whether there was a protocol
                        error, a failure to respond (often caused by
                        device disconnect), or some other fault.

This is why usb/uvc try to initiate device, unfortunately cheese use at
this time /dev/video0 this is why it can't be removed, and system create
new /dev/video1.

So the real problem is not in file names, but in usb controller or webcam.

enable debug for uvc:
sudo sh -c "echo 0xfff > /sys/module/uvcvideo/parameters/trace"

start video, wait until the error and take a look if there is some thing
interesting in dmesg. You can attach your demsg and send it here.


From useingubuntu at gmail.com  Sun Aug 21 00:20:20 2011
From: useingubuntu at gmail.com (Ubuntu User)
Date: Sat, 20 Aug 2011 15:20:20 -0700
Subject: [Linux-uvc-devel] /dev/video0 disappears after 7 seconds
In-Reply-To: <4E4F6566.4080104@fisher-privat.net>
References: <20110819232311.GA4256@eniac> <4E4F6566.4080104@fisher-privat.net>
Message-ID: <CA+GOuPanCVpCL1PdAqHTcLa7aV8Ru+KwUSaT39PqFHh1+0KoWA@mail.gmail.com>

Hmmm... I guess a new computer may be in order. I've had trouble with
other USB devices. Thanks for your help!
Matthew



On Sat, Aug 20, 2011 at 12:42 AM, Alexey Fisher
<bug-track at fisher-privat.net> wrote:
> On 20.08.2011 01:23, useingubuntu at gmail.com wrote:
>> Hi All,
>> When I run cheese like this:
>> sudo cheese &
>>
>> After about 7 sec. the uvcvideo driver puts this message into dmesg:
>> [ 3108.326835] uvcvideo: Non-zero status (-84) in status completion handler.
>> [ 3109.229746] usb 2-2: reset full speed USB device number 2 using uhci_hcd
>> [ 3109.231692] uvcvideo: Failed to resubmit video URB (-19).
>> [ 3109.263669] uvcvideo: Failed to resubmit video URB (-19).
>> [ 3109.295668] uvcvideo: Failed to resubmit video URB (-19).
>> [ 3109.327663] uvcvideo: Failed to resubmit video URB (-19).
>> [ 3109.359653] uvcvideo: Failed to resubmit video URB (-19).
>> [ 3109.431646] 2:3:1: cannot get freq at ep 0x84
>>
>> And reinitializes, causing /dev/video0 to disappear and /dev/video1 to appear
>> in its place. This confuses Cheese, causing it to print out this message:
>> libv4l2: error dequeuing buf: No such device
>
> There is nothing we can do about this,
> Non-zero status (-84) - see:
> grep 84 include/asm-generic/errno.h
> #define EILSEQ ? ? ? ? ?84 ? ? ?/* Illegal byte sequence */
>
> what mean:
> ./Documentation/usb/error-codes.txt
> -EILSEQ (*, **) ? ? ? ? a) CRC mismatch
> ? ? ? ? ? ? ? ? ? ? ? ?b) no response packet received within the
> ? ? ? ? ? ? ? ? ? ? ? ? ? prescribed bus turn-around time
> ? ? ? ? ? ? ? ? ? ? ? ?c) unknown USB error
>
> ? ? ? ? ? ? ? ? ? ? ? ?Note that often the controller hardware does not
> ? ? ? ? ? ? ? ? ? ? ? ?distinguish among cases a), b), and c), so a
> ? ? ? ? ? ? ? ? ? ? ? ?driver cannot tell whether there was a protocol
> ? ? ? ? ? ? ? ? ? ? ? ?error, a failure to respond (often caused by
> ? ? ? ? ? ? ? ? ? ? ? ?device disconnect), or some other fault.
>
> This is why usb/uvc try to initiate device, unfortunately cheese use at
> this time /dev/video0 this is why it can't be removed, and system create
> new /dev/video1.
>
> So the real problem is not in file names, but in usb controller or webcam.
>
> enable debug for uvc:
> sudo sh -c "echo 0xfff > /sys/module/uvcvideo/parameters/trace"
>
> start video, wait until the error and take a look if there is some thing
> interesting in dmesg. You can attach your demsg and send it here.
>


From precheca123 at yahoo.com.br  Tue Aug 23 21:20:29 2011
From: precheca123 at yahoo.com.br (=?iso-8859-1?Q?T=E9ssio_Fechine?=)
Date: Tue, 23 Aug 2011 12:20:29 -0700 (PDT)
Subject: [Linux-uvc-devel] Webcam Compatibility Report
Message-ID: <1314127229.22002.YahooMailClassic@web111707.mail.gq1.yahoo.com>

Hello,
My webcam Lenovo EasyCamera (090c:3717) is compatible with UVC and works very well. 
Just reporting new hardware to your known UVC devices.

Thanks!


From bug-track at fisher-privat.net  Thu Aug 25 09:44:10 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 25 Aug 2011 09:44:10 +0200
Subject: [Linux-uvc-devel] uvc header question
Message-ID: <4E55FD4A.9080906@fisher-privat.net>

Hi Laurent,

are there any reason why uvc_video_decode_start do not do precise header 
size checks? Are there many cameras with broken header size too?

I send you patch on what i work now to catch streams with fragmented 
packets.. what do you think about it? Will you apply some thing like this?

Regards,
	Alexey.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tmp.diff
Type: text/x-patch
Size: 6392 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110825/cc5c2522/attachment.bin>

From rob.krakora at messagenetsystems.com  Fri Aug 26 20:36:31 2011
From: rob.krakora at messagenetsystems.com (Robert Krakora)
Date: Fri, 26 Aug 2011 18:36:31 +0000 (UTC)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
Message-ID: <loom.20110826T203249-167@post.gmane.org>

Hello,

Were you ever able to get H.264 content from the Logitech B990?  I was able to
using Stephan's patches and a patch to the v4l2src GStreamer element.  I have
both audio and video.  However, I have not figured out how to affect the
encoding parameters that I believe are exposed by the XUs.  If you are
interested, I can make what I have available for you.

Best Regards,

Rob Krakora




From rob.krakora at messagenetsystems.com  Fri Aug 26 20:44:23 2011
From: rob.krakora at messagenetsystems.com (Robert Krakora)
Date: Fri, 26 Aug 2011 18:44:23 +0000 (UTC)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
Message-ID: <loom.20110826T203852-192@post.gmane.org>

Hello,

I just mentioned in a previous post that I have the B990 streaming H.264 with
Stephan's patches for v4l2 and some patches to GStreamer plugins-good for the
v4l2src element.  There were two additional changes I made beyond Stephan's that
I believe are necessary.  I have this running on CentOS 6.0 with GStreamer
0.10.35 and GStreamer plugins-good 0.10.30 (patched).  Logitech does NOT follow
the specification that they co-authored and submitted to USB-IF where H.264
content is multiplexed in the Motion JPEG container.  It is merely exposed as
another interface in the one and only configuration identified by the H.264
GUID.  I posted a question to Logitech about how to gain access to the encoder
controls via the XUs but have heard nothing back yet.

Best Regards,

Rob Krakora






From max.lapshin at gmail.com  Fri Aug 26 20:54:53 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Fri, 26 Aug 2011 22:54:53 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <loom.20110826T203852-192@post.gmane.org>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
	<loom.20110826T203852-192@post.gmane.org>
Message-ID: <CAMxVRxCoMC=ZgcHnoi-5KZBvHez4np84aak_gHzqdgr9jBfi6A@mail.gmail.com>

Wow, I'm very interested in this camera. In fact I can send money for
UVC authors to buy such a camera.


From pierre.gronlier at gmail.com  Fri Aug 26 22:04:48 2011
From: pierre.gronlier at gmail.com (Pierre Gronlier)
Date: Fri, 26 Aug 2011 23:04:48 +0300
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <loom.20110826T203249-167@post.gmane.org>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
	<loom.20110826T203249-167@post.gmane.org>
Message-ID: <CAOs7PLOyUo=VpJRXYVZGuCw_pV0SWSm9m1wojAB6b7z5tQ8fnw@mail.gmail.com>

On 26 August 2011 21:36, Robert Krakora
<rob.krakora at messagenetsystems.com> wrote:
> Hello,
>
> Were you ever able to get H.264 content from the Logitech B990? ?I was able to
> using Stephan's patches and a patch to the v4l2src GStreamer element. ?I have
> both audio and video. ?However, I have not figured out how to affect the
> encoding parameters that I believe are exposed by the XUs. ?If you are
> interested, I can make what I have available for you.

Hello,

This is a great news :)

If it is possible to send a tarball or links and diffs of the
different thing you mention ? then I will try to make it work this my
C920 logitech.

Best Regards,

>
> Best Regards,
>
> Rob Krakora
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>



-- 
Pierre Gronlier


From bug-track at fisher-privat.net  Sat Aug 27 08:09:33 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sat, 27 Aug 2011 08:09:33 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <loom.20110826T203249-167@post.gmane.org>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
	<loom.20110826T203249-167@post.gmane.org>
Message-ID: <4E588A1D.7050402@fisher-privat.net>

Am 26.08.2011 20:36, schrieb Robert Krakora:
> Hello,
>
> Were you ever able to get H.264 content from the Logitech B990?  I was able to
> using Stephan's patches and a patch to the v4l2src GStreamer element.  I have
> both audio and video.  However, I have not figured out how to affect the
> encoding parameters that I believe are exposed by the XUs.  If you are
> interested, I can make what I have available for you.
>
> Best Regards,
>
> Rob Krakora

I'd really like to know, is it worth to do it. I mean what is the image 
quality? What kind of H.264 bitstream is created? What is the key frame 
frequency? Can you grub and send me some sample file?

What actual use cases? If i understand correctly, it will be transcoded 
any way in case of videochat. To record myself i'd prefer software 
encoder, for better quality.


From max.lapshin at gmail.com  Sat Aug 27 11:09:13 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Sat, 27 Aug 2011 13:09:13 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <4E588A1D.7050402@fisher-privat.net>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
	<loom.20110826T203249-167@post.gmane.org>
	<4E588A1D.7050402@fisher-privat.net>
Message-ID: <CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>

Robert, would You kindly tell more: how can I get H264 with UVC api?

I'm not using gstreamer, because I capture video directly into my
program. I just brought B990 home (how huge is it!)
and trying to get compressed stream.

should I select something like V4L2_PIX_FMT_H264 ?


From max.lapshin at gmail.com  Sat Aug 27 11:50:55 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Sat, 27 Aug 2011 13:50:55 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<1308206162.4182.2.camel@mini>
	<loom.20110826T203249-167@post.gmane.org>
	<4E588A1D.7050402@fisher-privat.net>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
Message-ID: <CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>

By the way, have you seen document
http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.zip
?
There are some encoder setup options.

On Sat, Aug 27, 2011 at 1:09 PM, Max Lapshin <max.lapshin at gmail.com> wrote:
> Robert, would You kindly tell more: how can I get H264 with UVC api?
>
> I'm not using gstreamer, because I capture video directly into my
> program. I just brought B990 home (how huge is it!)
> and trying to get compressed stream.
>
> should I select something like V4L2_PIX_FMT_H264 ?
>


From bug-track at fisher-privat.net  Sun Aug 28 09:54:18 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sun, 28 Aug 2011 09:54:18 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpatiJ0_Ou13kqpUMrF9aohUWeoBFx9oMUPGGUxQ=dp=j=Xw@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>	<1308206162.4182.2.camel@mini>	<loom.20110826T203249-167@post.gmane.org>	<4E588A1D.7050402@fisher-privat.net>
	<CA+DpatiJ0_Ou13kqpUMrF9aohUWeoBFx9oMUPGGUxQ=dp=j=Xw@mail.gmail.com>
Message-ID: <4E59F42A.9010803@fisher-privat.net>

Hi Robert,

thank you for your response, even if it sound a bit like zombie
commercial :)

I took a look on the specification and feel like i need to put two bits
of doubt concerning this webcam, just in case some one wont to by it.

reference to:
http://www.logitech.com/en-us/for-business/products/webcams-headsets/devices/b990-hd-webcam
- Native 5MP HD sensor
- High-definition video in 720p widescreen mode with recommended system
- Color depth: 24-bit true color
- Frame rate: Up to 30 frames per second streaming video in 720p and VGA
mode

Doubts:
- 24-bit true color - i'm confused here, seems like we can access only
16-bit color over yuv. will it really do 24bit with h264? Even if it
will cost more power?... i think it is not true
- Even if it has 5MPixel sensor, seems like we have access only to 1MP.
According to this http://pastebin.com/9WFgytwY
the biggest resolution what it provide is 1280x720, in other words
"High-definition video in 720p". This is also maximal resolution what
can be uncompressed provided with ~15fps over USB2.0 . But it give us
actually only 10 fps.
JPEG compressed stream seems to be more realistic, it can indeed do 30
fps at HD720p. I guess it will take about 30Mbit/S bandwidth.

Now after it sounds more realistic...

H264 can reduce it even more (no doubt). In case of hardware encoder, we
should be able to dynamically control encoding process, reduce keyframe
frequency and be able to force KF if needed to recover the stream, (i
guess you currently trying to find it out). And if you use gstreamer
then, thelepythy+gstreamer should be able to control it as well.

It looks like lots of work and fun. Suddenly i do not have this toy to
play with it. I hope it is really worth it.

Regards,
	Alexey.



On 27.08.2011 19:47, Robert Krakora wrote:
> Hi Alexey,
> 
> As webcam sampling size increases (5MP in the case of the Logitech B990),
> encoding in the camera becomes important to conserve USB bandwidth, and if
> you want to transmit content over an Ethernet connection it is even more
> important.  Also, software encoding eats up host processor CPU.  We have
> Intel Atom based mediaports that employ NVidia hardware assisted decoding.
> The are all equipped with cameras and software encoding would consume a fair
> amount of the CPU.  We push the encoded data around the network.
> 
> If you have a mid->high end CPU, no problem, use a software encoder if you
> wish.  Just remember though, that your USB host controller + hub aggregate
> bandwidth will be mostly consumed by the raw data of the camera.  At some
> point we will probably see USB 3.0 webcams to handle raw data from cameras
> as sampling size increases.
> 
> I can send you some samples, but as of today I cannot control the encoders
> parameters, so it is not the highest quality, but still looks really good.
> 
> Best Regards,
> 
> Rob Krakora
> 
> 
> On Sat, Aug 27, 2011 at 2:09 AM, Alexey Fisher
> <bug-track at fisher-privat.net>wrote:
> 
>> Am 26.08.2011 20:36, schrieb Robert Krakora:
>>
>>> Hello,
>>>
>>> Were you ever able to get H.264 content from the Logitech B990?  I was
>>> able to
>>> using Stephan's patches and a patch to the v4l2src GStreamer element.  I
>>> have
>>> both audio and video.  However, I have not figured out how to affect the
>>> encoding parameters that I believe are exposed by the XUs.  If you are
>>> interested, I can make what I have available for you.
>>>
>>> Best Regards,
>>>
>>> Rob Krakora
>>>
>>
>> I'd really like to know, is it worth to do it. I mean what is the image
>> quality? What kind of H.264 bitstream is created? What is the key frame
>> frequency? Can you grub and send me some sample file?
>>
>> What actual use cases? If i understand correctly, it will be transcoded any
>> way in case of videochat. To record myself i'd prefer software encoder, for
>> better quality.
>>
> 
> 
> 



From linux4michelle at tamay-dogan.net  Sun Aug 28 14:37:27 2011
From: linux4michelle at tamay-dogan.net (Michelle Konzack)
Date: Sun, 28 Aug 2011 14:37:27 +0200
Subject: [Linux-uvc-devel] Seraching for HD camera
Message-ID: <20110828123727.GO14392@michelle1>

Hello *,

we have a future project, where we need a video camera  with  very  high
resolution, meaning Full-HD or more with 25 fps and long-time stability.
Also with maximum quality.  OK, RAW-Video will be a problem, not for the
Network, because I use a dedicate GE Cable  for  it,  but  for  the  SAS
Drives...  an OGG Stream (Theora + Vorbis) would be nice.

So, no inexpensive 20 Euro Made-In-China crap.

We need to record several hours (up to 12) at once, which mean  exactly,
that  the  receiving  program  should  cut  the  incoming  video  stream
automaticaly in pieces of 10 minutes or something like this.

Does someone know a camera which support this and works with uvc/v4l?

Also I have a 24M pixel Image-Sensor and currently  looking  for  a  DSP
PCIe or parallal interface, which I can connect to  a  Marvel  Discovery
MV78100 (1200MHz) or Marvel Armada 300 (up to 2000MHz)

So, if I do not find something for an acceptable price, I have to  build
it my own (I am engineer)

And hints and suggestions welcome

Note:  The storage server is a "Sun Fire X4250" with 16 SAS Drives
       of 2 TByte which mean, that storage ich the lesser problem!

Thanks, Greetings and nice Day/Evening
    Michelle Konzack

-- 
##################### Debian GNU/Linux Consultant ######################
   Development of Intranet and Embedded Systems with Debian GNU/Linux

itsystems at tdnet France            itsystems at tdnet
Owner Michelle Konzack            Owner Michelle Konzack

Apt. 917 (homeoffice)             Gewerbe Strasse 3
50, rue de Soultz                 77694 Kehl/Germany
67100 Strasbourg/France           Tel office: +49-176-86004575
Tel mobil: +33-6-61925193         Tel mobil:  +49-177-9351947

<http://www.itsystems.tamay-dogan.net/>  <http://www.flexray4linux.org/>
<http://www.debian.tamay-dogan.net/>         <http://www.can4linux.org/>

Jabber linux4michelle at jabber.ccc.de

Linux-User #280138 with the Linux Counter, http://counter.li.org/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.pgp
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110828/398b6b3e/attachment.pgp>

From philip at gladstonefamily.net  Sun Aug 28 16:20:55 2011
From: philip at gladstonefamily.net (Philip Gladstone)
Date: Sun, 28 Aug 2011 10:20:55 -0400
Subject: [Linux-uvc-devel] Seraching for HD camera
In-Reply-To: <20110828123727.GO14392@michelle1>
References: <20110828123727.GO14392@michelle1>
Message-ID: <4E5A4EC7.2050903@gladstonefamily.net>

I'm using a logitech C910 which will do what you want. It has a native 
5MP sensor, but you can't extract the full resolution at more than 10 
frames per second. I can't recall what the maximum resolution is that 
will do 25 fps, but it is at least 1920x1080.

However, I am experiencing some problems with the distance focus. I'm 
not (currently) able to focus it at infinity.

Philip

On 8/28/2011 8:37 AM, Michelle Konzack wrote:
> Hello *,
>
> we have a future project, where we need a video camera  with  very  high
> resolution, meaning Full-HD or more with 25 fps and long-time stability.
> Also with maximum quality.  OK, RAW-Video will be a problem, not for the
> Network, because I use a dedicate GE Cable  for  it,  but  for  the  SAS
> Drives...  an OGG Stream (Theora + Vorbis) would be nice.
>
> So, no inexpensive 20 Euro Made-In-China crap.
>
> We need to record several hours (up to 12) at once, which mean  exactly,
> that  the  receiving  program  should  cut  the  incoming  video  stream
> automaticaly in pieces of 10 minutes or something like this.
>
> Does someone know a camera which support this and works with uvc/v4l?
>
> Also I have a 24M pixel Image-Sensor and currently  looking  for  a  DSP
> PCIe or parallal interface, which I can connect to  a  Marvel  Discovery
> MV78100 (1200MHz) or Marvel Armada 300 (up to 2000MHz)
>
> So, if I do not find something for an acceptable price, I have to  build
> it my own (I am engineer)
>
> And hints and suggestions welcome
>
> Note:  The storage server is a "Sun Fire X4250" with 16 SAS Drives
>         of 2 TByte which mean, that storage ich the lesser problem!
>
> Thanks, Greetings and nice Day/Evening
>      Michelle Konzack
>
>
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel

-- 
Philip Gladstone
Ham: N1DQ


From linux4michelle at tamay-dogan.net  Sun Aug 28 20:17:15 2011
From: linux4michelle at tamay-dogan.net (Michelle Konzack)
Date: Sun, 28 Aug 2011 20:17:15 +0200
Subject: [Linux-uvc-devel] Seraching for HD camera
In-Reply-To: <4E5A4EC7.2050903@gladstonefamily.net>
References: <20110828123727.GO14392@michelle1>
	<4E5A4EC7.2050903@gladstonefamily.net>
Message-ID: <20110828181715.GP14392@michelle1>

Hello Philip,

Am 2011-08-28 10:20:55, hacktest Du folgendes herunter:
> I'm using a logitech C910 which will do what you want. It has a
> native 5MP sensor, but you can't extract the full resolution at more
> than 10 frames per second. I can't recall what the maximum
> resolution is that will do 25 fps, but it is at least 1920x1080.

Sound very promissing for 70 Euro here in Germany...

> However, I am experiencing some problems with the distance focus.
> I'm not (currently) able to focus it at infinity.
> 
> Philip

Thanks, Greetings and nice Day/Evening
    Michelle Konzack

-- 
##################### Debian GNU/Linux Consultant ######################
   Development of Intranet and Embedded Systems with Debian GNU/Linux

itsystems at tdnet France            itsystems at tdnet
Owner Michelle Konzack            Owner Michelle Konzack

Apt. 917 (homeoffice)             Gewerbe Stra?e 3
50, rue de Soultz                 77694 Kehl/Germany
67100 Strasbourg/France           Tel: +49-177-9351947  mobil
Tel: +33-6-61925193 mobil         Tel: +49-176-86004575 office

<http://www.itsystems.tamay-dogan.net/>  <http://www.flexray4linux.org/>
<http://www.debian.tamay-dogan.net/>         <http://www.can4linux.org/>

Jabber linux4michelle at jabber.ccc.de
ICQ    #328449886

Linux-User #280138 with the Linux Counter, http://counter.li.org/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.pgp
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110828/98f1b554/attachment.pgp>

From ajay.bhargav at einfochips.com  Mon Aug 29 07:16:05 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Mon, 29 Aug 2011 10:46:05 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAOs7PLOyUo=VpJRXYVZGuCw_pV0SWSm9m1wojAB6b7z5tQ8fnw@mail.gmail.com>
Message-ID: <437675540.14400.1314594964978.JavaMail.root@ahm.einfochips.com>


----- "Pierre Gronlier" <pierre.gronlier at gmail.com> wrote:

> On 26 August 2011 21:36, Robert Krakora
> <rob.krakora at messagenetsystems.com> wrote:
> > Hello,
> >
> > Were you ever able to get H.264 content from the Logitech B990? ?I
> was able to
> > using Stephan's patches and a patch to the v4l2src GStreamer
> element. ?I have
> > both audio and video. ?However, I have not figured out how to affect
> the
> > encoding parameters that I believe are exposed by the XUs. ?If you
> are
> > interested, I can make what I have available for you.
> 
> Hello,
> 
> This is a great news :)
> 
> If it is possible to send a tarball or links and diffs of the
> different thing you mention ? then I will try to make it work this my
> C920 logitech.
> 
> Best Regards,
> 
> >
> > Best Regards,
> >
> > Rob Krakora
> >
> >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> >
> 
> 
> 
> --
> Pierre Gronlier
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 
Hi Rob,

Can you please forward patches for this?

Thanks,
Ajay Bhargav


From bug-track at fisher-privat.net  Mon Aug 29 08:52:41 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 29 Aug 2011 08:52:41 +0200
Subject: [Linux-uvc-devel] question about bayer sensors
Message-ID: <4E5B3739.8050909@fisher-privat.net>

Hallo all,
i know some people here was working with bayer raw data. I just 
discovered this word for me, so i need some help to understand it correctly.

Normal bayer based image sensor have separate pixel for each color. 
Usually it made in 4 pixel squares, 1 - blue, 1 - red, 2 - green. There 
are different ways to precess this data but most easiest one will get 
one image pixel out of 4 physical pixels.
This also mean, if my (for example) webcam has physical sensor size of 
2MP, the real, not interpolated image data is MP*0.25.

1600x1200 (claimed resolution(2MP)) /2 = 800x600 (real/perfect image 
resolution(0,5MP))

Is this correct?

Regards,
	Alexey.


From jp.francois at cynove.com  Mon Aug 29 09:58:47 2011
From: jp.francois at cynove.com (jean-philippe francois)
Date: Mon, 29 Aug 2011 09:58:47 +0200
Subject: [Linux-uvc-devel] question about bayer sensors
In-Reply-To: <4E5B3739.8050909@fisher-privat.net>
References: <4E5B3739.8050909@fisher-privat.net>
Message-ID: <CAGGh5h3=ynNz++tqAM8g8P5orS7AoQbt5u2926fuNDmtGxVqqA@mail.gmail.com>

2011/8/29 Alexey Fisher <bug-track at fisher-privat.net>

> Hallo all,
> i know some people here was working with bayer raw data. I just discovered
> this word for me, so i need some help to understand it correctly.
>
> Normal bayer based image sensor have separate pixel for each color. Usually
> it made in 4 pixel squares, 1 - blue, 1 - red, 2 - green. There are
> different ways to precess this data but most easiest one will get one image
> pixel out of 4 physical pixels.
> This also mean, if my (for example) webcam has physical sensor size of 2MP,
> the real, not interpolated image data is MP*0.25.
>
> 1600x1200 (claimed resolution(2MP)) /2 = 800x600 (real/perfect image
> resolution(0,5MP))
>
> Is this correct?
>
>
I don't think the word 'real' is useful here.
If you treat pixel data as black and white data,
you can see pixel size details. Of course this black
and white image is polluted  by the fact that for a given
visible light quantity, a green pixel won't give you the
same value as a blue pixel, and the resulting image
will look like a mozaic.

If you take 4 pixels to make a half-sized image, you will
miss some details. Not doing interpolation does not mean
your image is more perfect or more real. It is just a suboptimal
usage of data at your disposal.

Let's suppose you could have three monochrome sensor with
the same resolution as your webcam each taking the exact
same image.

>From this image, you can construct a subsampled image
at half the resolution.

With bayer data,  smaller details than in  the subsampled
'perfect' image are available, yet you can only have and
approximation of the full resolution image.

The better your interpolation, the closer you are from
the 'perfect' image, for some definition of perfect.


> Regards,
>        Alexey.
> ______________________________**_________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.**de <Linux-uvc-devel at lists.berlios.de>
> https://lists.berlios.de/**mailman/listinfo/linux-uvc-**devel<https://lists.berlios.de/mailman/listinfo/linux-uvc-devel>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110829/7cc6d9c4/attachment.html>

From laurent.pinchart at ideasonboard.com  Tue Aug 30 23:25:22 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 30 Aug 2011 23:25:22 +0200
Subject: [Linux-uvc-devel] Microdia Sonix id 0c45:6310
In-Reply-To: <4E44D637.9000004@fisher-privat.net>
References: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>
	<CAPdm87r5VYdVCNw4p4-WF-qfhsHehecRQ7Fb=zzuc+6t5CgFRQ@mail.gmail.com>
	<4E44D637.9000004@fisher-privat.net>
Message-ID: <201108302325.22629.laurent.pinchart@ideasonboard.com>

Hi Rafael,

On Friday 12 August 2011 09:28:55 Alexey Fisher wrote:
> On 10.08.2011 16:06, Rafael Piazenski wrote:
> > Thanks again, for your help!
> > 
> > The file is attached!
> > I receiver this output (sorry this is in portuguese, but I'll try to
> > translate):
> > 
> > gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink
> > 
> > Definindo a fila de processamento para PAUSADO...
> > ERRO: A fila do processamento n?o quer pausar.
> > ERRO: do elemento /GstPipeline:pipeline0/GstV4l2Src:v4l2src0: O
> > dispositivo "/dev/video0" n?o p?de ser identificado.
> > Informa??o adicional de depura??o:
> > v4l2_calls.c(493): gst_v4l2_open ():
> > /GstPipeline:pipeline0/GstV4l2Src:v4l2src0: system error: Arquivo ou
> > diret?rio n?o encontrado
> > Definindo a fila de processamento para NULO...
> > Liberando a fila de processamento...
> > 
> > Setting the queue processing to PAUSED ...
> > ERROR: The queue does not want to pause processing.
> > ERROR: from element / GstPipeline: pipeline0/GstV4l2Src: v4l2src0:
> > Device "/ dev/video0" could not be identified.
> > Additional information for debugging:
> > v4l2_calls.c (493): gst_v4l2_open (): / GstPipeline:
> > pipeline0/GstV4l2Src: v4l2src0:
> > system error: File or directory not found
> > Setting the processing queue to NULL ...
> > Releasing the queue processing ...
> > 
> > Hope this can help!
> > Rafael
> > 
> > 2011/8/10 Alexey Fisher <bug-track at fisher-privat.net>:
> >> On 10.08.2011 15:11, Rafael Piazenski wrote:
> >>> Hello people!
> >>> First of all, thanks for your help!
> >>> I have this webcam on my ubuntu 11.04 in a HP TX2500 (2540br).
> >>> My webcam is recognized, but there is no /dev/video0 for it.
> >>> Can you help me solve this issue?
> >>> Thanks a lot!
> >>> Rafael Piazenski
> >>> 
> >>> Bus 002 Device 004: ID 0c45:6310 Microdia Sonix USB 2.0 Camera
> >>> 
> >>> lsusb -d 0c45:6310 -v | grep "14 Video"
> >>> can't get device qualifier: Operation not permitted
> >>> can't get debug descriptor: Operation not permitted
> >>> cannot read device status, Operation not permitted (1)
> >>> 
> >>>       bFunctionClass         14 Video
> >> 
> >> Please attach complete lsusb output.
> >> Use: sudo lsusb -vd 0c45:6310 > lsusb
> >> 
> >> Then reload uvc module with debug options:
> >> sudo rmmod uvcvideo && sudo modpprobe uvcvideo trace=0xfff
> >> 
> >> play some thing, for example:
> >> gst-launch-0.10 v4l2src num-buffers=3 ! autovideosink
> >> 
> >> this will capture only 3 frames. And after this attach dmesg output as
> >> well.
> >> 
> >> Regards,
> >> 
> >>        Alexey
> 
> In dmesg you can see this part:
> [11459.512425] uvcvideo: UVC non compliance - GET_DEF(PROBE) not
> supported. Enabling workaround.
> [11459.512829] uvcvideo: Failed to query (129) UVC probe control : -32
> (exp. 26).
> [11459.512837] uvcvideo: Failed to initialize the device (-5).
> 
> May be your can is really not uvc compliant.
> 
> I currently can't help you, if you able to compile kernel and wont to
> try some hacks then you are wellkome, but most of the time you should
> think and hack by your self.

Could you try to load the uvcvideo module with quirks=0x100 ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Tue Aug 30 23:28:31 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 30 Aug 2011 23:28:31 +0200
Subject: [Linux-uvc-devel] Interface between webcam driver and UVC
In-Reply-To: <CADmCyD2VxN8G_fbo-CuwuDiMJ9HTrxoFw94fDCk0Oji9tytz7g@mail.gmail.com>
References: <CADmCyD2VxN8G_fbo-CuwuDiMJ9HTrxoFw94fDCk0Oji9tytz7g@mail.gmail.com>
Message-ID: <201108302328.31481.laurent.pinchart@ideasonboard.com>

Hi Shekhar,

On Friday 12 August 2011 13:59:33 Chandrashekhar Lavania wrote:
> Hi,
> 
> This might be a naive question, but I was wondering which uvc driver file
> interacts with the actual webcam driver.

I'm not sure to understand your question. If you're looking for how the driver 
interacts with applications, that's implemented in uvc_v4l2.c.

> Also is there an architecture of the UVC driver for linux available which
> highlights the mentioned interaction and interaction between various layers
> of uvc driver.

Not that I know of :-) The V4L2 API specification 
(http://linuxtv.org/downloads/v4l-dvb-apis/) describes the kernel <-> 
userspace API.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Tue Aug 30 23:31:53 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 30 Aug 2011 23:31:53 +0200
Subject: [Linux-uvc-devel] Erlang capture for UVC
In-Reply-To: <CAMxVRxBs2JZPyyt-c9cRkNdQ5iN9xSTu4MU3TnMA0-EsZzDNOQ@mail.gmail.com>
References: <CAMxVRxBs2JZPyyt-c9cRkNdQ5iN9xSTu4MU3TnMA0-EsZzDNOQ@mail.gmail.com>
Message-ID: <201108302331.53752.laurent.pinchart@ideasonboard.com>

Hi Max,

On Friday 12 August 2011 18:37:31 Max Lapshin wrote:
> Hi.  I've added erlang driver for UVC:  http://github.com/erlyvideo/uvc
> 
> This driver captures video from v4l and transforms it to erlang
> messages. Mention adding huffman table to output jpeg.
> Without it jpeg decoders can't take mjpeg from camera.
> 
> Thanks again for great linux driver!

You're welcome. Thank you for contributing to Linux UVC support.

> This tool http://github.com/erlyvideo/jpeg uses turbojpeg library to
> decode mjpeg stream to yuv stream.

-- 
Regards,

Laurent Pinchart


From max.lapshin at gmail.com  Tue Aug 30 23:36:58 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 01:36:58 +0400
Subject: [Linux-uvc-devel] Erlang capture for UVC
In-Reply-To: <201108302331.53752.laurent.pinchart@ideasonboard.com>
References: <CAMxVRxBs2JZPyyt-c9cRkNdQ5iN9xSTu4MU3TnMA0-EsZzDNOQ@mail.gmail.com>
	<201108302331.53752.laurent.pinchart@ideasonboard.com>
Message-ID: <CAMxVRxBVRds8k6pAPxhkxDq3=egV-aFsrAxV1q4UudB1Z4p-=A@mail.gmail.com>

I would like to add H264 capture support and I have B990 camera, but I
can't find any exact information
where should I take patches and what should I change to capture h264.


From laurent.pinchart at ideasonboard.com  Tue Aug 30 23:47:39 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 30 Aug 2011 23:47:39 +0200
Subject: [Linux-uvc-devel] Webcam Compatibility Report
In-Reply-To: <1314127229.22002.YahooMailClassic@web111707.mail.gq1.yahoo.com>
References: <1314127229.22002.YahooMailClassic@web111707.mail.gq1.yahoo.com>
Message-ID: <201108302347.39883.laurent.pinchart@ideasonboard.com>

Hi,

On Tuesday 23 August 2011 21:20:29 T?ssio Fechine wrote:
> Hello,
> My webcam Lenovo EasyCamera (090c:3717) is compatible with UVC and works
> very well. Just reporting new hardware to your known UVC devices.

Thanks you for the report. Could you please send me the output of

lsusb -v -d 090c:3717

running as root if possible ?

Does the webcam come integrated in a laptop ? If so, what's its model name ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:03:03 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:03:03 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<4E588A1D.7050402@fisher-privat.net>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
Message-ID: <201108310003.03761.laurent.pinchart@ideasonboard.com>

Hi Max,

On Saturday 27 August 2011 11:09:13 Max Lapshin wrote:
> Robert, would You kindly tell more: how can I get H264 with UVC api?
> 
> I'm not using gstreamer, because I capture video directly into my
> program. I just brought B990 home (how huge is it!)
> and trying to get compressed stream.
> 
> should I select something like V4L2_PIX_FMT_H264 ?

You can't, at least for now. The uvcvideo driver doesn't support H.264. 
Stephan's patches might be enough to get very basic H.264 support for some 
webcams, but I'm not even sure about that.

-- 
Regards,

Laurent Pinchart


From max.lapshin at gmail.com  Wed Aug 31 00:06:20 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 02:06:20 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201108310003.03761.laurent.pinchart@ideasonboard.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<4E588A1D.7050402@fisher-privat.net>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
	<201108310003.03761.laurent.pinchart@ideasonboard.com>
Message-ID: <CAMxVRxB4jFQHGpG9CcKc6fUC-XbHH2rdyVX7uFBLOWoweBDEoA@mail.gmail.com>

On Wed, Aug 31, 2011 at 2:03 AM, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
>
> You can't, at least for now. The uvcvideo driver doesn't support H.264.
> Stephan's patches might be enough to get very basic H.264 support for some
> webcams, but I'm not even sure about that.
>

Robert showed that there is some result from B990.

However, I have a kernel programmer nearby, whom I can hire to add
proper support, according to docs on usb.org
Should I tell him to point at your repository?

These cameras are really cool for my task, so I need them.


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:07:11 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:07:11 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
	<CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>
Message-ID: <201108310007.11766.laurent.pinchart@ideasonboard.com>

Hi Max,

On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
> By the way, have you seen document
> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.zip
> ?
> There are some encoder setup options.

That's the totally broken spec I don't want to support.

-- 
Regards,

Laurent Pinchart


From max.lapshin at gmail.com  Wed Aug 31 00:12:50 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 02:12:50 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201108310007.11766.laurent.pinchart@ideasonboard.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
	<CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>
	<201108310007.11766.laurent.pinchart@ideasonboard.com>
Message-ID: <CAMxVRxDm8Lir__yfE+_HY1ix8Aj-HhHxRUDu-WN30JdckDAoMQ@mail.gmail.com>

On Wed, Aug 31, 2011 at 2:07 AM, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
> Hi Max,
>
> On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
>> By the way, have you seen document
>> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.zip
>> ?
>> There are some encoder setup options.
>
> That's the totally broken spec I don't want to support.
>

So, this document has nothing to do with the way, that Logitech B990
exchanges H264 via USB?


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:14:39 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:14:39 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxB4jFQHGpG9CcKc6fUC-XbHH2rdyVX7uFBLOWoweBDEoA@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<201108310003.03761.laurent.pinchart@ideasonboard.com>
	<CAMxVRxB4jFQHGpG9CcKc6fUC-XbHH2rdyVX7uFBLOWoweBDEoA@mail.gmail.com>
Message-ID: <201108310014.39520.laurent.pinchart@ideasonboard.com>

Hi Max,

On Wednesday 31 August 2011 00:06:20 Max Lapshin wrote:
> On Wed, Aug 31, 2011 at 2:03 AM, Laurent Pinchart wrote:
> > You can't, at least for now. The uvcvideo driver doesn't support H.264.
> > Stephan's patches might be enough to get very basic H.264 support for
> > some webcams, but I'm not even sure about that.
> 
> Robert showed that there is some result from B990.
> 
> However, I have a kernel programmer nearby, whom I can hire to add
> proper support, according to docs on usb.org
> Should I tell him to point at your repository?

As explained before, I will very likely refuse patches that implement support 
for that broken spec, unless you somehow manage to make them clean enough 
(which might be an impossible task).

Supporting H.264 cameras that don't conform to the spec will probably be 
easier.

> These cameras are really cool for my task, so I need them.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:15:17 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:15:17 +0200
Subject: [Linux-uvc-devel] Erlang capture for UVC
In-Reply-To: <CAMxVRxBVRds8k6pAPxhkxDq3=egV-aFsrAxV1q4UudB1Z4p-=A@mail.gmail.com>
References: <CAMxVRxBs2JZPyyt-c9cRkNdQ5iN9xSTu4MU3TnMA0-EsZzDNOQ@mail.gmail.com>
	<201108302331.53752.laurent.pinchart@ideasonboard.com>
	<CAMxVRxBVRds8k6pAPxhkxDq3=egV-aFsrAxV1q4UudB1Z4p-=A@mail.gmail.com>
Message-ID: <201108310015.17278.laurent.pinchart@ideasonboard.com>

On Tuesday 30 August 2011 23:36:58 Max Lapshin wrote:
> I would like to add H264 capture support and I have B990 camera, but I
> can't find any exact information
> where should I take patches and what should I change to capture h264.

There's no UVC H.264 support at the moment.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:16:31 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:16:31 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxDm8Lir__yfE+_HY1ix8Aj-HhHxRUDu-WN30JdckDAoMQ@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<201108310007.11766.laurent.pinchart@ideasonboard.com>
	<CAMxVRxDm8Lir__yfE+_HY1ix8Aj-HhHxRUDu-WN30JdckDAoMQ@mail.gmail.com>
Message-ID: <201108310016.31320.laurent.pinchart@ideasonboard.com>

Hi Max,

On Wednesday 31 August 2011 00:12:50 Max Lapshin wrote:
> On Wed, Aug 31, 2011 at 2:07 AM, Laurent Pinchart wrote:
> > On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
> >> By the way, have you seen document
> >> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.z
> >> ip ?
> >> There are some encoder setup options.
> > 
> > That's the totally broken spec I don't want to support.
> 
> So, this document has nothing to do with the way, that Logitech B990
> exchanges H264 via USB?

I don't know how H.264 support is implemented in the B990.

-- 
Regards,

Laurent Pinchart


From max.lapshin at gmail.com  Wed Aug 31 00:19:17 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 02:19:17 +0400
Subject: [Linux-uvc-devel] Erlang capture for UVC
In-Reply-To: <201108310015.17278.laurent.pinchart@ideasonboard.com>
References: <CAMxVRxBs2JZPyyt-c9cRkNdQ5iN9xSTu4MU3TnMA0-EsZzDNOQ@mail.gmail.com>
	<201108302331.53752.laurent.pinchart@ideasonboard.com>
	<CAMxVRxBVRds8k6pAPxhkxDq3=egV-aFsrAxV1q4UudB1Z4p-=A@mail.gmail.com>
	<201108310015.17278.laurent.pinchart@ideasonboard.com>
Message-ID: <CAMxVRxAKaGsfescrh4b+KyO13=vrNVh3P+xT6wzP7Hd4+tJQrg@mail.gmail.com>

On Wed, Aug 31, 2011 at 2:15 AM, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
> On Tuesday 30 August 2011 23:36:58 Max Lapshin wrote:
>> I would like to add H264 capture support and I have B990 camera, but I
>> can't find any exact information
>> where should I take patches and what should I change to capture h264.
>
> There's no UVC H.264 support at the moment.
>

Yes. Topic nearby =)


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:32:51 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:32:51 +0200
Subject: [Linux-uvc-devel] uvc header question
In-Reply-To: <4E55FD4A.9080906@fisher-privat.net>
References: <4E55FD4A.9080906@fisher-privat.net>
Message-ID: <201108310032.51561.laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Thursday 25 August 2011 09:44:10 Alexey Fisher wrote:
> Hi Laurent,
> 
> are there any reason why uvc_video_decode_start do not do precise header
> size checks? Are there many cameras with broken header size too?

How precise do you mean ? The driver currently doesn't use much of the header, 
so it just makes sure that the header size is smaller than or equal to the 
packet size, and that it's at least 2 bytes long.

> I send you patch on what i work now to catch streams with fragmented
> packets.. what do you think about it? Will you apply some thing like this?

I'm not sure about that. Webcams that would require something like that are so 
broken that I'm tempted to consider them as not UVC-compliant. They should be 
returned to vendors with a loud complaint.

Your patch might help, but the sad story is that it can't completely fix the 
streams. There's always a chance that fragmented packets that contains no 
header will start with data that looks like a header. You won't be able to 
find a buller-proof solution.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 00:39:53 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 00:39:53 +0200
Subject: [Linux-uvc-devel] Microdia Sonix id 0c45:6310
In-Reply-To: <CAPdm87rf9XROrz40phhx8NF01ZN5J43FYttSMjvhN=fQS1hi_w@mail.gmail.com>
References: <1312981882.4203.5.camel@rafael-HP-Pavilion-tx2500>
	<201108302325.22629.laurent.pinchart@ideasonboard.com>
	<CAPdm87rf9XROrz40phhx8NF01ZN5J43FYttSMjvhN=fQS1hi_w@mail.gmail.com>
Message-ID: <201108310039.53980.laurent.pinchart@ideasonboard.com>

Hi Rafael,

On Wednesday 31 August 2011 00:30:33 Rafael Piazenski wrote:
> Ok!
> I did this:
> 
> sudo modprobe -r uvcvideo
> sudo modprobe uvcvideo quirks=0x100
> 
> and I got this:
> 
> [ 4062.230154] usbcore: deregistering interface driver uvcvideo
> [ 4068.823775] Linux media interface: v0.10
> [ 4068.838320] Linux video capture interface: v2.00
> [ 4068.838327] WARNING: You are using an experimental version of the
> media stack.
> [ 4068.838328] 	As the driver is backported to an older kernel, it doesn't
> offer [ 4068.838330] 	enough quality for its usage in production.
> [ 4068.838331] 	Use it with care.
> [ 4068.838332] Latest git patches (needed if you report a bug to
> linux-media at vger.kernel.org):
> [ 4068.838333] 	9bed77ee2fb46b74782d0d9d14b92e9d07f3df6e [media]
> tuner_xc2028: Allow selection of the frequency adjustment code for
> XC3028
> [ 4068.838335] 	ffd638e0e613578fbe82d5f2d9c1e5ec503a3a2b [media] v4l:
> Move event documentation from SUBSCRIBE_EVENT to DQEVENT
> [ 4068.838337] 	31ee95ec2d3dd3b6f68d7fa0f410045652895af2 [media]
> adp1653: check error code of adp1653_init_controls
> [ 4068.844524] uvcvideo: Found UVC 1.00 device USB 2.0 Camera (0c45:6310)
> [ 4068.844529] uvcvideo: Forcing device quirks to 0x100 by module
> parameter for testing purpose.
> [ 4068.844531] uvcvideo: Please report required quirks to the
> linux-uvc-devel mailing list.
> [ 4068.846762] uvcvideo: Failed to query (129) UVC probe control : -32
> (exp. 26).
> [ 4068.846769] uvcvideo: Failed to initialize the device (-5).
> [ 4068.847508] usbcore: registered new interface driver uvcvideo
> [ 4068.847512] USB Video Class driver (1.1.1)

Your webcam looks badly broken. Can you test it under windows ?

-- 
Regards,

Laurent Pinchart


From ajay.bhargav at einfochips.com  Wed Aug 31 07:15:26 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Wed, 31 Aug 2011 10:45:26 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <loom.20110826T203852-192@post.gmane.org>
Message-ID: <1764289825.11869.1314767726241.JavaMail.root@ahm.einfochips.com>


----- "Robert Krakora" <rob.krakora at messagenetsystems.com> wrote:

> Hello,
> 
> I just mentioned in a previous post that I have the B990 streaming
> H.264 with
> Stephan's patches for v4l2 and some patches to GStreamer plugins-good
> for the
> v4l2src element.  There were two additional changes I made beyond
> Stephan's that
> I believe are necessary.  I have this running on CentOS 6.0 with
> GStreamer
> 0.10.35 and GStreamer plugins-good 0.10.30 (patched).  Logitech does
> NOT follow
> the specification that they co-authored and submitted to USB-IF where
> H.264
> content is multiplexed in the Motion JPEG container.  It is merely
> exposed as
> another interface in the one and only configuration identified by the
> H.264
> GUID.  I posted a question to Logitech about how to gain access to the
> encoder
> controls via the XUs but have heard nothing back yet.
> 
> Best Regards,
> 
> Rob Krakora
> 
Hi Rob,

Can you please provide link to your patches? I want to test it on my camera.

Regards,
Ajay Bhargav


From pierre.gronlier at gmail.com  Wed Aug 31 08:36:19 2011
From: pierre.gronlier at gmail.com (Pierre Gronlier)
Date: Wed, 31 Aug 2011 09:36:19 +0300
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201108310007.11766.laurent.pinchart@ideasonboard.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
	<CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>
	<201108310007.11766.laurent.pinchart@ideasonboard.com>
Message-ID: <CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>

Hi,

On Wed, Aug 31, 2011 at 1:07 AM, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
> Hi Max,
>
> On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
>> By the way, have you seen document
>> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.zip
>> ?
>> There are some encoder setup options.
>
> That's the totally broken spec I don't want to support.

Even if it allows Linux users to use Skype with hardware encoding camera ?

>
> --
> Regards,
>
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>



-- 
Pierre Gronlier


From bug-track at fisher-privat.net  Wed Aug 31 10:04:25 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 31 Aug 2011 10:04:25 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
	<CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>
	<201108310007.11766.laurent.pinchart@ideasonboard.com>
	<CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>
Message-ID: <4E5DEB09.1000300@fisher-privat.net>

Am 31.08.2011 08:36, schrieb Pierre Gronlier:
> Hi,
>
> On Wed, Aug 31, 2011 at 1:07 AM, Laurent Pinchart
> <laurent.pinchart at ideasonboard.com>  wrote:
>> Hi Max,
>>
>> On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
>>> By the way, have you seen document
>>> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.zip
>>> ?
>>> There are some encoder setup options.
>>
>> That's the totally broken spec I don't want to support.
>
> Even if it allows Linux users to use Skype with hardware encoding camera ?

I think the question like to do or not to do is not quiet correct here. 
If make this webcam work, will do help in some situations...  then why 
not. But it looks like Laurent is only responsible for UVC module and he 
is right - it is not belong to uvc.

But - there are some cam now, what use uvc and notuvc stuff. It will be 
interesting to use uvcvideo like a library and have some extension part. 
B990 is one of this.
On other side, if logitech will make next month new cam with other H264 
specification, it will be work for one cam only. Then automatically will 
come the question, who will maintain this code.

One more question: do h264 part work out of the box with uvc driver on 
windows?

Regards,
	Alexey


From max.lapshin at gmail.com  Wed Aug 31 10:11:41 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 12:11:41 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <4E5DEB09.1000300@fisher-privat.net>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<CAMxVRxATaM1RiK9F-XFztftxpt4mwjTL6pf4OHEtJavWV=qRJg@mail.gmail.com>
	<CAMxVRxCHw2jZ-A60v=CZW3J-9zXfq5WiAVim7E5SK5T2ZiU1cg@mail.gmail.com>
	<201108310007.11766.laurent.pinchart@ideasonboard.com>
	<CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>
	<4E5DEB09.1000300@fisher-privat.net>
Message-ID: <CAMxVRxDFYjYP1f_axm-ot5Ur3Uy_pcRNqxv1TC7WdbbhOmpftQ@mail.gmail.com>

On Wed, Aug 31, 2011 at 12:04 PM, Alexey Fisher
<bug-track at fisher-privat.net> wrote:

> But - there are some cam now, what use uvc and notuvc stuff. It will be
> interesting to use uvcvideo like a library and have some extension part.
> B990 is one of this.
> On other side, if logitech will make next month new cam with other H264
> specification, it will be work for one cam only. Then automatically will
> come the question, who will maintain this code.
>
> One more question: do h264 part work out of the box with uvc driver on
> windows?


Currently I see other problem: I can't find patchset in mailing list.
So it is hard to discuss if B990 is UVC or not UVC.


From laurent.pinchart at ideasonboard.com  Wed Aug 31 10:19:20 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 10:19:20 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<201108310007.11766.laurent.pinchart@ideasonboard.com>
	<CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>
Message-ID: <201108311019.21034.laurent.pinchart@ideasonboard.com>

Hi Pierre,

On Wednesday 31 August 2011 08:36:19 Pierre Gronlier wrote:
> On Wed, Aug 31, 2011 at 1:07 AM, Laurent Pinchart wrote:
> > On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
> >> By the way, have you seen document
> >> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.z
> >> ip ?
> >> There are some encoder setup options.
> > 
> > That's the totally broken spec I don't want to support.
> 
> Even if it allows Linux users to use Skype with hardware encoding camera ?

Yes.

I've notified Logitech multiple times that their spec was totally broken 
before they got it standardized. I pointed out the obvious design mistakes, 
proposed clean solutions and offered free help. They denied all problems and 
stop answering.

That spec has been designed solely to support Skype with Logitech webcams on 
Windows. Those three companies (well, two now) decided to game the system and 
get a completely broken specification standardized. This somehow reminds me of 
the OOXML fiasco.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 10:22:24 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 10:22:24 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <4E5DEB09.1000300@fisher-privat.net>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<CAOs7PLNGE5AaA5fMkJve0a-scZF8ECH6sp2m-ecNFJ4=mwq_PA@mail.gmail.com>
	<4E5DEB09.1000300@fisher-privat.net>
Message-ID: <201108311022.24794.laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Wednesday 31 August 2011 10:04:25 Alexey Fisher wrote:
> Am 31.08.2011 08:36, schrieb Pierre Gronlier:
> > On Wed, Aug 31, 2011 at 1:07 AM, Laurent Pinchart wrote:
> >> On Saturday 27 August 2011 11:50:55 Max Lapshin wrote:
> >>> By the way, have you seen document
> >>> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1_052811.
> >>> zip ?
> >>> There are some encoder setup options.
> >> 
> >> That's the totally broken spec I don't want to support.
> > 
> > Even if it allows Linux users to use Skype with hardware encoding camera
> > ?
> 
> I think the question like to do or not to do is not quiet correct here.
> If make this webcam work, will do help in some situations...  then why
> not. But it looks like Laurent is only responsible for UVC module and he
> is right - it is not belong to uvc.
> 
> But - there are some cam now, what use uvc and notuvc stuff. It will be
> interesting to use uvcvideo like a library and have some extension part.
> B990 is one of this.
> On other side, if logitech will make next month new cam with other H264
> specification, it will be work for one cam only. Then automatically will
> come the question, who will maintain this code.
> 
> One more question: do h264 part work out of the box with uvc driver on
> windows?

UVC devices that comply to the new UVC H.264 spec should work out of the box 
(provided the Windows UVC driver is new enough), but *only* with applications 
that implement support for UVC H.264. Applications that use the generic 
DirectShow API and try to get H.264 video from the device will fail. The only 
application that I know to work is Skype, as they co-designed the spec.

UVC devices that implement another H.264 interface will require a custom 
driver and/or custom applications.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 10:23:23 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 10:23:23 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpathOv9DMvCHJVaOYKWgUx-SyvJ3mf6OUr_BwYRL8Dv_-Fg@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<201108310014.39520.laurent.pinchart@ideasonboard.com>
	<CA+DpathOv9DMvCHJVaOYKWgUx-SyvJ3mf6OUr_BwYRL8Dv_-Fg@mail.gmail.com>
Message-ID: <201108311023.24221.laurent.pinchart@ideasonboard.com>

Hi Robert,

On Wednesday 31 August 2011 03:59:18 Robert Krakora wrote:
> Hi Laurent,
> 
> The Logitech B990 does not adhere to the USB-IF spec to which you have
> referred.  Multiplexing H.264 in a Motion JPEG container is a bit odd.
> Stephan's patches from earlier this year and some slight modifications to
> the GStreamer v4l2src element were sufficient.  I can see why you would
> reject patches for any cameras that adhere to the USB-IF spec, but I don't
> know why you would not consider accepting Stephan's patches.  They seem
> pretty benign.
> 
> The FaceVsion E1 exposes H.264 as a MPEG2 transport stream (another one of
> Stephan's patches), I have this working as well although there seems to be
> a audio/video synchronization problem.

That's something I plan to (at least try to) support. FaceVsion unfortunately 
ignored all my e-mails when I asked them for a camera sample.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 10:34:06 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 10:34:06 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxDFYjYP1f_axm-ot5Ur3Uy_pcRNqxv1TC7WdbbhOmpftQ@mail.gmail.com>
References: <804463466.358092.1308200212914.JavaMail.root@ahm.einfochips.com>
	<4E5DEB09.1000300@fisher-privat.net>
	<CAMxVRxDFYjYP1f_axm-ot5Ur3Uy_pcRNqxv1TC7WdbbhOmpftQ@mail.gmail.com>
Message-ID: <201108311034.06456.laurent.pinchart@ideasonboard.com>

Hi,

On Wednesday 31 August 2011 10:11:41 Max Lapshin wrote:
> On Wed, Aug 31, 2011 at 12:04 PM, Alexey Fisher wrote:
> > But - there are some cam now, what use uvc and notuvc stuff. It will be
> > interesting to use uvcvideo like a library and have some extension part.
> > B990 is one of this.
> > On other side, if logitech will make next month new cam with other H264
> > specification, it will be work for one cam only. Then automatically will
> > come the question, who will maintain this code.
> > 
> > One more question: do h264 part work out of the box with uvc driver on
> > windows?
> 
> Currently I see other problem: I can't find patchset in mailing list.
> So it is hard to discuss if B990 is UVC or not UVC.

Could someone please post the lsusb -v output for thr B990 ?

-- 
Regards,

Laurent Pinchart


From ajay.bhargav at einfochips.com  Wed Aug 31 10:27:56 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Wed, 31 Aug 2011 13:57:56 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201108311023.24221.laurent.pinchart@ideasonboard.com>
Message-ID: <2049139052.13896.1314779276260.JavaMail.root@ahm.einfochips.com>


----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:

> Hi Robert,
> 
> On Wednesday 31 August 2011 03:59:18 Robert Krakora wrote:
> > Hi Laurent,
> > 
> > The Logitech B990 does not adhere to the USB-IF spec to which you
> have
> > referred.  Multiplexing H.264 in a Motion JPEG container is a bit
> odd.
> > Stephan's patches from earlier this year and some slight
> modifications to
> > the GStreamer v4l2src element were sufficient.  I can see why you
> would
> > reject patches for any cameras that adhere to the USB-IF spec, but I
> don't
> > know why you would not consider accepting Stephan's patches.  They
> seem
> > pretty benign.
> > 
> > The FaceVsion E1 exposes H.264 as a MPEG2 transport stream (another
> one of
> > Stephan's patches), I have this working as well although there seems
> to be
> > a audio/video synchronization problem.
> 
> That's something I plan to (at least try to) support. FaceVsion
> unfortunately 
> ignored all my e-mails when I asked them for a camera sample.
> 
> -- 
> Regards,
> 
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 

It would be great if you can add that support.. Even I have a camera with MPEG2TS. Can you point me to Stephan's patches I want can test my cam.

Regards,
Ajay Bhargav


From max.lapshin at gmail.com  Wed Aug 31 13:44:29 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 15:44:29 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpathN8Dv7cZdFh=fUceRdhKEgmdXoTg55TGiR9_Qz38sKbg@mail.gmail.com>
References: <201108311023.24221.laurent.pinchart@ideasonboard.com>
	<2049139052.13896.1314779276260.JavaMail.root@ahm.einfochips.com>
	<CA+DpathN8Dv7cZdFh=fUceRdhKEgmdXoTg55TGiR9_Qz38sKbg@mail.gmail.com>
Message-ID: <CAMxVRxAsd5oObC386-HmZMGg_OJZP5BoNOM3xMRh6UT7Usd_OA@mail.gmail.com>

On Wed, Aug 31, 2011 at 3:29 PM, Robert Krakora
<rob.krakora at messagenetsystems.com> wrote:
> Here are the patches I used for v4l2.? I have an additional patch for the
> v4l2src element for GStreamer that I am going to create and e-mail as well.
> Many thanks to Stephan for his work on these patches.
>
> H264 (Logitech):
> https://patchwork.kernel.org/patch/515631/
>
> MPEG2 TS (FaceVsion):
> https://patchwork.kernel.org/patch/515621/

I can hardly understand, what is the problem in 4-lines patch, that
looks like other code.


From ajay.bhargav at einfochips.com  Wed Aug 31 13:49:59 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Wed, 31 Aug 2011 17:19:59 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpathN8Dv7cZdFh=fUceRdhKEgmdXoTg55TGiR9_Qz38sKbg@mail.gmail.com>
Message-ID: <1022793470.15110.1314791399913.JavaMail.root@ahm.einfochips.com>


----- "Robert Krakora" <rob.krakora at messagenetsystems.com> wrote: 


Here are the patches I used for v4l2. I have an additional patch for the v4l2src element for GStreamer that I am going to create and e-mail as well. Many thanks to Stephan for his work on these patches. 

H264 (Logitech): 
https://patchwork.kernel.org/patch/515631/ 

MPEG2 TS (FaceVsion): 
https://patchwork.kernel.org/patch/515621/ 


On Wed, Aug 31, 2011 at 4:27 AM, Ajay Bhargav < ajay.bhargav at einfochips.com > wrote: 






----- "Laurent Pinchart" < laurent.pinchart at ideasonboard.com > wrote: 

> Hi Robert, 
> 
> On Wednesday 31 August 2011 03:59:18 Robert Krakora wrote: 
> > Hi Laurent, 
> > 
> > The Logitech B990 does not adhere to the USB-IF spec to which you 
> have 
> > referred. Multiplexing H.264 in a Motion JPEG container is a bit 
> odd. 
> > Stephan's patches from earlier this year and some slight 
> modifications to 
> > the GStreamer v4l2src element were sufficient. I can see why you 
> would 
> > reject patches for any cameras that adhere to the USB-IF spec, but I 
> don't 
> > know why you would not consider accepting Stephan's patches. They 
> seem 
> > pretty benign. 
> > 
> > The FaceVsion E1 exposes H.264 as a MPEG2 transport stream (another 
> one of 
> > Stephan's patches), I have this working as well although there seems 
> to be 
> > a audio/video synchronization problem. 
> 
> That's something I plan to (at least try to) support. FaceVsion 
> unfortunately 
> ignored all my e-mails when I asked them for a camera sample. 
> 
> -- 
> Regards, 
> 
> Laurent Pinchart 

> _______________________________________________ 
> Linux-uvc-devel mailing list 
> Linux-uvc-devel at lists.berlios.de 
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel 
> 

It would be great if you can add that support.. Even I have a camera with MPEG2TS. Can you point me to Stephan's patches I want can test my cam. 

Regards, 
Ajay Bhargav 



-- 
Rob Krakora 
MessageNet Systems 
101 East Carmel Dr. Suite 105 
Carmel, IN 46032 
(317)566-1677 Ext 212 
(317)663-0808 Fax 

-- 
This message has been scanned for viruses and 
dangerous content by Clean Mail Gateway , and is 
believed to be clean. Hi rob, 

Thank you so much for links... I already have done the "MPEG2 TS" patching. I am able to get my cam registered as a video device now. But how do i check it's o/p? I have a uvcgrab application which takes one frame and store it, but it does not work. I added my UVC driver with full tracing and i see that frame rate is way too high.. which is not possible. Please help me with testing my cam. 

Thanks & Regards, 
Ajay Bhargav 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110831/57bb9020/attachment.html>

From ajay.bhargav at einfochips.com  Wed Aug 31 14:05:41 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Wed, 31 Aug 2011 17:35:41 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpathGm=wgOGjGvGA4chFjJ6gGofo0N=qDYeTEfgeBxzqYkA@mail.gmail.com>
Message-ID: <754450168.15206.1314792341655.JavaMail.root@ahm.einfochips.com>


----- "Robert Krakora" <rob.krakora at messagenetsystems.com> wrote: 


Here is one more patch that I found necessary to get MPEG2 TS to work...there is also a slight change to the same file where it appears there is a bug that I attempted and seemed to have addressed. I will discuss the perceived "bug" with Laurent in a separate thread. 


On Wed, Aug 31, 2011 at 7:29 AM, Robert Krakora < rob.krakora at messagenetsystems.com > wrote: 


Here are the patches I used for v4l2. I have an additional patch for the v4l2src element for GStreamer that I am going to create and e-mail as well. Many thanks to Stephan for his work on these patches. 

H264 (Logitech): 
https://patchwork.kernel.org/patch/515631/ 

MPEG2 TS (FaceVsion): 
https://patchwork.kernel.org/patch/515621/ 





On Wed, Aug 31, 2011 at 4:27 AM, Ajay Bhargav < ajay.bhargav at einfochips.com > wrote: 






----- "Laurent Pinchart" < laurent.pinchart at ideasonboard.com > wrote: 

> Hi Robert, 
> 
> On Wednesday 31 August 2011 03:59:18 Robert Krakora wrote: 
> > Hi Laurent, 
> > 
> > The Logitech B990 does not adhere to the USB-IF spec to which you 
> have 
> > referred. Multiplexing H.264 in a Motion JPEG container is a bit 
> odd. 
> > Stephan's patches from earlier this year and some slight 
> modifications to 
> > the GStreamer v4l2src element were sufficient. I can see why you 
> would 
> > reject patches for any cameras that adhere to the USB-IF spec, but I 
> don't 
> > know why you would not consider accepting Stephan's patches. They 
> seem 
> > pretty benign. 
> > 
> > The FaceVsion E1 exposes H.264 as a MPEG2 transport stream (another 
> one of 
> > Stephan's patches), I have this working as well although there seems 
> to be 
> > a audio/video synchronization problem. 
> 
> That's something I plan to (at least try to) support. FaceVsion 
> unfortunately 
> ignored all my e-mails when I asked them for a camera sample. 
> 
> -- 
> Regards, 
> 
> Laurent Pinchart 

> _______________________________________________ 
> Linux-uvc-devel mailing list 
> Linux-uvc-devel at lists.berlios.de 
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel 
> 

It would be great if you can add that support.. Even I have a camera with MPEG2TS. Can you point me to Stephan's patches I want can test my cam. 

Regards, 
Ajay Bhargav 






-- 
Rob Krakora 
MessageNet Systems 
101 East Carmel Dr. Suite 105 
Carmel, IN 46032 
(317)566-1677 Ext 212 
(317)663-0808 Fax 



-- 
Rob Krakora 
MessageNet Systems 
101 East Carmel Dr. Suite 105 
Carmel, IN 46032 
(317)566-1677 Ext 212 
(317)663-0808 Fax 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110831/5f08b271/attachment.html>

From ajay.bhargav at einfochips.com  Wed Aug 31 14:08:28 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Wed, 31 Aug 2011 17:38:28 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpathGm=wgOGjGvGA4chFjJ6gGofo0N=qDYeTEfgeBxzqYkA@mail.gmail.com>
Message-ID: <1989157087.15217.1314792508714.JavaMail.root@ahm.einfochips.com>


----- "Robert Krakora" <rob.krakora at messagenetsystems.com> wrote: 


Here is one more patch that I found necessary to get MPEG2 TS to work...there is also a slight change to the same file where it appears there is a bug that I attempted and seemed to have addressed. I will discuss the perceived "bug" with Laurent in a separate thread. 


-- 
Rob Krakora 
MessageNet Systems 
101 East Carmel Dr. Suite 105 
Carmel, IN 46032 
(317)566-1677 Ext 212 
(317)663-0808 Fax 

Hi Rob, 

Thank you so much.. can you please tell me if a normal UVC grab application can be used to test webcam? 

Regards, 
Ajay Bhargav 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110831/5494ad02/attachment.html>

From laurent.pinchart at ideasonboard.com  Wed Aug 31 14:32:24 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 14:32:24 +0200
Subject: [Linux-uvc-devel] [PATCH RFC] uvcvideo: Add a mapping for H.264
	payloads
In-Reply-To: <1296243538.17673.23.camel@svmlwks101>
References: <1296243538.17673.23.camel@svmlwks101>
Message-ID: <201108311432.24323.laurent.pinchart@ideasonboard.com>

Hi Stephan,

On Friday 28 January 2011 20:38:58 Stephan Lachowsky wrote:
> Associate the H.264 GUID with an H.264 pixel format so that frame
> and stream based format descriptors with this GUID are recognized
> by the UVC video driver.

Can I get your Signed-off-by line for this patch ?

> ---
>  drivers/media/video/uvc/uvc_driver.c |    5 +++++
>  drivers/media/video/uvc/uvcvideo.h   |    3 +++
>  include/linux/videodev2.h            |    1 +
>  3 files changed, 9 insertions(+), 0 deletions(-)
> 
> diff --git a/drivers/media/video/uvc/uvc_driver.c
> b/drivers/media/video/uvc/uvc_driver.c index 6bcb9e1..a5a86ce 100644
> --- a/drivers/media/video/uvc/uvc_driver.c
> +++ b/drivers/media/video/uvc/uvc_driver.c
> @@ -108,6 +108,11 @@ static struct uvc_format_desc uvc_fmts[] = {
>  		.guid		= UVC_GUID_FORMAT_MPEG,
>  		.fcc		= V4L2_PIX_FMT_MPEG,
>  	},
> +	{
> +		.name		= "H.264",
> +		.guid		= UVC_GUID_FORMAT_H264,
> +		.fcc		= V4L2_PIX_FMT_H264,
> +	},
>  };
> 
>  /*
> ------------------------------------------------------------------------
> diff --git a/drivers/media/video/uvc/uvcvideo.h
> b/drivers/media/video/uvc/uvcvideo.h index e522f99..4f65ac6 100644
> --- a/drivers/media/video/uvc/uvcvideo.h
> +++ b/drivers/media/video/uvc/uvcvideo.h
> @@ -155,6 +155,9 @@ struct uvc_xu_control {
>  #define UVC_GUID_FORMAT_MPEG \
>  	{ 'M',  'P',  'E',  'G', 0x00, 0x00, 0x10, 0x00, \
>  	 0x80, 0x00, 0x00, 0xaa, 0x00, 0x38, 0x9b, 0x71}
> +#define UVC_GUID_FORMAT_H264 \
> +	{ 'H',  '2',  '6',  '4', 0x00, 0x00, 0x10, 0x00, \
> +	 0x80, 0x00, 0x00, 0xaa, 0x00, 0x38, 0x9b, 0x71}
> 
>  /*
> ------------------------------------------------------------------------ *
> Driver specific constants.
> diff --git a/include/linux/videodev2.h b/include/linux/videodev2.h
> index 5f6f470..d3b5877 100644
> --- a/include/linux/videodev2.h
> +++ b/include/linux/videodev2.h
> @@ -341,6 +341,7 @@ struct v4l2_pix_format {
>  #define V4L2_PIX_FMT_JPEG     v4l2_fourcc('J', 'P', 'E', 'G') /* JFIF JPEG
>     */ #define V4L2_PIX_FMT_DV       v4l2_fourcc('d', 'v', 's', 'd') /*
> 1394          */ #define V4L2_PIX_FMT_MPEG     v4l2_fourcc('M', 'P', 'E',
> 'G') /* MPEG-1/2/4    */ +#define V4L2_PIX_FMT_H264     v4l2_fourcc('H',
> '2', '6', '4') /* H.264 Annex-B NAL Units */
> 
>  /*  Vendor-specific formats   */
>  #define V4L2_PIX_FMT_CPIA1    v4l2_fourcc('C', 'P', 'I', 'A') /* cpia1 YUV
> */

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Aug 31 14:35:13 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 31 Aug 2011 14:35:13 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAMxVRxAsd5oObC386-HmZMGg_OJZP5BoNOM3xMRh6UT7Usd_OA@mail.gmail.com>
References: <201108311023.24221.laurent.pinchart@ideasonboard.com>
	<CA+DpathN8Dv7cZdFh=fUceRdhKEgmdXoTg55TGiR9_Qz38sKbg@mail.gmail.com>
	<CAMxVRxAsd5oObC386-HmZMGg_OJZP5BoNOM3xMRh6UT7Usd_OA@mail.gmail.com>
Message-ID: <201108311435.13891.laurent.pinchart@ideasonboard.com>

Hi Max,

On Wednesday 31 August 2011 13:44:29 Max Lapshin wrote:
> On Wed, Aug 31, 2011 at 3:29 PM, Robert Krakora wrote:
> > Here are the patches I used for v4l2.  I have an additional patch for the
> > v4l2src element for GStreamer that I am going to create and e-mail as
> > well. Many thanks to Stephan for his work on these patches.
> > 
> > H264 (Logitech):
> > https://patchwork.kernel.org/patch/515631/
> > 
> > MPEG2 TS (FaceVsion):
> > https://patchwork.kernel.org/patch/515621/
> 
> I can hardly understand, what is the problem in 4-lines patch, that
> looks like other code.

The first patch was rejected back then because H.264 support in the V4L2 API 
had to be implemented differently. Recent discussions about H.264 and V4L2 
resulted in a different position, so I can now apply the patch. I've asked 
Stephan for his Signed-off-by line and I will push it to v3.2.

I still need to review the second patch properly, that's on my TODO list.

-- 
Regards,

Laurent Pinchart


From max.lapshin at gmail.com  Wed Aug 31 15:08:56 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 17:08:56 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201108311435.13891.laurent.pinchart@ideasonboard.com>
References: <201108311023.24221.laurent.pinchart@ideasonboard.com>
	<CA+DpathN8Dv7cZdFh=fUceRdhKEgmdXoTg55TGiR9_Qz38sKbg@mail.gmail.com>
	<CAMxVRxAsd5oObC386-HmZMGg_OJZP5BoNOM3xMRh6UT7Usd_OA@mail.gmail.com>
	<201108311435.13891.laurent.pinchart@ideasonboard.com>
Message-ID: <CAMxVRxBMM4sdQPVqOX92FijyweYb++wEd-8M=3PD_h1KJm6q4A@mail.gmail.com>

On Wed, Aug 31, 2011 at 4:35 PM, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:

> The first patch was rejected back then because H.264 support in the V4L2 API
> had to be implemented differently. Recent discussions about H.264 and V4L2
> resulted in a different position, so I can now apply the patch. I've asked
> Stephan for his Signed-off-by line and I will push it to v3.2.
>

Glad to here it.

Of course it is good when you can make one interface for different
entities, but it is really hard to unify DVB-S capture and UVC.
One is MPEG-TS, other is raw stream.


From ajay.bhargav at einfochips.com  Wed Aug 31 15:12:13 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Wed, 31 Aug 2011 18:42:13 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpatjZ0u9dbktKAqFh7hAZm_n3qRmEWjUNmR-ZWPF+PhNsCw@mail.gmail.com>
Message-ID: <871992206.15615.1314796333706.JavaMail.root@ahm.einfochips.com>


----- "Robert Krakora" <rob.krakora at messagenetsystems.com> wrote: 


Hi All, 

So, to test H.264, I used GStreamer 0.10.35 (+plugins-base 0.10.35) and plugins-good 0.10.30 with the attached patch applied. I also attached the previous patch that I sent you for uvc_video.c for v4l2. Also, I have the Fluendo Codec Bundle installed ( www.fluendo.com ). GStreamer is available at www.gstreamer.net . 

To test H.264 from the B990 I used this command line: 

gst-launch -vvv v4l2src device=/dev/video0 ! video/x-h264, width=1280, height=720, framerate=30/1 ! fluh264dec ! xvimagesink sync=false 

To test MPEG2 TS from the FaceVsion Touchcam E1 I used this command line: 

gst-launch -vvv v4l2src device=/dev/video0 ! video/mpegts ! mpegtsdemux ! fluh264dec ! xvimagesink sync=false 

Best Regards, 

-- 
Rob Krakora 
MessageNet Systems 
101 East Carmel Dr. Suite 105 
Carmel, IN 46032 
(317)566-1677 Ext 212 
(317)663-0808 Fax 

Hi Rob, 

Thank you so so much I will test and let you know. 

Regards, 
Ajay Bhargav 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110831/e2efdc9e/attachment.html>

From max.lapshin at gmail.com  Wed Aug 31 15:24:19 2011
From: max.lapshin at gmail.com (Max Lapshin)
Date: Wed, 31 Aug 2011 17:24:19 +0400
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <871992206.15615.1314796333706.JavaMail.root@ahm.einfochips.com>
References: <CA+DpatjZ0u9dbktKAqFh7hAZm_n3qRmEWjUNmR-ZWPF+PhNsCw@mail.gmail.com>
	<871992206.15615.1314796333706.JavaMail.root@ahm.einfochips.com>
Message-ID: <CAMxVRxCgBTidUZmSFN3vinVdB-Ff61gBPHrJNaLpDBSV5A6mbA@mail.gmail.com>

Yes, Robert, thanks a lot.


From bug-track at fisher-privat.net  Wed Aug 31 16:45:07 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 31 Aug 2011 16:45:07 +0200
Subject: [Linux-uvc-devel] B990 H.264 Sample
In-Reply-To: <339519601.1314725126111.JavaMail.ysi@sjcprdngw02.prod.yousendit.com>
References: <339519601.1314725126111.JavaMail.ysi@sjcprdngw02.prod.yousendit.com>
Message-ID: <4E5E48F3.3040101@fisher-privat.net>

Am 30.08.2011 19:25, schrieb rob.krakora at messagenetsystems.com:
			
> Subject:	B990 H.264 Sample
> Message:	Here is a sample H.264 capture from the B990 with none of the
> capture controls altered and, of course, none of the encoding parameters
> alters as I have not yet figured out how to alter them.
>

I got your sample, currently i can decode only one frame if i use 
ffmpeg, do fluendo can play this file?

Regards,
	Alexey


