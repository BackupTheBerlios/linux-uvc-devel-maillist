From grignon.matthieu at gmail.com  Fri Jul  1 09:37:23 2011
From: grignon.matthieu at gmail.com (Grignon Matthieu)
Date: Fri, 01 Jul 2011 03:37:23 -0400
Subject: [Linux-uvc-devel] Horizontal mirror uvc cams
In-Reply-To: <4A39F219.10301@redhat.com>
References: <4A39F219.10301@redhat.com>
Message-ID: <4E0D7933.5080201@gmail.com>

Hi,
First, thank you for your job!
I write you this mail because my webcam have a trouble, the image is al 
reverse at the horizontal (should have a horizontal mirror in the 
configuration to fix it).
I send you the lusb.log and dmi.log in attach.
I'm running with a packardbell easynote NM98-JU, the cam is integrate, 
and ubuntu natty (it was also the same with ubuntu 10.10).
Thanks for everything.
Sorry for my very approximate english.
/(The normal salutation here with a friendly formulation, i have no idea 
how to write that)/ ;-)

Matthieu

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110701/bbe364cf/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmi.log
Type: text/x-log
Size: 8405 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110701/bbe364cf/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lsusb.log
Type: text/x-log
Size: 424 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110701/bbe364cf/attachment-0001.bin>

From kirr at mns.spb.ru  Fri Jul  1 11:27:03 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Fri, 1 Jul 2011 13:27:03 +0400
Subject: [Linux-uvc-devel] [PATCH v2 0/2] USB: EHCI: Allow users to
	override 80% max	periodic bandwidth
In-Reply-To: <20110630180101.GB7979@xanatos>
References: <cover.1308933456.git.kirr@mns.spb.ru>
	<20110630180101.GB7979@xanatos>
Message-ID: <20110701092703.GA17010@tugrik.mns.mnsspb.ru>

On Thu, Jun 30, 2011 at 11:01:01AM -0700, Sarah Sharp wrote:
> On Fri, Jun 24, 2011 at 08:48:06PM +0400, Kirill Smelkov wrote:
> > 
> > Changes since v1:
> > 
> > 
> >  - dropped RFC status as "this seems like the sort of feature somebody might
> >    reasonably want to use -- if they know exactly what they're doing";
> > 
> >  - new preparatory patch (1/2) which moves already-in-there sysfs code into
> >    ehci-sysfs.c;
> > 
> >  - moved uframe_periodic_max parameter from module option to sysfs attribute,
> >    so that it can be set per controller and at runtime, added validity checks;
> > 
> >  - clarified a bit bandwith analysis for 96% max periodic setup as noticed by
> >    Alan Stern;
> > 
> >  - clarified patch description saying that set in stone 80% max periodic is
> >    specified by USB 2.0;
> 
> Have you tested this patch by maxing out this bandwidth on various
> types of host controllers?  It's entirely possible that you'll run into
> vendor-specific bugs if you try to pack the schedule with isochronous
> transfers.  I don't think any hardware designer would seriously test or
> validate their hardware with a schedule that is basically a violation of
> the USB bus spec (more than 80% for periodic transfers).

I've only tested it to work on my HP Mini 5103 with N10 chipset:

    kirr at mini:~$ lspci 
    00:00.0 Host bridge: Intel Corporation N10 Family DMI Bridge
    00:02.0 VGA compatible controller: Intel Corporation N10 Family Integrated Graphics Controller
    00:02.1 Display controller: Intel Corporation N10 Family Integrated Graphics Controller
    00:1b.0 Audio device: Intel Corporation N10/ICH 7 Family High Definition Audio Controller (rev 02)
    00:1c.0 PCI bridge: Intel Corporation N10/ICH 7 Family PCI Express Port 1 (rev 02)
    00:1c.3 PCI bridge: Intel Corporation N10/ICH 7 Family PCI Express Port 4 (rev 02)
    00:1d.0 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #1 (rev 02)
    00:1d.1 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #2 (rev 02)
    00:1d.2 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #3 (rev 02)
    00:1d.3 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #4 (rev 02)
    00:1d.7 USB Controller: Intel Corporation N10/ICH 7 Family USB2 EHCI Controller (rev 02)
    00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev e2)
    00:1f.0 ISA bridge: Intel Corporation NM10 Family LPC Controller (rev 02)
    00:1f.2 SATA controller: Intel Corporation N10/ICH7 Family SATA AHCI Controller (rev 02)
    01:00.0 Network controller: Broadcom Corporation BCM4313 802.11b/g/n Wireless LAN Controller (rev 01)
    02:00.0 Ethernet controller: Marvell Technology Group Ltd. 88E8059 PCI-E Gigabit Ethernet Controller (rev 11)

The system works stable with 110us/uframe (~88%) isoc bandwith allocated for
integrated UVC webcam and external EM28XX based capture board.


> But if Alan is fine with giving users a way to shoot themselves in the
> foot, and it's disabled by default, then I don't particularly mind this
> patch.

Yes, it is disabled by default, I mean max periodic bandwidth is set to
100us/uframe by default exactly as it was before the patch. So only
those of us who need the extreme settings are taking the risk - normal
users who do not alter uframe_periodic_max attribute should not see any
change at all.


Thanks for commenting. I'll extend my testing information and notes on
do-not-do-harm bahaviour in updated patch.


Kirill


From kirr at mns.spb.ru  Fri Jul  1 13:47:09 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Fri,  1 Jul 2011 15:47:09 +0400
Subject: [Linux-uvc-devel] [PATCH v3 0/2] USB: EHCI: Allow users to override
	80% max periodic bandwidth
Message-ID: <cover.1309520144.git.kirr@mns.spb.ru>

There are cases, when 80% max isochronous bandwidth is too limiting.

Let's allow knowledgeable users to override that 80% max limit explicitly for
extreme cases, like 2 high bandwidth isochronously streaming devices on the
same High Speed USB bus in order to make them work simultaneously.

See full details in PATCH 2/2.


Changes since v2:

 - changed the copyright in ehci-sysfs from David Brownell to Alan Stern;

 - added ACK to PATCH 1/2 from Alan Stern;

 - inspired by concerns raised by Sarah Sharp, added more details about testing
   done on N10 chipset, system stability, and that no-harm-is-done for those,
   who do not change uframe_periodic_max from default 100us;

 - when decreasing uframe_periodic_max, compare with the maximum number of
   microseconds already allocated for any uframe, instead of stopping as soon
   as it finds something above the new limit.


Changes since v1:

 - dropped RFC status as "this seems like the sort of feature somebody might
   reasonably want to use -- if they know exactly what they're doing";

 - new preparatory patch (1/2) which moves already-in-there sysfs code into
   ehci-sysfs.c;

 - moved uframe_periodic_max parameter from module option to sysfs attribute,
   so that it can be set per controller and at runtime, added validity checks;

 - clarified a bit bandwidth analysis for 96% max periodic setup as noticed by
   Alan Stern;

 - clarified patch description saying that set in stone 80% max periodic is
   specified by USB 2.0;


Kirill Smelkov (2):
  USB: EHCI: Move sysfs related bits into ehci-sysfs.c
  USB: EHCI: Allow users to override 80% max periodic bandwidth

 drivers/usb/host/ehci-hcd.c   |   11 ++-
 drivers/usb/host/ehci-hub.c   |   75 ----------------
 drivers/usb/host/ehci-sched.c |   17 ++--
 drivers/usb/host/ehci-sysfs.c |  190 +++++++++++++++++++++++++++++++++++++++++
 drivers/usb/host/ehci.h       |    2 +
 5 files changed, 208 insertions(+), 87 deletions(-)
 create mode 100644 drivers/usb/host/ehci-sysfs.c

-- 
1.7.6.rc3



From kirr at mns.spb.ru  Fri Jul  1 13:47:11 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Fri,  1 Jul 2011 15:47:11 +0400
Subject: [Linux-uvc-devel] [PATCH v3 2/2] USB: EHCI: Allow users to override
	80% max periodic bandwidth
In-Reply-To: <cover.1309520144.git.kirr@mns.spb.ru>
References: <cover.1309520144.git.kirr@mns.spb.ru>
Message-ID: <69ea2dd940481508f190419c53c780b626460b22.1309520144.git.kirr@mns.spb.ru>

There are cases, when 80% max isochronous bandwidth is too limiting.

For example I have two USB video capture cards which stream uncompressed
video, and to stream full NTSC + PAL videos we'd need

    NTSC 640x480 YUV422 @30fps      ~17.6 MB/s
    PAL  720x576 YUV422 @25fps      ~19.7 MB/s

isoc bandwidth.

Now, due to limited alt settings in capture devices NTSC one ends up
streaming with max_pkt_size=2688  and  PAL with max_pkt_size=2892, both
with interval=1. In terms of microframe time allocation this gives

    NTSC    ~53us
    PAL     ~57us

and together

    ~110us  >  100us == 80% of 125us uframe time.

So those two devices can't work together simultaneously because the'd
over allocate isochronous bandwidth.

80% seemed a bit arbitrary to me, and I've tried to raise it to 90% and
both devices started to work together, so I though sometimes it would be
a good idea for users to override hardcoded default of max 80% isoc
bandwidth.

After all, isn't it a user who should decide how to load the bus? If I
can live with 10% or even 5% bulk bandwidth that should be ok. I'm a USB
newcomer, but that 80% set in stone by USB 2.0 specification seems to be
chosen pretty arbitrary to me, just to serve as a reasonable default.

NOTE 1
~~~~~~

for two streams with max_pkt_size=3072 (worst case) both time
allocation would be 60us+60us=120us which is 96% periodic bandwidth
leaving 4% for bulk and control.  Alan Stern suggested that bulk then
would be problematic (less than 300*8 bittimes left per microframe), but
I think that is still enough for control traffic.

NOTE 2
~~~~~~

Sarah Sharp expressed concern that maxing out periodic bandwidth
could lead to vendor-specific hardware bugs on host controllers, because

> It's entirely possible that you'll run into
> vendor-specific bugs if you try to pack the schedule with isochronous
> transfers.  I don't think any hardware designer would seriously test or
> validate their hardware with a schedule that is basically a violation of
> the USB bus spec (more than 80% for periodic transfers).

So far I've only tested this patch on my HP Mini 5103 with N10 chipeset

    kirr at mini:~$ lspci
    00:00.0 Host bridge: Intel Corporation N10 Family DMI Bridge
    00:02.0 VGA compatible controller: Intel Corporation N10 Family Integrated Graphics Controller
    00:02.1 Display controller: Intel Corporation N10 Family Integrated Graphics Controller
    00:1b.0 Audio device: Intel Corporation N10/ICH 7 Family High Definition Audio Controller (rev 02)
    00:1c.0 PCI bridge: Intel Corporation N10/ICH 7 Family PCI Express Port 1 (rev 02)
    00:1c.3 PCI bridge: Intel Corporation N10/ICH 7 Family PCI Express Port 4 (rev 02)
    00:1d.0 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #1 (rev 02)
    00:1d.1 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #2 (rev 02)
    00:1d.2 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #3 (rev 02)
    00:1d.3 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #4 (rev 02)
    00:1d.7 USB Controller: Intel Corporation N10/ICH 7 Family USB2 EHCI Controller (rev 02)
    00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev e2)
    00:1f.0 ISA bridge: Intel Corporation NM10 Family LPC Controller (rev 02)
    00:1f.2 SATA controller: Intel Corporation N10/ICH7 Family SATA AHCI Controller (rev 02)
    01:00.0 Network controller: Broadcom Corporation BCM4313 802.11b/g/n Wireless LAN Controller (rev 01)
    02:00.0 Ethernet controller: Marvell Technology Group Ltd. 88E8059 PCI-E Gigabit Ethernet Controller (rev 11)

and the system works stable with 110us/uframe (~88%) isoc bandwith allocated for
above-mentioned isochronous transfers.

NOTE 3
~~~~~~

This feature is off by default. I mean max periodic bandwidth is set to
100us/uframe by default exactly as it was before the patch. So only those of us
who need the extreme settings are taking the risk - normal users who do not
alter uframe_periodic_max sysfs attribute should not see any change at all.

Cc: Sarah Sharp <sarah.a.sharp at linux.intel.com>
Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>
---
 drivers/usb/host/ehci-hcd.c   |    6 ++
 drivers/usb/host/ehci-sched.c |   17 +++----
 drivers/usb/host/ehci-sysfs.c |  104 +++++++++++++++++++++++++++++++++++++++--
 drivers/usb/host/ehci.h       |    2 +
 4 files changed, 115 insertions(+), 14 deletions(-)

diff --git a/drivers/usb/host/ehci-hcd.c b/drivers/usb/host/ehci-hcd.c
index 8306155..4ee62be 100644
--- a/drivers/usb/host/ehci-hcd.c
+++ b/drivers/usb/host/ehci-hcd.c
@@ -572,6 +572,12 @@ static int ehci_init(struct usb_hcd *hcd)
 	hcc_params = ehci_readl(ehci, &ehci->caps->hcc_params);
 
 	/*
+	 * by default set standard 80% (== 100 usec/uframe) max periodic
+	 * bandwidth as required by USB 2.0
+	 */
+	ehci->uframe_periodic_max = 100;
+
+	/*
 	 * hw default: 1K periodic list heads, one per frame.
 	 * periodic_size can shrink by USBCMD update if hcc_params allows.
 	 */
diff --git a/drivers/usb/host/ehci-sched.c b/drivers/usb/host/ehci-sched.c
index 6c9fbe3..2abf854 100644
--- a/drivers/usb/host/ehci-sched.c
+++ b/drivers/usb/host/ehci-sched.c
@@ -172,7 +172,7 @@ periodic_usecs (struct ehci_hcd *ehci, unsigned frame, unsigned uframe)
 		}
 	}
 #ifdef	DEBUG
-	if (usecs > 100)
+	if (usecs > ehci->uframe_periodic_max)
 		ehci_err (ehci, "uframe %d sched overrun: %d usecs\n",
 			frame * 8 + uframe, usecs);
 #endif
@@ -709,11 +709,8 @@ static int check_period (
 	if (uframe >= 8)
 		return 0;
 
-	/*
-	 * 80% periodic == 100 usec/uframe available
-	 * convert "usecs we need" to "max already claimed"
-	 */
-	usecs = 100 - usecs;
+	/* convert "usecs we need" to "max already claimed" */
+	usecs = ehci->uframe_periodic_max - usecs;
 
 	/* we "know" 2 and 4 uframe intervals were rejected; so
 	 * for period 0, check _every_ microframe in the schedule.
@@ -1286,9 +1283,9 @@ itd_slot_ok (
 {
 	uframe %= period;
 	do {
-		/* can't commit more than 80% periodic == 100 usec */
+		/* can't commit more than uframe_periodic_max usec */
 		if (periodic_usecs (ehci, uframe >> 3, uframe & 0x7)
-				> (100 - usecs))
+				> (ehci->uframe_periodic_max - usecs))
 			return 0;
 
 		/* we know urb->interval is 2^N uframes */
@@ -1345,7 +1342,7 @@ sitd_slot_ok (
 #endif
 
 		/* check starts (OUT uses more than one) */
-		max_used = 100 - stream->usecs;
+		max_used = ehci->uframe_periodic_max - stream->usecs;
 		for (tmp = stream->raw_mask & 0xff; tmp; tmp >>= 1, uf++) {
 			if (periodic_usecs (ehci, frame, uf) > max_used)
 				return 0;
@@ -1354,7 +1351,7 @@ sitd_slot_ok (
 		/* for IN, check CSPLIT */
 		if (stream->c_usecs) {
 			uf = uframe & 7;
-			max_used = 100 - stream->c_usecs;
+			max_used = ehci->uframe_periodic_max - stream->c_usecs;
 			do {
 				tmp = 1 << uf;
 				tmp <<= 8;
diff --git a/drivers/usb/host/ehci-sysfs.c b/drivers/usb/host/ehci-sysfs.c
index 29824a9..14ced00 100644
--- a/drivers/usb/host/ehci-sysfs.c
+++ b/drivers/usb/host/ehci-sysfs.c
@@ -74,21 +74,117 @@ static ssize_t store_companion(struct device *dev,
 }
 static DEVICE_ATTR(companion, 0644, show_companion, store_companion);
 
+
+/*
+ * Display / Set uframe_periodic_max
+ */
+static ssize_t show_uframe_periodic_max(struct device *dev,
+					struct device_attribute *attr,
+					char *buf)
+{
+	struct ehci_hcd		*ehci;
+	int			n;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	n = scnprintf(buf, PAGE_SIZE, "%d\n", ehci->uframe_periodic_max);
+	return n;
+}
+
+
+static ssize_t store_uframe_periodic_max(struct device *dev,
+					struct device_attribute *attr,
+					const char *buf, size_t count)
+{
+	struct ehci_hcd		*ehci;
+	unsigned		uframe_periodic_max;
+	unsigned		frame, uframe;
+	unsigned short		allocated_max;
+	unsigned long		flags;
+	ssize_t			ret;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	if (kstrtouint(buf, 0, &uframe_periodic_max) < 0)
+		return -EINVAL;
+
+	if (uframe_periodic_max < 100 || uframe_periodic_max >= 125) {
+		ehci_info(ehci, "rejecting invalid request for "
+				"uframe_periodic_max=%u\n", uframe_periodic_max);
+		return -EINVAL;
+	}
+
+	ret = -EINVAL;
+
+	/*
+	 * lock, so that our checking does not race with possible periodic
+	 * bandwidth allocation through submitting new urbs.
+	 */
+	spin_lock_irqsave (&ehci->lock, flags);
+
+	/*
+	 * for request to decrease max periodic bandwidth, we have to check
+	 * every microframe in the schedule to see whether the decrease is
+	 * possible.
+	 */
+	if (uframe_periodic_max < ehci->uframe_periodic_max) {
+		allocated_max = 0;
+
+		for (frame = 0; frame < ehci->periodic_size; ++frame)
+			for (uframe = 0; uframe < 7; ++uframe)
+				allocated_max = max(allocated_max,
+						    periodic_usecs (ehci, frame, uframe));
+
+		if (allocated_max > uframe_periodic_max) {
+			ehci_info(ehci,
+				"cannot decrease uframe_periodic_max becase "
+				"periodic bandwidth is already allocated "
+				"(%u > %u)\n",
+				allocated_max, uframe_periodic_max);
+			goto out_unlock;
+		}
+	}
+
+	/* increasing is always ok */
+
+	ehci_info(ehci, "setting max periodic bandwidth to %u%% "
+			"(== %u usec/uframe)\n",
+			100*uframe_periodic_max/125, uframe_periodic_max);
+
+	if (uframe_periodic_max != 100)
+		ehci_warn(ehci, "max periodic bandwidth set is non-standard\n");
+
+	ehci->uframe_periodic_max = uframe_periodic_max;
+	ret = count;
+
+out_unlock:
+	spin_unlock_irqrestore (&ehci->lock, flags);
+	return ret;
+}
+static DEVICE_ATTR(uframe_periodic_max, 0644, show_uframe_periodic_max, store_uframe_periodic_max);
+
+
 static inline int create_sysfs_files(struct ehci_hcd *ehci)
 {
+	struct device	*controller = ehci_to_hcd(ehci)->self.controller;
 	int	i = 0;
 
 	/* with integrated TT there is no companion! */
 	if (!ehci_is_TDI(ehci))
-		i = device_create_file(ehci_to_hcd(ehci)->self.controller,
-				       &dev_attr_companion);
+		i = device_create_file(controller, &dev_attr_companion);
+	if (i)
+		goto out;
+
+	i = device_create_file(controller, &dev_attr_uframe_periodic_max);
+out:
 	return i;
 }
 
 static inline void remove_sysfs_files(struct ehci_hcd *ehci)
 {
+	struct device	*controller = ehci_to_hcd(ehci)->self.controller;
+
 	/* with integrated TT there is no companion! */
 	if (!ehci_is_TDI(ehci))
-		device_remove_file(ehci_to_hcd(ehci)->self.controller,
-				   &dev_attr_companion);
+		device_remove_file(controller, &dev_attr_companion);
+
+	device_remove_file(controller, &dev_attr_uframe_periodic_max);
 }
diff --git a/drivers/usb/host/ehci.h b/drivers/usb/host/ehci.h
index bd6ff48..fa3129f 100644
--- a/drivers/usb/host/ehci.h
+++ b/drivers/usb/host/ehci.h
@@ -87,6 +87,8 @@ struct ehci_hcd {			/* one per controller */
 	union ehci_shadow	*pshadow;	/* mirror hw periodic table */
 	int			next_uframe;	/* scan periodic, start here */
 	unsigned		periodic_sched;	/* periodic activity count */
+	unsigned		uframe_periodic_max; /* max periodic time per uframe */
+
 
 	/* list of itds & sitds completed while clock_frame was still active */
 	struct list_head	cached_itd_list;
-- 
1.7.6.rc3



From kirr at mns.spb.ru  Fri Jul  1 13:47:10 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Fri,  1 Jul 2011 15:47:10 +0400
Subject: [Linux-uvc-devel] [PATCH v3 1/2] USB: EHCI: Move sysfs related bits
	into ehci-sysfs.c
In-Reply-To: <cover.1309520144.git.kirr@mns.spb.ru>
References: <cover.1309520144.git.kirr@mns.spb.ru>
Message-ID: <a8236643abf74ea7fbf5fdada29f03d2aad61969.1309520144.git.kirr@mns.spb.ru>

The only sysfs attr implemented so far is "companion" from ehci-hub.c,
but in the next patch we are going to add another sysfs file, so prior
to that let's structure things and move already-in-there sysfs code to
separate file.

NOTE: All the code I'm moving into this new file was written by Alan
Stern (in 57e06c11 "EHCI: force high-speed devices to run at full
speed"; Jan 16 2007), that's why I'm putting

    Copyright (C) 2007 by Alan Stern

there after explicit request from the author.

Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>
Acked-off-by: Alan Stern <stern at rowland.harvard.edu>
---
 drivers/usb/host/ehci-hcd.c   |    5 +-
 drivers/usb/host/ehci-hub.c   |   75 --------------------------------
 drivers/usb/host/ehci-sysfs.c |   94 +++++++++++++++++++++++++++++++++++++++++
 3 files changed, 97 insertions(+), 77 deletions(-)
 create mode 100644 drivers/usb/host/ehci-sysfs.c

diff --git a/drivers/usb/host/ehci-hcd.c b/drivers/usb/host/ehci-hcd.c
index e18862c..8306155 100644
--- a/drivers/usb/host/ehci-hcd.c
+++ b/drivers/usb/host/ehci-hcd.c
@@ -336,6 +336,7 @@ static void ehci_work(struct ehci_hcd *ehci);
 #include "ehci-mem.c"
 #include "ehci-q.c"
 #include "ehci-sched.c"
+#include "ehci-sysfs.c"
 
 /*-------------------------------------------------------------------------*/
 
@@ -520,7 +521,7 @@ static void ehci_stop (struct usb_hcd *hcd)
 	ehci_reset (ehci);
 	spin_unlock_irq(&ehci->lock);
 
-	remove_companion_file(ehci);
+	remove_sysfs_files(ehci);
 	remove_debug_files (ehci);
 
 	/* root hub is shut down separately (first, when possible) */
@@ -754,7 +755,7 @@ static int ehci_run (struct usb_hcd *hcd)
 	 * since the class device isn't created that early.
 	 */
 	create_debug_files(ehci);
-	create_companion_file(ehci);
+	create_sysfs_files(ehci);
 
 	return 0;
 }
diff --git a/drivers/usb/host/ehci-hub.c b/drivers/usb/host/ehci-hub.c
index ea6184b..d9e8d71 100644
--- a/drivers/usb/host/ehci-hub.c
+++ b/drivers/usb/host/ehci-hub.c
@@ -471,29 +471,6 @@ static int ehci_bus_resume (struct usb_hcd *hcd)
 
 /*-------------------------------------------------------------------------*/
 
-/* Display the ports dedicated to the companion controller */
-static ssize_t show_companion(struct device *dev,
-			      struct device_attribute *attr,
-			      char *buf)
-{
-	struct ehci_hcd		*ehci;
-	int			nports, index, n;
-	int			count = PAGE_SIZE;
-	char			*ptr = buf;
-
-	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
-	nports = HCS_N_PORTS(ehci->hcs_params);
-
-	for (index = 0; index < nports; ++index) {
-		if (test_bit(index, &ehci->companion_ports)) {
-			n = scnprintf(ptr, count, "%d\n", index + 1);
-			ptr += n;
-			count -= n;
-		}
-	}
-	return ptr - buf;
-}
-
 /*
  * Sets the owner of a port
  */
@@ -528,58 +505,6 @@ static void set_owner(struct ehci_hcd *ehci, int portnum, int new_owner)
 	}
 }
 
-/*
- * Dedicate or undedicate a port to the companion controller.
- * Syntax is "[-]portnum", where a leading '-' sign means
- * return control of the port to the EHCI controller.
- */
-static ssize_t store_companion(struct device *dev,
-			       struct device_attribute *attr,
-			       const char *buf, size_t count)
-{
-	struct ehci_hcd		*ehci;
-	int			portnum, new_owner;
-
-	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
-	new_owner = PORT_OWNER;		/* Owned by companion */
-	if (sscanf(buf, "%d", &portnum) != 1)
-		return -EINVAL;
-	if (portnum < 0) {
-		portnum = - portnum;
-		new_owner = 0;		/* Owned by EHCI */
-	}
-	if (portnum <= 0 || portnum > HCS_N_PORTS(ehci->hcs_params))
-		return -ENOENT;
-	portnum--;
-	if (new_owner)
-		set_bit(portnum, &ehci->companion_ports);
-	else
-		clear_bit(portnum, &ehci->companion_ports);
-	set_owner(ehci, portnum, new_owner);
-	return count;
-}
-static DEVICE_ATTR(companion, 0644, show_companion, store_companion);
-
-static inline int create_companion_file(struct ehci_hcd *ehci)
-{
-	int	i = 0;
-
-	/* with integrated TT there is no companion! */
-	if (!ehci_is_TDI(ehci))
-		i = device_create_file(ehci_to_hcd(ehci)->self.controller,
-				       &dev_attr_companion);
-	return i;
-}
-
-static inline void remove_companion_file(struct ehci_hcd *ehci)
-{
-	/* with integrated TT there is no companion! */
-	if (!ehci_is_TDI(ehci))
-		device_remove_file(ehci_to_hcd(ehci)->self.controller,
-				   &dev_attr_companion);
-}
-
-
 /*-------------------------------------------------------------------------*/
 
 static int check_reset_complete (
diff --git a/drivers/usb/host/ehci-sysfs.c b/drivers/usb/host/ehci-sysfs.c
new file mode 100644
index 0000000..29824a9
--- /dev/null
+++ b/drivers/usb/host/ehci-sysfs.c
@@ -0,0 +1,94 @@
+/*
+ * Copyright (C) 2007 by Alan Stern
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License as published by the
+ * Free Software Foundation; either version 2 of the License, or (at your
+ * option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful, but
+ * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
+ * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+ * for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software Foundation,
+ * Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+/* this file is part of ehci-hcd.c */
+
+
+/* Display the ports dedicated to the companion controller */
+static ssize_t show_companion(struct device *dev,
+			      struct device_attribute *attr,
+			      char *buf)
+{
+	struct ehci_hcd		*ehci;
+	int			nports, index, n;
+	int			count = PAGE_SIZE;
+	char			*ptr = buf;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	nports = HCS_N_PORTS(ehci->hcs_params);
+
+	for (index = 0; index < nports; ++index) {
+		if (test_bit(index, &ehci->companion_ports)) {
+			n = scnprintf(ptr, count, "%d\n", index + 1);
+			ptr += n;
+			count -= n;
+		}
+	}
+	return ptr - buf;
+}
+
+/*
+ * Dedicate or undedicate a port to the companion controller.
+ * Syntax is "[-]portnum", where a leading '-' sign means
+ * return control of the port to the EHCI controller.
+ */
+static ssize_t store_companion(struct device *dev,
+			       struct device_attribute *attr,
+			       const char *buf, size_t count)
+{
+	struct ehci_hcd		*ehci;
+	int			portnum, new_owner;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	new_owner = PORT_OWNER;		/* Owned by companion */
+	if (sscanf(buf, "%d", &portnum) != 1)
+		return -EINVAL;
+	if (portnum < 0) {
+		portnum = - portnum;
+		new_owner = 0;		/* Owned by EHCI */
+	}
+	if (portnum <= 0 || portnum > HCS_N_PORTS(ehci->hcs_params))
+		return -ENOENT;
+	portnum--;
+	if (new_owner)
+		set_bit(portnum, &ehci->companion_ports);
+	else
+		clear_bit(portnum, &ehci->companion_ports);
+	set_owner(ehci, portnum, new_owner);
+	return count;
+}
+static DEVICE_ATTR(companion, 0644, show_companion, store_companion);
+
+static inline int create_sysfs_files(struct ehci_hcd *ehci)
+{
+	int	i = 0;
+
+	/* with integrated TT there is no companion! */
+	if (!ehci_is_TDI(ehci))
+		i = device_create_file(ehci_to_hcd(ehci)->self.controller,
+				       &dev_attr_companion);
+	return i;
+}
+
+static inline void remove_sysfs_files(struct ehci_hcd *ehci)
+{
+	/* with integrated TT there is no companion! */
+	if (!ehci_is_TDI(ehci))
+		device_remove_file(ehci_to_hcd(ehci)->self.controller,
+				   &dev_attr_companion);
+}
-- 
1.7.6.rc3



From kirr at mns.spb.ru  Sat Jul  2 12:07:12 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sat, 2 Jul 2011 14:07:12 +0400
Subject: [Linux-uvc-devel] [PATCH v3 2/2] USB: EHCI: Allow users to
	override 80% max	periodic bandwidth
In-Reply-To: <20110701212427.GA11831@kroah.com>
References: <cover.1309520144.git.kirr@mns.spb.ru>
	<69ea2dd940481508f190419c53c780b626460b22.1309520144.git.kirr@mns.spb.ru>
	<20110701212427.GA11831@kroah.com>
Message-ID: <20110702100712.GA18338@tugrik.mns.mnsspb.ru>

On Fri, Jul 01, 2011 at 02:24:27PM -0700, Greg KH wrote:
> On Fri, Jul 01, 2011 at 03:47:11PM +0400, Kirill Smelkov wrote:
> >  drivers/usb/host/ehci-sysfs.c |  104 +++++++++++++++++++++++++++++++++++++++--
> 
> As you are adding new sysfs files, it is required that you also add new
> entries in the Documentation/ABI/ directory.
> 
> Please do that for these files so that people have an idea of what they
> are, and how to use them.
> 
> Care to redo this series with that change?

Sure, I'll post v4 with documentation included.

Thanks,
Kirill


From grinder13 at gmail.com  Sun Jul  3 02:04:29 2011
From: grinder13 at gmail.com (George)
Date: Sun, 3 Jul 2011 01:04:29 +0100
Subject: [Linux-uvc-devel] Logitech C270 mic problem
In-Reply-To: <CAE1CaMEG5GB_bK=XLSPWb0fRydpTz5hTc1keJ+wmBpk0gMd5Pg@mail.gmail.com>
References: <CAE1CaMEG5GB_bK=XLSPWb0fRydpTz5hTc1keJ+wmBpk0gMd5Pg@mail.gmail.com>
Message-ID: <CAE1CaMF=oF+6ybySiKHx2y0Liijc0P1R6Xv5+mex5pxO-jMaog@mail.gmail.com>

Hello all,

Here is a problem with a Logitech C270 webcam and its mic: Quite often when
I 'm on Skype (or Google talk) doing a video call, the mic suddenly goes
off, so the other side can't here me. I have to kill Skype from the command
line, unplug the camera, plug it back in and then load Skype again.
Sometimes I have to do this 2 or 3 times in a raw until the mic comes back
again. This happens only when I 'm doing video calls. When this happens I
see the following message when doing a dmesg:

*cannot set freq 24000 to ep 0x86*

I also see similar messages when the Linux kernel is loading:

*cannot set freq 24000 to ep 0x86
cannot set freq 32000 to ep 0x86
cannot set freq 48000 to ep 0x86*

I purchased this webcam 6 months ago (sorry for not mailing the list
earlier) and I noticed this behaviour from the very beginning I started
using it, so it's not something noticed with the latest Linux kernel. I 'm
using Debian Unstable with the Liquorix kernel, but it's the same with the
official Debian kernels as well. This has also been reported in Arch Linux.

I hope that the above information can help you to debug the problem. Please
do tell me if I can do anything more. Thank you in advance for any response.

Best regards,
George P.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110703/1e0918f0/attachment.html>

From kirr at mns.spb.ru  Sun Jul  3 18:36:55 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sun,  3 Jul 2011 20:36:55 +0400
Subject: [Linux-uvc-devel] [PATCH v4 0/2] USB: EHCI: Allow users to override
	80% max periodic bandwidth
Message-ID: <cover.1309710420.git.kirr@mns.spb.ru>

There are cases, when 80% max isochronous bandwidth is too limiting.

Let's allow knowledgeable users to override that 80% max limit explicitly for
extreme cases, like 2 high bandwidth isochronously streaming devices on the
same High Speed USB bus in order to make them work simultaneously.

See full details in PATCH 2/2.


Changes since v3:

 - as suggested by Greg KH added new entry to Documentation/ABI/;

 - for consistency also touched Documentation/usb/ehci.txt reminding we now
   have new setting for periodic transfers scheduler.

   The base text in-there requires much updating regarding isochronous
   transfers, so only "TBD" with brief description was put because I'm not the best
   person to get EHCI description into shape;

 - added ACK to PATCH 2/2 from Alan Stern based on previous feedback. (I hope
   it's still semi-ok to put it, inspite of adding new not-reviewed text into
   docs);

 - minor cosmetics in patch descriptions.


Changes since v2:

 - changed the copyright in ehci-sysfs from David Brownell to Alan Stern;

 - added ACK to PATCH 1/2 from Alan Stern;

 - inspired by concerns raised by Sarah Sharp, added more details about testing
   done on N10 chipset, system stability, and that no-harm-is-done for those,
   who do not change uframe_periodic_max from default 100us;

 - when decreasing uframe_periodic_max, compare with the maximum number of
   microseconds already allocated for any uframe, instead of stopping as soon
   as it finds something above the new limit.


Changes since v1:

 - dropped RFC status as "this seems like the sort of feature somebody might
   reasonably want to use -- if they know exactly what they're doing";

 - new preparatory patch (1/2) which moves already-in-there sysfs code into
   ehci-sysfs.c;

 - moved uframe_periodic_max parameter from module option to sysfs attribute,
   so that it can be set per controller and at runtime, added validity checks;

 - clarified a bit bandwidth analysis for 96% max periodic setup as noticed by
   Alan Stern;

 - clarified patch description saying that set in stone 80% max periodic is
   specified by USB 2.0;

Kirill Smelkov (2):
  USB: EHCI: Move sysfs related bits into ehci-sysfs.c
  USB: EHCI: Allow users to override 80% max periodic bandwidth

 Documentation/ABI/testing/sysfs-module |   23 ++++
 Documentation/usb/ehci.txt             |    2 +
 drivers/usb/host/ehci-hcd.c            |   11 ++-
 drivers/usb/host/ehci-hub.c            |   75 -------------
 drivers/usb/host/ehci-sched.c          |   17 +--
 drivers/usb/host/ehci-sysfs.c          |  190 ++++++++++++++++++++++++++++++++
 drivers/usb/host/ehci.h                |    2 +
 7 files changed, 233 insertions(+), 87 deletions(-)
 create mode 100644 drivers/usb/host/ehci-sysfs.c

-- 
1.7.6.rc3



From kirr at mns.spb.ru  Sun Jul  3 18:36:56 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sun,  3 Jul 2011 20:36:56 +0400
Subject: [Linux-uvc-devel] [PATCH v4 1/2] USB: EHCI: Move sysfs related bits
	into ehci-sysfs.c
In-Reply-To: <cover.1309710420.git.kirr@mns.spb.ru>
References: <cover.1309710420.git.kirr@mns.spb.ru>
Message-ID: <0f7b5fa21a812cd4ca73a17d137170247a0867e1.1309710420.git.kirr@mns.spb.ru>

The only sysfs attr implemented so far is "companion" from ehci-hub.c,
but in the next patch we are going to add another sysfs file, so prior
to that let's structure things and move already-in-there sysfs code to
separate file.

NOTE: All the code I'm moving into this new file was written by Alan
Stern (in 57e06c11 "EHCI: force high-speed devices to run at full
speed"; Jan 16 2007), that's why I'm putting

    Copyright (C) 2007 by Alan Stern

there after explicit request from the author.

Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>
Acked-by: Alan Stern <stern at rowland.harvard.edu>
---
 drivers/usb/host/ehci-hcd.c   |    5 +-
 drivers/usb/host/ehci-hub.c   |   75 --------------------------------
 drivers/usb/host/ehci-sysfs.c |   94 +++++++++++++++++++++++++++++++++++++++++
 3 files changed, 97 insertions(+), 77 deletions(-)
 create mode 100644 drivers/usb/host/ehci-sysfs.c

diff --git a/drivers/usb/host/ehci-hcd.c b/drivers/usb/host/ehci-hcd.c
index e18862c..8306155 100644
--- a/drivers/usb/host/ehci-hcd.c
+++ b/drivers/usb/host/ehci-hcd.c
@@ -336,6 +336,7 @@ static void ehci_work(struct ehci_hcd *ehci);
 #include "ehci-mem.c"
 #include "ehci-q.c"
 #include "ehci-sched.c"
+#include "ehci-sysfs.c"
 
 /*-------------------------------------------------------------------------*/
 
@@ -520,7 +521,7 @@ static void ehci_stop (struct usb_hcd *hcd)
 	ehci_reset (ehci);
 	spin_unlock_irq(&ehci->lock);
 
-	remove_companion_file(ehci);
+	remove_sysfs_files(ehci);
 	remove_debug_files (ehci);
 
 	/* root hub is shut down separately (first, when possible) */
@@ -754,7 +755,7 @@ static int ehci_run (struct usb_hcd *hcd)
 	 * since the class device isn't created that early.
 	 */
 	create_debug_files(ehci);
-	create_companion_file(ehci);
+	create_sysfs_files(ehci);
 
 	return 0;
 }
diff --git a/drivers/usb/host/ehci-hub.c b/drivers/usb/host/ehci-hub.c
index ea6184b..d9e8d71 100644
--- a/drivers/usb/host/ehci-hub.c
+++ b/drivers/usb/host/ehci-hub.c
@@ -471,29 +471,6 @@ static int ehci_bus_resume (struct usb_hcd *hcd)
 
 /*-------------------------------------------------------------------------*/
 
-/* Display the ports dedicated to the companion controller */
-static ssize_t show_companion(struct device *dev,
-			      struct device_attribute *attr,
-			      char *buf)
-{
-	struct ehci_hcd		*ehci;
-	int			nports, index, n;
-	int			count = PAGE_SIZE;
-	char			*ptr = buf;
-
-	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
-	nports = HCS_N_PORTS(ehci->hcs_params);
-
-	for (index = 0; index < nports; ++index) {
-		if (test_bit(index, &ehci->companion_ports)) {
-			n = scnprintf(ptr, count, "%d\n", index + 1);
-			ptr += n;
-			count -= n;
-		}
-	}
-	return ptr - buf;
-}
-
 /*
  * Sets the owner of a port
  */
@@ -528,58 +505,6 @@ static void set_owner(struct ehci_hcd *ehci, int portnum, int new_owner)
 	}
 }
 
-/*
- * Dedicate or undedicate a port to the companion controller.
- * Syntax is "[-]portnum", where a leading '-' sign means
- * return control of the port to the EHCI controller.
- */
-static ssize_t store_companion(struct device *dev,
-			       struct device_attribute *attr,
-			       const char *buf, size_t count)
-{
-	struct ehci_hcd		*ehci;
-	int			portnum, new_owner;
-
-	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
-	new_owner = PORT_OWNER;		/* Owned by companion */
-	if (sscanf(buf, "%d", &portnum) != 1)
-		return -EINVAL;
-	if (portnum < 0) {
-		portnum = - portnum;
-		new_owner = 0;		/* Owned by EHCI */
-	}
-	if (portnum <= 0 || portnum > HCS_N_PORTS(ehci->hcs_params))
-		return -ENOENT;
-	portnum--;
-	if (new_owner)
-		set_bit(portnum, &ehci->companion_ports);
-	else
-		clear_bit(portnum, &ehci->companion_ports);
-	set_owner(ehci, portnum, new_owner);
-	return count;
-}
-static DEVICE_ATTR(companion, 0644, show_companion, store_companion);
-
-static inline int create_companion_file(struct ehci_hcd *ehci)
-{
-	int	i = 0;
-
-	/* with integrated TT there is no companion! */
-	if (!ehci_is_TDI(ehci))
-		i = device_create_file(ehci_to_hcd(ehci)->self.controller,
-				       &dev_attr_companion);
-	return i;
-}
-
-static inline void remove_companion_file(struct ehci_hcd *ehci)
-{
-	/* with integrated TT there is no companion! */
-	if (!ehci_is_TDI(ehci))
-		device_remove_file(ehci_to_hcd(ehci)->self.controller,
-				   &dev_attr_companion);
-}
-
-
 /*-------------------------------------------------------------------------*/
 
 static int check_reset_complete (
diff --git a/drivers/usb/host/ehci-sysfs.c b/drivers/usb/host/ehci-sysfs.c
new file mode 100644
index 0000000..29824a9
--- /dev/null
+++ b/drivers/usb/host/ehci-sysfs.c
@@ -0,0 +1,94 @@
+/*
+ * Copyright (C) 2007 by Alan Stern
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License as published by the
+ * Free Software Foundation; either version 2 of the License, or (at your
+ * option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful, but
+ * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
+ * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+ * for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software Foundation,
+ * Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+/* this file is part of ehci-hcd.c */
+
+
+/* Display the ports dedicated to the companion controller */
+static ssize_t show_companion(struct device *dev,
+			      struct device_attribute *attr,
+			      char *buf)
+{
+	struct ehci_hcd		*ehci;
+	int			nports, index, n;
+	int			count = PAGE_SIZE;
+	char			*ptr = buf;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	nports = HCS_N_PORTS(ehci->hcs_params);
+
+	for (index = 0; index < nports; ++index) {
+		if (test_bit(index, &ehci->companion_ports)) {
+			n = scnprintf(ptr, count, "%d\n", index + 1);
+			ptr += n;
+			count -= n;
+		}
+	}
+	return ptr - buf;
+}
+
+/*
+ * Dedicate or undedicate a port to the companion controller.
+ * Syntax is "[-]portnum", where a leading '-' sign means
+ * return control of the port to the EHCI controller.
+ */
+static ssize_t store_companion(struct device *dev,
+			       struct device_attribute *attr,
+			       const char *buf, size_t count)
+{
+	struct ehci_hcd		*ehci;
+	int			portnum, new_owner;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	new_owner = PORT_OWNER;		/* Owned by companion */
+	if (sscanf(buf, "%d", &portnum) != 1)
+		return -EINVAL;
+	if (portnum < 0) {
+		portnum = - portnum;
+		new_owner = 0;		/* Owned by EHCI */
+	}
+	if (portnum <= 0 || portnum > HCS_N_PORTS(ehci->hcs_params))
+		return -ENOENT;
+	portnum--;
+	if (new_owner)
+		set_bit(portnum, &ehci->companion_ports);
+	else
+		clear_bit(portnum, &ehci->companion_ports);
+	set_owner(ehci, portnum, new_owner);
+	return count;
+}
+static DEVICE_ATTR(companion, 0644, show_companion, store_companion);
+
+static inline int create_sysfs_files(struct ehci_hcd *ehci)
+{
+	int	i = 0;
+
+	/* with integrated TT there is no companion! */
+	if (!ehci_is_TDI(ehci))
+		i = device_create_file(ehci_to_hcd(ehci)->self.controller,
+				       &dev_attr_companion);
+	return i;
+}
+
+static inline void remove_sysfs_files(struct ehci_hcd *ehci)
+{
+	/* with integrated TT there is no companion! */
+	if (!ehci_is_TDI(ehci))
+		device_remove_file(ehci_to_hcd(ehci)->self.controller,
+				   &dev_attr_companion);
+}
-- 
1.7.6.rc3



From kirr at mns.spb.ru  Sun Jul  3 18:36:57 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sun,  3 Jul 2011 20:36:57 +0400
Subject: [Linux-uvc-devel] =?utf-8?q?=5BPATCH_v4_2/2=5D_USB=3A_EHCI=3A_All?=
	=?utf-8?q?ow_users_to_override_80=25_max_periodic_bandwidth?=
In-Reply-To: <cover.1309710420.git.kirr@mns.spb.ru>
References: <cover.1309710420.git.kirr@mns.spb.ru>
Message-ID: <814bb70c49a62111145aafe705884065ae0af869.1309710420.git.kirr@mns.spb.ru>

There are cases, when 80% max isochronous bandwidth is too limiting.

For example I have two USB video capture cards which stream uncompressed
video, and to stream full NTSC + PAL videos we'd need

    NTSC 640x480 YUV422 @30fps      ~17.6 MB/s
    PAL  720x576 YUV422 @25fps      ~19.7 MB/s

isoc bandwidth.

Now, due to limited alt settings in capture devices NTSC one ends up
streaming with max_pkt_size=2688  and  PAL with max_pkt_size=2892, both
with interval=1. In terms of microframe time allocation this gives

    NTSC    ~53us
    PAL     ~57us

and together

    ~110us  >  100us == 80% of 125us uframe time.

So those two devices can't work together simultaneously because the'd
over allocate isochronous bandwidth.

80% seemed a bit arbitrary to me, and I've tried to raise it to 90% and
both devices started to work together, so I though sometimes it would be
a good idea for users to override hardcoded default of max 80% isoc
bandwidth.

After all, isn't it a user who should decide how to load the bus? If I
can live with 10% or even 5% bulk bandwidth that should be ok. I'm a USB
newcomer, but that 80% set in stone by USB 2.0 specification seems to be
chosen pretty arbitrary to me, just to serve as a reasonable default.

NOTE 1
~~~~~~

for two streams with max_pkt_size=3072 (worst case) both time
allocation would be 60us+60us=120us which is 96% periodic bandwidth
leaving 4% for bulk and control.  Alan Stern suggested that bulk then
would be problematic (less than 300*8 bittimes left per microframe), but
I think that is still enough for control traffic.

NOTE 2
~~~~~~

Sarah Sharp expressed concern that maxing out periodic bandwidth
could lead to vendor-specific hardware bugs on host controllers, because

> It's entirely possible that you'll run into
> vendor-specific bugs if you try to pack the schedule with isochronous
> transfers.  I don't think any hardware designer would seriously test or
> validate their hardware with a schedule that is basically a violation of
> the USB bus spec (more than 80% for periodic transfers).

So far I've only tested this patch on my HP Mini 5103 with N10 chipset

    kirr at mini:~$ lspci
    00:00.0 Host bridge: Intel Corporation N10 Family DMI Bridge
    00:02.0 VGA compatible controller: Intel Corporation N10 Family Integrated Graphics Controller
    00:02.1 Display controller: Intel Corporation N10 Family Integrated Graphics Controller
    00:1b.0 Audio device: Intel Corporation N10/ICH 7 Family High Definition Audio Controller (rev 02)
    00:1c.0 PCI bridge: Intel Corporation N10/ICH 7 Family PCI Express Port 1 (rev 02)
    00:1c.3 PCI bridge: Intel Corporation N10/ICH 7 Family PCI Express Port 4 (rev 02)
    00:1d.0 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #1 (rev 02)
    00:1d.1 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #2 (rev 02)
    00:1d.2 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #3 (rev 02)
    00:1d.3 USB Controller: Intel Corporation N10/ICH 7 Family USB UHCI Controller #4 (rev 02)
    00:1d.7 USB Controller: Intel Corporation N10/ICH 7 Family USB2 EHCI Controller (rev 02)
    00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev e2)
    00:1f.0 ISA bridge: Intel Corporation NM10 Family LPC Controller (rev 02)
    00:1f.2 SATA controller: Intel Corporation N10/ICH7 Family SATA AHCI Controller (rev 02)
    01:00.0 Network controller: Broadcom Corporation BCM4313 802.11b/g/n Wireless LAN Controller (rev 01)
    02:00.0 Ethernet controller: Marvell Technology Group Ltd. 88E8059 PCI-E Gigabit Ethernet Controller (rev 11)

and the system works stable with 110us/uframe (~88%) isoc bandwith allocated for
above-mentioned isochronous transfers.

NOTE 3
~~~~~~

This feature is off by default. I mean max periodic bandwidth is set to
100us/uframe by default exactly as it was before the patch. So only those of us
who need the extreme settings are taking the risk - normal users who do not
alter uframe_periodic_max sysfs attribute should not see any change at all.

NOTE 4
~~~~~~

I've tried to update documentation in Documentation/ABI/ thoroughly, but
only "TBD" was put into Documentation/usb/ehci.txt -- the text there seems
to be outdated and much needing refreshing, before it could be amended.

Cc: Sarah Sharp <sarah.a.sharp at linux.intel.com>
Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>
Acked-by: Alan Stern <stern at rowland.harvard.edu>
---
 Documentation/ABI/testing/sysfs-module |   23 +++++++
 Documentation/usb/ehci.txt             |    2 +
 drivers/usb/host/ehci-hcd.c            |    6 ++
 drivers/usb/host/ehci-sched.c          |   17 ++---
 drivers/usb/host/ehci-sysfs.c          |  104 ++++++++++++++++++++++++++++++-
 drivers/usb/host/ehci.h                |    2 +
 6 files changed, 140 insertions(+), 14 deletions(-)

diff --git a/Documentation/ABI/testing/sysfs-module b/Documentation/ABI/testing/sysfs-module
index cfcec3b..9489ea8 100644
--- a/Documentation/ABI/testing/sysfs-module
+++ b/Documentation/ABI/testing/sysfs-module
@@ -10,3 +10,26 @@ KernelVersion:	2.6.35
 Contact:	masa-korg at dsn.okisemi.com
 Description:	Write/read Option ROM data.
 
+
+What:		/sys/module/ehci_hcd/drivers/.../uframe_periodic_max
+Date:		July 2011
+KernelVersion:	3.1
+Contact:	Kirill Smelkov <kirr at mns.spb.ru>
+Description:	Maximum time allowed for periodic transfers per microframe (?s)
+
+		[ USB 2.0 sets maximum allowed time for periodic transfers per
+		  microframe to be 80%, that is 100 microseconds out of 125
+		  microseconds (full microframe).
+
+		  However there are cases, when 80% max isochronous bandwidth is
+		  too limiting. For example two video streams could require 110
+		  microseconds of isochronous bandwidth per microframe to work
+		  together. ]
+
+		Through this setting it is possible to raise the limit so that
+		the host controller would allow allocating more than 100
+		microseconds of periodic bandwidth per microframe.
+
+		Beware, non-standard modes are usually not thoroughly tested by
+		hardware designers, and the hardware can malfunction when this
+		setting differ from default 100.
diff --git a/Documentation/usb/ehci.txt b/Documentation/usb/ehci.txt
index 9dcafa7..160bd6c 100644
--- a/Documentation/usb/ehci.txt
+++ b/Documentation/usb/ehci.txt
@@ -210,3 +210,5 @@ TBD:  Interrupt and ISO transfer performance issues.  Those periodic
 transfers are fully scheduled, so the main issue is likely to be how
 to trigger "high bandwidth" modes.
 
+TBD:  More than standard 80% periodic bandwidth allocation is possible
+through sysfs uframe_periodic_max parameter. Describe that.
diff --git a/drivers/usb/host/ehci-hcd.c b/drivers/usb/host/ehci-hcd.c
index 8306155..4ee62be 100644
--- a/drivers/usb/host/ehci-hcd.c
+++ b/drivers/usb/host/ehci-hcd.c
@@ -572,6 +572,12 @@ static int ehci_init(struct usb_hcd *hcd)
 	hcc_params = ehci_readl(ehci, &ehci->caps->hcc_params);
 
 	/*
+	 * by default set standard 80% (== 100 usec/uframe) max periodic
+	 * bandwidth as required by USB 2.0
+	 */
+	ehci->uframe_periodic_max = 100;
+
+	/*
 	 * hw default: 1K periodic list heads, one per frame.
 	 * periodic_size can shrink by USBCMD update if hcc_params allows.
 	 */
diff --git a/drivers/usb/host/ehci-sched.c b/drivers/usb/host/ehci-sched.c
index 6c9fbe3..2abf854 100644
--- a/drivers/usb/host/ehci-sched.c
+++ b/drivers/usb/host/ehci-sched.c
@@ -172,7 +172,7 @@ periodic_usecs (struct ehci_hcd *ehci, unsigned frame, unsigned uframe)
 		}
 	}
 #ifdef	DEBUG
-	if (usecs > 100)
+	if (usecs > ehci->uframe_periodic_max)
 		ehci_err (ehci, "uframe %d sched overrun: %d usecs\n",
 			frame * 8 + uframe, usecs);
 #endif
@@ -709,11 +709,8 @@ static int check_period (
 	if (uframe >= 8)
 		return 0;
 
-	/*
-	 * 80% periodic == 100 usec/uframe available
-	 * convert "usecs we need" to "max already claimed"
-	 */
-	usecs = 100 - usecs;
+	/* convert "usecs we need" to "max already claimed" */
+	usecs = ehci->uframe_periodic_max - usecs;
 
 	/* we "know" 2 and 4 uframe intervals were rejected; so
 	 * for period 0, check _every_ microframe in the schedule.
@@ -1286,9 +1283,9 @@ itd_slot_ok (
 {
 	uframe %= period;
 	do {
-		/* can't commit more than 80% periodic == 100 usec */
+		/* can't commit more than uframe_periodic_max usec */
 		if (periodic_usecs (ehci, uframe >> 3, uframe & 0x7)
-				> (100 - usecs))
+				> (ehci->uframe_periodic_max - usecs))
 			return 0;
 
 		/* we know urb->interval is 2^N uframes */
@@ -1345,7 +1342,7 @@ sitd_slot_ok (
 #endif
 
 		/* check starts (OUT uses more than one) */
-		max_used = 100 - stream->usecs;
+		max_used = ehci->uframe_periodic_max - stream->usecs;
 		for (tmp = stream->raw_mask & 0xff; tmp; tmp >>= 1, uf++) {
 			if (periodic_usecs (ehci, frame, uf) > max_used)
 				return 0;
@@ -1354,7 +1351,7 @@ sitd_slot_ok (
 		/* for IN, check CSPLIT */
 		if (stream->c_usecs) {
 			uf = uframe & 7;
-			max_used = 100 - stream->c_usecs;
+			max_used = ehci->uframe_periodic_max - stream->c_usecs;
 			do {
 				tmp = 1 << uf;
 				tmp <<= 8;
diff --git a/drivers/usb/host/ehci-sysfs.c b/drivers/usb/host/ehci-sysfs.c
index 29824a9..14ced00 100644
--- a/drivers/usb/host/ehci-sysfs.c
+++ b/drivers/usb/host/ehci-sysfs.c
@@ -74,21 +74,117 @@ static ssize_t store_companion(struct device *dev,
 }
 static DEVICE_ATTR(companion, 0644, show_companion, store_companion);
 
+
+/*
+ * Display / Set uframe_periodic_max
+ */
+static ssize_t show_uframe_periodic_max(struct device *dev,
+					struct device_attribute *attr,
+					char *buf)
+{
+	struct ehci_hcd		*ehci;
+	int			n;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	n = scnprintf(buf, PAGE_SIZE, "%d\n", ehci->uframe_periodic_max);
+	return n;
+}
+
+
+static ssize_t store_uframe_periodic_max(struct device *dev,
+					struct device_attribute *attr,
+					const char *buf, size_t count)
+{
+	struct ehci_hcd		*ehci;
+	unsigned		uframe_periodic_max;
+	unsigned		frame, uframe;
+	unsigned short		allocated_max;
+	unsigned long		flags;
+	ssize_t			ret;
+
+	ehci = hcd_to_ehci(bus_to_hcd(dev_get_drvdata(dev)));
+	if (kstrtouint(buf, 0, &uframe_periodic_max) < 0)
+		return -EINVAL;
+
+	if (uframe_periodic_max < 100 || uframe_periodic_max >= 125) {
+		ehci_info(ehci, "rejecting invalid request for "
+				"uframe_periodic_max=%u\n", uframe_periodic_max);
+		return -EINVAL;
+	}
+
+	ret = -EINVAL;
+
+	/*
+	 * lock, so that our checking does not race with possible periodic
+	 * bandwidth allocation through submitting new urbs.
+	 */
+	spin_lock_irqsave (&ehci->lock, flags);
+
+	/*
+	 * for request to decrease max periodic bandwidth, we have to check
+	 * every microframe in the schedule to see whether the decrease is
+	 * possible.
+	 */
+	if (uframe_periodic_max < ehci->uframe_periodic_max) {
+		allocated_max = 0;
+
+		for (frame = 0; frame < ehci->periodic_size; ++frame)
+			for (uframe = 0; uframe < 7; ++uframe)
+				allocated_max = max(allocated_max,
+						    periodic_usecs (ehci, frame, uframe));
+
+		if (allocated_max > uframe_periodic_max) {
+			ehci_info(ehci,
+				"cannot decrease uframe_periodic_max becase "
+				"periodic bandwidth is already allocated "
+				"(%u > %u)\n",
+				allocated_max, uframe_periodic_max);
+			goto out_unlock;
+		}
+	}
+
+	/* increasing is always ok */
+
+	ehci_info(ehci, "setting max periodic bandwidth to %u%% "
+			"(== %u usec/uframe)\n",
+			100*uframe_periodic_max/125, uframe_periodic_max);
+
+	if (uframe_periodic_max != 100)
+		ehci_warn(ehci, "max periodic bandwidth set is non-standard\n");
+
+	ehci->uframe_periodic_max = uframe_periodic_max;
+	ret = count;
+
+out_unlock:
+	spin_unlock_irqrestore (&ehci->lock, flags);
+	return ret;
+}
+static DEVICE_ATTR(uframe_periodic_max, 0644, show_uframe_periodic_max, store_uframe_periodic_max);
+
+
 static inline int create_sysfs_files(struct ehci_hcd *ehci)
 {
+	struct device	*controller = ehci_to_hcd(ehci)->self.controller;
 	int	i = 0;
 
 	/* with integrated TT there is no companion! */
 	if (!ehci_is_TDI(ehci))
-		i = device_create_file(ehci_to_hcd(ehci)->self.controller,
-				       &dev_attr_companion);
+		i = device_create_file(controller, &dev_attr_companion);
+	if (i)
+		goto out;
+
+	i = device_create_file(controller, &dev_attr_uframe_periodic_max);
+out:
 	return i;
 }
 
 static inline void remove_sysfs_files(struct ehci_hcd *ehci)
 {
+	struct device	*controller = ehci_to_hcd(ehci)->self.controller;
+
 	/* with integrated TT there is no companion! */
 	if (!ehci_is_TDI(ehci))
-		device_remove_file(ehci_to_hcd(ehci)->self.controller,
-				   &dev_attr_companion);
+		device_remove_file(controller, &dev_attr_companion);
+
+	device_remove_file(controller, &dev_attr_uframe_periodic_max);
 }
diff --git a/drivers/usb/host/ehci.h b/drivers/usb/host/ehci.h
index bd6ff48..fa3129f 100644
--- a/drivers/usb/host/ehci.h
+++ b/drivers/usb/host/ehci.h
@@ -87,6 +87,8 @@ struct ehci_hcd {			/* one per controller */
 	union ehci_shadow	*pshadow;	/* mirror hw periodic table */
 	int			next_uframe;	/* scan periodic, start here */
 	unsigned		periodic_sched;	/* periodic activity count */
+	unsigned		uframe_periodic_max; /* max periodic time per uframe */
+
 
 	/* list of itds & sitds completed while clock_frame was still active */
 	struct list_head	cached_itd_list;
-- 
1.7.6.rc3



From pj.assis at gmail.com  Mon Jul  4 11:22:53 2011
From: pj.assis at gmail.com (Paulo Assis)
Date: Mon, 4 Jul 2011 10:22:53 +0100
Subject: [Linux-uvc-devel] Logitech C270 mic problem
In-Reply-To: <CAE1CaMF=oF+6ybySiKHx2y0Liijc0P1R6Xv5+mex5pxO-jMaog@mail.gmail.com>
References: <CAE1CaMEG5GB_bK=XLSPWb0fRydpTz5hTc1keJ+wmBpk0gMd5Pg@mail.gmail.com>
	<CAE1CaMF=oF+6ybySiKHx2y0Liijc0P1R6Xv5+mex5pxO-jMaog@mail.gmail.com>
Message-ID: <CAPueXH5iJ9pEbqsT8=U-pU7ZdZ4qgV_gU+LeL7nqYPcvM7M7AA@mail.gmail.com>

Hi,
your camera mic is supported by the snd-usb-audio alsa driver (
http://alsa.opensrc.org/Usb-audio ), this is a totally different
driver and specification from uvcvideo (video only).

Anyway is the problem related to skype only or do other apps like
audacity, suffer from the same issues?

Regards,
Paulo


2011/7/3 George <grinder13 at gmail.com>:
> Hello all,
>
> Here is a problem with a Logitech C270 webcam and its mic: Quite often when
> I 'm on Skype (or Google talk) doing a video call, the mic suddenly goes
> off, so the other side can't here me. I have to kill Skype from the command
> line, unplug the camera, plug it back in and then load Skype again.
> Sometimes I have to do this 2 or 3 times in a raw until the mic comes back
> again. This happens only when I 'm doing video calls. When this happens I
> see the following message when doing a dmesg:
>
> cannot set freq 24000 to ep 0x86
>
> I also see similar messages when the Linux kernel is loading:
>
> cannot set freq 24000 to ep 0x86
> cannot set freq 32000 to ep 0x86
> cannot set freq 48000 to ep 0x86
>
> I purchased this webcam 6 months ago (sorry for not mailing the list
> earlier) and I noticed this behaviour from the very beginning I started
> using it, so it's not something noticed with the latest Linux kernel. I 'm
> using Debian Unstable with the Liquorix kernel, but it's the same with the
> official Debian kernels as well. This has also been reported in Arch Linux.
>
> I hope that the above information can help you to debug the problem. Please
> do tell me if I can do anything more. Thank you in advance for any response.
>
> Best regards,
> George P.
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
>


From bug-track at fisher-privat.net  Mon Jul  4 11:37:31 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 04 Jul 2011 11:37:31 +0200
Subject: [Linux-uvc-devel] Logitech C270 mic problem
In-Reply-To: <CAPueXH5iJ9pEbqsT8=U-pU7ZdZ4qgV_gU+LeL7nqYPcvM7M7AA@mail.gmail.com>
References: <CAE1CaMEG5GB_bK=XLSPWb0fRydpTz5hTc1keJ+wmBpk0gMd5Pg@mail.gmail.com>
	<CAE1CaMF=oF+6ybySiKHx2y0Liijc0P1R6Xv5+mex5pxO-jMaog@mail.gmail.com>
	<CAPueXH5iJ9pEbqsT8=U-pU7ZdZ4qgV_gU+LeL7nqYPcvM7M7AA@mail.gmail.com>
Message-ID: <1309772251.4026.4.camel@zwerg>

I have same problem with my Logitech Notebook Pro and on my friends
webcam too, but i just do not have time to research it. I'd say,
enabling video couse some delay in audio stream so pulseaudio hangs or
some thing like this. Normally i have this with skype, not with
google-talk, and it seems to depend on version of skype.

On Mo, 2011-07-04 at 10:22 +0100, Paulo Assis wrote:
> Hi,
> your camera mic is supported by the snd-usb-audio alsa driver (
> http://alsa.opensrc.org/Usb-audio ), this is a totally different
> driver and specification from uvcvideo (video only).
> 
> Anyway is the problem related to skype only or do other apps like
> audacity, suffer from the same issues?
> 
> Regards,
> Paulo
> 
> 
> 2011/7/3 George <grinder13 at gmail.com>:
> > Hello all,
> >
> > Here is a problem with a Logitech C270 webcam and its mic: Quite often when
> > I 'm on Skype (or Google talk) doing a video call, the mic suddenly goes
> > off, so the other side can't here me. I have to kill Skype from the command
> > line, unplug the camera, plug it back in and then load Skype again.
> > Sometimes I have to do this 2 or 3 times in a raw until the mic comes back
> > again. This happens only when I 'm doing video calls. When this happens I
> > see the following message when doing a dmesg:
> >
> > cannot set freq 24000 to ep 0x86
> >
> > I also see similar messages when the Linux kernel is loading:
> >
> > cannot set freq 24000 to ep 0x86
> > cannot set freq 32000 to ep 0x86
> > cannot set freq 48000 to ep 0x86
> >
> > I purchased this webcam 6 months ago (sorry for not mailing the list
> > earlier) and I noticed this behaviour from the very beginning I started
> > using it, so it's not something noticed with the latest Linux kernel. I 'm
> > using Debian Unstable with the Liquorix kernel, but it's the same with the
> > official Debian kernels as well. This has also been reported in Arch Linux.
> >
> > I hope that the above information can help you to debug the problem. Please
> > do tell me if I can do anything more. Thank you in advance for any response.
> >
> > Best regards,
> > George P.
> >
> >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> >
> >
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel

-- 
Regards,
        Alexey



From T.Maguin at web.de  Mon Jul  4 23:11:30 2011
From: T.Maguin at web.de (piewie)
Date: Mon, 4 Jul 2011 23:11:30 +0200
Subject: [Linux-uvc-devel] ID 1871:0101 Aveo Technology Corp.
Message-ID: <201107042311.30484.T.Maguin@web.de>

Hello,

I have a Bresser "USB Microscope Digital". It is flawlessly working here on 
gentoo with 2.6.39-gentoo-r1, uvcvideo and guvcvideo - even the snapshot 
button on the microscope is useable.

Thank You very much for your work.

Thomas


ID 1871:0101 Aveo Technology Corp. 
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass          239 Miscellaneous Device
  bDeviceSubClass         2 ?
  bDeviceProtocol         1 Interface Association
  bMaxPacketSize0        64
  idVendor           0x1871 Aveo Technology Corp.
  idProduct          0x0101 
  bcdDevice            0.0c
  iManufacturer           1 AVEO Technology Corp.
  iProduct                2 USB2.0 Camera
  iSerial                 0 
  bNumConfigurations      1
  Configuration Descriptor:
    bLength                 9
    bDescriptorType         2
    wTotalLength          419
    bNumInterfaces          2
    bConfigurationValue     1
    iConfiguration          0 
    bmAttributes         0x80
      (Bus Powered)
    MaxPower              500mA
    Interface Association:
      bLength                 8
      bDescriptorType        11
      bFirstInterface         0
      bInterfaceCount         2
      bFunctionClass         14 Video
      bFunctionSubClass       3 Video Interface Collection
      bFunctionProtocol       0 
      iFunction               2 USB2.0 Camera
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        0
      bAlternateSetting       0
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      1 Video Control
      bInterfaceProtocol      0 
      iInterface              2 USB2.0 Camera
      VideoControl Interface Descriptor:
        bLength                13
        bDescriptorType        36
        bDescriptorSubtype      1 (HEADER)
        bcdUVC               1.00
        wTotalLength           77
        dwClockFrequency       30.000000MHz
        bInCollection           1
        baInterfaceNr( 0)       1
      VideoControl Interface Descriptor:
        bLength                18
        bDescriptorType        36
        bDescriptorSubtype      2 (INPUT_TERMINAL)
        bTerminalID             1
        wTerminalType      0x0201 Camera Sensor
        bAssocTerminal          0
        iTerminal               0 
        wObjectiveFocalLengthMin      0
        wObjectiveFocalLengthMax      0
        wOcularFocalLength            0
        bControlSize                  3
        bmControls           0x00000000
      VideoControl Interface Descriptor:
        bLength                 9
        bDescriptorType        36
        bDescriptorSubtype      3 (OUTPUT_TERMINAL)
        bTerminalID             2
        wTerminalType      0x0101 USB Streaming
        bAssocTerminal          0
        bSourceID               4
        iTerminal               0 
      VideoControl Interface Descriptor:
        bLength                11
        bDescriptorType        36
        bDescriptorSubtype      5 (PROCESSING_UNIT)
      Warning: Descriptor too short
        bUnitID                 3
        bSourceID               1
        wMaxMultiplier          0
        bControlSize            2
        bmControls     0x0000053b
          Brightness
          Contrast
          Saturation
          Sharpness
          Gamma
          Backlight Compensation
          Power Line Frequency
        iProcessing             0 
        bmVideoStandards     0x1a
          NTSC - 525/60
          SECAM - 625/50
          NTSC - 625/50
      VideoControl Interface Descriptor:
        bLength                26
        bDescriptorType        36
        bDescriptorSubtype      6 (EXTENSION_UNIT)
        bUnitID                 4
        guidExtensionCode         {52f2b8aa-d18e-7249-8ced-96b17f04408b}
        bNumControl             1
        bNrPins                 1
        baSourceID( 0)          3
        bControlSize            1
        bmControls( 0)       0x01
        iExtension              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x85  EP 5 IN
        bmAttributes            3
          Transfer Type            Interrupt
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0040  1x 64 bytes
        bInterval               7
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       0
      bNumEndpoints           0
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0 
      iInterface              0 
      VideoStreaming Interface Descriptor:
        bLength                            14
        bDescriptorType                    36
        bDescriptorSubtype                  1 (INPUT_HEADER)
        bNumFormats                         1
        wTotalLength                      215
        bEndPointAddress                  131
        bmInfo                              0
        bTerminalLink                       2
        bStillCaptureMethod                 2
        bTriggerSupport                     1
        bTriggerUsage                       0
        bControlSize                        1
        bmaControls( 0)                    27
      VideoStreaming Interface Descriptor:
        bLength                            27
        bDescriptorType                    36
        bDescriptorSubtype                  4 (FORMAT_UNCOMPRESSED)
        bFormatIndex                        1
        bNumFrameDescriptors                5
        guidFormat                            
{59555932-0000-1000-8000-00aa00389b71}
        bBitsPerPixel                      16
        bDefaultFrameIndex                  1
        bAspectRatioX                       0
        bAspectRatioY                       0
        bmInterlaceFlags                 0x00
          Interlaced stream or variable: No
          Fields per frame: 2 fields
          Field 1 first: No
          Field pattern: Field 1 only
          bCopyProtect                      0
      VideoStreaming Interface Descriptor:
        bLength                            30
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         1
        bmCapabilities                   0x00
          Still image unsupported
        wWidth                            640
        wHeight                           480
        dwMinBitRate                147456000
        dwMaxBitRate                147456000
        dwMaxVideoFrameBufferSize      614400
        dwDefaultFrameInterval         333333
        bFrameIntervalType                  1
        dwFrameInterval( 0)            333333
      VideoStreaming Interface Descriptor:
        bLength                            30
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         2
        bmCapabilities                   0x00
          Still image unsupported
        wWidth                            160
        wHeight                           120
        dwMinBitRate                  9216000
        dwMaxBitRate                  9216000
        dwMaxVideoFrameBufferSize       38400
        dwDefaultFrameInterval         333333
        bFrameIntervalType                  1
        dwFrameInterval( 0)            333333
      VideoStreaming Interface Descriptor:
        bLength                            30
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         3
        bmCapabilities                   0x00
          Still image unsupported
        wWidth                            320
        wHeight                           240
        dwMinBitRate                 36864000
        dwMaxBitRate                 36864000
        dwMaxVideoFrameBufferSize      153600
        dwDefaultFrameInterval         333333
        bFrameIntervalType                  1
        dwFrameInterval( 0)            333333
      VideoStreaming Interface Descriptor:
        bLength                            30
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         4
        bmCapabilities                   0x00
          Still image unsupported
        wWidth                            176
        wHeight                           144
        dwMinBitRate                 12165120
        dwMaxBitRate                 12165120
        dwMaxVideoFrameBufferSize       50688
        dwDefaultFrameInterval         333333
        bFrameIntervalType                  1
        dwFrameInterval( 0)            333333
      VideoStreaming Interface Descriptor:
        bLength                            30
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         5
        bmCapabilities                   0x00
          Still image unsupported
        wWidth                            352
        wHeight                           288
        dwMinBitRate                 48660480
        dwMaxBitRate                 48660480
        dwMaxVideoFrameBufferSize      202752
        dwDefaultFrameInterval         333333
        bFrameIntervalType                  1
        dwFrameInterval( 0)            333333
      VideoStreaming Interface Descriptor:
        bLength                            18
        bDescriptorType                    36
        bDescriptorSubtype                  3 (STILL_IMAGE_FRAME)
        bEndpointAddress                    0
        bNumImageSizePatterns               3
        wWidth( 0)                        640
        wHeight( 0)                       480
        wWidth( 1)                        320
        wHeight( 1)                       240
        wWidth( 2)                        160
        wHeight( 2)                       120
        bNumCompressionPatterns             3
      VideoStreaming Interface Descriptor:
        bLength                             6
        bDescriptorType                    36
        bDescriptorSubtype                 13 (COLORFORMAT)
        bColorPrimaries                     1 (BT.709,sRGB)
        bTransferCharacteristics            1 (BT.709)
        bMatrixCoefficients                 4 (SMPTE 170M (BT.601))
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       1
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0 
      iInterface              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            5
          Transfer Type            Isochronous
          Synch Type               Asynchronous
          Usage Type               Data
        wMaxPacketSize     0x020c  1x 524 bytes
        bInterval               1
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       2
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0 
      iInterface              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            5
          Transfer Type            Isochronous
          Synch Type               Asynchronous
          Usage Type               Data
        wMaxPacketSize     0x030c  1x 780 bytes
        bInterval               1
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       3
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0 
      iInterface              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            5
          Transfer Type            Isochronous
          Synch Type               Asynchronous
          Usage Type               Data
        wMaxPacketSize     0x03fc  1x 1020 bytes
        bInterval               1
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       4
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0 
      iInterface              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            5
          Transfer Type            Isochronous
          Synch Type               Asynchronous
          Usage Type               Data
        wMaxPacketSize     0x0bfc  2x 1020 bytes
        bInterval               1
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       5
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0 
      iInterface              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            5
          Transfer Type            Isochronous
          Synch Type               Asynchronous
          Usage Type               Data
        wMaxPacketSize     0x13fc  3x 1020 bytes
        bInterval               1
Device Qualifier (for other device speed):
  bLength                10
  bDescriptorType         6
  bcdUSB               2.00
  bDeviceClass          239 Miscellaneous Device
  bDeviceSubClass         2 ?
  bDeviceProtocol         1 Interface Association
  bMaxPacketSize0        64
  bNumConfigurations      1
Device Status:     0x0000
  (Bus Powered)


From grinder13 at gmail.com  Tue Jul  5 00:20:21 2011
From: grinder13 at gmail.com (George)
Date: Mon, 4 Jul 2011 23:20:21 +0100
Subject: [Linux-uvc-devel] Logitech C270 mic problem
In-Reply-To: <1309772251.4026.4.camel@zwerg>
References: <CAE1CaMEG5GB_bK=XLSPWb0fRydpTz5hTc1keJ+wmBpk0gMd5Pg@mail.gmail.com>
	<CAE1CaMF=oF+6ybySiKHx2y0Liijc0P1R6Xv5+mex5pxO-jMaog@mail.gmail.com>
	<CAPueXH5iJ9pEbqsT8=U-pU7ZdZ4qgV_gU+LeL7nqYPcvM7M7AA@mail.gmail.com>
	<1309772251.4026.4.camel@zwerg>
Message-ID: <CAE1CaMEVcYcdXDOyfiTDhC87f9swfohnbHOq+u6gdLqmBWVB4g@mail.gmail.com>

Hello Paulo,

As I said in my original email, the problem appears with video calls (Skype
or Google Talk). When it's a simple VoIP call I don't experience this
problem. I haven't tried with applications like Audacity. I should also add
that there was no PulseAudio layer in between (I say was, because today I
just switched to OpenSuse 11.4 after many years with Debian Unstable). If
you feel that it's not a uvcvideo problem then I can inform the usb alsa
devs.

Regards,
George P.


On Mon, Jul 4, 2011 at 10:37 AM, Alexey Fisher
<bug-track at fisher-privat.net>wrote:

> I have same problem with my Logitech Notebook Pro and on my friends
> webcam too, but i just do not have time to research it. I'd say,
> enabling video couse some delay in audio stream so pulseaudio hangs or
> some thing like this. Normally i have this with skype, not with
> google-talk, and it seems to depend on version of skype.
>
> On Mo, 2011-07-04 at 10:22 +0100, Paulo Assis wrote:
> > Hi,
> > your camera mic is supported by the snd-usb-audio alsa driver (
> > http://alsa.opensrc.org/Usb-audio ), this is a totally different
> > driver and specification from uvcvideo (video only).
> >
> > Anyway is the problem related to skype only or do other apps like
> > audacity, suffer from the same issues?
> >
> > Regards,
> > Paulo
> >
> >
> > 2011/7/3 George <grinder13 at gmail.com>:
> > > Hello all,
> > >
> > > Here is a problem with a Logitech C270 webcam and its mic: Quite often
> when
> > > I 'm on Skype (or Google talk) doing a video call, the mic suddenly
> goes
> > > off, so the other side can't here me. I have to kill Skype from the
> command
> > > line, unplug the camera, plug it back in and then load Skype again.
> > > Sometimes I have to do this 2 or 3 times in a raw until the mic comes
> back
> > > again. This happens only when I 'm doing video calls. When this happens
> I
> > > see the following message when doing a dmesg:
> > >
> > > cannot set freq 24000 to ep 0x86
> > >
> > > I also see similar messages when the Linux kernel is loading:
> > >
> > > cannot set freq 24000 to ep 0x86
> > > cannot set freq 32000 to ep 0x86
> > > cannot set freq 48000 to ep 0x86
> > >
> > > I purchased this webcam 6 months ago (sorry for not mailing the list
> > > earlier) and I noticed this behaviour from the very beginning I started
> > > using it, so it's not something noticed with the latest Linux kernel. I
> 'm
> > > using Debian Unstable with the Liquorix kernel, but it's the same with
> the
> > > official Debian kernels as well. This has also been reported in Arch
> Linux.
> > >
> > > I hope that the above information can help you to debug the problem.
> Please
> > > do tell me if I can do anything more. Thank you in advance for any
> response.
> > >
> > > Best regards,
> > > George P.
> > >
> > >
> > > _______________________________________________
> > > Linux-uvc-devel mailing list
> > > Linux-uvc-devel at lists.berlios.de
> > > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> > >
> > >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
> --
> Regards,
>         Alexey
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110704/f96e2748/attachment.html>

From hagar at iinet.net.au  Tue Jul  5 11:23:03 2011
From: hagar at iinet.net.au (hagar)
Date: Tue, 05 Jul 2011 17:23:03 +0800
Subject: [Linux-uvc-devel] ID 1871:0101 Aveo Technology Corp.
In-Reply-To: <201107042311.30484.T.Maguin@web.de>
References: <201107042311.30484.T.Maguin@web.de>
Message-ID: <4E12D7F7.9030807@iinet.net.au>

Which Bresser Digital Microscope is it?
What Image sizes does the specifications say and can you get them under 
linux ?

On 07/05/2011 05:11 AM, piewie wrote:
> Hello,
>
> I have a Bresser "USB Microscope Digital". It is flawlessly working here on
> gentoo with 2.6.39-gentoo-r1, uvcvideo and guvcvideo - even the snapshot
> button on the microscope is useable.
>
> Thank You very much for your work.
>
> Thomas
>
>
> ID 1871:0101 Aveo Technology Corp.
> Device Descriptor:
>    bLength                18
>    bDescriptorType         1
>    bcdUSB               2.00
>    bDeviceClass          239 Miscellaneous Device
>    bDeviceSubClass         2 ?
>    bDeviceProtocol         1 Interface Association
>    bMaxPacketSize0        64
>    idVendor           0x1871 Aveo Technology Corp.
>    idProduct          0x0101
>    bcdDevice            0.0c
>    iManufacturer           1 AVEO Technology Corp.
>    iProduct                2 USB2.0 Camera
>    iSerial                 0
>    bNumConfigurations      1
>    Configuration Descriptor:



From macsmith.us at gmail.com  Tue Jul  5 12:01:33 2011
From: macsmith.us at gmail.com (Mac Smith)
Date: Tue, 5 Jul 2011 15:31:33 +0530
Subject: [Linux-uvc-devel] Green Image
Message-ID: <358D66A6-9583-4782-88EE-AA38F498DAF8@gmail.com>

Hi,


I am getting a green image when i capture it using vgrabbj.

# vgrabbj -d /dev/video0 -f /var/www/webcam2.jpeg -D 7 -i vga

Set option ImageSize to value 640 (value: vga)
Set option ImageSize to value 480 (value: vga)
Updated pointers to new allocated memory.
Done parsing commandline
Setting tmpout file to /var/www/webcam2.jpeg.tmp
Device /dev/video0 successfully opened
Checking settings of device /dev/video0
Set palette successfully to YUYV
Initializing memory
Memory initialized, size: 614400 (in), 921600 (out)
Reading image from /dev/video0
Palette to be used: YUYV (8), size: 614400
Could not get mmap-buffer - Falling back to read()
Using normal read for image grabbing
Image successfully read
Got YUYV, converting...
converted to RGB24
Temporary outputfile /var/www/webcam2.jpeg.tmp closed
Temporary output /var/www/webcam2.jpeg.tmp moved to final destination /var/www/webcam2.jpeg
Updated pointers to new allocated memory.
There was no map allocated to be freed...
Device /dev/video0 closed
Buffers freed
vars freed


Image: http://flic.kr/p/9ZLRNb

From T.Maguin at web.de  Wed Jul  6 22:00:36 2011
From: T.Maguin at web.de (piewie)
Date: Wed, 6 Jul 2011 22:00:36 +0200
Subject: [Linux-uvc-devel] ID 1871:0101 Aveo Technology Corp.
In-Reply-To: <4E12D7F7.9030807@iinet.net.au>
References: <201107042311.30484.T.Maguin@web.de>
	<4E12D7F7.9030807@iinet.net.au>
Message-ID: <201107062200.36148.T.Maguin@web.de>

link to the microscope:
http://www.lidl.de/de/Lernspass-von-A-Z-ab-04-07-/BRESSER-Digitales-USB-
Mikroskop

resolutions supported by guvcview: 
640x480
160x120
320x240
176x144
372x288




On Tuesday, July 05, 2011 11:23:03 AM hagar wrote:
> Which Bresser Digital Microscope is it?
> What Image sizes does the specifications say and can you get them under
> linux ?
> 
> On 07/05/2011 05:11 AM, piewie wrote:
> > Hello,
> > 
> > I have a Bresser "USB Microscope Digital". It is flawlessly working here
> > on gentoo with 2.6.39-gentoo-r1, uvcvideo and guvcvideo - even the
> > snapshot button on the microscope is useable.
> > 
> > Thank You very much for your work.
> > 
> > Thomas
> > 
> > 
> > ID 1871:0101 Aveo Technology Corp.
> > 
> > Device Descriptor:
> >    bLength                18
> >    bDescriptorType         1
> >    bcdUSB               2.00
> >    bDeviceClass          239 Miscellaneous Device
> >    bDeviceSubClass         2 ?
> >    bDeviceProtocol         1 Interface Association
> >    bMaxPacketSize0        64
> >    idVendor           0x1871 Aveo Technology Corp.
> >    idProduct          0x0101
> >    bcdDevice            0.0c
> >    iManufacturer           1 AVEO Technology Corp.
> >    iProduct                2 USB2.0 Camera
> >    iSerial                 0
> >    bNumConfigurations      1
> 
> >    Configuration Descriptor:
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From hagar at iinet.net.au  Thu Jul  7 08:23:53 2011
From: hagar at iinet.net.au (hagar)
Date: Thu, 07 Jul 2011 14:23:53 +0800
Subject: [Linux-uvc-devel] ID 1871:0101 Aveo Technology Corp.
In-Reply-To: <201107062200.36148.T.Maguin@web.de>
References: <201107042311.30484.T.Maguin@web.de>	<4E12D7F7.9030807@iinet.net.au>
	<201107062200.36148.T.Maguin@web.de>
Message-ID: <4E1550F9.9030905@iinet.net.au>

Thanx - I was just wondering if it was similar to the one that I was 
having trouble with

On 07/07/2011 04:00 AM, piewie wrote:
> link to the microscope:
> http://www.lidl.de/de/Lernspass-von-A-Z-ab-04-07-/BRESSER-Digitales-USB-
> Mikroskop
>
> resolutions supported by guvcview:
> 640x480
> 160x120
> 320x240
> 176x144
> 372x288
>
>
>
>
> On Tuesday, July 05, 2011 11:23:03 AM hagar wrote:
>> Which Bresser Digital Microscope is it?
>> What Image sizes does the specifications say and can you get them under
>> linux ?
>>
>> On 07/05/2011 05:11 AM, piewie wrote:
>>> Hello,
>>>
>>> I have a Bresser "USB Microscope Digital". It is flawlessly working here
>>> on gentoo with 2.6.39-gentoo-r1, uvcvideo and guvcvideo - even the
>>> snapshot button on the microscope is useable.
>>>
>>> Thank You very much for your work.
>>>
>>> Thomas
>>>
>>>
>>> ID 1871:0101 Aveo Technology Corp.
>>>
>>> Device Descriptor:
>>>     bLength                18
>>>     bDescriptorType         1
>>>     bcdUSB               2.00
>>>     bDeviceClass          239 Miscellaneous Device
>>>     bDeviceSubClass         2 ?
>>>     bDeviceProtocol         1 Interface Association
>>>     bMaxPacketSize0        64
>>>     idVendor           0x1871 Aveo Technology Corp.
>>>     idProduct          0x0101
>>>     bcdDevice            0.0c
>>>     iManufacturer           1 AVEO Technology Corp.
>>>     iProduct                2 USB2.0 Camera
>>>     iSerial                 0
>>>     bNumConfigurations      1
>>>     Configuration Descriptor:
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>



From toshonn at yahoo.com  Sat Jul  9 08:32:38 2011
From: toshonn at yahoo.com (Todor Nickolov)
Date: Fri, 8 Jul 2011 23:32:38 -0700 (PDT)
Subject: [Linux-uvc-devel] New UVC device
Message-ID: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>

Hello,

I have got a device working with the UVC driver and not listed in the table of known devices.

Device ID: 041e:4071
Name: Creative Live! Cam Video IM Ultra (according to usb driver - Product: VF0415 Live! Cam Vid. IM Ultra)

Manufacturer: Creative Technology Ltd. (Creative Labs?)

Kernel version: 2.6.37.6

If any other information is needed, please let me know.

Best regards,
Todor
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110708/4f6b753f/attachment.html>

From aab at cichlid.com  Sat Jul  9 16:32:42 2011
From: aab at cichlid.com (Andrew Burgess)
Date: Sat, 09 Jul 2011 07:32:42 -0700
Subject: [Linux-uvc-devel] New UVC device
In-Reply-To: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>
	(from toshonn@yahoo.com on Fri Jul  8 23:32:38 2011)
References: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>
Message-ID: <1310221962.6544.35@hogo>

On 07/08/2011 11:32:38 PM, Todor Nickolov wrote:

> I have got a device working with the UVC driver and not listed in the
> table of known devices.
> 
> 
> Device ID: 041e:4071
> Name: Creative Live! Cam Video IM Ultra (according to usb driver -
> Product: VF0415 Live! Cam Vid. IM Ultra)

> If any other information is needed, please let me know.

curious if it does mjpeg and at what resolutions


From deroussel at gmail.com  Mon Jul 11 20:26:48 2011
From: deroussel at gmail.com (Denis Roussel)
Date: Mon, 11 Jul 2011 20:26:48 +0200
Subject: [Linux-uvc-devel]  Looking for upside down uvc cams
In-Reply-To: <CABNuf87BA+P+pcRfA-etAG-fN+W29u-rF+jy9Ji+svpM8D30eA@mail.gmail.com>
References: <CABNuf87BA+P+pcRfA-etAG-fN+W29u-rF+jy9Ji+svpM8D30eA@mail.gmail.com>
Message-ID: <CABNuf87EYEi6UaEqgJ30d3LXMQRc-2aVZskCV=TFb2Ad_ScE_Q@mail.gmail.com>

Hi,

I have the upside-down issue. I tried to reload the driver using "modprobe
uvcvideo quirks=vflip=1 trace=vflip=1" that I found on Internet but I have
an error in respond.
I join you the logs.
Thank for all you've down and all you'll do.

Best regards

Denis Roussel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110711/0c09b333/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lsusb.log
Type: text/x-log
Size: 393 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110711/0c09b333/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmi.log
Type: text/x-log
Size: 21778 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110711/0c09b333/attachment-0001.bin>

From kirr at mns.spb.ru  Tue Jul 12 10:58:52 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Tue, 12 Jul 2011 12:58:52 +0400
Subject: [Linux-uvc-devel] [PATCH] uvcvideo: Add FIX_BANDWIDTH quirk to
	HP Webcam found	on HP Mini 5103 netbook
In-Reply-To: <1308679663-11431-1-git-send-email-kirr@mns.spb.ru>
References: <1308679663-11431-1-git-send-email-kirr@mns.spb.ru>
Message-ID: <20110712085852.GA12576@tugrik.mns.mnsspb.ru>

On Tue, Jun 21, 2011 at 10:07:43PM +0400, Kirill Smelkov wrote:
> The camera there identifeis itself as being manufactured by Cheng Uei
> Precision Industry Co., Ltd (Foxlink), and product is titled as "HP
> Webcam [2 MP Fixed]".
> 
> I was trying to get 2 USB video capture devices to work simultaneously,
> and noticed that the above mentioned webcam always requires packet size
> = 3072 bytes per micro frame (~= 23.4 MB/s isoc bandwidth), which is far
> more than enough to get standard NTSC 640x480x2x30 = ~17.6 MB/s isoc
> bandwidth.
> 
> As there are alt interfaces with smaller MxPS
> 
>     T:  Bus=01 Lev=01 Prnt=01 Port=03 Cnt=01 Dev#=  2 Spd=480  MxCh= 0
>     D:  Ver= 2.00 Cls=ef(misc ) Sub=02 Prot=01 MxPS=64 #Cfgs=  1
>     P:  Vendor=05c8 ProdID=0403 Rev= 1.06
>     S:  Manufacturer=Foxlink
>     S:  Product=HP Webcam [2 MP Fixed]
>     S:  SerialNumber=200909240102
>     C:* #Ifs= 2 Cfg#= 1 Atr=80 MxPwr=500mA
>     A:  FirstIf#= 0 IfCount= 2 Cls=0e(video) Sub=03 Prot=00
>     I:* If#= 0 Alt= 0 #EPs= 1 Cls=0e(video) Sub=01 Prot=00 Driver=uvcvideo
>     E:  Ad=83(I) Atr=03(Int.) MxPS=  16 Ivl=4ms
>     I:* If#= 1 Alt= 0 #EPs= 0 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     I:  If#= 1 Alt= 1 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS= 128 Ivl=125us
>     I:  If#= 1 Alt= 2 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS= 512 Ivl=125us
>     I:  If#= 1 Alt= 3 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=1024 Ivl=125us
>     I:  If#= 1 Alt= 4 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=1536 Ivl=125us
>     I:  If#= 1 Alt= 5 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=2048 Ivl=125us
>     I:  If#= 1 Alt= 6 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=2688 Ivl=125us
>     I:  If#= 1 Alt= 7 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=3072 Ivl=125us
> 
> UVC_QUIRK_FIX_BANDWIDTH helps here and NTSC video can be served with
> MxPS=2688 i.e. 20.5 MB/s isoc bandwidth.
> 
> In terms of microframe time allocation, before the quirk NTSC video
> required 60 usecs / microframe and 53 usecs / microframe after.
> 
> 
> P.S. Now with tweaked ehci-hcd to allow up to 90% isoc bandwith (instead of
> allowed for high speed 80%) I can capture two video sources -- PAL 720x576
> YUV422 @25fps + NTSC 640x480 YUV422 @30fps simultaneously. Hooray!
> 
> Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>


Silence...  though even the above-mentioned EHCI tweak was merged already:

http://git.kernel.org/?p=linux/kernel/git/gregkh/usb-2.6.git;a=commitdiff;h=cc62a7eb6396e8be95b9a30053ed09191818b99b


Hope this patch is not lost and thanks,
Kirill


From jvpeetz at web.de  Wed Jul 13 10:59:59 2011
From: jvpeetz at web.de (=?ISO-8859-1?Q?J=F6rg-Volker_Peetz?=)
Date: Wed, 13 Jul 2011 10:59:59 +0200
Subject: [Linux-uvc-devel] Two new supported UVC compliant video input
	devices
Message-ID: <4E1D5E8F.3090702@web.de>

Dear Laurent Pinchart,

thank you very much for your work on the UVC driver.
Recently, we got two HP laptops with built-in camera. Using a self-compiled
kernel (2.6.39.3) on a Debian testing/sid system the cameras work using the UVC
driver. Tested with the programs mplayer and guvcview.
The devices are reported as

 064e:f209   SuYin     HP Webcam
  (HP Pavilion dv7-4152eg; output of lsusb in attachment lsusb-v-d-HP_Webcam)

 0bda:5801   Realtek   2SF022
  (HP Pavilion dv7-4151sg; output of lsusb in attachment lsusb-v-d-2SF022)

-- 
Best regards,
J?rg-Volker.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lsusb-v-d-HP_Webcam
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110713/53a1b9b6/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lsusb-v-d-2SF022
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110713/53a1b9b6/attachment-0001.ksh>

From member at linkedin.com  Tue Jul 19 11:01:00 2011
From: member at linkedin.com (Laurent Pinchart via LinkedIn)
Date: Tue, 19 Jul 2011 09:01:00 +0000 (UTC)
Subject: [Linux-uvc-devel] Invitation to connect on LinkedIn
Message-ID: <569891750.9913028.1311066060322.JavaMail.app@ela4-bed79.prod>

LinkedIn Invitations

Laurent Pinchart wrote:
-------------------------------------------
* RE: Invitation to connect on LinkedIn

Hi Liu,

On 07/19/11 12:51 AM, Liu Jaloo wrote:
>
> Laurent,
>
> I'd like to add you to my professional network on LinkedIn.

My memory might be playing tricks on me, but have we worked together ?

Laurent Pinchart
-------------------------------------------

Reply to Laurent Pinchart:
http://www.linkedin.com/e/2d8m4g-gqamvqjk-65/YhLeBtiJ1S_RPnQZ02mJgWFyYP4RYKjG0EhEfiqeMY29FTi7/blk/I134231218_13/3cNnPwNcz4PczgPckALpn9JbOYWrSlI/mre/
If you wish to change how you receive future LinkedIn invitation notifications, please click here:
http://www.linkedin.com/e/2d8m4g-gqamvqjk-65/YhLeBtiJ1S_RPnQZ02mJgWFyYP4RYKjG0EhEfiqeMY29FTi7/blk/I134231218_13/sS9xbOYWrSlI/abs/

If you have any questions, please contact customer_service at linkedin.com.

 
-- 
(c) 2011, LinkedIn Corporation
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110719/66978507/attachment.html>

From kirr at mns.spb.ru  Fri Jul 22 16:47:22 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Fri, 22 Jul 2011 18:47:22 +0400
Subject: [Linux-uvc-devel] [PATCH,
	RESEND] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam	found on HP
	Mini 5103 netbook
Message-ID: <20110722144722.GA3717@tugrik.mns.mnsspb.ru>

 [ Cc'ing Andrew Morton -- Andrew, could you please pick this patch, in
   case there is no response from maintainers again? Thanks beforehand. ]


Hello up there,

My first posting was 1 month ago, and a reminder ~ 2 weeks ago. All
without a reply. v3.0 is out and they say the merge window will be
shorter this time, so in oder not to miss it, I've decided to resend my
patch on lowering USB periodic bandwidth allocation topic. 


Could this simple patch be please applied?

Thanks,
Kirill


P.S.

Referenced in the description cc62a7eb (USB: EHCI: Allow users to
override 80% max periodic bandwidth) will be entering the mainline via
Greg's usb tree.

---- 8< ----
From: Kirill Smelkov <kirr at mns.spb.ru>
Subject: [PATCH] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam found on HP Mini 5103 netbook

The camera there identifies itself as being manufactured by Cheng Uei
Precision Industry Co., Ltd (Foxlink), and product is titled as "HP
Webcam [2 MP Fixed]".

I was trying to get 2 USB video capture devices to work simultaneously,
and noticed that the above mentioned webcam always requires packet size
= 3072 bytes per micro frame (~= 23.4 MB/s isoc bandwidth), which is far
more than enough to get standard NTSC 640x480x2x30 = ~17.6 MB/s isoc
bandwidth.

As there are alt interfaces with smaller MxPS

    T:  Bus=01 Lev=01 Prnt=01 Port=03 Cnt=01 Dev#=  2 Spd=480  MxCh= 0
    D:  Ver= 2.00 Cls=ef(misc ) Sub=02 Prot=01 MxPS=64 #Cfgs=  1
    P:  Vendor=05c8 ProdID=0403 Rev= 1.06
    S:  Manufacturer=Foxlink
    S:  Product=HP Webcam [2 MP Fixed]
    S:  SerialNumber=200909240102
    C:* #Ifs= 2 Cfg#= 1 Atr=80 MxPwr=500mA
    A:  FirstIf#= 0 IfCount= 2 Cls=0e(video) Sub=03 Prot=00
    I:* If#= 0 Alt= 0 #EPs= 1 Cls=0e(video) Sub=01 Prot=00 Driver=uvcvideo
    E:  Ad=83(I) Atr=03(Int.) MxPS=  16 Ivl=4ms
    I:* If#= 1 Alt= 0 #EPs= 0 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    I:  If#= 1 Alt= 1 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS= 128 Ivl=125us
    I:  If#= 1 Alt= 2 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS= 512 Ivl=125us
    I:  If#= 1 Alt= 3 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS=1024 Ivl=125us
    I:  If#= 1 Alt= 4 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS=1536 Ivl=125us
    I:  If#= 1 Alt= 5 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS=2048 Ivl=125us
    I:  If#= 1 Alt= 6 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS=2688 Ivl=125us
    I:  If#= 1 Alt= 7 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
    E:  Ad=81(I) Atr=05(Isoc) MxPS=3072 Ivl=125us

UVC_QUIRK_FIX_BANDWIDTH helps here and NTSC video can be served with
MxPS=2688 i.e. 20.5 MB/s isoc bandwidth.

In terms of microframe time allocation, before the quirk NTSC video
required 60 usecs / microframe and 53 usecs / microframe after.


P.S.

Now with tweaked ehci-hcd to allow up to 90% isoc bandwidth (cc62a7eb
"USB: EHCI: Allow users to override 80% max periodic bandwidth") I can
capture two video sources -- PAL 720x576 YUV422 @25fps + NTSC 640x480
YUV422 @30fps simultaneously.  Hooray!

Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>
---
 drivers/media/video/uvc/uvc_driver.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/drivers/media/video/uvc/uvc_driver.c b/drivers/media/video/uvc/uvc_driver.c
index b6eae48..f633700 100644
--- a/drivers/media/video/uvc/uvc_driver.c
+++ b/drivers/media/video/uvc/uvc_driver.c
@@ -2130,6 +2130,15 @@ static struct usb_device_id uvc_ids[] = {
 	  .bInterfaceProtocol	= 0,
 	  .driver_info 		= UVC_QUIRK_PROBE_MINMAX
 				| UVC_QUIRK_BUILTIN_ISIGHT },
+	/* Foxlink ("HP Webcam" on HP Mini 5103) */
+	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
+				| USB_DEVICE_ID_MATCH_INT_INFO,
+	  .idVendor		= 0x05c8,
+	  .idProduct		= 0x0403,
+	  .bInterfaceClass	= USB_CLASS_VIDEO,
+	  .bInterfaceSubClass	= 1,
+	  .bInterfaceProtocol	= 0,
+	  .driver_info		= UVC_QUIRK_FIX_BANDWIDTH },
 	/* Genesys Logic USB 2.0 PC Camera */
 	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
 				| USB_DEVICE_ID_MATCH_INT_INFO,
-- 
1.7.6.rc1



From overclocked at yandex.ru  Fri Jul 22 22:12:04 2011
From: overclocked at yandex.ru (overclocked)
Date: Fri, 22 Jul 2011 22:12:04 +0200
Subject: [Linux-uvc-devel] 05c8:0403 Cheng Uei Precision Industry Co.,
	Ltd (Foxlink)
Message-ID: <4E29D994.8020407@yandex.ru>

Dear ladies and gentlemen.

I'm writing to You because it was recommended on 
http://www.ideasonboard.org/uvc/#devices, if the device is not listed.

So I have a "05c8:0403 Cheng Uei Precision Industry Co., Ltd (Foxlink)" 
web cam in my HP 4720s laptop and it's not working or working very bad 
in Ubuntu 11.04...

If you google it, it's used not only in this laptop and not only in HP 
laptops...

Even if it works, every 5-10 seconds video stops in Skype and I need to 
restart it.

Sometimes it even does not start at all:(

Also time to time I have a problem with /var/log/uvcdynctrl-udev.log 
file - it uses all space available on the system - see 
https://bugs.launchpad.net/ubuntu/+source/libwebcam/+bug/811604

I would be pleasured if You can provide me any help...
Thank You in advance,
Kind Regards,

-- 
Andrey Sapegin,

PhD Student,
University of Leipzig,
Software Developer,
Unister GmbH,
+4915778339304,
andrey at sapegin.org.



From kirr at mns.spb.ru  Fri Jul 22 22:39:11 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sat, 23 Jul 2011 00:39:11 +0400
Subject: [Linux-uvc-devel] 05c8:0403 Cheng Uei Precision Industry Co.,
	Ltd (Foxlink)
In-Reply-To: <4E29D994.8020407@yandex.ru>
References: <4E29D994.8020407@yandex.ru>
Message-ID: <20110722203911.GA14453@tugrik.mns.mnsspb.ru>

On Fri, Jul 22, 2011 at 10:12:04PM +0200, overclocked wrote:
> Dear ladies and gentlemen.
>
> I'm writing to You because it was recommended on  
> http://www.ideasonboard.org/uvc/#devices, if the device is not listed.
>
> So I have a "05c8:0403 Cheng Uei Precision Industry Co., Ltd (Foxlink)"  
> web cam in my HP 4720s laptop and it's not working or working very bad  
> in Ubuntu 11.04...
>
> If you google it, it's used not only in this laptop and not only in HP  
> laptops...
>
> Even if it works, every 5-10 seconds video stops in Skype and I need to  
> restart it.
>
> Sometimes it even does not start at all:(
>
> Also time to time I have a problem with /var/log/uvcdynctrl-udev.log  
> file - it uses all space available on the system - see  
> https://bugs.launchpad.net/ubuntu/+source/libwebcam/+bug/811604

Hmm,

I have the same cam on my HP Mini 5103 and it's working reliably without
a problem (guvcview, xawtv, my V4L application [1]) on Debian 6.0
Squeeze system with self-compiled kernel (2.6.38, 2.6.39 and today 3.0).
I'm not using Skype, so I can't tell whether it is working there.


Kirill

P.S. I even tweaked uvcvideo driver a bit for it[2], but it was not
neccessary to make it work at all, only to "eat" less usb bandwidth.


[1] http://repo.or.cz/w/rawv.git
[2] http://www.spinics.net/lists/linux-media/msg35721.html


From laurent.pinchart at ideasonboard.com  Sat Jul 23 00:03:57 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sat, 23 Jul 2011 00:03:57 +0200
Subject: [Linux-uvc-devel] [PATCH,
	RESEND] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam found on HP
	Mini 5103 netbook
In-Reply-To: <20110722144722.GA3717@tugrik.mns.mnsspb.ru>
References: <20110722144722.GA3717@tugrik.mns.mnsspb.ru>
Message-ID: <201107230003.59800.laurent.pinchart@ideasonboard.com>

Hi Kirill,

On Friday 22 July 2011 16:47:22 Kirill Smelkov wrote:
>  [ Cc'ing Andrew Morton -- Andrew, could you please pick this patch, in
>    case there is no response from maintainers again? Thanks beforehand. ]
> 
> 
> Hello up there,
> 
> My first posting was 1 month ago, and a reminder ~ 2 weeks ago. All
> without a reply. v3.0 is out and they say the merge window will be
> shorter this time, so in oder not to miss it, I've decided to resend my
> patch on lowering USB periodic bandwidth allocation topic.

I'm very very sorry for missing the patch (and worse, twice :-/).

> Could this simple patch be please applied?

Yes it can. I see that Andrew already applied it to his tree. Mauro, should it 
go through there, or through your tree ? I've pushed it to my tree at 
git://linuxtv.org/pinchartl/uvcvideo.git uvcvideo-stable, so you can already 
pull.

> Thanks,
> Kirill
> 
> 
> P.S.
> 
> Referenced in the description cc62a7eb (USB: EHCI: Allow users to
> override 80% max periodic bandwidth) will be entering the mainline via
> Greg's usb tree.
> 
> ---- 8< ----
> From: Kirill Smelkov <kirr at mns.spb.ru>
> Subject: [PATCH] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam found on HP
> Mini 5103 netbook
> 
> The camera there identifies itself as being manufactured by Cheng Uei
> Precision Industry Co., Ltd (Foxlink), and product is titled as "HP
> Webcam [2 MP Fixed]".

The device isn't listed in the supported devices list. Could you please send 
me its lsusb -v output ?

> I was trying to get 2 USB video capture devices to work simultaneously,
> and noticed that the above mentioned webcam always requires packet size
> = 3072 bytes per micro frame (~= 23.4 MB/s isoc bandwidth), which is far
> more than enough to get standard NTSC 640x480x2x30 = ~17.6 MB/s isoc
> bandwidth.
> 
> As there are alt interfaces with smaller MxPS
> 
>     T:  Bus=01 Lev=01 Prnt=01 Port=03 Cnt=01 Dev#=  2 Spd=480  MxCh= 0
>     D:  Ver= 2.00 Cls=ef(misc ) Sub=02 Prot=01 MxPS=64 #Cfgs=  1
>     P:  Vendor=05c8 ProdID=0403 Rev= 1.06
>     S:  Manufacturer=Foxlink
>     S:  Product=HP Webcam [2 MP Fixed]
>     S:  SerialNumber=200909240102
>     C:* #Ifs= 2 Cfg#= 1 Atr=80 MxPwr=500mA
>     A:  FirstIf#= 0 IfCount= 2 Cls=0e(video) Sub=03 Prot=00
>     I:* If#= 0 Alt= 0 #EPs= 1 Cls=0e(video) Sub=01 Prot=00 Driver=uvcvideo
>     E:  Ad=83(I) Atr=03(Int.) MxPS=  16 Ivl=4ms
>     I:* If#= 1 Alt= 0 #EPs= 0 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     I:  If#= 1 Alt= 1 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS= 128 Ivl=125us
>     I:  If#= 1 Alt= 2 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS= 512 Ivl=125us
>     I:  If#= 1 Alt= 3 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=1024 Ivl=125us
>     I:  If#= 1 Alt= 4 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=1536 Ivl=125us
>     I:  If#= 1 Alt= 5 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=2048 Ivl=125us
>     I:  If#= 1 Alt= 6 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=2688 Ivl=125us
>     I:  If#= 1 Alt= 7 #EPs= 1 Cls=0e(video) Sub=02 Prot=00 Driver=uvcvideo
>     E:  Ad=81(I) Atr=05(Isoc) MxPS=3072 Ivl=125us
> 
> UVC_QUIRK_FIX_BANDWIDTH helps here and NTSC video can be served with
> MxPS=2688 i.e. 20.5 MB/s isoc bandwidth.
> 
> In terms of microframe time allocation, before the quirk NTSC video
> required 60 usecs / microframe and 53 usecs / microframe after.
> 
> 
> P.S.
> 
> Now with tweaked ehci-hcd to allow up to 90% isoc bandwidth (cc62a7eb
> "USB: EHCI: Allow users to override 80% max periodic bandwidth") I can
> capture two video sources -- PAL 720x576 YUV422 @25fps + NTSC 640x480
> YUV422 @30fps simultaneously.  Hooray!
> 
> Signed-off-by: Kirill Smelkov <kirr at mns.spb.ru>

Acked-by: Laurent Pinchart <laurent.pinchart at ideasonboard.com>

> ---
>  drivers/media/video/uvc/uvc_driver.c |    9 +++++++++
>  1 files changed, 9 insertions(+), 0 deletions(-)
> 
> diff --git a/drivers/media/video/uvc/uvc_driver.c
> b/drivers/media/video/uvc/uvc_driver.c index b6eae48..f633700 100644
> --- a/drivers/media/video/uvc/uvc_driver.c
> +++ b/drivers/media/video/uvc/uvc_driver.c
> @@ -2130,6 +2130,15 @@ static struct usb_device_id uvc_ids[] = {
>  	  .bInterfaceProtocol	= 0,
>  	  .driver_info 		= UVC_QUIRK_PROBE_MINMAX
> 
>  				| UVC_QUIRK_BUILTIN_ISIGHT },
> 
> +	/* Foxlink ("HP Webcam" on HP Mini 5103) */
> +	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
> +				| USB_DEVICE_ID_MATCH_INT_INFO,
> +	  .idVendor		= 0x05c8,
> +	  .idProduct		= 0x0403,
> +	  .bInterfaceClass	= USB_CLASS_VIDEO,
> +	  .bInterfaceSubClass	= 1,
> +	  .bInterfaceProtocol	= 0,
> +	  .driver_info		= UVC_QUIRK_FIX_BANDWIDTH },
>  	/* Genesys Logic USB 2.0 PC Camera */
>  	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
> 
>  				| USB_DEVICE_ID_MATCH_INT_INFO,

-- 
Regards,

Laurent Pinchart


From kirr at mns.spb.ru  Sat Jul 23 00:25:20 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sat, 23 Jul 2011 02:25:20 +0400
Subject: [Linux-uvc-devel] [PATCH,
	RESEND] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam	found on HP
	Mini 5103 netbook
In-Reply-To: <201107230003.59800.laurent.pinchart@ideasonboard.com>
References: <20110722144722.GA3717@tugrik.mns.mnsspb.ru>
	<201107230003.59800.laurent.pinchart@ideasonboard.com>
Message-ID: <20110722222520.GA14917@tugrik.mns.mnsspb.ru>

Hi Laurent, All,

On Sat, Jul 23, 2011 at 12:03:57AM +0200, Laurent Pinchart wrote:
> Hi Kirill,
> 
> On Friday 22 July 2011 16:47:22 Kirill Smelkov wrote:
> >  [ Cc'ing Andrew Morton -- Andrew, could you please pick this patch, in
> >    case there is no response from maintainers again? Thanks beforehand. ]
> > 
> > 
> > Hello up there,
> > 
> > My first posting was 1 month ago, and a reminder ~ 2 weeks ago. All
> > without a reply. v3.0 is out and they say the merge window will be
> > shorter this time, so in oder not to miss it, I've decided to resend my
> > patch on lowering USB periodic bandwidth allocation topic.
> 
> I'm very very sorry for missing the patch (and worse, twice :-/).

Nevermind. I'm curious though, whether I did something wrong or anything
else?  I mean how to avoid such long delays next time?


> > Could this simple patch be please applied?
> 
> Yes it can. I see that Andrew already applied it to his tree. Mauro, should it 
> go through there, or through your tree ? I've pushed it to my tree at 
> git://linuxtv.org/pinchartl/uvcvideo.git uvcvideo-stable, so you can already 
> pull.

You've applied the patch from my first posting, but actually in the
RESEND one I've added reference to EHCI-tweaking patch -- it is already
merged into Greg's USB tree (it was not when I first posted), so could you
please reapply? (sorry for confusion).


Thanks for replying and for uvcvideo,
Kirill


From laurent.pinchart at ideasonboard.com  Sat Jul 23 01:12:11 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sat, 23 Jul 2011 01:12:11 +0200
Subject: [Linux-uvc-devel] [PATCH,
	RESEND] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam found on HP
	Mini 5103 netbook
In-Reply-To: <20110722222520.GA14917@tugrik.mns.mnsspb.ru>
References: <20110722144722.GA3717@tugrik.mns.mnsspb.ru>
	<201107230003.59800.laurent.pinchart@ideasonboard.com>
	<20110722222520.GA14917@tugrik.mns.mnsspb.ru>
Message-ID: <201107230112.12868.laurent.pinchart@ideasonboard.com>

Hi Kirill,

On Saturday 23 July 2011 00:25:20 Kirill Smelkov wrote:
> On Sat, Jul 23, 2011 at 12:03:57AM +0200, Laurent Pinchart wrote:
> > On Friday 22 July 2011 16:47:22 Kirill Smelkov wrote:
> > >  [ Cc'ing Andrew Morton -- Andrew, could you please pick this patch, in
> > >  
> > >    case there is no response from maintainers again? Thanks beforehand.
> > >    ]
> > > 
> > > Hello up there,
> > > 
> > > My first posting was 1 month ago, and a reminder ~ 2 weeks ago. All
> > > without a reply. v3.0 is out and they say the merge window will be
> > > shorter this time, so in oder not to miss it, I've decided to resend my
> > > patch on lowering USB periodic bandwidth allocation topic.
> > 
> > I'm very very sorry for missing the patch (and worse, twice :-/).
> 
> Nevermind. I'm curious though, whether I did something wrong or anything
> else?  I mean how to avoid such long delays next time?

It was all my fault, mails piled up in my mailbox and for some reason I marked 
yours as processed while they were not. I certainly hope it won't happen 
again.

> > > Could this simple patch be please applied?
> > 
> > Yes it can. I see that Andrew already applied it to his tree. Mauro,
> > should it go through there, or through your tree ? I've pushed it to my
> > tree at git://linuxtv.org/pinchartl/uvcvideo.git uvcvideo-stable, so you
> > can already pull.
> 
> You've applied the patch from my first posting, but actually in the
> RESEND one I've added reference to EHCI-tweaking patch -- it is already
> merged into Greg's USB tree (it was not when I first posted), so could you
> please reapply? (sorry for confusion).

Sure. That should now be fixed.

> Thanks for replying and for uvcvideo,

You're more than welcome. Thank you for the patch, and thank you for keeping 
on pushing :-)

-- 
Regards,

Laurent Pinchart


From kirr at mns.spb.ru  Sat Jul 23 20:15:09 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Sat, 23 Jul 2011 22:15:09 +0400
Subject: [Linux-uvc-devel] [PATCH,
	RESEND] uvcvideo: Add FIX_BANDWIDTH quirk to HP Webcam	found on HP
	Mini 5103 netbook
In-Reply-To: <201107230112.12868.laurent.pinchart@ideasonboard.com>
References: <20110722144722.GA3717@tugrik.mns.mnsspb.ru>
	<201107230003.59800.laurent.pinchart@ideasonboard.com>
	<20110722222520.GA14917@tugrik.mns.mnsspb.ru>
	<201107230112.12868.laurent.pinchart@ideasonboard.com>
Message-ID: <20110723181509.GA16414@tugrik.mns.mnsspb.ru>

Hi Laurent, All,

On Sat, Jul 23, 2011 at 01:12:11AM +0200, Laurent Pinchart wrote:
> Hi Kirill,
> 
> On Saturday 23 July 2011 00:25:20 Kirill Smelkov wrote:
> > On Sat, Jul 23, 2011 at 12:03:57AM +0200, Laurent Pinchart wrote:
> > > On Friday 22 July 2011 16:47:22 Kirill Smelkov wrote:
> > > >  [ Cc'ing Andrew Morton -- Andrew, could you please pick this patch, in
> > > >  
> > > >    case there is no response from maintainers again? Thanks beforehand.
> > > >    ]
> > > > 
> > > > Hello up there,
> > > > 
> > > > My first posting was 1 month ago, and a reminder ~ 2 weeks ago. All
> > > > without a reply. v3.0 is out and they say the merge window will be
> > > > shorter this time, so in oder not to miss it, I've decided to resend my
> > > > patch on lowering USB periodic bandwidth allocation topic.
> > > 
> > > I'm very very sorry for missing the patch (and worse, twice :-/).
> > 
> > Nevermind. I'm curious though, whether I did something wrong or anything
> > else?  I mean how to avoid such long delays next time?
> 
> It was all my fault, mails piled up in my mailbox and for some reason I marked 
> yours as processed while they were not. I certainly hope it won't happen 
> again.

I see, thanks. Yes let's hope mail won't do such "surprises" next time.



> > > > Could this simple patch be please applied?
> > > 
> > > Yes it can. I see that Andrew already applied it to his tree. Mauro,
> > > should it go through there, or through your tree ? I've pushed it to my
> > > tree at git://linuxtv.org/pinchartl/uvcvideo.git uvcvideo-stable, so you
> > > can already pull.
> > 
> > You've applied the patch from my first posting, but actually in the
> > RESEND one I've added reference to EHCI-tweaking patch -- it is already
> > merged into Greg's USB tree (it was not when I first posted), so could you
> > please reapply? (sorry for confusion).
> 
> Sure. That should now be fixed.

Thanks.


> > Thanks for replying and for uvcvideo,
> 
> You're more than welcome. Thank you for the patch, and thank you for keeping 
> on pushing :-)

:) Thanks again. I suppose it would be better for my patch to enter the
mainline through v4l tree then, because it's the normal path for uvc
bits.



Thanks,
Kirill


P.S.

And thanks Andrew for backing me up.


From laurent.pinchart at ideasonboard.com  Sun Jul 24 01:01:58 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 01:01:58 +0200
Subject: [Linux-uvc-devel] New UVC device
In-Reply-To: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>
References: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>
Message-ID: <201107240101.58775.laurent.pinchart@ideasonboard.com>

Hi Todor,

On Saturday 09 July 2011 08:32:38 Todor Nickolov wrote:
> Hello,
> 
> I have got a device working with the UVC driver and not listed in the table
> of known devices.
> 
> Device ID: 041e:4071
> Name: Creative Live! Cam Video IM Ultra (according to usb driver - Product:
> VF0415 Live! Cam Vid. IM Ultra)
> 
> Manufacturer: Creative Technology Ltd. (Creative Labs?)
> 
> Kernel version: 2.6.37.6
> 
> If any other information is needed, please let me know.

Could you please send me the output of

lsusb -v -d 041e:4071

running as root if possible ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 24 01:15:07 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 01:15:07 +0200
Subject: [Linux-uvc-devel] ID 1871:0101 Aveo Technology Corp.
In-Reply-To: <201107042311.30484.T.Maguin@web.de>
References: <201107042311.30484.T.Maguin@web.de>
Message-ID: <201107240115.08060.laurent.pinchart@ideasonboard.com>

Hi,

On Monday 04 July 2011 23:11:30 piewie wrote:
> Hello,
> 
> I have a Bresser "USB Microscope Digital". It is flawlessly working here on
> gentoo with 2.6.39-gentoo-r1, uvcvideo and guvcvideo - even the snapshot
> button on the microscope is useable.

Thank you. I've updated the suppported devices list.

> Thank You very much for your work.

You're welcome.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 24 01:33:25 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 01:33:25 +0200
Subject: [Linux-uvc-devel] Green Image
In-Reply-To: <358D66A6-9583-4782-88EE-AA38F498DAF8@gmail.com>
References: <358D66A6-9583-4782-88EE-AA38F498DAF8@gmail.com>
Message-ID: <201107240133.25977.laurent.pinchart@ideasonboard.com>

Hi,

On Tuesday 05 July 2011 12:01:33 Mac Smith wrote:
> Hi,
> 
> I am getting a green image when i capture it using vgrabbj.

vgrabbj supports the deprecated V4L1 API only. uvcvideo only supports V4L2.

> # vgrabbj -d /dev/video0 -f /var/www/webcam2.jpeg -D 7 -i vga
> 
> Set option ImageSize to value 640 (value: vga)
> Set option ImageSize to value 480 (value: vga)
> Updated pointers to new allocated memory.
> Done parsing commandline
> Setting tmpout file to /var/www/webcam2.jpeg.tmp
> Device /dev/video0 successfully opened
> Checking settings of device /dev/video0
> Set palette successfully to YUYV
> Initializing memory
> Memory initialized, size: 614400 (in), 921600 (out)
> Reading image from /dev/video0
> Palette to be used: YUYV (8), size: 614400
> Could not get mmap-buffer - Falling back to read()
> Using normal read for image grabbing
> Image successfully read
> Got YUYV, converting...
> converted to RGB24
> Temporary outputfile /var/www/webcam2.jpeg.tmp closed
> Temporary output /var/www/webcam2.jpeg.tmp moved to final destination
> /var/www/webcam2.jpeg Updated pointers to new allocated memory.
> There was no map allocated to be freed...
> Device /dev/video0 closed
> Buffers freed
> vars freed
> 
> 
> Image: http://flic.kr/p/9ZLRNb

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 24 01:38:06 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 01:38:06 +0200
Subject: [Linux-uvc-devel] Horizontal mirror uvc cams
In-Reply-To: <4E0D7933.5080201@gmail.com>
References: <4A39F219.10301@redhat.com> <4E0D7933.5080201@gmail.com>
Message-ID: <201107240138.06773.laurent.pinchart@ideasonboard.com>

Hi Matthieu,

On Friday 01 July 2011 09:37:23 Grignon Matthieu wrote:
> Hi,
> First, thank you for your job!

You're welcome.

> I write you this mail because my webcam have a trouble, the image is al
> reverse at the horizontal (should have a horizontal mirror in the
> configuration to fix it).
> I send you the lusb.log and dmi.log in attach.
> I'm running with a packardbell easynote NM98-JU, the cam is integrate,
> and ubuntu natty (it was also the same with ubuntu 10.10).

Could you please send me the output of

lsusb -v -d 0402:9665

running as root if possible ?

> Thanks for everything.
> Sorry for my very approximate english.
> /(The normal salutation here with a friendly formulation, i have no idea
> how to write that)/ ;-)

Don't worry :-)

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 24 01:39:27 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 01:39:27 +0200
Subject: [Linux-uvc-devel] Multiple Lifecam Cinema HD's
In-Reply-To: <4E0C954B.9090405@sucs.org>
References: <4E0C954B.9090405@sucs.org>
Message-ID: <201107240139.27289.laurent.pinchart@ideasonboard.com>

Hi Chris,

On Thursday 30 June 2011 17:24:59 Chris Jones wrote:
> Hi All,
> 
> Google tells me this camera has a bug where it requests all available
> bus bandwidth, and that I should 'set the FIX_BANDWIDTH quirk'.
> 
> How do I go about setting the FIX_BANDWIDTH quirk?

Try loading the driver with

modprobe uvcvideo quirks=0x80

Could you please send me the output of lsusb -v (running as root if possible) 
for your webcam ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 24 01:49:22 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 01:49:22 +0200
Subject: [Linux-uvc-devel] UVC Compilant USB Cam
In-Reply-To: <22963A4D-FE85-458E-9C73-C90424BD62CE@gmail.com>
References: <22963A4D-FE85-458E-9C73-C90424BD62CE@gmail.com>
Message-ID: <201107240149.22884.laurent.pinchart@ideasonboard.com>

Hi,

On Thursday 30 June 2011 08:41:28 Mac Smith wrote:
> Hi,
> 
> We have usb cameras from Beyond which uses aveo chip. I am not able to run
> it under ubuntu linux. I understand that ubuntu linux has uvcvideo driver
> inbuild kernel. I tried using different application like cheese, vgrabbj,
> streamer to capture still images.
> 
> every application says its unable to set or get properties from the camera.
> 
> Kindly help us to sort this out. Out of some of the commands are
> 
> 
> # lsusb
> Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
> Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
> Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
> Bus 001 Device 003: ID 160a:3184 VIA Technologies, Inc. VIA VNT-6656 [WiFi
> 802.11b/g USB Dongle] Bus 001 Device 002: ID 1871:0501 Aveo Technology
> Corp.
> Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

Could you please send me the output of

lsusb -v -d 1871:0501

running as root if possible ?

[snip]

> [   11.421088] uvcvideo: Found UVC 1.00 device USB2.0 Camera (1871:0501)
> [   11.422756] uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported.
> Enabling workaround.
> [   11.423917] usbcore: registered new interface driver uvcvideo

[snip]

> [   89.435099] uvcvideo: Failed to query (130) UVC probe control : -32 (exp.
> 26).
> [   89.435472] uvcvideo: Failed to query (130) UVC probe control : -32 (exp.
> 26).

Please try to load the uvcvideo module with

modprobe uvcvideo quirks=2

If the module is already loaded, unload it with modprobe -r uvcvideo before 
loading it with quirks=2.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 24 02:12:52 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 24 Jul 2011 02:12:52 +0200
Subject: [Linux-uvc-devel] error code list
In-Reply-To: <1308937506.2194.62.camel@sacarino>
References: <1308068882.3072.17.camel@sacarino>
	<201106241716.24679.laurent.pinchart@ideasonboard.com>
	<1308937506.2194.62.camel@sacarino>
Message-ID: <201107240212.52638.laurent.pinchart@ideasonboard.com>

Hi Jorge,

On Friday 24 June 2011 19:45:06 Jorge Yesid Rios Ortiz wrote:
> Hello laurent:
> 
> You propose to me:
> "Try to upgrade to a recent kernel. 2.6.14 is more than 5 years old."
> 
> It isn't possible to use a newer/newest kernel. I tried to compile
> different versions of kernels  (2.6.18, 2.6.20, 2.6.22,
> 2.6.24....2.6.38 ) and basically is impossible for some reasons:
> 
> 
> 1) the toolchains is very old (3.3.2 version).  I wrote to ARTILA's
> support tech  asking about a new toolchain because I need to compile a
> newer kernel and your answers was: "this is the last toolchains for your
> board, you must to use this". I download different versions of ARM's
> toolchains (like code sourcery lite version
> http://www.codesourcery.com/sgpp/lite/arm  and others more), if I well I
> can to compile a c or c++ file, when I try to compile or I upload to my
> target the the executable, isn't working.

I've successfully used 2009q1-203 for kernel compilation.

> 2) Russell King ( he supports the ARM Linux kernel community
> http://www.arm.linux.org.uk ) on your site wrote this:
> <<Downloading an ARM patch: You only need this step if you are using a
> kernel prior to 2.6.0-test2. There are no -rmk or -vrs patches for later
> kernels.>>
> 
> I suppose that recent versions of kernel has support for ARM
> architecture, but, when I tried to compile different versions of
> kernels, always I obtain different errors.
> 
> 3) On ARTILA ftp site, the "last kernel version" is 2.6.14-M5 kernel
> version update to september 15 / 2010, I think. (for me it's a bad joke
> to say "last kernel version" to a 2.6.14 version).
> 
> I read something about URB and I  don't know what I must to be for to
> solve this error.
> 
> If you have some idea about how to proceeded I will appreciate very
> much.

That's always the problem with vendor-provided kernels, and that's why I 
always try to use a mainline kernel and get support for my boards upstreamed. 
It's not an easy task and often requires kernel development. You would 
basically need to port support for your board from 2.6.14 to a mainline 
kernel.

-- 
Regards,

Laurent Pinchart


From toshonn at yahoo.com  Sun Jul 24 23:30:58 2011
From: toshonn at yahoo.com (Todor Nickolov)
Date: Sun, 24 Jul 2011 14:30:58 -0700 (PDT)
Subject: [Linux-uvc-devel] New UVC device
In-Reply-To: <201107240101.58775.laurent.pinchart@ideasonboard.com>
References: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>
	<201107240101.58775.laurent.pinchart@ideasonboard.com>
Message-ID: <1311543058.35515.YahooMailNeo@web125506.mail.ne1.yahoo.com>

Hello Laurent,

I attach the output.

Best regards,

Todor


________________________________
From: Laurent Pinchart <laurent.pinchart at ideasonboard.com>
To: linux-uvc-devel at lists.berlios.de; Todor Nickolov <toshonn at yahoo.com>
Sent: Sunday, July 24, 2011 2:01 AM
Subject: Re: [Linux-uvc-devel] New UVC device

Hi Todor,

On Saturday 09 July 2011 08:32:38 Todor Nickolov wrote:
> Hello,
> 
> I have got a device working with the UVC driver and not listed in the table
> of known devices.
> 
> Device ID: 041e:4071
> Name: Creative Live! Cam Video IM Ultra (according to usb driver - Product:
> VF0415 Live! Cam Vid. IM Ultra)
> 
> Manufacturer: Creative Technology Ltd. (Creative Labs?)
> 
> Kernel version: 2.6.37.6
> 
> If any other information is needed, please let me know.

Could you please send me the output of

lsusb -v -d 041e:4071

running as root if possible ?

-- 
Regards,

Laurent Pinchart
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110724/638e25fa/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: livecam_lsusb.txt.zip
Type: application/zip
Size: 3532 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110724/638e25fa/attachment.zip>

From overclocked at yandex.ru  Mon Jul 25 23:08:24 2011
From: overclocked at yandex.ru (overclocked)
Date: Mon, 25 Jul 2011 23:08:24 +0200
Subject: [Linux-uvc-devel] 05c8:0403 Cheng Uei Precision Industry Co.,
 Ltd (Foxlink)
Message-ID: <4E2DDB48.4080704@yandex.ru>

For me it's not working... When I run 'cheese' from the console after

20-30 seconds video stops with message:
"libv4l2: error dequeuing buf: No such device".

So it's not a Skype problem.

My kernel is 2.6.38-10-generic.

Self-compiled kernel is very nice, but unfortunately I don't have enough
time to invest in such things like kernel compilation on Ubuntu. On the
other hand, I really need a cam...

So I would be happy if there will be any solution for this problem, but
I would not like to compile a fresh kernel version "just to try".

Thank You in advance,
Kind Regards,
Andrey Sapegin.



On 07/22/2011 10:39 PM, Kirill Smelkov wrote:
>  On Fri, Jul 22, 2011 at 10:12:04PM +0200, overclocked wrote:
>>  Dear ladies and gentlemen.
>>
>>  I'm writing to You because it was recommended on
>>  http://www.ideasonboard.org/uvc/#devices, if the device is not listed.
>>
>>  So I have a "05c8:0403 Cheng Uei Precision Industry Co., Ltd (Foxlink)"
>>  web cam in my HP 4720s laptop and it's not working or working very bad
>>  in Ubuntu 11.04...
>>
>>  If you google it, it's used not only in this laptop and not only in HP
>>  laptops...
>>
>>  Even if it works, every 5-10 seconds video stops in Skype and I need to
>>  restart it.
>>
>>  Sometimes it even does not start at all:(
>>
>>  Also time to time I have a problem with /var/log/uvcdynctrl-udev.log
>>  file - it uses all space available on the system - see
>>  https://bugs.launchpad.net/ubuntu/+source/libwebcam/+bug/811604
>  Hmm,
>
>  I have the same cam on my HP Mini 5103 and it's working reliably without
>  a problem (guvcview, xawtv, my V4L application [1]) on Debian 6.0
>  Squeeze system with self-compiled kernel (2.6.38, 2.6.39 and today 3.0).
>  I'm not using Skype, so I can't tell whether it is working there.
>
>
>  Kirill
>
>  P.S. I even tweaked uvcvideo driver a bit for it[2], but it was not
>  neccessary to make it work at all, only to "eat" less usb bandwidth.
>
>
>  [1] http://repo.or.cz/w/rawv.git
>  [2] http://www.spinics.net/lists/linux-media/msg35721.html



From laurent.pinchart at ideasonboard.com  Tue Jul 26 01:44:17 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 26 Jul 2011 01:44:17 +0200
Subject: [Linux-uvc-devel] Multiple Lifecam Cinema HD's
In-Reply-To: <4E2D3CC7.9000007@sucs.org>
References: <4E0C954B.9090405@sucs.org>
	<201107240139.27289.laurent.pinchart@ideasonboard.com>
	<4E2D3CC7.9000007@sucs.org>
Message-ID: <201107260144.17515.laurent.pinchart@ideasonboard.com>

Hi Chris,

On Monday 25 July 2011 11:52:07 Chris Jones wrote:
> On 24/07/11 00:39, Laurent Pinchart wrote:
> > On Thursday 30 June 2011 17:24:59 Chris Jones wrote:
> >> How do I go about setting the FIX_BANDWIDTH quirk?
> > 
> > Try loading the driver with
> > 
> > modprobe uvcvideo quirks=0x80
> 
> That doesn't seem to help, i still get a 'Device or resource busy' message
> when trying to open the second device.

Have you made sure the driver isn't already loaded before loading it with the 
above command ? modprobe exits silently if the driver is already loaded, 
without doing anything.

> > Could you please send me the output of lsusb -v (running as root if
> > possible) for your webcam ?
> 
> Sure, attached.

Thank you.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Tue Jul 26 01:49:13 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 26 Jul 2011 01:49:13 +0200
Subject: [Linux-uvc-devel] New UVC device
In-Reply-To: <1311543058.35515.YahooMailNeo@web125506.mail.ne1.yahoo.com>
References: <1310193158.81444.YahooMailNeo@web55802.mail.re3.yahoo.com>
	<201107240101.58775.laurent.pinchart@ideasonboard.com>
	<1311543058.35515.YahooMailNeo@web125506.mail.ne1.yahoo.com>
Message-ID: <201107260149.14155.laurent.pinchart@ideasonboard.com>

Hi Todor,

On Sunday 24 July 2011 23:30:58 Todor Nickolov wrote:
> Hello Laurent,
> 
> I attach the output.

Thank you. I've updated the supported devices list.

-- 
Regards,

Laurent Pinchart


From xiechao.linux at gmail.com  Tue Jul 26 11:32:03 2011
From: xiechao.linux at gmail.com (chao xie)
Date: Tue, 26 Jul 2011 17:32:03 +0800
Subject: [Linux-uvc-devel] Is there any sample for uvc gadget?
Message-ID: <CAK9wHMS27PZVLzeRoA0ujj0+uiT30tRM0Dn4LfE9gsEaztMyVw@mail.gmail.com>

hi
My develop board have usb and camera sensor supported. I want to
simulate my board to be a usb camera for the Linux host. I find that
the f_uvc is supported in current kernel, but i am confused about how
to make use of the video device exported by webcam. How can i do to
simulate the board as a usb camera device? Is there any sample i can
reference to? Thanks.


From rollercow at sucs.org  Tue Jul 26 11:40:56 2011
From: rollercow at sucs.org (Chris Jones)
Date: Tue, 26 Jul 2011 10:40:56 +0100
Subject: [Linux-uvc-devel] Multiple Lifecam Cinema HD's
In-Reply-To: <201107260144.17515.laurent.pinchart@ideasonboard.com>
References: <4E0C954B.9090405@sucs.org>
	<201107240139.27289.laurent.pinchart@ideasonboard.com>
	<4E2D3CC7.9000007@sucs.org>
	<201107260144.17515.laurent.pinchart@ideasonboard.com>
Message-ID: <4E2E8BA8.5040904@sucs.org>

On 26/07/11 00:44, Laurent Pinchart wrote:
> On Monday 25 July 2011 11:52:07 Chris Jones wrote:
>> On 24/07/11 00:39, Laurent Pinchart wrote:
>>> Try loading the driver with
>>>
>>> modprobe uvcvideo quirks=0x80
>> That doesn't seem to help, i still get a 'Device or resource busy' message
>> when trying to open the second device.
> Have you made sure the driver isn't already loaded before loading it with the 
> above command ? modprobe exits silently if the driver is already loaded, 
> without doing anything.

Yes,

I ran `rmmod uvcvideo` first.

It seems if I turn the resolution right down I can get both to work
simultaneously...

--
Chris





From kirr at mns.spb.ru  Tue Jul 26 16:19:16 2011
From: kirr at mns.spb.ru (Kirill Smelkov)
Date: Tue, 26 Jul 2011 18:19:16 +0400
Subject: [Linux-uvc-devel] 05c8:0403 Cheng Uei Precision Industry Co.,
	Ltd (Foxlink)
In-Reply-To: <4E2DCF3E.6010706@yandex.ru>
References: <4E29D994.8020407@yandex.ru>
	<20110722203911.GA14453@tugrik.mns.mnsspb.ru>
	<4E2DCF3E.6010706@yandex.ru>
Message-ID: <20110726141916.GB23696@tugrik.mns.mnsspb.ru>

On Mon, Jul 25, 2011 at 10:17:02PM +0200, overclocked wrote:
> For me it's not working... When I run 'cheese' from the console after  
> 20-30 seconds video stops with message:
> "libv4l2: error dequeuing buf: No such device".
>
> So it's not a Skype problem.

I've checked - cheese from Debian 6.0 works on my side for hours on 3.0
kernel.


> My kernel is 2.6.38-10-generic.
>
> Self-compiled kernel is very nice, but unfortunately I don't have enough  
> time to invest in such things like kernel compilation on Ubuntu. On the  
> other hand, I really need a cam...
>
> So I would be happy if there will be any solution for this problem, but  
> I would not like to compile a fresh kernel version "just to try".
>
> Thank You in advance,
> Kind Regards,
> Andrey Sapegin.

Sorry, I can't help you here.

Kirill


From laurent.pinchart at ideasonboard.com  Tue Jul 26 16:57:27 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Tue, 26 Jul 2011 16:57:27 +0200
Subject: [Linux-uvc-devel] Multiple Lifecam Cinema HD's
In-Reply-To: <4E2E8BA8.5040904@sucs.org>
References: <4E0C954B.9090405@sucs.org>
	<201107260144.17515.laurent.pinchart@ideasonboard.com>
	<4E2E8BA8.5040904@sucs.org>
Message-ID: <201107261657.28104.laurent.pinchart@ideasonboard.com>

Hi Chris,

On Tuesday 26 July 2011 11:40:56 Chris Jones wrote:
> On 26/07/11 00:44, Laurent Pinchart wrote:
> > On Monday 25 July 2011 11:52:07 Chris Jones wrote:
> >> On 24/07/11 00:39, Laurent Pinchart wrote:
> >>> Try loading the driver with
> >>> 
> >>> modprobe uvcvideo quirks=0x80
> >> 
> >> That doesn't seem to help, i still get a 'Device or resource busy'
> >> message when trying to open the second device.

This slipped through when I replied to your e-mail. That error doesn't seem to 
be related to USB bandwidth. What do you mean by opening the device ? Are you 
talking about the open() call, or opening it in an application ? The uvcvideo 
driver will only return -EBUSY if an application has already opened the 
device.

> > Have you made sure the driver isn't already loaded before loading it with
> > the above command ? modprobe exits silently if the driver is already
> > loaded, without doing anything.
> 
> Yes,
> 
> I ran `rmmod uvcvideo` first.
> 
> It seems if I turn the resolution right down I can get both to work
> simultaneously...

With or without the quirk ?

What resolution(s) have you tried ?

-- 
Regards,

Laurent Pinchart


From rollercow at sucs.org  Mon Jul 25 11:52:07 2011
From: rollercow at sucs.org (Chris Jones)
Date: Mon, 25 Jul 2011 10:52:07 +0100
Subject: [Linux-uvc-devel] Multiple Lifecam Cinema HD's
In-Reply-To: <201107240139.27289.laurent.pinchart@ideasonboard.com>
References: <4E0C954B.9090405@sucs.org>
	<201107240139.27289.laurent.pinchart@ideasonboard.com>
Message-ID: <4E2D3CC7.9000007@sucs.org>

Hi Laurent,

On 24/07/11 00:39, Laurent Pinchart wrote:
> On Thursday 30 June 2011 17:24:59 Chris Jones wrote:
>> How do I go about setting the FIX_BANDWIDTH quirk?
> Try loading the driver with
>
> modprobe uvcvideo quirks=0x80

That doesn't seem to help, i still get a 'Device or resource busy'
message when trying to open the second device.

> Could you please send me the output of lsusb -v (running as root if possible) 
> for your webcam ?

Sure, attached.

Thanks!

--
Chris
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: output.txt
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110725/34bb9a96/attachment.txt>

From nohbudy at gmail.com  Wed Jul 27 01:24:53 2011
From: nohbudy at gmail.com (Vincent)
Date: Tue, 26 Jul 2011 16:24:53 -0700
Subject: [Linux-uvc-devel] Microsoft LifeCam HD-5000 Confirmed working
Message-ID: <CAJ7MEeN9waBfE-p_guvWOqqtM3ze+TCmX04L7m3vDbRM4dfxRQ@mail.gmail.com>

I would like to confirm that Microsoft LifeCam HD-5000 with a device
ID of 045e:076d is tested and working!


From xiechao.linux at gmail.com  Thu Jul 28 02:58:05 2011
From: xiechao.linux at gmail.com (chao xie)
Date: Thu, 28 Jul 2011 08:58:05 +0800
Subject: [Linux-uvc-devel] Is there any sample for uvc gadget?
In-Reply-To: <CAK9wHMS27PZVLzeRoA0ujj0+uiT30tRM0Dn4LfE9gsEaztMyVw@mail.gmail.com>
References: <CAK9wHMS27PZVLzeRoA0ujj0+uiT30tRM0Dn4LfE9gsEaztMyVw@mail.gmail.com>
Message-ID: <CAK9wHMTX28m6P-Q5pGdRr8tg5FDMX4o_v_ZidymYj5uO2vv7PA@mail.gmail.com>

hi
 My develop board have usb and camera sensor supported. I want to
 simulate my board to be a usb camera for the Linux host. I find that
 the f_uvc is supported in current kernel, but i am confused about how
 to make use of the video device exported by webcam. How can i do to
 simulate the board as a usb camera device? Is there any sample i can
 reference to? Thanks.


From coronasensei at gmail.com  Thu Jul 28 03:10:25 2011
From: coronasensei at gmail.com (Andrew Leech)
Date: Thu, 28 Jul 2011 11:10:25 +1000
Subject: [Linux-uvc-devel] Is there any sample for uvc gadget?
In-Reply-To: <CAK9wHMTX28m6P-Q5pGdRr8tg5FDMX4o_v_ZidymYj5uO2vv7PA@mail.gmail.com>
References: <CAK9wHMS27PZVLzeRoA0ujj0+uiT30tRM0Dn4LfE9gsEaztMyVw@mail.gmail.com>
	<CAK9wHMTX28m6P-Q5pGdRr8tg5FDMX4o_v_ZidymYj5uO2vv7PA@mail.gmail.com>
Message-ID: <4E30B701.9060105@gmail.com>

I haven't tried it myself (I made my own bare metal uvc device to avoid 
using linux) but google and the list archives is your friend, as much as 
anything.
http://lists.berlios.de/pipermail/linux-uvc-devel/2011-February/006277.html
There's sample code availble in the distro already, as long as your 
linux is new enough.

Andrew

On 28/07/2011 10:58 AM, chao xie wrote:
> hi
>   My develop board have usb and camera sensor supported. I want to
>   simulate my board to be a usb camera for the Linux host. I find that
>   the f_uvc is supported in current kernel, but i am confused about how
>   to make use of the video device exported by webcam. How can i do to
>   simulate the board as a usb camera device? Is there any sample i can
>   reference to? Thanks.
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From fancherjw at gmail.com  Sat Jul 30 04:48:37 2011
From: fancherjw at gmail.com (John Fancher)
Date: Fri, 29 Jul 2011 22:48:37 -0400
Subject: [Linux-uvc-devel] WEBcam (UVC Microscope) not supported
Message-ID: <4E337105.4080601@gmail.com>

The following USB webcam (microscope) is not recognised by the driver....

lsusb output:

Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.


(From edu science a subsidiary of toys r us)






From bug-track at fisher-privat.net  Sat Jul 30 10:13:16 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sat, 30 Jul 2011 10:13:16 +0200
Subject: [Linux-uvc-devel] WEBcam (UVC Microscope) not supported
In-Reply-To: <4E337105.4080601@gmail.com>
References: <4E337105.4080601@gmail.com>
Message-ID: <1312013596.22174.2.camel@zwerg>

On Fr, 2011-07-29 at 22:48 -0400, John Fancher wrote:
> The following USB webcam (microscope) is not recognised by the driver....
> 
> lsusb output:
> 
> Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.

Please can you send verbose lsusb output. use:
sudo lsusb -vd 1871:01b0

Also can you please send link to the product? I looking one for me
too :)

-- 
Regards,
        Alexey



From michael+uvc at stapelberg.de  Sat Jul 30 15:08:14 2011
From: michael+uvc at stapelberg.de (Michael Stapelberg)
Date: Sat, 30 Jul 2011 15:08:14 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live! Cam
	Socialize HD
Message-ID: <1312030286-sup-231@midna.zekjur.net>

Hi,

I recently bought a Creative Live! Cam Socialize HD (ID 041e:4080) after
verifying that it is a device supported by the uvcvideo driver.

The device basically works, but to get 30 fps (at 640x480, but also with higher
resolutions), I need to set the 'Exposure, Auto' setting to 1 (Manual Mode).
Afterwards, I can set the 'Exposure (Absolute)' setting to one of the values
39, 78, 156, 312, 625, 1250, 2500, ?. All other values lead to a heavily
over-exposed picture. This effect was already mentioned on this list for a
different cam [1]. I wonder what we can do about it, as the step size for this
setting is reported as '1' while in reality it seems logarithmic ? with the
exception of the step 312 to 625.

So, I can live with changing the configuration after plugging in the cam, which
I would automate with udev.

However, I have noticed that I need to have an active video capture running,
otherwise setting these values with uvcdynctrl has no effect. I tested it like
this:

1) Plug in the camera, wait until the white LED (which indicates capturing)
   goes off. This takes about 5 seconds.
2) Use uvcdynctrl -s 'Exposure, Auto' 1
3) Verify the result with uvcdynctrl -g 'Exposure, Auto', which also returns 1
4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
5) Use gst-launch v4l2src ! xvimagesink
?  The video is at 5 fps instead of 30 fps

If I do it like this, it works:

1) Plug in the camera, wait until the white LED (which indicates capturing)
   goes off. This takes about 5 seconds.
2) Use gst-launch v4l2src ! xvimagesink, leave it open
3) Use uvcdynctrl -s 'Exposure, Auto' 1, verify it
4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
?  The video works correctly

What I also do not understand is why the control has a reported default value
of 1 while uvcdynctrl -g 'Exposure, Auto' returns 3.

Is this a bug in the uvcvideo driver? Or in the camera firmware? What is the
recommended way to deal with the Exposure setting?

Best regards,
Michael

[1] http://lists.berlios.de/pipermail/linux-uvc-devel/2010-May/005731.html

PS:
I am using uvcdynctrl 0.2.1, checked out of SVN r125 of
http://svn.quickcamteam.net/svn/qct/webcam-tools/trunk.
My kernel version is 2.6.39.2.

I have attached the output of uvcdynctrl -v -c. 

I also attached the output of lsusb -v.

If you need any more information, please let me know.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: uvcdynctrl-v-c.txt
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110730/616e504e/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lsusb-v.txt
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110730/616e504e/attachment-0001.txt>

From fancherjw at gmail.com  Sat Jul 30 15:57:41 2011
From: fancherjw at gmail.com (John Fancher)
Date: Sat, 30 Jul 2011 09:57:41 -0400
Subject: [Linux-uvc-devel] WEBcam (UVC Microscope) not supported
In-Reply-To: <1312013596.22174.2.camel@zwerg>
References: <4E337105.4080601@gmail.com> <1312013596.22174.2.camel@zwerg>
Message-ID: <4E340DD5.9090806@gmail.com>

On 07/30/2011 04:13 AM, Alexey Fisher wrote:
> On Fr, 2011-07-29 at 22:48 -0400, John Fancher wrote:
>> The following USB webcam (microscope) is not recognised by the driver....
>>
>> lsusb output:
>>
>> Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.
> Please can you send verbose lsusb output. use:
> sudo lsusb -vd 1871:01b0
>
> Also can you please send link to the product? I looking one for me
> too :)
>
lsusb verbose output:

Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.
Device Descriptor:
   bLength                18
   bDescriptorType         1
   bcdUSB               2.00
   bDeviceClass            0 (Defined at Interface level)
   bDeviceSubClass         0
   bDeviceProtocol         0
   bMaxPacketSize0        64
   idVendor           0x1871 Aveo Technology Corp.
   idProduct          0x01b0
   bcdDevice            0.05
   iManufacturer           1 AVEO Technology Corp.
   iProduct                2 AVEO Cheetah3 USB2.0 Device
   iSerial                 0
   bNumConfigurations      1
   Configuration Descriptor:
     bLength                 9
     bDescriptorType         2
     wTotalLength          105
     bNumInterfaces          1
     bConfigurationValue     1
     iConfiguration          0
     bmAttributes         0x80
       (Bus Powered)
     MaxPower              500mA
     Interface Descriptor:
       bLength                 9
       bDescriptorType         4
       bInterfaceNumber        0
       bAlternateSetting       0
       bNumEndpoints           1
       bInterfaceClass       255 Vendor Specific Class
       bInterfaceSubClass    255 Vendor Specific Subclass
       bInterfaceProtocol    255 Vendor Specific Protocol
       iInterface              0
       Endpoint Descriptor:
         bLength                 7
         bDescriptorType         5
         bEndpointAddress     0x83  EP 3 IN
         bmAttributes            1
           Transfer Type            Isochronous
           Synch Type               None
           Usage Type               Data
         wMaxPacketSize     0x0000  1x 0 bytes
         bInterval               1
     Interface Descriptor:
       bLength                 9
       bDescriptorType         4
       bInterfaceNumber        0
       bAlternateSetting       1
       bNumEndpoints           1
       bInterfaceClass       255 Vendor Specific Class
       bInterfaceSubClass    255 Vendor Specific Subclass
       bInterfaceProtocol    255 Vendor Specific Protocol
       iInterface              0
       Endpoint Descriptor:
         bLength                 7
         bDescriptorType         5
         bEndpointAddress     0x83  EP 3 IN
         bmAttributes            1
           Transfer Type            Isochronous
           Synch Type               None
           Usage Type               Data
         wMaxPacketSize     0x0200  1x 512 bytes
         bInterval               1
     Interface Descriptor:
       bLength                 9
       bDescriptorType         4
       bInterfaceNumber        0
       bAlternateSetting       2
       bNumEndpoints           1
       bInterfaceClass       255 Vendor Specific Class
       bInterfaceSubClass    255 Vendor Specific Subclass
       bInterfaceProtocol    255 Vendor Specific Protocol
       iInterface              0
       Endpoint Descriptor:
         bLength                 7
         bDescriptorType         5
         bEndpointAddress     0x83  EP 3 IN
         bmAttributes            1
           Transfer Type            Isochronous
           Synch Type               None
           Usage Type               Data
         wMaxPacketSize     0x03fc  1x 1020 bytes
         bInterval               1
     Interface Descriptor:
       bLength                 9
       bDescriptorType         4
       bInterfaceNumber        0
       bAlternateSetting       3
       bNumEndpoints           1
       bInterfaceClass       255 Vendor Specific Class
       bInterfaceSubClass    255 Vendor Specific Subclass
       bInterfaceProtocol    255 Vendor Specific Protocol
       iInterface              0
       Endpoint Descriptor:
         bLength                 7
         bDescriptorType         5
         bEndpointAddress     0x83  EP 3 IN
         bmAttributes            1
           Transfer Type            Isochronous
           Synch Type               None
           Usage Type               Data
         wMaxPacketSize     0x0400  1x 1024 bytes
         bInterval               1
     Interface Descriptor:
       bLength                 9
       bDescriptorType         4
       bInterfaceNumber        0
       bAlternateSetting       4
       bNumEndpoints           1
       bInterfaceClass       255 Vendor Specific Class
       bInterfaceSubClass    255 Vendor Specific Subclass
       bInterfaceProtocol    255 Vendor Specific Protocol
       iInterface              0
       Endpoint Descriptor:
         bLength                 7
         bDescriptorType         5
         bEndpointAddress     0x83  EP 3 IN
         bmAttributes            1
           Transfer Type            Isochronous
           Synch Type               None
           Usage Type               Data
         wMaxPacketSize     0x0c00  2x 1024 bytes
         bInterval               1
     Interface Descriptor:
       bLength                 9
       bDescriptorType         4
       bInterfaceNumber        0
       bAlternateSetting       5
       bNumEndpoints           1
       bInterfaceClass       255 Vendor Specific Class
       bInterfaceSubClass    255 Vendor Specific Subclass
       bInterfaceProtocol    255 Vendor Specific Protocol
       iInterface              0
       Endpoint Descriptor:
         bLength                 7
         bDescriptorType         5
         bEndpointAddress     0x83  EP 3 IN
         bmAttributes            1
           Transfer Type            Isochronous
           Synch Type               None
           Usage Type               Data
         wMaxPacketSize     0x1400  3x 1024 bytes
         bInterval               1
Device Qualifier (for other device speed):
   bLength                10
   bDescriptorType         6
   bcdUSB               2.00
   bDeviceClass            0 (Defined at Interface level)
   bDeviceSubClass         0
   bDeviceProtocol         0
   bMaxPacketSize0        64
   bNumConfigurations      1
Device Status:     0x0000
   (Bus Powered)

BRK

also, the only link I have ever found for the product is to retailers.  
It was found at toys r us but now is not shown on their website.

The company was Edu Science which was a part of Toys R US.  It is a 
handheld Microscope.  I have the PDF of the user manual that I will try 
to post to the list.  I also have the driver for windows which says it 
is a UVC Driver.

Thanks for the help!









From fancherjw at gmail.com  Sat Jul 30 16:06:53 2011
From: fancherjw at gmail.com (John Fancher)
Date: Sat, 30 Jul 2011 10:06:53 -0400
Subject: [Linux-uvc-devel] WEBcam (UVC Microscope) not supported
In-Reply-To: <1312013596.22174.2.camel@zwerg>
References: <4E337105.4080601@gmail.com> <1312013596.22174.2.camel@zwerg>
Message-ID: <4E340FFD.1030504@gmail.com>

On 07/30/2011 04:13 AM, Alexey Fisher wrote:
> On Fr, 2011-07-29 at 22:48 -0400, John Fancher wrote:
>> The following USB webcam (microscope) is not recognised by the driver....
>>
>> lsusb output:
>>
>> Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.
> Please can you send verbose lsusb output. use:
> sudo lsusb -vd 1871:01b0
>
> Also can you please send link to the product? I looking one for me
> too :)
>
Here is a link to the zip file of a windows driver and the pdf of the 
manual...

http://explorescientific.com/downloads/explore_scientific_software_downloads.html

Thanks again for the help.
John



From bug-track at fisher-privat.net  Sat Jul 30 16:38:53 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sat, 30 Jul 2011 16:38:53 +0200
Subject: [Linux-uvc-devel] WEBcam (UVC Microscope) not supported
In-Reply-To: <4E340DD5.9090806@gmail.com>
References: <4E337105.4080601@gmail.com> <1312013596.22174.2.camel@zwerg>
	<4E340DD5.9090806@gmail.com>
Message-ID: <1312036733.28464.6.camel@zwerg>

On Sa, 2011-07-30 at 09:57 -0400, John Fancher wrote:
> On 07/30/2011 04:13 AM, Alexey Fisher wrote:
> > On Fr, 2011-07-29 at 22:48 -0400, John Fancher wrote:
> >> The following USB webcam (microscope) is not recognised by the driver....
> >>
> >> lsusb output:
> >>
> >> Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.
> > Please can you send verbose lsusb output. use:
> > sudo lsusb -vd 1871:01b0
> >
> > Also can you please send link to the product? I looking one for me
> > too :)
> >
> lsusb verbose output:
> 
> Bus 001 Device 002: ID 1871:01b0 Aveo Technology Corp.
> Device Descriptor:
>    bLength                18
>    bDescriptorType         1
>    bcdUSB               2.00
>    bDeviceClass            0 (Defined at Interface level)
>    bDeviceSubClass         0
>    bDeviceProtocol         0
>    bMaxPacketSize0        64
>    idVendor           0x1871 Aveo Technology Corp.
>    idProduct          0x01b0
>    bcdDevice            0.05
>    iManufacturer           1 AVEO Technology Corp.
>    iProduct                2 AVEO Cheetah3 USB2.0 Device
>    iSerial                 0
>    bNumConfigurations      1
>    Configuration Descriptor:
>      bLength                 9
>      bDescriptorType         2
>      wTotalLength          105
>      bNumInterfaces          1
>      bConfigurationValue     1
>      iConfiguration          0
>      bmAttributes         0x80
>        (Bus Powered)
>      MaxPower              500mA
>      Interface Descriptor:
>        bLength                 9
>        bDescriptorType         4
>        bInterfaceNumber        0
>        bAlternateSetting       0
>        bNumEndpoints           1
>        bInterfaceClass       255 Vendor Specific Class
>        bInterfaceSubClass    255 Vendor Specific Subclass
>        bInterfaceProtocol    255 Vendor Specific Protocol
>        iInterface              0

At this point it shoud say "bInterfaceClass 14 Video", your is
"bInterfaceClass 255 Vendor Specific Class". It mean it is not UVC
device, or it is uvc undercover ;)

To test it you should be able to compile kerner by your self. Take also
look in: linux-2.6/drivers/media/video/uvc/uvc_driver.c
Search for some thing like this:
        /* Logitech Quickcam Fusion */
        { .match_flags          = USB_DEVICE_ID_MATCH_DEVICE
                                | USB_DEVICE_ID_MATCH_INT_INFO,
          .idVendor             = 0x046d,
          .idProduct            = 0x08c1,
          .bInterfaceClass      = USB_CLASS_VENDOR_SPEC,
          .bInterfaceSubClass   = 1,
          .bInterfaceProtocol   = 0 },

and place your idVendor and idProduct.

> BRK
> 
> also, the only link I have ever found for the product is to retailers.  
> It was found at toys r us but now is not shown on their website.
> 
> The company was Edu Science which was a part of Toys R US.  It is a 
> handheld Microscope.  I have the PDF of the user manual that I will try 
> to post to the list.  I also have the driver for windows which says it 
> is a UVC Driver.
> 
> Thanks for the help

-- 
Regards,
        Alexey



From laurent.pinchart at ideasonboard.com  Sun Jul 31 17:59:09 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 31 Jul 2011 17:59:09 +0200
Subject: [Linux-uvc-devel] Is there any sample for uvc gadget?
In-Reply-To: <CAK9wHMTX28m6P-Q5pGdRr8tg5FDMX4o_v_ZidymYj5uO2vv7PA@mail.gmail.com>
References: <CAK9wHMS27PZVLzeRoA0ujj0+uiT30tRM0Dn4LfE9gsEaztMyVw@mail.gmail.com>
	<CAK9wHMTX28m6P-Q5pGdRr8tg5FDMX4o_v_ZidymYj5uO2vv7PA@mail.gmail.com>
Message-ID: <201107311759.09925.laurent.pinchart@ideasonboard.com>

Hi,

On Thursday 28 July 2011 02:58:05 chao xie wrote:
> hi
>  My develop board have usb and camera sensor supported. I want to
>  simulate my board to be a usb camera for the Linux host. I find that
>  the f_uvc is supported in current kernel, but i am confused about how
>  to make use of the video device exported by webcam. How can i do to
>  simulate the board as a usb camera device? Is there any sample i can
>  reference to? Thanks.

The only sample userspace application I know of is called uvc-gadget and 
available at http://git.ideasonboard.org/.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 31 17:58:23 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 31 Jul 2011 17:58:23 +0200
Subject: [Linux-uvc-devel] Microsoft LifeCam HD-5000 Confirmed working
In-Reply-To: <CAJ7MEeN9waBfE-p_guvWOqqtM3ze+TCmX04L7m3vDbRM4dfxRQ@mail.gmail.com>
References: <CAJ7MEeN9waBfE-p_guvWOqqtM3ze+TCmX04L7m3vDbRM4dfxRQ@mail.gmail.com>
Message-ID: <201107311758.23362.laurent.pinchart@ideasonboard.com>

Hi Vincent,

On Wednesday 27 July 2011 01:24:53 Vincent wrote:
> I would like to confirm that Microsoft LifeCam HD-5000 with a device
> ID of 045e:076d is tested and working!

Thank you for the report. I've updated the supported devices list.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 31 18:03:32 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 31 Jul 2011 18:03:32 +0200
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <1835110100.384521.1308803968089.JavaMail.root@ahm.einfochips.com>
References: <1835110100.384521.1308803968089.JavaMail.root@ahm.einfochips.com>
Message-ID: <201107311803.32939.laurent.pinchart@ideasonboard.com>

Hi Ajay,

On Thursday 23 June 2011 06:39:28 Ajay Bhargav wrote:
> Hi Laurent,
> 
> Thanks for your reply. Well I know that H.264 payload is specified in newer
> UVC 1.1 documentation, but my webcam is not sending H.264 as payload. Its
> sending MPEG2-TS according to UVC1.0 secifications, i found out during
> debugging, format descriptor gives 0x0A as Descriptor subtype.
> 
> As per old archives from mailing list i added MPEG2-TS handling similar to
> DV format. I am now able to create a /dev/video device on my machine but i
> have no idea how to add stream support to UVC-v4l2 interface or where to
> add that support. As there is no frame descriptor V4L2 driver is not able
> to detect the frame rate etc... Maybe i am getting little confused here?

Implementing MPEG2-TS support is onmy TODO list, but I unfortunately don't own 
any UVC device that implements MPEG2-TS :-S

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 31 18:10:59 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 31 Jul 2011 18:10:59 +0200
Subject: [Linux-uvc-devel] uvc webcam does not support 640*480 on arm9
	board
In-Reply-To: <BANLkTikHsNjPdgB0L=W+Y-mOd_czdUd0KA@mail.gmail.com>
References: <BANLkTikHsNjPdgB0L=W+Y-mOd_czdUd0KA@mail.gmail.com>
Message-ID: <201107311810.59424.laurent.pinchart@ideasonboard.com>

Hi,

On Wednesday 08 June 2011 14:31:59 JITENDRA SINGH wrote:
> Hi all,
> 
> I am able to "uvccapture" 320*240 jpgs using this webcam on arm9 board, but
> it fails when I try to capture 640*480 stills, it hangs while trying to
> exit:

[snip]

> dmesg error when uvccapture didnt work:
> [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
> [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
> [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).
> [ 2650.790000] uvcvideo: Failed to resubmit video URB (-45).

45 is EL2NSYNC. A quick grep in drivers/usb shows only one driver returning 
that error code, and that's for a gadget device, not a host controller.

I suspect an issue in your board's USB host controller driver. What ARM9 SoC 
are you using ? Can you try upgrading it to a more recent kernel ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Sun Jul 31 18:28:27 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Sun, 31 Jul 2011 18:28:27 +0200
Subject: [Linux-uvc-devel] Exposure setting problems with Creative Live!
	Cam Socialize HD
In-Reply-To: <1312030286-sup-231@midna.zekjur.net>
References: <1312030286-sup-231@midna.zekjur.net>
Message-ID: <201107311828.27977.laurent.pinchart@ideasonboard.com>

Hi Michael,

On Saturday 30 July 2011 15:08:14 Michael Stapelberg wrote:
> Hi,
> 
> I recently bought a Creative Live! Cam Socialize HD (ID 041e:4080) after
> verifying that it is a device supported by the uvcvideo driver.
> 
> The device basically works, but to get 30 fps (at 640x480, but also with
> higher resolutions), I need to set the 'Exposure, Auto' setting to 1
> (Manual Mode). Afterwards, I can set the 'Exposure (Absolute)' setting to
> one of the values 39, 78, 156, 312, 625, 1250, 2500, ?. All other values
> lead to a heavily over-exposed picture. This effect was already mentioned
> on this list for a different cam [1]. I wonder what we can do about it, as
> the step size for this setting is reported as '1' while in reality it
> seems logarithmic ? with the exception of the step 312 to 625.

Those values are 2500 / 64, 32, 16, 8, 4, 2 and 1. There's unfortunately no 
way for the driver to know that other values will lead to bad results. I've 
seen bad firmware bugs, but this one is high on the list.

> So, I can live with changing the configuration after plugging in the cam,
> which I would automate with udev.
> 
> However, I have noticed that I need to have an active video capture
> running, otherwise setting these values with uvcdynctrl has no effect. I
> tested it like this:
> 
> 1) Plug in the camera, wait until the white LED (which indicates capturing)
>    goes off. This takes about 5 seconds.
> 2) Use uvcdynctrl -s 'Exposure, Auto' 1
> 3) Verify the result with uvcdynctrl -g 'Exposure, Auto', which also
> returns 1 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
> 5) Use gst-launch v4l2src ! xvimagesink
> ?  The video is at 5 fps instead of 30 fps
> 
> If I do it like this, it works:
> 
> 1) Plug in the camera, wait until the white LED (which indicates capturing)
>    goes off. This takes about 5 seconds.
> 2) Use gst-launch v4l2src ! xvimagesink, leave it open
> 3) Use uvcdynctrl -s 'Exposure, Auto' 1, verify it
> 4) Use uvcdynctrl -s 'Exposure (Absolute)' 312, verify it
> ?  The video works correctly

That's weird. I'm wondering if the camera doesn't just reset all controls when 
the video stream is started. What happens in the second case if you stop the 
video stream and restart it ? Are exposure settings correct, or do they go 
back to bad values ?

> What I also do not understand is why the control has a reported default
> value of 1 while uvcdynctrl -g 'Exposure, Auto' returns 3.
> 
> Is this a bug in the uvcvideo driver? Or in the camera firmware?

Probably in the camera firmware. The device queries the camera for default and 
current values, and I wouldn't be surprised if the camera reported a default 
value that it doesn't use as a default.

> What is the recommended way to deal with the Exposure setting?

How do you mean ? On non-broken cameras you can just set the control to any 
legal value and things will work :-)

-- 
Regards,

Laurent Pinchart


