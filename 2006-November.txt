From rumi_ml at rtfm.hu  Wed Nov  1 01:19:28 2006
From: rumi_ml at rtfm.hu (Rumi Szabolcs)
Date: Wed, 1 Nov 2006 01:19:28 +0100
Subject: [Linux-uvc-devel] Logitech QC Fusion problems
Message-ID: <20061101011928.7e09ac5f.rumi_ml@rtfm.hu>

Hello!

I've put my hands on a Logitech QC Fusion:

Bus 001 Device 002: ID 046d:08c1 Logitech, Inc.

And I tried to get it working using linux-uvc.
Tried both versions 51 and 64 but neither one worked although the
camera model is said to be supported:

uvcvideo: Found UVC 1.00 device <unnamed> (046d:08c1)
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110.
uvcvideo: Failed to initialize the device (-5).

After this, the device /dev/video0 does appear, but

gmplayer -tv device=/dev/video0:driver=v4l2:channel=0 tv://

says:

MPlayer 1.0pre8-3.4.4 (C) 2000-2006 MPlayer Team
CPU:               Intel(R) Pentium(R) 4 CPU 2.40GHz (Family: 15, Model: 2, Stepping: 9)
SSE2 supported but disabled
CPUflags:  MMX: 1 MMX2: 1 3DNow: 0 3DNow2: 0 SSE: 1 SSE2: 0
Compiled with runtime CPU detection.

93 audio & 211 video codecs

Playing tv://.
Selected driver: v4l2
 name: Video 4 Linux 2 input
 author: Martin Olschewski <olschewski at zpr.uni-koeln.de>
 comment: first try, more to come ;-)
v4l2: ioctl get standard failed: Invalid argument
Selected device: USB Video Class device
 Capabilites:  video capture  streaming
 supported norms:
 inputs: 0 = Camera;
 Current input: 0
 Current format: YUYV
v4l2: ioctl set format failed: Input/output error
v4l2: ioctl set mute failed: Invalid argument
v4l2: 0 frames successfully processed, 0 frames dropped.

Exiting... (Quit)

This is Linux-2.6.18 with version 64 but it did about the same with
older kernels and version 51.

What can be the reason for this?
Am I doing something wrong?

Thanks!

Best regards,

Sab


From larry at foxgulch.com  Wed Nov  1 19:19:33 2006
From: larry at foxgulch.com (Larry Jones)
Date: Wed, 01 Nov 2006 11:19:33 -0700
Subject: [Linux-uvc-devel] lucview fails upon second invocation?
Message-ID: <4548E535.9070309@foxgulch.com>

I've made some progress thanks to the help found here and elsewhere on the web.  I can run luvview with the uvcvideo-52 version driver.  But only one time before I have to reboot to successfully invoke lucview again.  Below   lines beginning with *** are my comments, the other lines are copied from the terminal window.
-------------------------------------------------------------------------------------------------------------------

***** First, I invoke luvcview and it runs normally.*
*
$ ./luvcview
uvcview version 0.1.7
Video driver: x11
A window manager is available
video /dev/video0

*****  Second,  I quit luvcview with the "Quit Happy Bye Bye button"
**** luvcview exits normally, spitting out:**

$ Clean Up done Quit

*****  Third I attempt invoke ./lucview again **

$ ./luvcview
uvcview version 0.1.7
Video driver: x11
A window manager is available
video /dev/video0
Unable to set format: 5.
 Init v4L2 failed !! exit fatal

***** If I reboot my PC,  luvcview runs normally one more time
*** but again  fails on second  invocation of ./luvcview as described above**

***** dmesg contains**
uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -32.
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32.


-----------------------------------
This is with Linux lian 2.6.18-1.2200.fc5
uvcvideo-52
and lucview-20060920.
and a Logitech  QuickCam Orbit MP  id= 046d:08c2 Logitech, Inc.

In the /* comments */ preface to  uvcvideo.c,   I read

* * Multiple open is not supported. Opening the driver multiple times will fail
* * with -EBUSY. This might or might not be fixed soon.*

Is this the cause of the failure of ./lucview to exit and then run again. 
Thank you,


Larry Jones



From vidarno at gmail.com  Thu Nov  2 00:21:11 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Thu, 2 Nov 2006 00:21:11 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
Message-ID: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>

Hi,

I need to record video from my webcam, a Logitech Quickam for Notebooks Pro,
and also grab a stillframe fairly often, say each 10-20 seconds? I am unsure
which
software is compatible with the uvc driver, but what I need is software
where I can
specify that it has to record for an hour and then start a new file,
recording for an
hour, etc.). A comnmand-line utility is preferred as this is for a
surveillance system.

For framegrabbing I have tried to use uvccapture (0.4) but if I run the
command
with the following parameters I get an  "ioctl reset control error" and
"ioctl
querycontrol error 5": .
/uvccapture -t10

Any and all help is greatly appreciated. And let me thank you all for great
work
with the uvc driver and helpful replies in the mailing list (which I have
read quite
alot of posts of).

Sincerely,
Vidar Normann
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061102/b61ac93d/attachment.html>

From ticapix at gmail.com  Thu Nov  2 07:52:50 2006
From: ticapix at gmail.com (Pierre G)
Date: Thu, 2 Nov 2006 07:52:50 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
Message-ID: <6c4a3a1d0611012252o4c61ad4bw11c468a3f373f534@mail.gmail.com>

Hi,

To  record video from my 5000 pro, I used this scriptshell function with ffmpeg:

function record_cam () {
   [ "$#" -ne 2 ] && echo "usage: ./$0 /dev/video file" && return 1
   ffmpeg -vd "$1" -target svcd -s 640x480 -ad /dev/dsp -ad /dev/dsp -ac 1 "$2"
}

I just have to specify record_cam /dev/video0 /tmp/video.avi

I sure that you can fix the framerate with -fps option and put this
function in another scriptshell function that will append date and
hour to the file name.
To record for one hour, use the -t duration option.

Pierre

On 11/2/06, Vidar Normann <vidarno at gmail.com> wrote:
> Hi,
>
> I need to record video from my webcam, a Logitech Quickam for Notebooks Pro,
> and also grab a stillframe fairly often, say each 10-20 seconds? I am unsure
> which
> software is compatible with the uvc driver, but what I need is software
> where I can
> specify that it has to record for an hour and then start a new file,
> recording for an
> hour, etc.). A comnmand-line utility is preferred as this is for a
> surveillance system.
>
> For framegrabbing I have tried to use uvccapture ( 0.4) but if I run the
> command
> with the following parameters I get an  "ioctl reset control error" and
> "ioctl
> querycontrol error 5": .
> /uvccapture -t10
>
> Any and all help is greatly appreciated. And let me thank you all for great
> work
> with the uvc driver and helpful replies in the mailing list (which I have
> read quite
> alot of posts of).
>
> Sincerely,
> Vidar Normann
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
>
>


-- 
EPITA - Temps Reel - promo 2006 - Gentoo User
MSN: ticapix at hotmail.com
Skype.com: Ticapix


From vidarno at gmail.com  Thu Nov  2 08:13:34 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Thu, 2 Nov 2006 08:13:34 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <9398f0eb0611011530v7772959fmfb65fe96c662fea7@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<9398f0eb0611011530v7772959fmfb65fe96c662fea7@mail.gmail.com>
Message-ID: <2eed5f740611012313g30a98690x1ee0f7c01c54aac@mail.gmail.com>

Hello,

thank you for the suggestion. I don't really need motion-detection as I'd
like it to record always, but otherwise it seems to be able to do what I
want.

Vidar

On 11/2/06, George Styles <ripnetuk at gmail.com> wrote:
>
> Hi,
>
> I use motion - with the V4L2 patch (google it) - it supports motion
> detection, and can record a movie when it detects motion, and can be
> set to capture stills every X seconds as well
>
> Of course, this is with the linuxuvc driver (with a Orbit camera)
>
> g
>
>
> On 11/1/06, Vidar Normann <vidarno at gmail.com> wrote:
> > Hi,
> >
> > I need to record video from my webcam, a Logitech Quickam for Notebooks
> Pro,
> > and also grab a stillframe fairly often, say each 10-20 seconds? I am
> unsure
> > which
> > software is compatible with the uvc driver, but what I need is software
> > where I can
> > specify that it has to record for an hour and then start a new file,
> > recording for an
> > hour, etc.). A comnmand-line utility is preferred as this is for a
> > surveillance system.
> >
> > For framegrabbing I have tried to use uvccapture ( 0.4) but if I run the
> > command
> > with the following parameters I get an  "ioctl reset control error" and
> > "ioctl
> > querycontrol error 5": .
> > /uvccapture -t10
> >
> > Any and all help is greatly appreciated. And let me thank you all for
> great
> > work
> > with the uvc driver and helpful replies in the mailing list (which I
> have
> > read quite
> > alot of posts of).
> >
> > Sincerely,
> > Vidar Normann
> >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061102/2c8612e3/attachment.html>

From vidarno at gmail.com  Thu Nov  2 10:58:58 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Thu, 2 Nov 2006 10:58:58 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <6c4a3a1d0611012252o4c61ad4bw11c468a3f373f534@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<6c4a3a1d0611012252o4c61ad4bw11c468a3f373f534@mail.gmail.com>
Message-ID: <2eed5f740611020158x654a625fmf0d3cc743ec31445@mail.gmail.com>

Thank you pierre, that is just what I need. I have been toying around with
ffmpeg since your post but am unable to view the resulting video file with
mplayer,xine or vlc. ffmpeg does not give any errors. I am sure the camera
works as I have tried it with both luvcview and uvccapture.

Any suggestions?

Vidar

On 11/2/06, Pierre G <ticapix at gmail.com> wrote:
>
> Hi,
>
> To  record video from my 5000 pro, I used this scriptshell function with
> ffmpeg:
>
> function record_cam () {
>    [ "$#" -ne 2 ] && echo "usage: ./$0 /dev/video file" && return 1
>    ffmpeg -vd "$1" -target svcd -s 640x480 -ad /dev/dsp -ad /dev/dsp -ac 1
> "$2"
> }
>
> I just have to specify record_cam /dev/video0 /tmp/video.avi
>
> I sure that you can fix the framerate with -fps option and put this
> function in another scriptshell function that will append date and
> hour to the file name.
> To record for one hour, use the -t duration option.
>
> Pierre
>
> On 11/2/06, Vidar Normann <vidarno at gmail.com> wrote:
> > Hi,
> >
> > I need to record video from my webcam, a Logitech Quickam for Notebooks
> Pro,
> > and also grab a stillframe fairly often, say each 10-20 seconds? I am
> unsure
> > which
> > software is compatible with the uvc driver, but what I need is software
> > where I can
> > specify that it has to record for an hour and then start a new file,
> > recording for an
> > hour, etc.). A comnmand-line utility is preferred as this is for a
> > surveillance system.
> >
> > For framegrabbing I have tried to use uvccapture ( 0.4) but if I run the
> > command
> > with the following parameters I get an  "ioctl reset control error" and
> > "ioctl
> > querycontrol error 5": .
> > /uvccapture -t10
> >
> > Any and all help is greatly appreciated. And let me thank you all for
> great
> > work
> > with the uvc driver and helpful replies in the mailing list (which I
> have
> > read quite
> > alot of posts of).
> >
> > Sincerely,
> > Vidar Normann
> >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> >
> >
> >
>
>
> --
> EPITA - Temps Reel - promo 2006 - Gentoo User
> MSN: ticapix at hotmail.com
> Skype.com: Ticapix
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061102/90eb7e71/attachment.html>

From noblepepper at bellsouth.net  Thu Nov  2 15:41:44 2006
From: noblepepper at bellsouth.net (Noble Pepper)
Date: Thu, 2 Nov 2006 14:41:44 +0000 (UTC)
Subject: [Linux-uvc-devel] Logitech Orb won't pan/tilt in 704x576 resolution
Message-ID: <loom.20061102T153058-9@post.gmane.org>

Hello again.

I just installed a USB2.0 interface in my desktop box so I am playing with
the higher resolutions available with the Orb.

In 320x240 and 640x480 resolutions, the pan/tilt operates fine in both
luvcview and motion. 

When I go to 704x576 I get errors and the camera doesn't move

In luvcview I get:
ioctl pan updown control error
Set Pan up error
ioctl tiltupdown control error
Set Tilt up error

In motion I get:
[0] Failed to move camera!: Input/output error
[0] httpd - Read from client: Input/output error

Since both apps have similar problems I am assuming this is a driver or
hardware problem.

Is this a known issue?

Are you interested in pursuing this?

I am going to try to get more detailed info but any tips would help at this
point.





From vidarno at gmail.com  Thu Nov  2 23:25:05 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Thu, 2 Nov 2006 23:25:05 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <op.tieqhjpt42iof8@maya>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<op.tieqhjpt42iof8@maya>
Message-ID: <2eed5f740611021425r294b8680x96396d99711d84ff@mail.gmail.com>

GStreamer is an X-windows program, right? I'll have to look into it
tomorrow.
I've used this entire day trying to get ffmpeg to work, my only hurdle being
that
it currently doesn't care if I use "-t" so I'm unable to specify a period
for it to
record, and thus it's kind of useless for me..If anyone is interested, this
is
the line which doesn't work as expected (based on Pierres script)

ffmpeg -vd "/dev/video0" -target vcd -t 15 "test.avi"
(should result in 15-second recording,but it keeps on recording and I have
to quit it with "q")

Anyway, thanks for the great suggestions so far.

Sleepy,
Vidar




On 11/2/06, Martin Rubli <linux at rubli.info> wrote:
>
> Have you tried using GStreamer? The latest version of GStreamer's v4l2src
> plugin works quite well with the UVC driver. It has proven quite flexible
> in the past and you could probably use gst-launch or write your own little
> command line program if you want to script it.
>
> Cheers,
> Martin
>
>
> On Thu, 02 Nov 2006 00:21:11 +0100, Vidar Normann <vidarno at gmail.com>
> wrote:
>
> > Hi,
> >
> > I need to record video from my webcam, a Logitech Quickam for Notebooks
> > Pro,
> > and also grab a stillframe fairly often, say each 10-20 seconds? I am
> > unsure
> > which
> > software is compatible with the uvc driver, but what I need is software
> > where I can
> > specify that it has to record for an hour and then start a new file,
> > recording for an
> > hour, etc.). A comnmand-line utility is preferred as this is for a
> > surveillance system.
> >
> > For framegrabbing I have tried to use uvccapture (0.4) but if I run the
> > command
> > with the following parameters I get an  "ioctl reset control error" and
> > "ioctl
> > querycontrol error 5": .
> > /uvccapture -t10
> >
> > Any and all help is greatly appreciated. And let me thank you all for
> > great
> > work
> > with the uvc driver and helpful replies in the mailing list (which I
> have
> > read quite
> > alot of posts of).
> >
> > Sincerely,
> > Vidar Normann
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061102/f3f3b174/attachment.html>

From pablo.dangelo at web.de  Thu Nov  2 23:54:03 2006
From: pablo.dangelo at web.de (Pablo d'Angelo)
Date: Thu, 02 Nov 2006 23:54:03 +0100
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <op.tierv4dc42iof8@maya>
References: <649942202@web.de> <op.tierv4dc42iof8@maya>
Message-ID: <454A770B.2080705@web.de>

Hi Martin,

Sorry for this slightly off topic mail, its more about the capabilities of
webcams than the driver..

>> The question now is, which framerate could I expect
>> from 5 UVC USB2 cameras connected to a single laptop? Or is there a
>> principal problem of using that amount of cameras at the same time?
> 
> I don't have the equipment to do this test with me at the moment but to
> give you something to work with:
> 
> - The UVC overhead is minimal.
> - There is obviously some USB overhead but it should be rather small
> compared to the video stream.
> - In YUV mode, the size of one frame is 1.5*height*width.
> - In MJPEG mode, the size is somewhat unpredictable but obviously tends
> to be much smaller. You can test this using the -c option of luvcview.

The YUV mode definitely leads to a huge amount of data in that case. (if 15
or 30 fps is desired). With a firewire camera at least the capture wouldn't
be a problem (no copying involved, all data transfered via DMA), saving to
disk probably is the killer there. At first I'm looking at dumping the
images right to disk.

So a camera with MJPEG output would be definitely a nice thing to have,
because it would probably lead to a manageable amount of data.
Unfortunately, I would like to know a bit more about the capabilities of the
recent logitech webcams before I buy one, just to find that it doesn't do
the things I need.

MJPEG support is good news, but there is not information on the web for with
resolution and framerates it is supported.
All information from logitech is just marketing bubbles, no hard facts
there, like which mode is available at what image size and frame rate.

The only thing I found out is that the Fusion doesn't support more than 7.5
fps in its highest resolution (in RGB24 mode?):
http://ghonis2.ho8.com/fusiontest5.html

The question now is what the limits for MJPEG capturing are. Given the lack
of tech info on the web, has anybody with a Fusion or QC 5000 found out
framerates (and maybe average size of the data stream) for MJPEG captures at
640x480 and 1280x960?

> This should give you an idea of the amount of data you have. Whether
> your PC can handle it, is a whole other story. :-)

I hope that the MPEG streams can be saved to disk in realtime. If I have to
use YUV, maybe compression using ffmpeg might buy something, but I guess I'd
be limited to 640x480 with less than 30 fps.

ciao
  Pablo


From pierre.gronlier at gmail.com  Fri Nov  3 00:24:29 2006
From: pierre.gronlier at gmail.com (pierre gronlier)
Date: Fri, 3 Nov 2006 00:24:29 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <2eed5f740611021425r294b8680x96396d99711d84ff@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<op.tieqhjpt42iof8@maya>
	<2eed5f740611021425r294b8680x96396d99711d84ff@mail.gmail.com>
Message-ID: <ecc945da0611021524t468a955fs2d2a6c8b14353279@mail.gmail.com>

Hi Vidar,

ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
is working perfectly at home and record 15 sec.
I'm using ffmpeg-0.4.9_p20060530. (cvs version)
What is your version ?

Pierre

On 02/11/06, Vidar Normann <vidarno at gmail.com> wrote:
> GStreamer is an X-windows program, right? I'll have to look into it
> tomorrow.
> I've used this entire day trying to get ffmpeg to work, my only hurdle being
> that
> it currently doesn't care if I use "-t" so I'm unable to specify a period
> for it to
> record, and thus it's kind of useless for me..If anyone is interested, this
> is
> the line which doesn't work as expected (based on Pierres script)
>
> ffmpeg -vd "/dev/video0" -target vcd -t 15 "test.avi "
> (should result in 15-second recording,but it keeps on recording and I have
> to quit it with "q")
>
> Anyway, thanks for the great suggestions so far.
>
> Sleepy,
> Vidar
>
>
>
>
>  On 11/2/06, Martin Rubli <linux at rubli.info> wrote:
> > Have you tried using GStreamer? The latest version of GStreamer's v4l2src
> > plugin works quite well with the UVC driver. It has proven quite flexible
> > in the past and you could probably use gst-launch or write your own little
> > command line program if you want to script it.
> >
> > Cheers,
> > Martin
> >
> >
> > On Thu, 02 Nov 2006 00:21:11 +0100, Vidar Normann <vidarno at gmail.com>
> > wrote:
> >
> >
> > > Hi,
> > >
> > > I need to record video from my webcam, a Logitech Quickam for Notebooks
> > > Pro,
> > > and also grab a stillframe fairly often, say each 10-20 seconds? I am
> > > unsure
> > > which
> > > software is compatible with the uvc driver, but what I need is software
> > > where I can
> > > specify that it has to record for an hour and then start a new file,
> > > recording for an
> > > hour, etc.). A comnmand-line utility is preferred as this is for a
> > > surveillance system.
> > >
> > > For framegrabbing I have tried to use uvccapture (0.4) but if I run the
> > > command
> > > with the following parameters I get an  "ioctl reset control error" and
> > > "ioctl
> > > querycontrol error 5": .
> > > /uvccapture -t10
> > >
> > > Any and all help is greatly appreciated. And let me thank you all for
> > > great
> > > work
> > > with the uvc driver and helpful replies in the mailing list (which I
> have
> > > read quite
> > > alot of posts of).
> > >
> > > Sincerely,
> > > Vidar Normann
> >
> >
> >
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
>
>


-- 
www.gentoo.org - www.dptmaths.ens-cachan.fr - www.epita.fr - www.iitk.ac.in
http://ticapix.blogspot.com/


From mclaughlin.denis at gmail.com  Fri Nov  3 06:05:40 2006
From: mclaughlin.denis at gmail.com (Denis McLaughlin)
Date: Fri, 3 Nov 2006 00:05:40 -0500
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <649942202@web.de>
References: <649942202@web.de>
Message-ID: <74e91400611022105t5ebf0c24y77ed138071c3b6a3@mail.gmail.com>

  I'm working on a project that involves streaming from multiple web cams.
By and large, things work, but there are some gotchas.

 - my system is a P4 2.8GHz with 1G of memory
 - running Debian with kernel 2.6.17
 - I have 8 logitech QC fusions, as well as 6 logitech QC messengers on the
system
 - the 8 fusions are grouped 4-each into two USB2 hubs
 - I'm capturing the fusions at 640x480x15fps
 - I wrote a capture program (based on luvcview) which grabs frames from a
uvc cam and dunks it into a datafile with a timestamp: I run 8 instances of
this capture program, one for each of the fusions
 - the messengers, being USB 1.1, can't stream, but I snap pics from them
round-robin fashion, hitting each cam about once every 3 or 4 seconds
 - I'm also recording audio from each of the 8 fusions as well
 - the entire recording system is stable enough to run for 2-3 hours or more
(generating 70-80G of audio and video)

  Because I'm getting MJPEG encoded frames from the fusions, the frames can
be directly stored without any post-processing, and consequently there is
very little CPU overhead in capturing the data.  I can capture 8
640x480x15fps video streams, plus record 8 audio streams, and snap pics from
the messengers, all on the same system, and CPU utilization is spiky but
generally low.

  However, there are gotchas, not all of which I have solutions for:

 - Audio recording from the fusions has a persistent pop or click in it.
This makes the audio unusable directly, but it's not difficult to remove the
clicks using something like audacity or gnome wave cleaner.

 - While the USB 2 bus can support 8 streaming cams, there seems to be a
fair bit of jitter in capture time.  The capture utility I wrote time-stamps
each frame as it receives it, but while the frames are generally uniformly
spaced 0.066s, there are occasional dropouts and periods where frames are
snapped very quickly one after another.  I haven't done enough testing to
know whether this jitter gets worse with more web cams or not.

 - Likely as a consequence of the time jitter in the USB bus (or maybe a
problem with the cams?  or maybe my capture program?), I'm having a lot of
trouble trying to synchronize the video streams from the fusions with the
audio I recorded.  I'm still working on a solution to this one... :(

  Capturing the cameras in YUV format may introduce other bottlenecks
because of the increased bandwidth, I haven't tried that.  My 640x480 MJPEG
frames come in around 70k apiece.

  Hope this helps!

Denis

On 10/20/06, Pablo dAngelo <Pablo.dAngelo at web.de> wrote:
>
> Hi all,
>
> I would like to build an omnidirectional video camera system, that can
> capture a 360? degree view of a scene, similar to the ladybug camera by
> pointgrey (http://www.ptgrey.com/products/ladybug2/index.asp). Such a
> system would probably consist of 4 or 5 cameras rotated by 90 or 72 degrees
> each, and maybe another one pointing upwards. They should all capture images
> in parallel.
>
> Since it should be quite cheap (but high quality), my only option is to
> use webcams, either based on USB or Firewire (although the only affordable
> firewire camera I found, the Fire-I seems to be out of production).
>
> I have a single Philips 740K camera, which has a nice picture quality and
> provides a standard M12x0.5 lens screw mount, so I can mount some third
> party wide angle lens. However, it is limited to USB 1.1, that will lead
> to a very limited framerate, I fear.
>
> Therefore I'm thinking about using USB2 webcams, such as the Logitech
> Fusion or Pro 5000, to increase the overall framerate I can archive with
> this driver. The question now is, which framerate could I expect from 5 UVC
> USB2 cameras connected to a single laptop? Or is there a principal problem
> of using that amount of cameras at the same time?
>
> On
> https://lists.berlios.de/pipermail/linux-uvc-devel/2006-March/000365.html,
> David Moore noticed:
> > Hi, I'm interested in connecting more than one camera at once,
> > specifically, a pair of Logitech Quickcam Pro 5000s.
> > I only have one at the moment, but when I run it at full uncompressed
> > resolution (640x480x30fps YUV), it chooses an ISO endpoint with a packet
> > size of 3060 bytes.  This is more than half of the available ISO
> > bandwidth. (cat /proc/bus/usb/devices claims it's 60%)
>
> Is there a compression method supported by the cameras (for example
> MJPEG), that would lead to higher compression, thus allowing a higher total
> framerate?
>
> Btw. Thanks a lot for developing this driver!
>
> ciao
>   Pablo
> __________________________________________________________________________
> Erweitern Sie FreeMail zu einem noch leistungsst?rkeren E-Mail-Postfach!
> Mehr Infos unter http://freemail.web.de/home/landingpad/?mc=021131
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/31714401/attachment.html>

From pablo.dangelo at web.de  Fri Nov  3 08:19:00 2006
From: pablo.dangelo at web.de (Pablo d'Angelo)
Date: Fri, 03 Nov 2006 08:19:00 +0100
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <op.tiewuyq242iof8@maya>
References: <649942202@web.de> <op.tierv4dc42iof8@maya>
	<454A770B.2080705@web.de> <op.tiewuyq242iof8@maya>
Message-ID: <454AED64.10601@web.de>

Hi Martin,

Martin Rubli wrote:
> Hey Pablo,
> 
>> The YUV mode definitely leads to a huge amount of data in that case.
>> (if 15 or 30 fps is desired). With a firewire camera at least the
>> capture wouldn't be a problem (no copying involved, all data
>> transfered via DMA)
> 
> How is Firewire different from USB in this case?

All memory transfer is handled by DMA, leading to little cpu load. The
cameras firewire cameras I use at work do not have any problems with
streaming 3 uncompressed VGA grayscale images at 30 fps over one firewire
bus. Denis McLaughlin reported that the capture is not always steady when he
tries streaming of a similar amount of data using USB2.0 and 4 logitech
fusion cameras at VGA and 15 fps (and he is using MJPEG, which results in
dramatically less bandwidth, 70kB instead of 300kB per frame.). I don't know
if this is a camera or a driver issue though.

Since I need to combine the images into one single image/panorama
afterwards, having synchronized cameras would be best, but I think if the
capture frequency is the same for each camera and stays constant, it is
hopefully possible to do once define the offset in frames for each camera
(relative to one master camera) after the capture.

>> MJPEG support is good news, but there is not information on the web
>> for with resolution and framerates it is supported.
>> All information from logitech is just marketing bubbles, no hard facts
>> there, like which mode is available at what image size and frame rate.
> 
> I work for Logitech, so feel free to bring on criticism ... :-)

*g*

Thanks a lot for the detailed information! Nice to see that detailed
information is/will be available on the web soon.

I have one more question: I heard that the Quickcam Fusion uses a rolling
shutter (which means that the whole image is not captured at once, but in a
row by row, or similar manner). Is can lead to artefacts for moving objects.
I understand that this is not a problem for the typical webcam user, but for
some applications (mostly for merging multiple images into a panorama or
doing stereo analysis or similar) it is preferable to have a progressive
scan camera (where the whole image is captured at once).

Do you know if logitech manufactures webcams with progressive scan sensors?

ciao
  Pablo


From pablo.dangelo at web.de  Fri Nov  3 08:36:14 2006
From: pablo.dangelo at web.de (Pablo d'Angelo)
Date: Fri, 03 Nov 2006 08:36:14 +0100
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <74e91400611022105t5ebf0c24y77ed138071c3b6a3@mail.gmail.com>
References: <649942202@web.de>
	<74e91400611022105t5ebf0c24y77ed138071c3b6a3@mail.gmail.com>
Message-ID: <454AF16E.3070402@web.de>

Hi Denis,

This sounds very interesting, and is a quite similar setup to what I would
like to use.

Denis McLaughlin wrote:
>  - While the USB 2 bus can support 8 streaming cams, there seems to be a
> fair bit of jitter in capture time.  The capture utility I wrote
> time-stamps each frame as it receives it, but while the frames are
> generally uniformly spaced 0.066s, there are occasional dropouts and
> periods where frames are snapped very quickly one after another.  I
> haven't done enough testing to know whether this jitter gets worse with
> more web cams or not.

That doesn't sound very good for my application, since I need synchronised
images (audio is not so important for me). Is the timestamp you recorded an
accurate indicator for the capture time, or is it independent from that?

>  - Likely as a consequence of the time jitter in the USB bus (or maybe a
> problem with the cams?  or maybe my capture program?), I'm having a lot
> of trouble trying to synchronize the video streams from the fusions with
> the audio I recorded.  I'm still working on a solution to this one... :(

If the timestamp itself is a reliable measure for the jitter, it might be
possible to leave out or duplicate some frames in post processing.

> My 640x480 MJPEG frames come in around 70k apiece.

Great. Sounds like a very managable amount of data.

ciao
  Pablo


From vidarno at gmail.com  Fri Nov  3 09:34:37 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Fri, 3 Nov 2006 09:34:37 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <ecc945da0611021524t468a955fs2d2a6c8b14353279@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<op.tieqhjpt42iof8@maya>
	<2eed5f740611021425r294b8680x96396d99711d84ff@mail.gmail.com>
	<ecc945da0611021524t468a955fs2d2a6c8b14353279@mail.gmail.com>
Message-ID: <2eed5f740611030034q3bd2290dpff9d6a33faca6e64@mail.gmail.com>

Hi Pierre,

I tried the command which worked for you and I still get the same result,
output at the end of this mail. My current version is the newest subversion
version (ahem) but I have also tried with the version packaged with Ubuntu
Edgy Eft (same problem) and the older one from Dapper Drake (no image).
I will try to get the same version you are using, hoping that the bug
affecting
me was not introduced yet at that time. :)

Vidar

ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
FFmpeg version SVN-rUNKNOWN, Copyright (c) 2000-2004 Fabrice Bellard
  configuration:  --enable-gpl --enable-pp --enable-pthreads --enable-vorbis
--enable-libogg --enable-a52 --enable-dts --enable-libgsm --enable-dc1394
--disable-debug --enable-shared --prefix=/usr
  libavutil version: 0d.49.0.0
  libavcodec version: 0d.51.11.0
  libavformat version: 0d.50.5.0
  built on Sep 20 2006 00:08:26, gcc: 4.1.2 20060906 (prerelease) (Ubuntu
4.1.1-13ubuntu2)
Assuming PAL for target.
[video4linux2 @ 0x2b5aa0742400][4]Capabilities: 4000001
The V4L2 driver changed the video from 352x288 to 1024x576
Input #0, video4linux2, from '':
  Duration: N/A, bitrate: N/A
  Stream #0.0: Video: rawvideo, yuv422, 1024x576, 235929 kb/s, 25.00 fps(r)
Input #1, audio_device, from '':
  Duration: N/A, bitrate: N/A
  Stream #1.0: Audio: pcm_s16le, 44100 Hz, mono, 705 kb/s
PIX_FMT_YUV420P will be used as an intermediate format for rescaling
Output #0, vcd, to 'test.avi':
  Stream #0.0: Video: mpeg1video, yuv420p, 352x288, q=2-31, 1150 kb/s,
25.00fps(c)
  Stream #0.1: Audio: mp2, 44100 Hz, mono, 224 kb/s
Stream mapping:
  Stream #0.0 -> #0.0
  Stream #1.0 -> #0.1
Press [q] to stop encoding
frame=  535 q=2.0 Lsize=    3030kB time=21.4 bitrate=1162.0kbits/s
video:1031kB audio:0kB global headers:0kB muxing overhead 193.764138%



On 11/3/06, pierre gronlier <pierre.gronlier at gmail.com> wrote:
>
> Hi Vidar,
>
> ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
> is working perfectly at home and record 15 sec.
> I'm using ffmpeg-0.4.9_p20060530. (cvs version)
> What is your version ?
>
> Pierre
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/ecb61cb4/attachment.html>

From linux at rubli.info  Fri Nov  3 09:34:35 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:34:35 +0100
Subject: [Linux-uvc-devel] Logitech Orb won't pan/tilt in 704x576
	resolution
In-Reply-To: <loom.20061102T153058-9@post.gmane.org>
References: <loom.20061102T153058-9@post.gmane.org>
Message-ID: <op.tifl3xzh42iof8@maya>

Hi,

As a certain other company would put it: This behavior is by design. ;-)

If you try the same thing on Windows, you will see that the pan/tilt
buttons are disabled for resolutions higher than VGA. It's a limitation of
the hardware.

Cheers,
Martin


On Thu, 02 Nov 2006 15:41:44 +0100, Noble Pepper
<noblepepper at bellsouth.net> wrote:

> Hello again.
>
> I just installed a USB2.0 interface in my desktop box so I am playing  
> with
> the higher resolutions available with the Orb.
>
> In 320x240 and 640x480 resolutions, the pan/tilt operates fine in both
> luvcview and motion.
>
> When I go to 704x576 I get errors and the camera doesn't move
>
> In luvcview I get:
> ioctl pan updown control error
> Set Pan up error
> ioctl tiltupdown control error
> Set Tilt up error
>
> In motion I get:
> [0] Failed to move camera!: Input/output error
> [0] httpd - Read from client: Input/output error
>
> Since both apps have similar problems I am assuming this is a driver or
> hardware problem.
>
> Is this a known issue?
>
> Are you interested in pursuing this?
>
> I am going to try to get more detailed info but any tips would help at  
> this
> point.
>
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From linux at rubli.info  Fri Nov  3 09:34:53 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:34:53 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
Message-ID: <op.tifl4fcz42iof8@maya>

Have you tried using GStreamer? The latest version of GStreamer's v4l2src
plugin works quite well with the UVC driver. It has proven quite flexible
in the past and you could probably use gst-launch or write your own little
command line program if you want to script it.

Cheers,
Martin


On Thu, 02 Nov 2006 00:21:11 +0100, Vidar Normann <vidarno at gmail.com>
wrote:

> Hi,
>
> I need to record video from my webcam, a Logitech Quickam for Notebooks  
> Pro,
> and also grab a stillframe fairly often, say each 10-20 seconds? I am  
> unsure
> which
> software is compatible with the uvc driver, but what I need is software
> where I can
> specify that it has to record for an hour and then start a new file,
> recording for an
> hour, etc.). A comnmand-line utility is preferred as this is for a
> surveillance system.
>
> For framegrabbing I have tried to use uvccapture (0.4) but if I run the
> command
> with the following parameters I get an  "ioctl reset control error" and
> "ioctl
> querycontrol error 5": .
> /uvccapture -t10
>
> Any and all help is greatly appreciated. And let me thank you all for  
> great
> work
> with the uvc driver and helpful replies in the mailing list (which I have
> read quite
> alot of posts of).
>
> Sincerely,
> Vidar Normann


From linux at rubli.info  Fri Nov  3 09:35:22 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:35:22 +0100
Subject: [Linux-uvc-devel] Changing and Jumbled picture from uvcvideo
	driver using Logitech 046d:08c2 USB Webcam
In-Reply-To: <453FC509.8090904@foxgulch.com>
References: <453FC509.8090904@foxgulch.com>
Message-ID: <op.tifl48gx42iof8@maya>

Hi Larry,

> 3.  But all the video producing applications I've tried so far,  produce
> a jumbled picture such as this 7 kB sample viewable at
>
> http://foxgulch.com/Miscellaneous/snap.jpg
>
> If you look closely, you can see parts of my face,  but not in the
> sequence my Mother intended. {;-)

Does this happen in JPEG and YUV mode? You can test this with the help of
the -f option when launching luvcview.

What about different resolutions? It would be great if you could post some
more samples. I've never seen anything like this, although it reminds me
of some pictures where the Y, U, and V channels were screwed up. (But that
couldn't possibly occur in JPEG mode.)

> 4.  That  above jpg was produced with uvccapture.   Under
> luvcview20060920,  I can control the pan/tilt etc of the 046d:08C2
> logitech orbit/sphere usb web camera.  However the fps number shown at
> the top constantly varies and the picture is repeatedly  similarly  
> jumbled.

Again, rather strange behavior. Does your camera work on Windows, just to
be sure?

Cheers,
Martin


From linux at rubli.info  Fri Nov  3 09:35:31 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:35:31 +0100
Subject: [Linux-uvc-devel] HP dv2000 laptop
In-Reply-To: <200610252107.17347.laurent.pinchart@skynet.be>
References: <1160372834.5529.5.camel@soncomputer>
	<1161743974.12182.1.camel@sonlaptop>
	<1161748765.4063.10.camel@sonlaptop>
	<200610252107.17347.laurent.pinchart@skynet.be>
Message-ID: <op.tifl5hhx42iof8@maya>

On Wed, 25 Oct 2006 21:07:17 +0200, Laurent Pinchart
<laurent.pinchart at skynet.be> wrote:

> Your webcam might not have sound support.
>
> uvcvideo is a video-only driver anyway, I don't know much about USB audio
> support. You could try asking the snd-usb-audio developers, but if the  
> driver doesn't recognize the webcam, it probably doesn't have sound  
> support.

Indeed. Webcams built into laptops are very unlikely to have audio support
because laptops already have mic and speakers. I would check out some of
the Linux compatibility websites to see if you can get the built-in audio
to work on Linux.

http://www.linux-laptop.net/
http://tuxmobil.org/

(I'm sure there are others ...)

Cheers,
Martin


From linux at rubli.info  Fri Nov  3 09:35:43 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:35:43 +0100
Subject: [Linux-uvc-devel] Unable to set format: 22., Init v4L2 failed
In-Reply-To: <453C6412.4070108@fastsearch.com>
References: <453C1A02.7030405@fastsearch.com> <453C6412.4070108@fastsearch.com>
Message-ID: <op.tifl5tly42iof8@maya>

What about luvcview? Do you see the pattern throughout the video? If so,
could you perhaps post a few more samples?

Cheers,
Martin


On Mon, 23 Oct 2006 08:41:22 +0200, Terje Marthinussen
<terje.marthinussen at fastsearch.com> wrote:

> Trying to test higher jpeg quality with uvccapture on a Logitech Pro  
> 5000.
>
> I haven't got time to look much at the code yet, but maybe someone knows
> the answer anyway (from other posts on the lists, I do believe the
> camera should support YUV capture?).
>
> Things work fine when not using YUV capture
>
> ./bin/uvccapture  -v -q100
> Using videodevice: /dev/video0
> Saving images to: snap.jpg
> Image size: 320x240
> Taking snapshot every 0 seconds
> Taking images using mmap
> Unable to set format: 22.
>  Init v4L2 failed !! exit fatal
>
>  ./bin/uvccapture  -m -v
> Using videodevice: /dev/video0
> Saving images to: snap.jpg
> Image size: 320x240
> Taking snapshot every 0 seconds
> Taking images using mmap
> Unable to set format: 22.
>  Init v4L2 failed !! exit fatal
>
>
> ./bin/uvccapture  -v
> Using videodevice: /dev/video0
> Saving images to: snap.jpg
> Image size: 320x240
> Taking snapshot every 0 seconds
> Taking images using mmap
> Resetting camera settings
> Camera brightness level is 127
> Camera contrast level is 32
> Camera saturation level is 32
> Camera gain level is 0
> Saving image to: snap.jpg
>
> Regards,
> Terje
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From linux at rubli.info  Fri Nov  3 09:35:56 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:35:56 +0100
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <649942202@web.de>
References: <649942202@web.de>
Message-ID: <op.tifl56o242iof8@maya>

Hi,

> Therefore I'm thinking about using USB2 webcams, such as the Logitech  
> Fusion or Pro 5000, to increase the overall framerate I can archive with  
> this driver. The question now is, which framerate could I expect from 5  
> UVC USB2 cameras connected to a single laptop? Or is there a principal  
> problem of using that amount of cameras at the same time?

I don't have the equipment to do this test with me at the moment but to
give you something to work with:

- The UVC overhead is minimal.
- There is obviously some USB overhead but it should be rather small
compared to the video stream.
- In YUV mode, the size of one frame is 1.5*height*width.
- In MJPEG mode, the size is somewhat unpredictable but obviously tends to
be much smaller. You can test this using the -c option of luvcview.

This should give you an idea of the amount of data you have. Whether your
PC can handle it, is a whole other story. :-)

> On
> https://lists.berlios.de/pipermail/linux-uvc-devel/2006-March/000365.html,
> David Moore noticed:
>> Hi, I'm interested in connecting more than one camera at once,
>> specifically, a pair of Logitech Quickcam Pro 5000s.
>> I only have one at the moment, but when I run it at full uncompressed
>> resolution (640x480x30fps YUV), it chooses an ISO endpoint with a packet
>> size of 3060 bytes.  This is more than half of the available ISO
>> bandwidth. (cat /proc/bus/usb/devices claims it's 60%)

I'm not sure if this is indeed a problem because, IIRC, Linux does not
enforce isoc bandwidth constraints unless explicitly told to do so
(experimental kernel compile-time option). So, if your camera did not use
the entire 60%, it should still be available for other cameras.

> Is there a compression method supported by the cameras (for example  
> MJPEG), that would lead to higher compression, thus allowing a higher  
> total framerate?

Yes, MJPEG is supported by all Logitech UVC cameras.

Cheers,
Martin


From linux at rubli.info  Fri Nov  3 09:36:07 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:36:07 +0100
Subject: [Linux-uvc-devel] Logitech QuickCam Orbit MP Pan/Tilt
In-Reply-To: <006b01c6ed7d$fefbd650$6701a8c0@osiris>
References: <006b01c6ed7d$fefbd650$6701a8c0@osiris>
Message-ID: <op.tifl6hnx42iof8@maya>

On Wed, 11 Oct 2006 23:41:22 +0200, Bob Burch <bburch at cfl.rr.com> wrote:

> I was wondering if  anybody been successful controlling the Pan, Tilt,  
> and
> Zoom for a Orbit MP?  I have tried v4lctl and luvcview to control the
> Pan/Tilt but the MP does unpredictable things.

Yes, that's a known problem. The pan/tilt controls have changed quite a
bit in the UVC driver (e.g. their control values), so if you have a driver
version different from the one that luvcview was compiled with, it gets
messy.

But as Laurent mentioned, the latest driver splits these controls up, so
as soon as Michel catches up, that problem should be solved once and for
all.

Cheers,
Martin


From linux at rubli.info  Fri Nov  3 09:36:20 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:36:20 +0100
Subject: [Linux-uvc-devel] lucview fails upon second invocation?
In-Reply-To: <4548E535.9070309@foxgulch.com>
References: <4548E535.9070309@foxgulch.com>
Message-ID: <op.tifl6uba42iof8@maya>

Hi,

The problem has come up numerous times on this mailing list. I remember,
there was a discussion about 3 weeks ago. You may want to check the
archives.

The bottom line is that it's a problem with the cameras that only shows up
on Linux and we're still looking for root causes and workarounds. I have
another workaround that's a little less hardcore than the "reset patch"
that keeps getting mentioned. It's still ugly but Laurent is currently
testing it. We should be able to post some news about that in the next few
days ...

Cheers,
Martin


On Wed, 01 Nov 2006 19:19:33 +0100, Larry Jones <larry at foxgulch.com> wrote:

> I've made some progress thanks to the help found here and elsewhere on  
> the web.  I can run luvview with the uvcvideo-52 version driver.  But  
> only one time before I have to reboot to successfully invoke lucview  
> again.  Below   lines beginning with *** are my comments, the other  
> lines are copied from the terminal window.
> -------------------------------------------------------------------------------------------------------------------
>
> ***** First, I invoke luvcview and it runs normally.*
> *
> $ ./luvcview
> uvcview version 0.1.7
> Video driver: x11
> A window manager is available
> video /dev/video0
>
> *****  Second,  I quit luvcview with the "Quit Happy Bye Bye button"
> **** luvcview exits normally, spitting out:**
>
> $ Clean Up done Quit
>
> *****  Third I attempt invoke ./lucview again **
>
> $ ./luvcview
> uvcview version 0.1.7
> Video driver: x11
> A window manager is available
> video /dev/video0
> Unable to set format: 5.
>  Init v4L2 failed !! exit fatal
>
> ***** If I reboot my PC,  luvcview runs normally one more time
> *** but again  fails on second  invocation of ./luvcview as described  
> above**
>
> ***** dmesg contains**
> uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -32.
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32.
>
>
> -----------------------------------
> This is with Linux lian 2.6.18-1.2200.fc5
> uvcvideo-52
> and lucview-20060920.
> and a Logitech  QuickCam Orbit MP  id= 046d:08c2 Logitech, Inc.
>
> In the /* comments */ preface to  uvcvideo.c,   I read
>
> * * Multiple open is not supported. Opening the driver multiple times  
> will fail
> * * with -EBUSY. This might or might not be fixed soon.*
>
> Is this the cause of the failure of ./lucview to exit and then run again.
> Thank you,
>
>
> Larry Jones
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From linux at rubli.info  Fri Nov  3 09:36:41 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:36:41 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <2eed5f740611021425r294b8680x96396d99711d84ff@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<op.tieqhjpt42iof8@maya>
	<2eed5f740611021425r294b8680x96396d99711d84ff@mail.gmail.com>
Message-ID: <op.tifl7fwh42iof8@maya>

> GStreamer is an X-windows program, right? I'll have to look into it
> tomorrow.

Not exactly. :-) GStreamer is a platform independent multimedia library.
Obviously, using it with V4L2 makes it Linux dependent but there's not
necessarily a GUI associated with it. Most programs that use GStreamer
just happen to have one but like I said, gst-launch has no GUI and it
often takes only a few lines of code to do cool things.

> I've used this entire day trying to get ffmpeg to work, my only hurdle  
> being that it currently doesn't care if I use "-t" so I'm unable to  
> specify a period
> for it to record, and thus it's kind of useless for me..If anyone is  
> interested, this is the line which doesn't work as expected (based on  
> Pierres script)
>
> ffmpeg -vd "/dev/video0" -target vcd -t 15 "test.avi"
> (should result in 15-second recording,but it keeps on recording and I  
> have to quit it with "q")

I don't see anything obviously wrong with this. But then again, different
programs parse the command line very differently. Have you tried "-t15"
without the space? Also, the man page mentiones a second time format:
      `-t duration'
      Set the recording time in seconds. hh:mm:ss[.xxx] syntax is also
supported.
Might be worth a shot ...

Cheers,
Martin


From linux at rubli.info  Fri Nov  3 09:39:12 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 03 Nov 2006 09:39:12 +0100
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <454A770B.2080705@web.de>
References: <649942202@web.de> <op.tierv4dc42iof8@maya>
	<454A770B.2080705@web.de>
Message-ID: <op.tifmbmbs42iof8@maya>

Hey Pablo,

> The YUV mode definitely leads to a huge amount of data in that case. (if  
> 15 or 30 fps is desired). With a firewire camera at least the capture  
> wouldn't be a problem (no copying involved, all data transfered via DMA)

How is Firewire different from USB in this case?

> saving to disk probably is the killer there. At first I'm looking at  
> dumping the
> images right to disk.

Likely, but a RAID could certainly handle this.

> So a camera with MJPEG output would be definitely a nice thing to have,
> because it would probably lead to a manageable amount of data.
> Unfortunately, I would like to know a bit more about the capabilities of  
> the recent logitech webcams before I buy one, just to find that it  
> doesn't do
> the things I need.
>
> MJPEG support is good news, but there is not information on the web for  
> with resolution and framerates it is supported.
> All information from logitech is just marketing bubbles, no hard facts
> there, like which mode is available at what image size and frame rate.

I work for Logitech, so feel free to bring on criticism ... :-)

Yes, we know that it's not exactly easy to get detailed information, but
the good news is that we're working on it! We're currently setting up a
server that will host, among other things, a website with just this kind
of details. I've attached an extract. It's a list of supported frame
rates, I think that's what you're looking for. Please keep in mind that it
has some data that still needs to be checked.

> The only thing I found out is that the Fusion doesn't support more than  
> 7.5 fps in its highest resolution (in RGB24 mode?):

True, see attachment. Just to be clear: There is no RGB24 mode in the
camera. The camera only knows YUY2 (YUYV) and MJPEG. RGB24 is emulated by
the driver on Windows and so is I420.

Cheers,
Martin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/b26729ae/attachment.html>

From mxhaard at magic.fr  Fri Nov  3 12:04:25 2006
From: mxhaard at magic.fr (Michel Xhaard)
Date: Fri, 3 Nov 2006 12:04:25 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <2eed5f740611030034q3bd2290dpff9d6a33faca6e64@mail.gmail.com>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<ecc945da0611021524t468a955fs2d2a6c8b14353279@mail.gmail.com>
	<2eed5f740611030034q3bd2290dpff9d6a33faca6e64@mail.gmail.com>
Message-ID: <200611031204.25526.mxhaard@magic.fr>

Le Vendredi 3 Novembre 2006 09:34, Vidar Normann a ?crit?:
> Hi Pierre,
>
> I tried the command which worked for you and I still get the same result,
> output at the end of this mail. My current version is the newest subversion
> version (ahem) but I have also tried with the version packaged with Ubuntu
> Edgy Eft (same problem) and the older one from Dapper Drake (no image).
> I will try to get the same version you are using, hoping that the bug
> affecting
> me was not introduced yet at that time. :)
>
> Vidar
>
> ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
> FFmpeg version SVN-rUNKNOWN, Copyright (c) 2000-2004 Fabrice Bellard
>   configuration:  --enable-gpl --enable-pp --enable-pthreads
> --enable-vorbis --enable-libogg --enable-a52 --enable-dts --enable-libgsm
> --enable-dc1394 --disable-debug --enable-shared --prefix=/usr
>   libavutil version: 0d.49.0.0
>   libavcodec version: 0d.51.11.0
>   libavformat version: 0d.50.5.0
>   built on Sep 20 2006 00:08:26, gcc: 4.1.2 20060906 (prerelease) (Ubuntu
> 4.1.1-13ubuntu2)
> Assuming PAL for target.
> [video4linux2 @ 0x2b5aa0742400][4]Capabilities: 4000001
> The V4L2 driver changed the video from 352x288 to 1024x576
> Input #0, video4linux2, from '':
>   Duration: N/A, bitrate: N/A
>   Stream #0.0: Video: rawvideo, yuv422, 1024x576, 235929 kb/s, 25.00 fps(r)
> Input #1, audio_device, from '':
>   Duration: N/A, bitrate: N/A
>   Stream #1.0: Audio: pcm_s16le, 44100 Hz, mono, 705 kb/s
> PIX_FMT_YUV420P will be used as an intermediate format for rescaling
> Output #0, vcd, to 'test.avi':
>   Stream #0.0: Video: mpeg1video, yuv420p, 352x288, q=2-31, 1150 kb/s,
> 25.00fps(c)
>   Stream #0.1: Audio: mp2, 44100 Hz, mono, 224 kb/s
> Stream mapping:
>   Stream #0.0 -> #0.0
>   Stream #1.0 -> #0.1
> Press [q] to stop encoding
> frame=  535 q=2.0 Lsize=    3030kB time=21.4 bitrate=1162.0kbits/s
> video:1031kB audio:0kB global headers:0kB muxing overhead 193.764138%
>
> On 11/3/06, pierre gronlier <pierre.gronlier at gmail.com> wrote:
> > Hi Vidar,
> >
> > ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
> > is working perfectly at home and record 15 sec.
> > I'm using ffmpeg-0.4.9_p20060530. (cvs version)
> > What is your version ?
> >
> > Pierre
Hi,
 did you try the last revision of luvcview? It can now record avi file in 
native MJPG :)
regards
-- 
Michel Xhaard
http://mxhaard.free.fr


From mclaughlin.denis at gmail.com  Fri Nov  3 14:44:10 2006
From: mclaughlin.denis at gmail.com (Denis McLaughlin)
Date: Fri, 3 Nov 2006 08:44:10 -0500
Subject: [Linux-uvc-devel] Maximum framerate with multiple USB 2 cameras?
In-Reply-To: <454AF16E.3070402@web.de>
References: <649942202@web.de>
	<74e91400611022105t5ebf0c24y77ed138071c3b6a3@mail.gmail.com>
	<454AF16E.3070402@web.de>
Message-ID: <74e91400611030544w3425bc20h4a9b97ed67b988ec@mail.gmail.com>

On 11/3/06, Pablo d'Angelo <pablo.dangelo at web.de> wrote:
>
> Denis McLaughlin wrote:
> >  - While the USB 2 bus can support 8 streaming cams, there seems to be a
> > fair bit of jitter in capture time.  The capture utility I wrote
> > time-stamps each frame as it receives it, but while the frames are
> > generally uniformly spaced 0.066s, there are occasional dropouts and
> > periods where frames are snapped very quickly one after another.  I
> > haven't done enough testing to know whether this jitter gets worse with
> > more web cams or not.
>
> That doesn't sound very good for my application, since I need synchronised
> images (audio is not so important for me). Is the timestamp you recorded
> an
> accurate indicator for the capture time, or is it independent from that?


  The timestamp is just gettimeofday() called from the program doing the
capture, so it's an accurate upper bound on the frame capture time (ie. the
frame can't have been captured any later than the time stamp).although it's
unclear when in the preceding interval the picture actually came from.  I
don't want to overstate the problem: by and large, the cameras do hit 15 fps
quite accurately, it's just that there is some jitter.

  To back this up with a little data, you can see the capture times for a
single camera here: http://denism.homeip.net/stuff/capture-times, the
differences between consecutive frames here:
http://denism.homeip.net/stuff/capture-differences, and I've generated a
histogram of those differences here:
http://denism.homeip.net/stuff/interframe-histogram.png against a
logarithmic Y axis.  The histogram shows that the vast majority of the
inter-frame differences are in the 0.06-ish area, but there are a number
faster and slower than that.

  Whether or not this jitter is big enough to cause a problem depends on how
synchronized you need frames from the cameras to be: the jitter I show above
is quite tolerable for my purposes.


>  - Likely as a consequence of the time jitter in the USB bus (or maybe a
> > problem with the cams?  or maybe my capture program?), I'm having a lot
> > of trouble trying to synchronize the video streams from the fusions with
> > the audio I recorded.  I'm still working on a solution to this one... :(
>
> If the timestamp itself is a reliable measure for the jitter, it might be
> possible to leave out or duplicate some frames in post processing.


  Yeah, I have a script that massages the frames, selecting the right ones
and duping to fill in gaps as needed.  I actually had a breakthrough last
night, when I realized my audio/visual synch wasn't caused by the video
frames being non-uniform, but rather that the audio I recorded from the USB
mics isn't correct.  When I matched the video up against the audio from a DV
video camera filming the same scene, everything looked fine (wrt synch).
Yay!  So my audio-visual synch problem was actually caused by a problem with
my USB audio recording (though there is still some variability in frame
capture times, as shown above).

Denis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/a0c8793a/attachment.html>

From pablo.dangelo at web.de  Fri Nov  3 20:01:48 2006
From: pablo.dangelo at web.de (Pablo d'Angelo)
Date: Fri, 03 Nov 2006 20:01:48 +0100
Subject: [Linux-uvc-devel] Jitter during multiple camera (Fusion) capture
 [Re:Maximum framerate with multiple USB 2 cameras?]
In-Reply-To: <74e91400611030544w3425bc20h4a9b97ed67b988ec@mail.gmail.com>
References: <649942202@web.de>	
	<74e91400611022105t5ebf0c24y77ed138071c3b6a3@mail.gmail.com>	
	<454AF16E.3070402@web.de>
	<74e91400611030544w3425bc20h4a9b97ed67b988ec@mail.gmail.com>
Message-ID: <454B921C.3030007@web.de>

Hi Denis,

> I don't want to overstate the problem: by and
> large, the cameras do hit 15 fps quite accurately, it's just that there
> is some jitter.
> 
>   To back this up with a little data, you can see the capture times for
> a single camera here: http://denism.homeip.net/stuff/capture-times, the
> differences between consecutive frames here:
> http://denism.homeip.net/stuff/capture-differences, and I've generated a
> histogram of those differences here:
> http://denism.homeip.net/stuff/interframe-histogram.png against a
> logarithmic Y axis.  The histogram shows that the vast majority of the
> inter-frame differences are in the 0.06-ish area, but there are a number
> faster and slower than that.

Thank you for this data! Looks like 1.6% of all frames are lost. I noticed
that the jitter always start with a very long delay, and they seem to be
quite regular. I have attached a histogram over the time between the
jitters, and the jitter seems to occur at multiples of 80 frames. Hard to
say where it comes from, but it might be a buffering problem?

>   Whether or not this jitter is big enough to cause a problem depends on
> how synchronized you need frames from the cameras to be: the jitter I
> show above is quite tolerable for my purposes.

While I haven't calculated the tolerable amount yet, I think I probably need
to synchronize the image streams after they have been captured.

> I actually had a
> breakthrough last night, when I realized my audio/visual synch wasn't
> caused by the video frames being non-uniform, but rather that the audio
> I recorded from the USB mics isn't correct.  When I matched the video up
> against the audio from a DV video camera filming the same scene,
> everything looked fine (wrt synch).  Yay!

Good to know. But actually the video frames should be approximately 1.6%
faster than the audio, based on the data you posted. Maybe that amount is
harder to notice, but after two hours, the difference would be 115 seconds?

ciao
  Pablo


-------------- next part --------------
A non-text attachment was scrubbed...
Name: time_between_jitter.png
Type: image/png
Size: 2810 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/6bc66c67/attachment.png>

From vidarno at gmail.com  Fri Nov  3 21:35:50 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Fri, 3 Nov 2006 21:35:50 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <200611031204.25526.mxhaard@magic.fr>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<ecc945da0611021524t468a955fs2d2a6c8b14353279@mail.gmail.com>
	<2eed5f740611030034q3bd2290dpff9d6a33faca6e64@mail.gmail.com>
	<200611031204.25526.mxhaard@magic.fr>
Message-ID: <2eed5f740611031235u373aafaare59a70ce089e5d77@mail.gmail.com>

On 11/3/06, Michel Xhaard <mxhaard at magic.fr> wrote:
>
> Le Vendredi 3 Novembre 2006 09:34, Vidar Normann a ?crit:
> > Hi Pierre,
> >
> > I tried the command which worked for you and I still get the same
> result,
> > output at the end of this mail. My current version is the newest
> subversion
> > version (ahem) but I have also tried with the version packaged with
> Ubuntu
> > Edgy Eft (same problem) and the older one from Dapper Drake (no image).
> > I will try to get the same version you are using, hoping that the bug
> > affecting
> > me was not introduced yet at that time. :)
> >
> > Vidar
> >
> > ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
> > FFmpeg version SVN-rUNKNOWN, Copyright (c) 2000-2004 Fabrice Bellard
> >   configuration:  --enable-gpl --enable-pp --enable-pthreads
> > --enable-vorbis --enable-libogg --enable-a52 --enable-dts
> --enable-libgsm
> > --enable-dc1394 --disable-debug --enable-shared --prefix=/usr
> >   libavutil version: 0d.49.0.0
> >   libavcodec version: 0d.51.11.0
> >   libavformat version: 0d.50.5.0
> >   built on Sep 20 2006 00:08:26, gcc: 4.1.2 20060906 (prerelease)
> (Ubuntu
> > 4.1.1-13ubuntu2)
> > Assuming PAL for target.
> > [video4linux2 @ 0x2b5aa0742400][4]Capabilities: 4000001
> > The V4L2 driver changed the video from 352x288 to 1024x576
> > Input #0, video4linux2, from '':
> >   Duration: N/A, bitrate: N/A
> >   Stream #0.0: Video: rawvideo, yuv422, 1024x576, 235929 kb/s, 25.00fps(r)
> > Input #1, audio_device, from '':
> >   Duration: N/A, bitrate: N/A
> >   Stream #1.0: Audio: pcm_s16le, 44100 Hz, mono, 705 kb/s
> > PIX_FMT_YUV420P will be used as an intermediate format for rescaling
> > Output #0, vcd, to 'test.avi':
> >   Stream #0.0: Video: mpeg1video, yuv420p, 352x288, q=2-31, 1150 kb/s,
> > 25.00fps(c)
> >   Stream #0.1: Audio: mp2, 44100 Hz, mono, 224 kb/s
> > Stream mapping:
> >   Stream #0.0 -> #0.0
> >   Stream #1.0 -> #0.1
> > Press [q] to stop encoding
> > frame=  535 q=2.0 Lsize=    3030kB time=21.4 bitrate=1162.0kbits/s
> > video:1031kB audio:0kB global headers:0kB muxing overhead 193.764138%
> >
> > On 11/3/06, pierre gronlier <pierre.gronlier at gmail.com> wrote:
> > > Hi Vidar,
> > >
> > > ffmpeg -y -vd /dev/video0 -target vcd -t 15 test.avi
> > > is working perfectly at home and record 15 sec.
> > > I'm using ffmpeg-0.4.9_p20060530. (cvs version)
> > > What is your version ?
> > >
> > > Pierre
> Hi,
> did you try the last revision of luvcview? It can now record avi file in
> native MJPG :)
> regards
> --
> Michel Xhaard
> http://mxhaard.free.fr
>

I hadn't noticed that possibility, but tried it just now. Unfortunately what
I need
is to be able to run the program from the command line and specify the
duration
for recording - the idea is to have a script that loops "forever" so it
records an
hour of video and then another hour of video and so on - Thus creating an
archive of
1-hour long footage. In luvcvciew I have to specify when to start/stop
recording in
the GUI. If someone were to add the functionality I need though... =)
(I'd give it a go myself, but it's been a while since I programmed C)

Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/1c680fdd/attachment.html>

From vidarno at gmail.com  Fri Nov  3 22:03:03 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Fri, 3 Nov 2006 22:03:03 +0100
Subject: [Linux-uvc-devel] Recording video and grabbing a frame
In-Reply-To: <op.tifl4fcz42iof8@maya>
References: <2eed5f740611011521n242564edodd3f2a5fd1762b39@mail.gmail.com>
	<op.tifl4fcz42iof8@maya>
Message-ID: <2eed5f740611031303k236fe571n87e439b31b166d24@mail.gmail.com>

On 11/3/06, Martin Rubli <linux at rubli.info> wrote:
>
> Have you tried using GStreamer? The latest version of GStreamer's v4l2src
> plugin works quite well with the UVC driver. It has proven quite flexible
> in the past and you could probably use gst-launch or write your own little
> command line program if you want to script it.
>
> Cheers,
> Martin
>

I'm looking into it Martin, it seems gst-launch will record, but as far as I
can tell
it has no way of specifying the duration of recording which is really what
I'm
looking for.

Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061103/d0178ef8/attachment.html>

From jim at federated.com  Sat Nov  4 06:36:01 2006
From: jim at federated.com (Jim Studt)
Date: Fri, 3 Nov 2006 23:36:01 -0600
Subject: [Linux-uvc-devel] A UVC camera which does not work with this driver
Message-ID: <1307F24F-2317-45AD-81A3-20390641552C@federated.com>

I have a "Pico iMage Webcam" from Ecamm which is a CCD based UVC  
device. I suspect it is far from being supported in the uvcvideo  
drivers. It works without device specific drivers on Mac OS X and  
allegedly Windows XP so it seems they have followed the spec in some  
manner.

Problems so far:

1) The frame format descriptor is in the endpoint instead of the  
interface. I patched to look both places.
2) The probe fails. I naively skip the probe.
3) There are no isochronous endpoints. The only endpoint is Video  
Streaming endpoint for 512 byte bulk data.

At this point I'm guessing it will take 100+ lines of code to deal  
with this camera and is better left to the driver writers.

I'll switch to one of the supported logitech models. Though my first  
camera didn't work, I have to say it is nice to have a driver working  
from a documented camera API after all the time I've spent playing  
driver roulette with the various reverse engineered webcam drivers  
for linux.

If one of the active driver writers would like this camera for coding  
and they aren't someplace too expensive for me to ship from the usa  
then they should send me an email and an address and I'll send them  
the camera.



From vidarno at gmail.com  Sat Nov  4 15:44:40 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sat, 4 Nov 2006 15:44:40 +0100
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
Message-ID: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>

Hello again,

I seem to have become "lucky" enough to experience the bug with my
Logitech camera (Quickcam for Notebooks Pro) that results in this
error:

Unable to set format: 5.
 Init v4L2 failed !! exit fatal

I searched the mailing-list and found Alexandre's patch here
https://lists.berlios.de/pipermail/linux-uvc-devel/2006-February/000210.html

It patches into uvcvideo.c (although I have to specify the filename for hunk
#3
to succeed) but I still get this error. I did notice though that when
recompiling
uvc I got this warning:
warning: 'uvc_video_reinit' defined but not used

I assume it is pertinent, but I have no idea what to do. Any takers?

Regards,
Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061104/417b2401/attachment.html>

From evgeny at indent.ru  Sat Nov  4 18:01:26 2006
From: evgeny at indent.ru (Evgeny)
Date: Sat, 4 Nov 2006 20:01:26 +0300
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
Message-ID: <200611042001.26334.evgeny@indent.ru>

Hi, Vidar

What revision of uvc driver do you use?

Regards, Evgeny

> Hello again,
>
> I seem to have become "lucky" enough to experience the bug with my
> Logitech camera (Quickcam for Notebooks Pro) that results in this
> error:
>
> Unable to set format: 5.
>  Init v4L2 failed !! exit fatal
>
> I searched the mailing-list and found Alexandre's patch here
> https://lists.berlios.de/pipermail/linux-uvc-devel/2006-February/000210.htm
>l
>
> It patches into uvcvideo.c (although I have to specify the filename for
> hunk #3
> to succeed) but I still get this error. I did notice though that when
> recompiling
> uvc I got this warning:
> warning: 'uvc_video_reinit' defined but not used
>
> I assume it is pertinent, but I have no idea what to do. Any takers?
>
> Regards,
> Vidar


From vidarno at gmail.com  Sat Nov  4 17:57:10 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sat, 4 Nov 2006 17:57:10 +0100
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <200611042001.26334.evgeny@indent.ru>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
	<200611042001.26334.evgeny@indent.ru>
Message-ID: <2eed5f740611040857i75341a5ds38bc500a3ce1a325@mail.gmail.com>

Hi Evgeny,

I've been using the current svn checkout, which is from last night I
believe,
I'm unable to download a newer one at the moment, my subversion client
complains that berlios is unreachable..

Regards,
Vidar

On 11/4/06, Evgeny <evgeny at indent.ru> wrote:
>
> Hi, Vidar
>
> What revision of uvc driver do you use?
>
> Regards, Evgeny
>
> > Hello again,
> >
> > I seem to have become "lucky" enough to experience the bug with my
> > Logitech camera (Quickcam for Notebooks Pro) that results in this
> > error:
> >
> > Unable to set format: 5.
> >  Init v4L2 failed !! exit fatal
> >
> > I searched the mailing-list and found Alexandre's patch here
> >
> https://lists.berlios.de/pipermail/linux-uvc-devel/2006-February/000210.htm
> >l
> >
> > It patches into uvcvideo.c (although I have to specify the filename for
> > hunk #3
> > to succeed) but I still get this error. I did notice though that when
> > recompiling
> > uvc I got this warning:
> > warning: 'uvc_video_reinit' defined but not used
> >
> > I assume it is pertinent, but I have no idea what to do. Any takers?
> >
> > Regards,
> > Vidar
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061104/940e9fe1/attachment.html>

From evgeny at indent.ru  Sat Nov  4 19:21:40 2006
From: evgeny at indent.ru (Evgeny)
Date: Sat, 4 Nov 2006 21:21:40 +0300
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <2eed5f740611040857i75341a5ds38bc500a3ce1a325@mail.gmail.com>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
	<200611042001.26334.evgeny@indent.ru>
	<2eed5f740611040857i75341a5ds38bc500a3ce1a325@mail.gmail.com>
Message-ID: <200611042121.40683.evgeny@indent.ru>

Vidar,

There are 2 branches - split and monolithic. Monolithic branch was not updated 
since revision 52 and all work is concentrated in split branch. 
Originally "reset patch" was created for monolithic branch. I dont'd know is 
it possible to apply it to revision 52. In some time (maybe 1-2 hours) I'll 
post patch for split branch.

Sorry for my bad English
Evgeny
> Hi Evgeny,
>
> I've been using the current svn checkout, which is from last night I
> believe,
> I'm unable to download a newer one at the moment, my subversion client
> complains that berlios is unreachable..
>
> Regards,
> Vidar
>


From mclaughlin.denis at gmail.com  Sat Nov  4 18:31:32 2006
From: mclaughlin.denis at gmail.com (Denis McLaughlin)
Date: Sat, 4 Nov 2006 12:31:32 -0500
Subject: [Linux-uvc-devel] Jitter during multiple camera (Fusion)
	capture [Re:Maximum framerate with multiple USB 2 cameras?]
In-Reply-To: <454B921C.3030007@web.de>
References: <649942202@web.de>
	<74e91400611022105t5ebf0c24y77ed138071c3b6a3@mail.gmail.com>
	<454AF16E.3070402@web.de>
	<74e91400611030544w3425bc20h4a9b97ed67b988ec@mail.gmail.com>
	<454B921C.3030007@web.de>
Message-ID: <74e91400611040931r1c6de257xe269e633ea6e69b3@mail.gmail.com>

Hi Pablo,

Thank you for this data! Looks like 1.6% of all frames are lost. I noticed
> that the jitter always start with a very long delay, and they seem to be
> quite regular. I have attached a histogram over the time between the
> jitters, and the jitter seems to occur at multiples of 80 frames. Hard to
> say where it comes from, but it might be a buffering problem?


  Hmm, yeah, that is interesting.  Could be USB bus contention, or maybe
disk activity or something.

>   Whether or not this jitter is big enough to cause a problem depends on
> > how synchronized you need frames from the cameras to be: the jitter I
> > show above is quite tolerable for my purposes.
>
> While I haven't calculated the tolerable amount yet, I think I probably
> need
> to synchronize the image streams after they have been captured.


  After processing my 15fps streams, I find that I can get the frames
synchronized to within about 0.02 seconds, meaning that there's a spread of
about 0.02 seconds between the frames that I'm assigning to the same time
slot.  That's good enough for me... :)


> I actually had a
> > breakthrough last night, when I realized my audio/visual synch wasn't
> > caused by the video frames being non-uniform, but rather that the audio
> > I recorded from the USB mics isn't correct.  When I matched the video up
> > against the audio from a DV video camera filming the same scene,
> > everything looked fine (wrt synch).  Yay!
>
> Good to know. But actually the video frames should be approximately 1.6%
> faster than the audio, based on the data you posted. Maybe that amount is
> harder to notice, but after two hours, the difference would be 115
> seconds?


  Well, because I'm timestamping the frames as I capture them, I can figure
out which ones are missing and duplicate others to fill in.  When the video
is played, the duping makes it look like the scene is frozen, but it's only
very brief, so that's cool.

Denis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061104/7c06c47b/attachment.html>

From vidarno at gmail.com  Sat Nov  4 18:36:01 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sat, 4 Nov 2006 18:36:01 +0100
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <200611042121.40683.evgeny@indent.ru>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
	<200611042001.26334.evgeny@indent.ru>
	<2eed5f740611040857i75341a5ds38bc500a3ce1a325@mail.gmail.com>
	<200611042121.40683.evgeny@indent.ru>
Message-ID: <2eed5f740611040936v7caf12bcu7b19fba3ff8f9ba@mail.gmail.com>

Evgeny,

I'm not sure which branch is available through the following command:
svn checkout svn://svn.berlios.de/linux-uvc/linux-uvc/trunk

It is the command listed on the website for linux-uvc, I assume it
is the split-branch? Thanks for your help, your english is more than
sufficient, I'm not a native english-speaker myself.

Also, are patches usually found only in the mailing-list or are they
posted somewhere else?

Regards,
Vidar

On 11/4/06, Evgeny <evgeny at indent.ru> wrote:
>
> Vidar,
>
> There are 2 branches - split and monolithic. Monolithic branch was not
> updated
> since revision 52 and all work is concentrated in split branch.
> Originally "reset patch" was created for monolithic branch. I dont'd know
> is
> it possible to apply it to revision 52. In some time (maybe 1-2 hours)
> I'll
> post patch for split branch.
>
> Sorry for my bad English
> Evgeny
> > Hi Evgeny,
> >
> > I've been using the current svn checkout, which is from last night I
> > believe,
> > I'm unable to download a newer one at the moment, my subversion client
> > complains that berlios is unreachable..
> >
> > Regards,
> > Vidar
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061104/f426ad9e/attachment.html>

From evgeny at indent.ru  Sat Nov  4 20:03:23 2006
From: evgeny at indent.ru (Evgeny)
Date: Sat, 4 Nov 2006 22:03:23 +0300
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <2eed5f740611040936v7caf12bcu7b19fba3ff8f9ba@mail.gmail.com>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
	<200611042121.40683.evgeny@indent.ru>
	<2eed5f740611040936v7caf12bcu7b19fba3ff8f9ba@mail.gmail.com>
Message-ID: <200611042203.23627.evgeny@indent.ru>

> I'm not sure which branch is available through the following command:
> svn checkout svn://svn.berlios.de/linux-uvc/linux-uvc/trunk

This is old monolithic branch. You can checkout split-branch throught the
svn checkout svn://svn.berlios.de/svnroot/repos/linux-uvc/linux-uvc/branches/split.

"reset patch" is a hardcore solution and will never be merged with driver code. 
Please search the maillist - Laurent cleanly described this situation.

The problem located in camera hardware, but the good news are that Laurent 
and Marting promised to give us a better workaround. It probably will be merged in tree.

Berlios svn is still not available and I cannot get original files to create a patch. I'll post it here when berlios`ll come up

Regards, Evgeny


From evgeny at indent.ru  Sat Nov  4 19:30:44 2006
From: evgeny at indent.ru (Evgeny)
Date: Sat, 4 Nov 2006 21:30:44 +0300
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
Message-ID: <200611042130.44478.evgeny@indent.ru>

I'd like to present so-called "reset patch" for revision 64 of split-branch.
Enjoy

diff -u old/uvc_driver.c new/uvc_driver.c
--- old/uvc_driver.c	2006-11-04 22:14:32.000000000 +0300
+++ new/uvc_driver.c	2006-11-04 02:17:08.000000000 +0300
@@ -147,6 +147,52 @@
 	return 0;
 }
 
+
+/* 
+ * Reset and Re-Initialize video device
+ */
+int uvc_video_reinit(struct uvc_video_device *video)
+{
+	int ret;
+
+	if ((ret = uvc_usb_reset(video->dev)) < 0)
+		return ret;
+
+	if ((ret = uvc_set_video_ctrl(video, &video->streaming->ctrl, 0)) < 0) {
+		uvc_printk(KERN_DEBUG, "uvc_video_reinit: Unable to commit format "
+			   "(%d).\n", ret);
+		return ret;
+	}
+
+	return 0;
+}
+
+
+int uvc_usb_reset(struct uvc_device *dev)
+{
+	int l, ret;
+
+	l = usb_lock_device_for_reset(dev->udev, dev->intf);
+
+	if (l >= 0) {
+		ret = usb_reset_device(dev->udev);
+		if (l)
+			usb_unlock_device(dev->udev);
+	}
+	else
+		ret = -EBUSY;
+
+	if (ret)
+		uvc_printk(KERN_DEBUG, "uvc_usb_reset: Unable to reset usb device"
+			   "(%d).\n", ret);
+	else
+		dev->state &= ~UVC_DEV_IOERROR;
+
+	return ret;
+}
+
+
+
 /* Simplify a fraction using a simple continued fraction decomposition. The
  * idea here is to convert fractions such as 333333/10000000 to 1/30 using
  * 32 bit arithmetic only. The algorithm is not perfect and relies upon two
@@ -1198,9 +1244,19 @@
 	 * parameters.
 	 */
 	if ((ret = uvc_video_init(&dev->video)) < 0) {
-		uvc_printk(KERN_ERR, "Failed to initialize the device "
-			"(%d).\n", ret);
-		return ret;
+
+		uvc_printk(KERN_ERR, "Failed to initialize the device, "
+			   "(%d). trying to reset ...\n", ret);
+
+		if ((ret = uvc_usb_reset(dev)))
+			return ret;
+
+		if ((ret = uvc_video_init(&dev->video)) < 0) {
+			uvc_printk(KERN_ERR, "Failed to initialize the device "
+				   "(%d).\n", ret);
+			return ret;
+		}
+
 	}
 
 	/* Register the device with V4L. */
diff -u old/uvc_v4l2.c new/uvc_v4l2.c
--- old/uvc_v4l2.c	2006-11-04 22:14:32.000000000 +0300
+++ new/uvc_v4l2.c	2006-11-04 21:30:52.000000000 +0300
@@ -434,6 +434,10 @@
 		mutex_unlock(&video->queue.mutex);
 	}
 
+	/* leave usb device in a clean state */
+	if (video->dev->state & UVC_DEV_IOERROR)
+		uvc_video_reinit(video);
+
 	/* Release the file handle. */
 	uvc_dismiss_privileges(handle);
 	kfree(handle);
diff -u old/uvc_video.c new/uvc_video.c
--- old/uvc_video.c	2006-11-04 22:14:32.000000000 +0300
+++ new/uvc_video.c	2006-11-04 22:22:42.000000000 +0300
@@ -45,6 +45,7 @@
 		uvc_printk(KERN_ERR, "Failed to query (%u) UVC control %u "
 			"(unit %u) : %d (exp. %u).\n", query, cs, unit, ret,
 			size);
+		dev->state |= UVC_DEV_IOERROR;
 		return -EIO;
 	}
 
diff -u old/uvcvideo.h new/uvcvideo.h
--- old/uvcvideo.h	2006-11-04 22:14:32.000000000 +0300
+++ new/uvcvideo.h	2006-11-04 02:16:51.000000000 +0300
@@ -511,6 +511,7 @@
 
 enum uvc_device_state {
 	UVC_DEV_DISCONNECTED = 1,
+	UVC_DEV_IOERROR = 2,
 };
 
 struct uvc_device {
@@ -664,6 +665,10 @@
 extern struct usb_host_endpoint *uvc_find_endpoint(
 		struct usb_host_interface *alts, __u8 epaddr);
 
+
+extern int uvc_video_reinit(struct uvc_video_device *video);
+extern int uvc_usb_reset(struct uvc_device *dev);
+
 #endif /* __KERNEL__ */
 
 #endif




Regards, Evgeny


From vidarno at gmail.com  Sat Nov  4 20:24:44 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sat, 4 Nov 2006 20:24:44 +0100
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <200611042130.44478.evgeny@indent.ru>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
	<200611042130.44478.evgeny@indent.ru>
Message-ID: <2eed5f740611041124p67e1afekdc9dae98b1f480dd@mail.gmail.com>

Thank you for this patch, I am sure it will fix my problems with the webcam
locking up. One question though, how is this patch used? I tried copying the
text into a file (called reset-patch) and then running the command
patch < reset-patch
this results in the following output:

patch < reset-patch
patching file uvc_driver.c
Hunk #1 succeeded at 147 with fuzz 2.
Hunk #2 FAILED at 1244.
1 out of 2 hunks FAILED -- saving rejects to file uvc_driver.c.rej
patching file uvc_v4l2.c
Hunk #1 FAILED at 434.
1 out of 1 hunk FAILED -- saving rejects to file uvc_v4l2.c.rej
patching file uvc_video.c
Hunk #1 FAILED at 45.
1 out of 1 hunk FAILED -- saving rejects to file uvc_video.c.rej
patching file uvcvideo.h
Hunk #1 FAILED at 511.
Hunk #2 succeeded at 665 with fuzz 2.
1 out of 2 hunks FAILED -- saving rejects to file uvcvideo.h.rej

Note also that I do not have any folders called new or old when downloading
the split branch, when getting the last revision with this command:

svn checkout svn://svn.berlios.de/linux-uvc/linux-uvc/branches/split

The files I get are:
split/uvc_ctrl.c
split/uvc_queue.c
split/uvc_video.c
split/uvc_v4l2.c
split/uvc_compat.h
split/uvc_driver.c
split/uvcvideo.h
split/Makefile

Again, thank you for your work :)

Regards,
Vidar

On 11/4/06, Evgeny <evgeny at indent.ru> wrote:
>
> I'd like to present so-called "reset patch" for revision 64 of
> split-branch.
> Enjoy
>
> diff -u old/uvc_driver.c new/uvc_driver.c
> --- old/uvc_driver.c    2006-11-04 22:14:32.000000000 +0300
> +++ new/uvc_driver.c    2006-11-04 02:17:08.000000000 +0300
> @@ -147,6 +147,52 @@
>         return 0;
> }
>
> +
> +/*
> + * Reset and Re-Initialize video device
> + */
> +int uvc_video_reinit(struct uvc_video_device *video)
> +{
> +       int ret;
> +
> +       if ((ret = uvc_usb_reset(video->dev)) < 0)
> +               return ret;
> +
> +       if ((ret = uvc_set_video_ctrl(video, &video->streaming->ctrl, 0))
> < 0) {
> +               uvc_printk(KERN_DEBUG, "uvc_video_reinit: Unable to commit
> format "
> +                          "(%d).\n", ret);
> +               return ret;
> +       }
> +
> +       return 0;
> +}
> +
> +
> +int uvc_usb_reset(struct uvc_device *dev)
> +{
> +       int l, ret;
> +
> +       l = usb_lock_device_for_reset(dev->udev, dev->intf);
> +
> +       if (l >= 0) {
> +               ret = usb_reset_device(dev->udev);
> +               if (l)
> +                       usb_unlock_device(dev->udev);
> +       }
> +       else
> +               ret = -EBUSY;
> +
> +       if (ret)
> +               uvc_printk(KERN_DEBUG, "uvc_usb_reset: Unable to reset usb
> device"
> +                          "(%d).\n", ret);
> +       else
> +               dev->state &= ~UVC_DEV_IOERROR;
> +
> +       return ret;
> +}
> +
> +
> +
> /* Simplify a fraction using a simple continued fraction decomposition.
> The
>   * idea here is to convert fractions such as 333333/10000000 to 1/30
> using
>   * 32 bit arithmetic only. The algorithm is not perfect and relies upon
> two
> @@ -1198,9 +1244,19 @@
>          * parameters.
>          */
>         if ((ret = uvc_video_init(&dev->video)) < 0) {
> -               uvc_printk(KERN_ERR, "Failed to initialize the device "
> -                       "(%d).\n", ret);
> -               return ret;
> +
> +               uvc_printk(KERN_ERR, "Failed to initialize the device, "
> +                          "(%d). trying to reset ...\n", ret);
> +
> +               if ((ret = uvc_usb_reset(dev)))
> +                       return ret;
> +
> +               if ((ret = uvc_video_init(&dev->video)) < 0) {
> +                       uvc_printk(KERN_ERR, "Failed to initialize the
> device "
> +                                  "(%d).\n", ret);
> +                       return ret;
> +               }
> +
>         }
>
>         /* Register the device with V4L. */
> diff -u old/uvc_v4l2.c new/uvc_v4l2.c
> --- old/uvc_v4l2.c      2006-11-04 22:14:32.000000000 +0300
> +++ new/uvc_v4l2.c      2006-11-04 21:30:52.000000000 +0300
> @@ -434,6 +434,10 @@
>                 mutex_unlock(&video->queue.mutex);
>         }
>
> +       /* leave usb device in a clean state */
> +       if (video->dev->state & UVC_DEV_IOERROR)
> +               uvc_video_reinit(video);
> +
>         /* Release the file handle. */
>         uvc_dismiss_privileges(handle);
>         kfree(handle);
> diff -u old/uvc_video.c new/uvc_video.c
> --- old/uvc_video.c     2006-11-04 22:14:32.000000000 +0300
> +++ new/uvc_video.c     2006-11-04 22:22:42.000000000 +0300
> @@ -45,6 +45,7 @@
>                 uvc_printk(KERN_ERR, "Failed to query (%u) UVC control %u
> "
>                         "(unit %u) : %d (exp. %u).\n", query, cs, unit,
> ret,
>                         size);
> +               dev->state |= UVC_DEV_IOERROR;
>                 return -EIO;
>         }
>
> diff -u old/uvcvideo.h new/uvcvideo.h
> --- old/uvcvideo.h      2006-11-04 22:14:32.000000000 +0300
> +++ new/uvcvideo.h      2006-11-04 02:16:51.000000000 +0300
> @@ -511,6 +511,7 @@
>
> enum uvc_device_state {
>         UVC_DEV_DISCONNECTED = 1,
> +       UVC_DEV_IOERROR = 2,
> };
>
> struct uvc_device {
> @@ -664,6 +665,10 @@
> extern struct usb_host_endpoint *uvc_find_endpoint(
>                 struct usb_host_interface *alts, __u8 epaddr);
>
> +
> +extern int uvc_video_reinit(struct uvc_video_device *video);
> +extern int uvc_usb_reset(struct uvc_device *dev);
> +
> #endif /* __KERNEL__ */
>
> #endif
>
>
>
>
> Regards, Evgeny
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061104/37e1b969/attachment.html>

From evgeny at indent.ru  Sat Nov  4 20:44:36 2006
From: evgeny at indent.ru (Evgeny)
Date: Sat, 4 Nov 2006 22:44:36 +0300
Subject: [Linux-uvc-devel] Does the "reset patch" still work?
In-Reply-To: <2eed5f740611041124p67e1afekdc9dae98b1f480dd@mail.gmail.com>
References: <2eed5f740611040644y27470f2ar428db6db8bf76ba9@mail.gmail.com>
	<200611042130.44478.evgeny@indent.ru>
	<2eed5f740611041124p67e1afekdc9dae98b1f480dd@mail.gmail.com>
Message-ID: <200611042244.36643.evgeny@indent.ru>

> this results in the following output

Very strange. I can apply it against clean split branch from revision 64 
without any problems.

Please try to use the same patch attached to this message.

Also try to use "patch -p1 < split-reset.patch" to strip "new" and "old" 
directory names. 

Remember to update files from svn before patching to be sure that you have 
clean working copy.

In case all of this will not help, fill free to send me *.rej files

Regards, Evgeny
-------------- next part --------------
A non-text attachment was scrubbed...
Name: split-reset.patch
Type: text/x-diff
Size: 3111 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061104/9d6d38a6/attachment.patch>

From laurent.pinchart at skynet.be  Sun Nov  5 12:38:58 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sun, 5 Nov 2006 12:38:58 +0100
Subject: [Linux-uvc-devel] Logitech QC Fusion problems
In-Reply-To: <20061101011928.7e09ac5f.rumi_ml@rtfm.hu>
References: <20061101011928.7e09ac5f.rumi_ml@rtfm.hu>
Message-ID: <200611051238.58610.laurent.pinchart@skynet.be>

Hi Sab,

> I've put my hands on a Logitech QC Fusion:
>
> Bus 001 Device 002: ID 046d:08c1 Logitech, Inc.
>
> And I tried to get it working using linux-uvc.
> Tried both versions 51 and 64 but neither one worked although the
> camera model is said to be supported:
>
> uvcvideo: Found UVC 1.00 device <unnamed> (046d:08c1)
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110.
> uvcvideo: Failed to initialize the device (-5).
>
> After this, the device /dev/video0 does appear, but
>
> gmplayer -tv device=/dev/video0:driver=v4l2:channel=0 tv://
>
> says:
>
> MPlayer 1.0pre8-3.4.4 (C) 2000-2006 MPlayer Team
> CPU:               Intel(R) Pentium(R) 4 CPU 2.40GHz (Family: 15, Model: 2,
> Stepping: 9) SSE2 supported but disabled
> CPUflags:  MMX: 1 MMX2: 1 3DNow: 0 3DNow2: 0 SSE: 1 SSE2: 0
> Compiled with runtime CPU detection.
>
> 93 audio & 211 video codecs
>
> Playing tv://.
> Selected driver: v4l2
>  name: Video 4 Linux 2 input
>  author: Martin Olschewski <olschewski at zpr.uni-koeln.de>
>  comment: first try, more to come ;-)
> v4l2: ioctl get standard failed: Invalid argument
> Selected device: USB Video Class device
>  Capabilites:  video capture  streaming
>  supported norms:
>  inputs: 0 = Camera;
>  Current input: 0
>  Current format: YUYV
> v4l2: ioctl set format failed: Input/output error
> v4l2: ioctl set mute failed: Invalid argument
> v4l2: 0 frames successfully processed, 0 frames dropped.
>
> Exiting... (Quit)
>
> This is Linux-2.6.18 with version 64 but it did about the same with
> older kernels and version 51.
>
> What can be the reason for this?
> Am I doing something wrong?

Mplayer is known not to work with the UVC driver. A (simple) bug inside 
mplayer still hasn't been fixed.

Try to use ekiga or luvcview to check if your webcam works. Then, but the 
mplayer developers to fix the bug.

Cheers,

Laurent Pinchart


From rumi_ml at rtfm.hu  Sun Nov  5 13:43:51 2006
From: rumi_ml at rtfm.hu (Rumi Szabolcs)
Date: Sun, 5 Nov 2006 13:43:51 +0100
Subject: [Linux-uvc-devel] Logitech QC Fusion problems
In-Reply-To: <200611051238.58610.laurent.pinchart@skynet.be>
References: <20061101011928.7e09ac5f.rumi_ml@rtfm.hu>
	<200611051238.58610.laurent.pinchart@skynet.be>
Message-ID: <20061105134351.8d23c81b.rumi_ml@rtfm.hu>

Hi Laurent,

On Sun, 5 Nov 2006 12:38:58 +0100
Laurent Pinchart <laurent.pinchart at skynet.be> wrote:

> Mplayer is known not to work with the UVC driver. A (simple) bug inside 
> mplayer still hasn't been fixed.
> 
> Try to use ekiga or luvcview to check if your webcam works. Then, but the 
> mplayer developers to fix the bug.

Well, I was just using mplayer to test as I thought it may
have a solid V4L2 implementation, apparently I was wrong...

Yeah, indeed, luvcview did succeed to initialize the camera.
Ekiga by itself did not, but after I ran luvcview, Ekiga
was able use it. But after some experimenting with Ekiga
(turning cam off and on) sometimes it failed, then I
reran luvcview and then it started to work again.

The tcl/tk-based MSN client "amsn" also failed to get the
camera to work, even after it has been initialized with
luvcview.

So practically I could not use the camera for anything
good although it theoretically works. Does this count?

Thanks,

Sab


From laurent.pinchart at skynet.be  Sun Nov  5 16:53:28 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sun, 5 Nov 2006 16:53:28 +0100
Subject: [Linux-uvc-devel] Logitech QC Fusion problems
In-Reply-To: <20061105134351.8d23c81b.rumi_ml@rtfm.hu>
References: <20061101011928.7e09ac5f.rumi_ml@rtfm.hu>
	<200611051238.58610.laurent.pinchart@skynet.be>
	<20061105134351.8d23c81b.rumi_ml@rtfm.hu>
Message-ID: <200611051653.29021.laurent.pinchart@skynet.be>

Hi Sab,

> > Mplayer is known not to work with the UVC driver. A (simple) bug inside
> > mplayer still hasn't been fixed.
> >
> > Try to use ekiga or luvcview to check if your webcam works. Then, but the
> > mplayer developers to fix the bug.
>
> Well, I was just using mplayer to test as I thought it may
> have a solid V4L2 implementation, apparently I was wrong...

Mplayer has a good V4L2 implementation, but not good enough for the linux-uvc 
driver.

> Yeah, indeed, luvcview did succeed to initialize the camera.
> Ekiga by itself did not, but after I ran luvcview, Ekiga
> was able use it. But after some experimenting with Ekiga
> (turning cam off and on) sometimes it failed, then I
> reran luvcview and then it started to work again.

Ekiga is not to blame. Logitech webcams have a hardware bug which prevent them 
from working properly when used with some USB controllers. There's a subtle 
timing issue at the USB stack level which is triggered by Linux only. We 
currently don't know how to work around it.

> The tcl/tk-based MSN client "amsn" also failed to get the
> camera to work, even after it has been initialized with
> luvcview.

amsn doesn't support V4L2 properly.

> So practically I could not use the camera for anything
> good although it theoretically works. Does this count?

Now that your webcam works (well, mostly, if you don't take the hardware bug 
into account), your next task will be to get your applications of choice 
fixed :-)

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sun Nov  5 17:07:32 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sun, 5 Nov 2006 17:07:32 +0100
Subject: [Linux-uvc-devel] A UVC camera which does not work with this
	driver
In-Reply-To: <1307F24F-2317-45AD-81A3-20390641552C@federated.com>
References: <1307F24F-2317-45AD-81A3-20390641552C@federated.com>
Message-ID: <200611051707.32534.laurent.pinchart@skynet.be>

Hi Jim,

> I have a "Pico iMage Webcam" from Ecamm which is a CCD based UVC
> device. I suspect it is far from being supported in the uvcvideo
> drivers. It works without device specific drivers on Mac OS X and
> allegedly Windows XP so it seems they have followed the spec in some
> manner.

That's interesting. The linux-uvc project aims at supporting all UVC compliant 
webcams, so I'm definitely interested in investigating your problems.

> Problems so far:
>
> 1) The frame format descriptor is in the endpoint instead of the
> interface. I patched to look both places.

That's not very UVC-compliant. Could you send me a complete device descriptor 
dump ? As lsusb might not print all information, please send me the content 
of /proc/bus/usb/<bus number>/<device number> as well.

> 2) The probe fails. I naively skip the probe.

How does it fail ? Can you give me more information ?

> 3) There are no isochronous endpoints. The only endpoint is Video
> Streaming endpoint for 512 byte bulk data.

That's a known issue. UVC devices can use either isochronous or bulk 
transfers. As the only cameras I own or can easily get access to implement 
isochronous transfers only, I haven't been able to add support for bulk 
transfers.

> At this point I'm guessing it will take 100+ lines of code to deal
> with this camera and is better left to the driver writers.

You could have a try :-) Support for bulk transfers is an important feature.

> I'll switch to one of the supported logitech models. Though my first
> camera didn't work, I have to say it is nice to have a driver working
> from a documented camera API after all the time I've spent playing
> driver roulette with the various reverse engineered webcam drivers
> for linux.
>
> If one of the active driver writers would like this camera for coding
> and they aren't someplace too expensive for me to ship from the usa
> then they should send me an email and an address and I'll send them
> the camera.

That's very nice of you. I live in Belgium, how expensive would it be to send 
it here ?

Best regards,

Laurent Pinchart


From pauljurczak at yahoo.com  Mon Nov  6 20:53:14 2006
From: pauljurczak at yahoo.com (Paul Jurczak)
Date: Mon, 6 Nov 2006 11:53:14 -0800 (PST)
Subject: [Linux-uvc-devel] Hardware issues with UVC Linux driver and some
	USB controllers
Message-ID: <20061106195314.13915.qmail@web60513.mail.yahoo.com>

Hi Laurent,

is there a USB controller, which does not have this problem? Is there a way of using UVC API (just my custom application and embedded version of Linux) to avoid this problem? 

Regards,
Paul.


......

> Yeah, indeed, luvcview did succeed to initialize the camera.
> Ekiga by itself did not, but after I ran luvcview, Ekiga
> was able use it. But after some experimenting with Ekiga
> (turning cam off and on) sometimes it failed, then I
> reran luvcview and then it started to work again.

Ekiga is not to blame. Logitech webcams have a hardware bug which prevent them 
from working properly when used with some USB controllers. There's a subtle 
timing issue at the USB stack level which is triggered by Linux only. We 
currently don't know how to work around it.







From louisg00 at bellsouth.net  Mon Nov  6 21:04:11 2006
From: louisg00 at bellsouth.net (Louis E Garcia II)
Date: Mon, 06 Nov 2006 15:04:11 -0500
Subject: [Linux-uvc-devel] Which branch to use
Message-ID: <1162843451.5772.4.camel@sonlaptop>

I'm currently using trunk. I found out about the split branch. What is
the difference between these two branches.

-Louis



From laurent.pinchart at skynet.be  Tue Nov  7 10:32:44 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 7 Nov 2006 10:32:44 +0100
Subject: [Linux-uvc-devel] Which branch to use
In-Reply-To: <1162843451.5772.4.camel@sonlaptop>
References: <1162843451.5772.4.camel@sonlaptop>
Message-ID: <200611071032.44566.laurent.pinchart@skynet.be>

Hi Louis,

> I'm currently using trunk. I found out about the split branch. What is
> the difference between these two branches.

The split branch was created to split the driver in several files, making 
development easier. The code is now pretty stable, and should be merged into 
the trunk soon. If you want to help with testing the driver, you should 
checkout and use the split branch, as the trunk hasn't been updated for a few 
months.

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Nov  7 10:36:38 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 7 Nov 2006 10:36:38 +0100
Subject: [Linux-uvc-devel] Hardware issues with UVC Linux driver and
	some USB controllers
In-Reply-To: <20061106195314.13915.qmail@web60513.mail.yahoo.com>
References: <20061106195314.13915.qmail@web60513.mail.yahoo.com>
Message-ID: <200611071036.39155.laurent.pinchart@skynet.be>

Hi Paul,

> is there a USB controller, which does not have this problem? Is there a way
> of using UVC API (just my custom application and embedded version of Linux)
> to avoid this problem?

I've always suffered from the problem, more often with some controllers than 
others. Unfortunately, there is no way to know how good (or how bad) your 
webcam will work with your controller short of trying.

Martin will soon post a simple workaround (less intrusive than the reset 
patch) on the list. It has been tested by a few people already, and seems to 
improve the situation for some of them. What we would like to know is how 
many people currently suffer from the issue, how bad it gets for them, and 
how the patch will help.

Best regards,

Laurent Pinchart


From linux at rubli.info  Tue Nov  7 12:22:49 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 07 Nov 2006 12:22:49 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with Logitech
	webcams
Message-ID: <op.tim8j4tc42iof8@misha>

Hi all,

Attached is a rather ugly patch that has proven to make the Logitech UVC  
cameras work fine for some people. It works around the USB errors by  
retrying control requests up to three times.

We would like to get as much feedback as possible, so if you try it out,  
please let us know whether or not it works for you.

A few notes:

- The patch is against the split branch.

- This only applies for Logitech UVC cameras (QuickCam Fusion,  
Orbit/Sphere, Pro 5000, for Notebooks Pro, UltraVision), the Cisco VT  
Camera II, and for some built-in laptop cameras like the QuickCam for Dell  
Notebooks and the Acer OrbiCam.

- If the debug output bugs you, just uncomment the uvc_printk line. It  
does, however give you an indication of whether and how often the patch  
has "prevented" the problem.

- Feel free to increase the QUERY_CTRL_RETRIES if you find that it helps.  
If it does, please drop us a note.

Again, any feedback is welcome. :-)

Cheers,
Martin





Index: uvc_video.c
===================================================================
--- uvc_video.c	(revision 65)
+++ uvc_video.c	(working copy)
@@ -38,8 +38,24 @@
  			      : usb_sndctrlpipe(dev->udev, 0);
  	type |= (query & 0x80) ? USB_DIR_IN : USB_DIR_OUT;

+#ifndef QUERY_CTRL_RETRIES
  	ret = usb_control_msg(dev->udev, pipe, query, type, cs << 8,
  			unit << 8 | intfnum, data, size, UVC_CTRL_TIMEOUT);
+#else
+	{
+	int tries = 1 + QUERY_CTRL_RETRIES;
+	ret = 0;
+	while (tries--) {
+		ret = usb_control_msg(dev->udev, pipe, query, type, cs << 8,
+				unit << 8 | intfnum, data, size, UVC_CTRL_TIMEOUT);
+		if(ret >= 0 || ret != -EPIPE)
+			break;
+		uvc_printk(KERN_ERR, "Failed to query (%u) UVC control %u "
+			"(unit %u) : %d. Retrying %d more times ...\n",
+			query, cs, unit, ret, tries);
+	}
+	}
+#endif /* QUERY_CTRL_RETRIES */

  	if (ret != size) {
  		uvc_printk(KERN_ERR, "Failed to query (%u) UVC control %u "
Index: uvcvideo.h
===================================================================
--- uvcvideo.h	(revision 65)
+++ uvcvideo.h	(working copy)
@@ -233,6 +233,8 @@
  #define UVC_MAX_VIDEO_BUFFERS	32

  #define UVC_CTRL_TIMEOUT	300
+/* Number of retries for stalled control requests */
+#define QUERY_CTRL_RETRIES	3

  /*  
------------------------------------------------------------------------
   * Structures.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: usb-retry.patch
Type: application/octet-stream
Size: 1343 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061107/d13546ac/attachment.obj>

From evgeny at indent.ru  Tue Nov  7 13:44:40 2006
From: evgeny at indent.ru (Evgeny)
Date: Tue, 7 Nov 2006 15:44:40 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tim8j4tc42iof8@misha>
References: <op.tim8j4tc42iof8@misha>
Message-ID: <200611071544.40890.evgeny@indent.ru>

Hi Martin

>It works around the USB errors by
> retrying control requests up to three times.

> +???????????????if(ret >= 0 || ret != -EPIPE)
> +                       break;

Thank you for your work. The only question is what happens when ret == 
ETIMEOUT ? The camera usually becomes unaccessable after this error

Regards, Evgeny


From linux at rubli.info  Tue Nov  7 17:52:23 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 07 Nov 2006 17:52:23 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611071544.40890.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611071544.40890.evgeny@indent.ru>
Message-ID: <op.tinntlwu42iof8@misha>

>> It works around the USB errors by
>> retrying control requests up to three times.
>
>> +???????????????if(ret >= 0 || ret != -EPIPE)
>> +                       break;
>
> Thank you for your work. The only question is what happens when ret ==
> ETIMEOUT ? The camera usually becomes unaccessable after this error

Good question ... The only computer I can currently test it on doesn't  
seem to give me the ETIMEDOUT error at all. If you experience ETIMEDOUT,  
what happens if you retry in that case, too?

Other errors that were reported to occur are EOVERFLOW and EPROTO but  
those are pretty rare and therefore more difficult to test.

Cheers,
Martin


From pauljurczak at yahoo.com  Tue Nov  7 19:13:52 2006
From: pauljurczak at yahoo.com (Paul Jurczak)
Date: Tue, 7 Nov 2006 10:13:52 -0800 (PST)
Subject: [Linux-uvc-devel] Hardware issues with UVC Linux driver and
	some USB controllers
Message-ID: <20061107181352.8467.qmail@web60512.mail.yahoo.com>

Hi Laurent,

  is this problem limited to camera initialization? If so, soft or hard reset would
work for me, at least temporarily. I had USB2.0 camera initialization problems
under Windows and hardware hack to toggle the power to the camera solved
the problem.

Regards,
Paul.


Hi Paul,

> is there a USB controller, which does not have this problem? Is there a way
> of using UVC API (just my custom application and embedded version of Linux)
> to avoid this problem?

I've always suffered from the problem, more often with some controllers than 
others. Unfortunately, there is no way to know how good (or how bad) your 
webcam will work with your controller short of trying.

Martin will soon post a simple workaround (less intrusive than the reset 
patch) on the list. It has been tested by a few people already, and seems to 
improve the situation for some of them. What we would like to know is how 
many people currently suffer from the issue, how bad it gets for them, and 
how the patch will help.

Best regards,

Laurent Pinchart








From vidarno at gmail.com  Tue Nov  7 22:27:52 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Tue, 7 Nov 2006 22:27:52 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tinntlwu42iof8@misha>
References: <op.tim8j4tc42iof8@misha> <200611071544.40890.evgeny@indent.ru>
	<op.tinntlwu42iof8@misha>
Message-ID: <2eed5f740611071327r15cfb63fu9a3372b87223906a@mail.gmail.com>

Hello,

I installed this patch on a computer used for webcam surveillance
(yes, I finally got ffmpeg working!), but now I have a strange issue:
This computer has 2 webcams connected, but it seems that sometimes
only one of it is "shown" - only one of the videoX devices show up in
/dev. First time I noticed only one was showing I did a reboot, and both
were available again, next reboot only one. Not sure if
this is because of the patch or just buggy Logitech webcams.

Regards,
Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061107/64a88dcc/attachment.html>

From pauljurczak at yahoo.com  Wed Nov  8 18:24:27 2006
From: pauljurczak at yahoo.com (Paul Jurczak)
Date: Wed, 8 Nov 2006 09:24:27 -0800 (PST)
Subject: [Linux-uvc-devel] Non-Logitech UVC cameras.
Message-ID: <20061108172428.80371.qmail@web60525.mail.yahoo.com>

Hello,

  are there any non-Logitech UVC cameras, which do not experience control request problems?
 
Regards,
Paul.






From vidarno at gmail.com  Wed Nov  8 20:06:08 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Wed, 8 Nov 2006 20:06:08 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tim8j4tc42iof8@misha>
References: <op.tim8j4tc42iof8@misha>
Message-ID: <2eed5f740611081106l4ee69efj2251a005eabe896@mail.gmail.com>

On 11/7/06, Martin Rubli <linux at rubli.info> wrote:
> Hi all,
>
> Attached is a rather ugly patch that has proven to make the Logitech UVC
> cameras work fine for some people. It works around the USB errors by
> retrying control requests up to three times.
>
> We would like to get as much feedback as possible, so if you try it out,
> please let us know whether or not it works for you.
>

I'm using the patch and on one camera it is able to record 20+
times before I start seeing this error in dmesg:
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).

As this is for a surveillance system I need these cameras to work all
the time, and I probably won't be allowed to return them to the store
since I've used them - My only hope is that Logitech fixes this or
that you uvc-developers have a functional workaround. :)

Is there anything I should post or do to help you (and myself) out?

Regards,
Vidar


From evgeny at indent.ru  Fri Nov 10 11:07:53 2006
From: evgeny at indent.ru (Evgeny)
Date: Fri, 10 Nov 2006 13:07:53 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tinntlwu42iof8@misha>
References: <op.tim8j4tc42iof8@misha> <200611071544.40890.evgeny@indent.ru>
	<op.tinntlwu42iof8@misha>
Message-ID: <200611101307.53798.evgeny@indent.ru>

> Good question ... The only computer I can currently test it on doesn't
> seem to give me the ETIMEDOUT error at all. If you experience ETIMEDOUT,
> what happens if you retry in that case, too?
>
> Other errors that were reported to occur are EOVERFLOW and EPROTO but
> those are pretty rare and therefore more difficult to test.


So, my look at this problem. Sometimes, when trying to change controls, camera 
reports -32 (-EPIPE) error.  -110 (-ETIMEDOUT) error occurs after some 
numbers of -EPIPE, and leaves the camera in locked state. Martin, please tell 
me, what do you think about applying your patch and so called "reset patch" 
simultaneously? E.g. try to resubmit command to camera if it failed with -32 
and reset camera if it failed with -110. I can try to create combined patch 
and it can be less ugly solution that "reset patch", but more stable than 
simple resubmitting of a control message.

Regards, Evgeny


From linux at rubli.info  Fri Nov 10 13:46:17 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 10 Nov 2006 13:46:17 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <2eed5f740611081106l4ee69efj2251a005eabe896@mail.gmail.com>
References: <op.tim8j4tc42iof8@misha>
	<2eed5f740611081106l4ee69efj2251a005eabe896@mail.gmail.com>
Message-ID: <op.tiswffeg42iof8@misha>

Hey Vidar,

Could you try changing the line that reads

if(ret >= 0 || ret != -EPIPE)

to

if(ret >= 0 || (ret != -EPIPE && ret != -ETIMEDOUT))

to see if the camera recovers from error -110 (ETIMEDOUT) in the same way  
as it does from -32 (EPIPE)?

I don't know much about store return policies but from my past experience  
some shops are pretty nice about that. Especially if you pretend to be an  
unexperienced user and tell them that "the camera just doesn't work". ;-)  
Anyway, we're obviously trying our best to come up with something that  
will save you from returning your camera.

Cheers,
Martin



On Wed, 08 Nov 2006 20:06:08 +0100, Vidar Normann <vidarno at gmail.com>  
wrote:

> On 11/7/06, Martin Rubli <linux at rubli.info> wrote:
>> Hi all,
>>
>> Attached is a rather ugly patch that has proven to make the Logitech UVC
>> cameras work fine for some people. It works around the USB errors by
>> retrying control requests up to three times.
>>
>> We would like to get as much feedback as possible, so if you try it out,
>> please let us know whether or not it works for you.
>>
>
> I'm using the patch and on one camera it is able to record 20+
> times before I start seeing this error in dmesg:
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
>
> As this is for a surveillance system I need these cameras to work all
> the time, and I probably won't be allowed to return them to the store
> since I've used them - My only hope is that Logitech fixes this or
> that you uvc-developers have a functional workaround. :)
>
> Is there anything I should post or do to help you (and myself) out?
>
> Regards,
> Vidar
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel




From linux at rubli.info  Fri Nov 10 13:57:02 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 10 Nov 2006 13:57:02 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611101307.53798.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611071544.40890.evgeny@indent.ru>
	<op.tinntlwu42iof8@misha> <200611101307.53798.evgeny@indent.ru>
Message-ID: <op.tiswxcg642iof8@misha>

On Fri, 10 Nov 2006 11:07:53 +0100, Evgeny <evgeny at indent.ru> wrote:

>> Good question ... The only computer I can currently test it on doesn't
>> seem to give me the ETIMEDOUT error at all. If you experience ETIMEDOUT,
>> what happens if you retry in that case, too?
>>
>> Other errors that were reported to occur are EOVERFLOW and EPROTO but
>> those are pretty rare and therefore more difficult to test.
>
>
> So, my look at this problem. Sometimes, when trying to change controls,  
> camera reports -32 (-EPIPE) error.  -110 (-ETIMEDOUT) error occurs after  
> some
> numbers of -EPIPE, and leaves the camera in locked state. Martin, please  
> tell me, what do you think about applying your patch and so called  
> "reset patch" simultaneously?

That sounds like an idea. Before you do that, however, can you confirm  
that retrying control requests after -ETIMEDOUT does _not_ succeed?

> E.g. try to resubmit command to camera if it failed with -32 and reset  
> camera if it failed with -110. I can try to create combined patch and it  
> can be less ugly solution that "reset patch", but more stable
> than simple resubmitting of a control message.

Depending on the outcome of the "retry after ETIMEDOUT" experiment, it  
might be a good idea to first retry even in the case of -ETIMEDOUT and, if  
that doesn't help, reset the camera. If you want to write such a patch,  
please go ahead, you know where to find testers. ;-)

Cheers,
Martin


From linux at rubli.info  Fri Nov 10 14:04:47 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 10 Nov 2006 14:04:47 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tim8j4tc42iof8@misha>
References: <op.tim8j4tc42iof8@misha>
Message-ID: <op.tisw99ym42iof8@misha>

Hey George,

> I am also a victim of this issue... FWIW i found the patch worked fine
> last time I tried it (i have since updated from SVN, and as I run
> motion which just opens the camera and keeps it open, the bug doesnt
> hit me that often, so I havent bothered to reapply. However, if my nfs
> drive goes down, motion crashes, and it needs to be re-opened, and
> sometimes I therefore have the problem, hence my interest.).

Just to make sure I understand you right: For you, the bug appeared both  
during opening and capturing but the retry patch fixed the capturing  
problem?

> My question is - even though this is a (nescesary) ugly workaround,
> will it ever be merged into the 'offical' driver?

Absolutely. We still want to find the nicest possible workaround, but  
_something_ will be integrated in the official driver.

> im guessing the 'offical' windows driver must have something similar
> in it to overcome the hardware bug...
> has anyone tried sniffing a windows session on the USB to see if does
> anything like these resets?

That's the thing. On Windows, the hardware bug simply isn't triggered. The  
timing of the USB packets is slightly different on Linux and Windows and  
apparently that's enough to trigger the problem.

Cheers,
Martin


From linux at rubli.info  Fri Nov 10 15:55:24 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 10 Nov 2006 15:55:24 +0100
Subject: [Linux-uvc-devel] Non-Logitech UVC cameras.
In-Reply-To: <20061108172428.80371.qmail@web60525.mail.yahoo.com>
References: <20061108172428.80371.qmail@web60525.mail.yahoo.com>
Message-ID: <op.tis2emwq42iof8@misha>

I've heard that HP Pavilion dv2000/dv9000 laptops have built-in UVC  
cameras (see the list archive). I don't know much about those, though,  
they might have other problems. (BTW: If anyone out there has feedback,  
we'd appreciate it!) Apart from that I don't know of any.

Cheers,
Martin


On Wed, 08 Nov 2006 18:24:27 +0100, Paul Jurczak <pauljurczak at yahoo.com>  
wrote:

> Hello,
>
>   are there any non-Logitech UVC cameras, which do not experience  
> control request problems?
> Regards,
> Paul.
>
>
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel




From evgeny at indent.ru  Fri Nov 10 17:05:59 2006
From: evgeny at indent.ru (Evgeny)
Date: Fri, 10 Nov 2006 19:05:59 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tiswxcg642iof8@misha>
References: <op.tim8j4tc42iof8@misha> <200611101307.53798.evgeny@indent.ru>
	<op.tiswxcg642iof8@misha>
Message-ID: <200611101906.00636.evgeny@indent.ru>

> Other errors that were reported to occur are EOVERFLOW and EPROTO but ?
> those are pretty rare and therefore more difficult to test.

Martin, is there good reason why not to resend USB control message in case of 
EOVERFLOW, EPROTO or any other error?


From evgeny at indent.ru  Fri Nov 10 17:34:37 2006
From: evgeny at indent.ru (Evgeny)
Date: Fri, 10 Nov 2006 19:34:37 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tiswxcg642iof8@misha>
References: <op.tim8j4tc42iof8@misha> <200611101307.53798.evgeny@indent.ru>
	<op.tiswxcg642iof8@misha>
Message-ID: <200611101934.37412.evgeny@indent.ru>

Another question.
Can anybody tell me, why not to use HZ as a timeout multiplier when calling 
usb_control_msg() ?


From linux at rubli.info  Fri Nov 10 20:22:43 2006
From: linux at rubli.info (Martin Rubli)
Date: Fri, 10 Nov 2006 20:22:43 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611101906.00636.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611101307.53798.evgeny@indent.ru>
	<op.tiswxcg642iof8@misha> <200611101906.00636.evgeny@indent.ru>
Message-ID: <op.titer5v542iof8@misha>

On Fri, 10 Nov 2006 17:05:59 +0100, Evgeny <evgeny at indent.ru> wrote:

>> Other errors that were reported to occur are EOVERFLOW and EPROTO but ?
>> those are pretty rare and therefore more difficult to test.
>
> Martin, is there good reason why not to resend USB control message in  
> case of
> EOVERFLOW, EPROTO or any other error?

Only because I wasn't able to test it; they don't happen on my machine. If  
you get these errors and can test if retrying helps, please let us know  
the results ...

Cheers,
Martin


From laurent.pinchart at skynet.be  Fri Nov 10 21:27:31 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 10 Nov 2006 21:27:31 +0100
Subject: [Linux-uvc-devel] Non-Logitech UVC cameras.
In-Reply-To: <20061108172428.80371.qmail@web60525.mail.yahoo.com>
References: <20061108172428.80371.qmail@web60525.mail.yahoo.com>
Message-ID: <200611102127.31651.laurent.pinchart@skynet.be>

Hi Paul,

> are there any non-Logitech UVC cameras, which do not experience control
> request problems?

None that I know of. On the good side, newer Logitech webcams will (Martin 
might be able to confirm) either implement a workaround in the firmware, or 
use a different chipset with no hardware bug (or at least not that particular 
bug :-)).

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Fri Nov 10 21:29:19 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 10 Nov 2006 21:29:19 +0100
Subject: [Linux-uvc-devel] Hardware issues with UVC Linux driver and
	some USB controllers
In-Reply-To: <20061107181352.8467.qmail@web60512.mail.yahoo.com>
References: <20061107181352.8467.qmail@web60512.mail.yahoo.com>
Message-ID: <200611102129.19688.laurent.pinchart@skynet.be>

Hi Paul,

> is this problem limited to camera initialization? If so, soft or hard
> reset would work for me, at least temporarily. I had USB2.0 camera
> initialization problems under Windows and hardware hack to toggle the power
> to the camera solved the problem.

The problem can occur at any time a control request is issued to the camera. 
Control requests are used to change the controls (brightness, contrast, ...) 
and initialise streaming. If you don't touch the controls, no problem should 
occur while the camera is streaming.

Laurent Pinchart


From laurent.pinchart at skynet.be  Fri Nov 10 21:37:58 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 10 Nov 2006 21:37:58 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tiswffeg42iof8@misha>
References: <op.tim8j4tc42iof8@misha>
	<2eed5f740611081106l4ee69efj2251a005eabe896@mail.gmail.com>
	<op.tiswffeg42iof8@misha>
Message-ID: <200611102137.58389.laurent.pinchart@skynet.be>

Hi everybody,

> Could you try changing the line that reads
>
> if(ret >= 0 || ret != -EPIPE)
>
> to
>
> if(ret >= 0 || (ret != -EPIPE && ret != -ETIMEDOUT))

Make it

if(ret >= 0 || (ret != -EPIPE && ret != -ETIMEDOUT && ret != -EPROTO && ret != 
-EOVERFLOW))

> to see if the camera recovers from error -110 (ETIMEDOUT) in the same way
> as it does from -32 (EPIPE)?

In my experience, at least some ETIMEDOUT errors can be recovered from by 
retrying the request.

> I don't know much about store return policies but from my past experience
> some shops are pretty nice about that. Especially if you pretend to be an
> unexperienced user and tell them that "the camera just doesn't work". ;-)

Then they will plug it in a Windows box and tell you that it works :-)

Laurent Pinchart


From laurent.pinchart at skynet.be  Fri Nov 10 21:39:19 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 10 Nov 2006 21:39:19 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611101934.37412.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <op.tiswxcg642iof8@misha>
	<200611101934.37412.evgeny@indent.ru>
Message-ID: <200611102139.20170.laurent.pinchart@skynet.be>

Hi Evgeny,

> Another question.
> Can anybody tell me, why not to use HZ as a timeout multiplier when calling
> usb_control_msg() ?

Because the usb_control_msg() documentation states that the timeout parameter 
is expressed in milliseconds.

Laurent Pinchart


From laurent.pinchart at skynet.be  Fri Nov 10 21:42:47 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 10 Nov 2006 21:42:47 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <2eed5f740611071327r15cfb63fu9a3372b87223906a@mail.gmail.com>
References: <op.tim8j4tc42iof8@misha> <op.tinntlwu42iof8@misha>
	<2eed5f740611071327r15cfb63fu9a3372b87223906a@mail.gmail.com>
Message-ID: <200611102142.47948.laurent.pinchart@skynet.be>

Hi Vidar,

> I installed this patch on a computer used for webcam surveillance
> (yes, I finally got ffmpeg working!), but now I have a strange issue:
> This computer has 2 webcams connected, but it seems that sometimes
> only one of it is "shown" - only one of the videoX devices show up in
> /dev. First time I noticed only one was showing I did a reboot, and both
> were available again, next reboot only one. Not sure if
> this is because of the patch or just buggy Logitech webcams.

If the webcam doesn't respond to control messages when probed by the driver, 
it might not be detected properly. That's probably what happened with your 
webcams.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Fri Nov 10 21:54:14 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 10 Nov 2006 21:54:14 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tisw99ym42iof8@misha>
References: <op.tim8j4tc42iof8@misha> <op.tisw99ym42iof8@misha>
Message-ID: <200611102154.15155.laurent.pinchart@skynet.be>

> > My question is - even though this is a (nescesary) ugly workaround,
> > will it ever be merged into the 'offical' driver?
>
> Absolutely. We still want to find the nicest possible workaround, but
> _something_ will be integrated in the official driver.

I'll merge the retry patch in the driver if it helps, but the reset patch will 
probably not go mainstream. It's just too intrusive.

> > im guessing the 'offical' windows driver must have something similar
> > in it to overcome the hardware bug...
> > has anyone tried sniffing a windows session on the USB to see if does
> > anything like these resets?
>
> That's the thing. On Windows, the hardware bug simply isn't triggered. The
> timing of the USB packets is slightly different on Linux and Windows and
> apparently that's enough to trigger the problem.

Any user with a USB analyser and a Windows box to play the 7 differences game 
between Linux and Windows ? :-)

Cheers,

Laurent Pinchart


From nick at customdesigns.ca  Sat Nov 11 00:06:17 2006
From: nick at customdesigns.ca (Nick Wiltshire)
Date: Fri, 10 Nov 2006 16:06:17 -0700
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tisw99ym42iof8@misha>
References: <op.tim8j4tc42iof8@misha> <op.tisw99ym42iof8@misha>
Message-ID: <200611101606.18292.nick@customdesigns.ca>

On Friday 10 November 2006 06:04, Martin Rubli wrote:
> That's the thing. On Windows, the hardware bug simply isn't triggered. The
> ? timing of the USB packets is slightly different on Linux and Windows and
> apparently that's enough to trigger the problem.

Is this something that should be addressed in the USB subsystem? Is either the 
Linux or Windows way right or wrong, or just different?

Nick


From linux at rubli.info  Sat Nov 11 00:17:17 2006
From: linux at rubli.info (Martin Rubli)
Date: Sat, 11 Nov 2006 00:17:17 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611101606.18292.nick@customdesigns.ca>
References: <op.tim8j4tc42iof8@misha> <op.tisw99ym42iof8@misha>
	<200611101606.18292.nick@customdesigns.ca>
Message-ID: <op.titpm3mp42iof8@misha>

On Sat, 11 Nov 2006 00:06:17 +0100, Nick Wiltshire <nick at customdesigns.ca>  
wrote:

> On Friday 10 November 2006 06:04, Martin Rubli wrote:
>> That's the thing. On Windows, the hardware bug simply isn't triggered.  
>> The timing of the USB packets is slightly different on Linux and  
>> Windows and apparently that's enough to trigger the problem.
>
> Is this something that should be addressed in the USB subsystem? Is  
> either the Linux or Windows way right or wrong, or just different?

Just different, unfortunately. The error is clearly in the hardware and  
there isn't much the USB subsystem can do about it since the EHCI driver  
just programs the controller and the actual timing depends on the  
controller. At which point the difference springs into existence is  
something I haven't understood yet and nobody was able to tell me.

We were talking to the Linux USB stack developers a few weeks ago but  
there was no conclusion about this particular problem.

Cheers,
Martin


From linux at rubli.info  Sat Nov 11 00:21:30 2006
From: linux at rubli.info (Martin Rubli)
Date: Sat, 11 Nov 2006 00:21:30 +0100
Subject: [Linux-uvc-devel] Non-Logitech UVC cameras.
In-Reply-To: <200611102127.31651.laurent.pinchart@skynet.be>
References: <20061108172428.80371.qmail@web60525.mail.yahoo.com>
	<200611102127.31651.laurent.pinchart@skynet.be>
Message-ID: <op.titpt4r642iof8@misha>

On Fri, 10 Nov 2006 21:27:31 +0100, Laurent Pinchart  
<laurent.pinchart at skynet.be> wrote:

>> are there any non-Logitech UVC cameras, which do not experience control
>> request problems?
>
> None that I know of. On the good side, newer Logitech webcams will  
> (Martin might be able to confirm) either implement a workaround in the  
> firmware, or use a different chipset with no hardware bug (or at least  
> not that particular bug :-)).

I can't confirm anything at this point but the next generation of Logitech  
cameras are extremly unlikely to contain the same bug for the very reasons  
that Laurent mentioned. Obviously, now that we know about the problem, we  
will keep an eye on the bug for future cameras.

Cheers,
Martin


From laurent.pinchart at skynet.be  Sat Nov 11 00:59:44 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 11 Nov 2006 00:59:44 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.titpm3mp42iof8@misha>
References: <op.tim8j4tc42iof8@misha>
	<200611101606.18292.nick@customdesigns.ca>
	<op.titpm3mp42iof8@misha>
Message-ID: <200611110059.44981.laurent.pinchart@skynet.be>

> >> That's the thing. On Windows, the hardware bug simply isn't triggered.
> >> The timing of the USB packets is slightly different on Linux and
> >> Windows and apparently that's enough to trigger the problem.
> >
> > Is this something that should be addressed in the USB subsystem? Is
> > either the Linux or Windows way right or wrong, or just different?
>
> Just different, unfortunately. The error is clearly in the hardware and
> there isn't much the USB subsystem can do about it since the EHCI driver
> just programs the controller and the actual timing depends on the
> controller. At which point the difference springs into existence is
> something I haven't understood yet and nobody was able to tell me.

A control request is made of a SETUP transaction (setup stage), zero, one or 
more DATA transactions (data stage) and a last DATA transaction (status 
stage).

The EHCI driver splits the request into at least 2 transactions (when there is 
no data stage), and queues all the transactions to the hardware. Individual 
packets timing in a single transaction is up to the controller, but it should 
be possible to delay submission of transactions instead of queuing them ASAP. 
Knowledge of the EHCI driver internals is needed here.

Anyone wanna give this a try ?

Laurent Pinchart


From vidarno at gmail.com  Sat Nov 11 21:28:42 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sat, 11 Nov 2006 21:28:42 +0100
Subject: [Linux-uvc-devel] Hardware issues with UVC Linux driver and
	some USB controllers
In-Reply-To: <200611102129.19688.laurent.pinchart@skynet.be>
References: <20061107181352.8467.qmail@web60512.mail.yahoo.com>
	<200611102129.19688.laurent.pinchart@skynet.be>
Message-ID: <2eed5f740611111228t18c76748v79a78d65f50f433a@mail.gmail.com>

On 11/10/06, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
>
>
> The problem can occur at any time a control request is issued to the
> camera.
> Control requests are used to change the controls (brightness, contrast,
> ...)
> and initialise streaming. If you don't touch the controls, no problem
> should
> occur while the camera is streaming.
>
> Laurent Pinchart
>

Hi Laurent,
I'm suffering from the same problem, I have a script that runs ffmpeg over
and over again
and records 15-minutes of video. After some time I get the notorious error,
would I bypass
this error by just continually streaming and instead record 15 minutes from
the stream?
(If this is at all possible, I have not looked into it yet)

Regards,
Vidar Normann
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061111/2e254c32/attachment.html>

From evgeny at indent.ru  Sun Nov 12 00:58:29 2006
From: evgeny at indent.ru (Evgeny)
Date: Sun, 12 Nov 2006 02:58:29 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tim8j4tc42iof8@misha>
References: <op.tim8j4tc42iof8@misha>
Message-ID: <200611120258.30196.evgeny@indent.ru>

Hi, all

Patch definitely is not a solution. I performed a deep investigation of this 
problem. I tested driver on x86 and amd64 architectures with "reply" 
and "reset" patches and without them. As a result I found, that replying 
control message almost doesn't help. At some point camera doesn't acknowledge 
the message and goes to "broken" state. Replying in most cases returns -32 
(-EPIPE) error. Sometimes it can be -75(-EOVERFLOW)  error, which indicates 
a "bubble" situation - in my understanding, camera sends us data, which we 
don't request and don't expect. After -32 or -75 error we will always 
receive -110 (ETIMEDOUT). Hardware not understand us, the only way is to 
reset camera, either by calling usb_reset_device() or by unplugging the cord.

I performed this investigation, using small program, that changes camera 
controls in loop with random values. The -32 error code usually is returned 
after I try to change any control immediately after gamma, white balance or 
exposure controls. Camera need more time to physically apply this controls to 
hardware. So, I think, that we send controls to quickly. Yes, camera must 
acknowledge control packet only after it applied it to hardware. But who 
knows does it do so or not.

The solution may be in a delay between to calls of usb_control_msg(). I'm 
performing this tests now and almost ready to post the patch. Martin and 
Laurent, I need your opinion about this.

Again and again, sorry for my English.  I really hope, that this message is  
readable at least partly 

Regards, Evgeny


From evgeny at indent.ru  Mon Nov 13 02:08:20 2006
From: evgeny at indent.ru (Evgeny)
Date: Mon, 13 Nov 2006 04:08:20 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611120258.30196.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611120258.30196.evgeny@indent.ru>
Message-ID: <200611130408.20436.evgeny@indent.ru>

Hi, all

Please look at this patch. It contains at least 500 microseconds delay before 
?onsistent usb_control_msg() calls. Reset patch is also included, but 
disabled by default.

In my test I never get -110 error. -32 returned in case of incorrect control 
value (for example changing white balance, when it's in auto mode), but this 
must not be a problem and never leads to -110.

Regards, Evgeny
-------------- next part --------------
A non-text attachment was scrubbed...
Name: delay.patch
Type: text/x-diff
Size: 4478 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061113/21bbf9dd/attachment.patch>

From vidarno at gmail.com  Mon Nov 13 19:46:25 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Mon, 13 Nov 2006 19:46:25 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
Message-ID: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>

Hi,

after a discussion on ffmpeg's mailing-list it seems the reason I'm unable
to record
from two webcams at the same time lies in the uvc-driver..
I am able to record from either of the webcams, but if I try to record at
the same time
I get the following error when invoking the ffmpeg-command to record from
/dev/video1
while another ffmpeg is recording from /dev/video0:
--
ioctl(VIDIOC_STREAMON): No space left on device
Could not find video grab device
--
I notice that the last entry in dmesg is this:
--
uvcvideo: Failed to submit isoc URB 0 (-28).
--

Is there a bug in uvc or is there another explanation?
FYI I'm using the Logitech QuickCam for Notebooks for Pro and
using the newest CVS of the Split-branch of UVC.

Regards,
Vidar Normann
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061113/b569e4c0/attachment.html>

From luca.risolia at studio.unibo.it  Mon Nov 13 21:00:23 2006
From: luca.risolia at studio.unibo.it (Luca Risolia)
Date: Mon, 13 Nov 2006 21:00:23 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
Message-ID: <200611132100.23817.luca.risolia@studio.unibo.it>

Alle 19:46, luned?? 13 novembre 2006, Vidar Normann ha scritto:
> ioctl(VIDIOC_STREAMON): No space left on device

There's not enough bandwidth to use two webcams at the same time.

Best regards
Luca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061113/84a46057/attachment.html>

From linux at rubli.info  Mon Nov 13 21:05:34 2006
From: linux at rubli.info (Martin Rubli)
Date: Mon, 13 Nov 2006 21:05:34 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
Message-ID: <op.tiy0rkdy42iof8@misha>

On Mon, 13 Nov 2006 19:46:25 +0100, Vidar Normann <vidarno at gmail.com>  
wrote:

> after a discussion on ffmpeg's mailing-list it seems the reason I'm  
> unable to record
> from two webcams at the same time lies in the uvc-driver..
> I am able to record from either of the webcams, but if I try to record at
> the same time
> I get the following error when invoking the ffmpeg-command to record from
> /dev/video1
> while another ffmpeg is recording from /dev/video0:
> --
> ioctl(VIDIOC_STREAMON): No space left on device
> Could not find video grab device
> --
> I notice that the last entry in dmesg is this:
> --
> uvcvideo: Failed to submit isoc URB 0 (-28).
> --
>
> Is there a bug in uvc or is there another explanation?
> FYI I'm using the Logitech QuickCam for Notebooks for Pro and
> using the newest CVS of the Split-branch of UVC.

What resolutions and frame rates are you using? Have you tried QVGA? I  
know I had two cameras work at the same time but I may never have tried  
resolutions above QVGA.

Cheers,
Martin


From vidarno at gmail.com  Mon Nov 13 23:04:40 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Mon, 13 Nov 2006 23:04:40 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <op.tiy0rkdy42iof8@misha>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<op.tiy0rkdy42iof8@misha>
Message-ID: <2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>

Thanks for your replies Luca and Martin, I really appreciate it. Although
lowering frames-per-second
and resolution does not help at all. See paste at end of post.

On 11/13/06, Martin Rubli <linux at rubli.info> wrote:
>
> On Mon, 13 Nov 2006 19:46:25 +0100, Vidar Normann <vidarno at gmail.com>
> wrote:
>
> > after a discussion on ffmpeg's mailing-list it seems the reason I'm
> > unable to record
> > from two webcams at the same time lies in the uvc-driver..
> > I am able to record from either of the webcams, but if I try to record
> at
> > the same time
> > I get the following error when invoking the ffmpeg-command to record
> from
> > /dev/video1
> > while another ffmpeg is recording from /dev/video0:
> > --
> > ioctl(VIDIOC_STREAMON): No space left on device
> > Could not find video grab device
> > --
> > I notice that the last entry in dmesg is this:
> > --
> > uvcvideo: Failed to submit isoc URB 0 (-28).
> > --
> >
> > Is there a bug in uvc or is there another explanation?
> > FYI I'm using the Logitech QuickCam for Notebooks for Pro and
> > using the newest CVS of the Split-branch of UVC.
>
> What resolutions and frame rates are you using? Have you tried QVGA? I
> know I had two cameras work at the same time but I may never have tried
> resolutions above QVGA.
>
> Cheers,
> Martin
>

I reran both commands:
ffmpeg -vd "/dev/video1" -an -vcodec mpeg4 -s 320x240 -r 5 -y "test2.avi"
FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et al.
  configuration:  --enable-xvid --enable-gpl
  libavutil version: 49.0.2
  libavcodec version: 51.25.0
  libavformat version: 51.6.0
  built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
[video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
The V4L2 driver changed the video from 320x240 to 1024x576
Input #0, video4linux2, from '':
  Duration: N/A, bitrate: N/A
  Stream #0.0: Video: rawvideo, yuv422, 1024x576, 47185 kb/s,  5.00 fps(r)
PIX_FMT_YUV420P will be used as an intermediate format for rescaling
Output #0, avi, to 'test2.avi':
  Stream #0.0: Video: mpeg4, yuv420p, 320x240, q=2-31, 200 kb/s,  5.00fps(c)
Stream mapping:
  Stream #0.0 -> #0.0
Press [q] to stop encoding
frame=   80 q=2.0 Lsize=     221kB time=16.0 bitrate= 113.0kbits/s
video:213kB audio:0kB global headers:0kB muxing overhead 3.500250%

--
So far so good, it records until I press 'q', the problem arises when I try
to record from the other
webcam as well:
--
ffmpeg -vd "/dev/video0" -an -vcodec mpeg4 -s 320x240 -r 5 -y "test1.avi"
FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et al.
  configuration:  --enable-xvid --enable-gpl
  libavutil version: 49.0.2
  libavcodec version: 51.25.0
  libavformat version: 51.6.0
  built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
[video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
The V4L2 driver changed the video from 320x240 to 1024x576
ioctl(VIDIOC_STREAMON): No space left on device
Could not find video grab device
--

The thing that I notice is the third last line, seems the v4l2-driver forces
transfer in a 1024x576
resolution? Other than that, I have no idea and I don't know what to do.

Regards,
Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061113/f26e9a5f/attachment.html>

From linux at rubli.info  Mon Nov 13 23:29:01 2006
From: linux at rubli.info (Martin Rubli)
Date: Mon, 13 Nov 2006 23:29:01 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<op.tiy0rkdy42iof8@misha>
	<2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
Message-ID: <op.tiy7enbr42iof8@misha>

On Mon, 13 Nov 2006 23:04:40 +0100, Vidar Normann <vidarno at gmail.com>  
wrote:

> I reran both commands:
> ffmpeg -vd "/dev/video1" -an -vcodec mpeg4 -s 320x240 -r 5 -y "test2.avi"
> FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et al.
>   configuration:  --enable-xvid --enable-gpl
>   libavutil version: 49.0.2
>   libavcodec version: 51.25.0
>   libavformat version: 51.6.0
>   built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
> [video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
> The V4L2 driver changed the video from 320x240 to 1024x576
> Input #0, video4linux2, from '':
>   Duration: N/A, bitrate: N/A
>   Stream #0.0: Video: rawvideo, yuv422, 1024x576, 47185 kb/s,  5.00  
> fps(r)
> PIX_FMT_YUV420P will be used as an intermediate format for rescaling
> Output #0, avi, to 'test2.avi':
>   Stream #0.0: Video: mpeg4, yuv420p, 320x240, q=2-31, 200 kb/s,   
> 5.00fps(c)
> Stream mapping:
>   Stream #0.0 -> #0.0
> Press [q] to stop encoding
> frame=   80 q=2.0 Lsize=     221kB time=16.0 bitrate= 113.0kbits/s
> video:213kB audio:0kB global headers:0kB muxing overhead 3.500250%
>
> --
> So far so good, it records until I press 'q', the problem arises when I  
> try
> to record from the other
> webcam as well:
> --
> ffmpeg -vd "/dev/video0" -an -vcodec mpeg4 -s 320x240 -r 5 -y "test1.avi"
> FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et al.
>   configuration:  --enable-xvid --enable-gpl
>   libavutil version: 49.0.2
>   libavcodec version: 51.25.0
>   libavformat version: 51.6.0
>   built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
> [video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
> The V4L2 driver changed the video from 320x240 to 1024x576
> ioctl(VIDIOC_STREAMON): No space left on device
> Could not find video grab device
> --
>
> The thing that I notice is the third last line, seems the v4l2-driver  
> forces transfer in a 1024x576
> resolution? Other than that, I have no idea and I don't know what to do.

That looks weird, indeed. The UVC driver doesn't do that, however. Maybe  
there's something wrong in the way that ffmpeg tries to set the  
resolution. I'll try to have a look at the ffmpeg source code tomorrow.

In the meantime, could you check whether you can stream with two  
simultaneously running instances of luvcview and, if so, at what  
resolutions?

Cheers,
Martin


From dcm at MIT.EDU  Tue Nov 14 00:27:10 2006
From: dcm at MIT.EDU (David Moore)
Date: Mon, 13 Nov 2006 18:27:10 -0500
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<op.tiy0rkdy42iof8@misha>
	<2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
Message-ID: <1163460430.14157.6.camel@virgo.csail.mit.edu>

The Logitech cameras I've used only support YUV streaming at the highest
possible resolution.  Thus, ffmpeg is always streaming at 1024x576 from
the driver, no matter what resolution you request.

In order to capture lower resolutions, you would have to use the MJPEG
mode instead of YUV.  However, I have no idea if ffmpeg would support
such a method.

I am not sure why the bitrate is still high despite the lower framerate.
Perhaps ffmpeg doesn't know about the new framerate controls that have
been added to the V4L2 API.  In other words, ffmpeg might always be
capturing at the max framerate.  It might be possible to fix that with a
patch to ffmpeg.

-David

On Mon, 2006-11-13 at 23:04 +0100, Vidar Normann wrote:
> Thanks for your replies Luca and Martin, I really appreciate it.
> Although lowering frames-per-second
> and resolution does not help at all. See paste at end of post.
> 
> On 11/13/06, Martin Rubli <linux at rubli.info> wrote:
>         On Mon, 13 Nov 2006 19:46:25 +0100, Vidar Normann
>         <vidarno at gmail.com>
>         wrote:
>         
>         > after a discussion on ffmpeg's mailing-list it seems the
>         reason I'm
>         > unable to record 
>         > from two webcams at the same time lies in the uvc-driver..
>         > I am able to record from either of the webcams, but if I try
>         to record at
>         > the same time
>         > I get the following error when invoking the ffmpeg-command
>         to record from 
>         > /dev/video1
>         > while another ffmpeg is recording from /dev/video0:
>         > --
>         > ioctl(VIDIOC_STREAMON): No space left on device
>         > Could not find video grab device
>         > --
>         > I notice that the last entry in dmesg is this: 
>         > --
>         > uvcvideo: Failed to submit isoc URB 0 (-28).
>         > --
>         >
>         > Is there a bug in uvc or is there another explanation?
>         > FYI I'm using the Logitech QuickCam for Notebooks for Pro
>         and
>         > using the newest CVS of the Split-branch of UVC. 
>         
>         What resolutions and frame rates are you using? Have you tried
>         QVGA? I
>         know I had two cameras work at the same time but I may never
>         have tried
>         resolutions above QVGA.
>         
>         Cheers,
>         Martin
> 
> I reran both commands:
> ffmpeg -vd "/dev/video1" -an -vcodec mpeg4 -s 320x240 -r 5 -y
> "test2.avi"
> FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et
> al.
>   configuration:  --enable-xvid --enable-gpl 
>   libavutil version: 49.0.2
>   libavcodec version: 51.25.0
>   libavformat version: 51.6.0
>   built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
> [video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
> The V4L2 driver changed the video from 320x240 to 1024x576
> Input #0, video4linux2, from '':
>   Duration: N/A, bitrate: N/A
>   Stream #0.0: Video: rawvideo, yuv422, 1024x576, 47185 kb/s,  5.00
> fps(r)
> PIX_FMT_YUV420P will be used as an intermediate format for rescaling 
> Output #0, avi, to 'test2.avi':
>   Stream #0.0: Video: mpeg4, yuv420p, 320x240, q=2-31, 200 kb/s,  5.00
> fps(c)
> Stream mapping:
>   Stream #0.0 -> #0.0
> Press [q] to stop encoding
> frame=   80 q=2.0 Lsize=     221kB time= 16.0 bitrate= 113.0kbits/s
> video:213kB audio:0kB global headers:0kB muxing overhead 3.500250%
> 
> --
> So far so good, it records until I press 'q', the problem arises when
> I try to record from the other
> webcam as well: 
> --
> ffmpeg -vd "/dev/video0" -an -vcodec mpeg4 -s 320x240 -r 5 -y
> "test1.avi"
> FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et
> al.
>   configuration:  --enable-xvid --enable-gpl 
>   libavutil version: 49.0.2
>   libavcodec version: 51.25.0
>   libavformat version: 51.6.0
>   built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
> [video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
> The V4L2 driver changed the video from 320x240 to 1024x576
> ioctl(VIDIOC_STREAMON): No space left on device
> Could not find video grab device
> --
> 
> The thing that I notice is the third last line, seems the v4l2-driver
> forces transfer in a 1024x576 
> resolution? Other than that, I have no idea and I don't know what to
> do. 
> 
> Regards,
> Vidar 
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From linux at rubli.info  Tue Nov 14 00:37:39 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 14 Nov 2006 00:37:39 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <1163460430.14157.6.camel@virgo.csail.mit.edu>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<op.tiy0rkdy42iof8@misha>
	<2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
	<1163460430.14157.6.camel@virgo.csail.mit.edu>
Message-ID: <op.tizak1f642iof8@misha>

On Tue, 14 Nov 2006 00:27:10 +0100, David Moore <dcm at MIT.EDU> wrote:

> The Logitech cameras I've used only support YUV streaming at the highest
> possible resolution.  Thus, ffmpeg is always streaming at 1024x576 from
> the driver, no matter what resolution you request.
>
> In order to capture lower resolutions, you would have to use the MJPEG
> mode instead of YUV.  However, I have no idea if ffmpeg would support
> such a method.

You're actually right if you have one of the first QuickCam for Notebooks  
Pro Series (046d:08c3). This year's model (046d:08cb) supports YUY2 at all  
sorts of lower resolutions. (See the frame format matrix that I posted as  
part of  
https://lists.berlios.de/pipermail/linux-uvc-devel/2006-November/000932.html)

Sorry, I really should have guessed you were using the old one from the  
1024x576 resolution ...

Cheers,
Martin


From laurent.pinchart at skynet.be  Tue Nov 14 09:11:41 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 14 Nov 2006 09:11:41 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <op.tiy7enbr42iof8@misha>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
	<op.tiy7enbr42iof8@misha>
Message-ID: <200611140911.41296.laurent.pinchart@skynet.be>

Hi,

> > I reran both commands:
> > ffmpeg -vd "/dev/video1" -an -vcodec mpeg4 -s 320x240 -r 5 -y "test2.avi"
> > FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et al.
> >   configuration:  --enable-xvid --enable-gpl
> >   libavutil version: 49.0.2
> >   libavcodec version: 51.25.0
> >   libavformat version: 51.6.0
> >   built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
> > [video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
> > The V4L2 driver changed the video from 320x240 to 1024x576
> > Input #0, video4linux2, from '':
> >   Duration: N/A, bitrate: N/A
> >   Stream #0.0: Video: rawvideo, yuv422, 1024x576, 47185 kb/s,  5.00
> > fps(r)
> > PIX_FMT_YUV420P will be used as an intermediate format for rescaling
> > Output #0, avi, to 'test2.avi':
> >   Stream #0.0: Video: mpeg4, yuv420p, 320x240, q=2-31, 200 kb/s,
> > 5.00fps(c)
> > Stream mapping:
> >   Stream #0.0 -> #0.0
> > Press [q] to stop encoding
> > frame=   80 q=2.0 Lsize=     221kB time=16.0 bitrate= 113.0kbits/s
> > video:213kB audio:0kB global headers:0kB muxing overhead 3.500250%
> >
> > --
> > So far so good, it records until I press 'q', the problem arises when I
> > try to record from the other webcam as well:
> > --
> > ffmpeg -vd "/dev/video0" -an -vcodec mpeg4 -s 320x240 -r 5 -y "test1.avi"
> > FFmpeg version SVN-r7012, Copyright (c) 2000-2006 Fabrice Bellard, et al.
> >   configuration:  --enable-xvid --enable-gpl
> >   libavutil version: 49.0.2
> >   libavcodec version: 51.25.0
> >   libavformat version: 51.6.0
> >   built on Nov 13 2006 15:34:26, gcc: 3.3.5 (Debian 1:3.3.5-13)
> > [video4linux2 @ 0x83a81f0][4]Capabilities: 4000001
> > The V4L2 driver changed the video from 320x240 to 1024x576
> > ioctl(VIDIOC_STREAMON): No space left on device
> > Could not find video grab device
> > --
> >
> > The thing that I notice is the third last line, seems the v4l2-driver
> > forces transfer in a 1024x576
> > resolution? Other than that, I have no idea and I don't know what to do.
>
> That looks weird, indeed. The UVC driver doesn't do that, however.

Except when asked for it :-) You're probably asking the webcam to stream in 
YUV format, and first generation hardware doesn't support low resolutions in 
YUV. You will have to set the format to MJPEG, or get a newer webcam if you 
absolutely need YUV at low resolutions.

Cheers,

Laurent Pinchart


From vidarno at gmail.com  Tue Nov 14 15:02:51 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Tue, 14 Nov 2006 15:02:51 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <200611140911.41296.laurent.pinchart@skynet.be>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>
	<op.tiy7enbr42iof8@misha>
	<200611140911.41296.laurent.pinchart@skynet.be>
Message-ID: <2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>

Hi,

On 11/14/06, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
>
> Hi,
>
> > > The thing that I notice is the third last line, seems the v4l2-driver
> > > forces transfer in a 1024x576
> > > resolution? Other than that, I have no idea and I don't know what to
> do.
> >
> > That looks weird, indeed. The UVC driver doesn't do that, however.
>
> Except when asked for it :-) You're probably asking the webcam to stream
> in
> YUV format, and first generation hardware doesn't support low resolutions
> in
> YUV. You will have to set the format to MJPEG, or get a newer webcam if
> you
> absolutely need YUV at low resolutions.


I don't need YUV, I need it to work :)
How do I set it to stream in MJPEG-format?

Regards,
Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061114/689981c9/attachment.html>

From laurent.pinchart at skynet.be  Tue Nov 14 15:31:36 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 14 Nov 2006 15:31:36 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611140911.41296.laurent.pinchart@skynet.be>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
Message-ID: <200611141531.36667.laurent.pinchart@skynet.be>

> > > > The thing that I notice is the third last line, seems the v4l2-driver
> > > > forces transfer in a 1024x576
> > > > resolution? Other than that, I have no idea and I don't know what to
> >
> > do.
> >
> > > That looks weird, indeed. The UVC driver doesn't do that, however.
> >
> > Except when asked for it :-) You're probably asking the webcam to stream
> > in
> > YUV format, and first generation hardware doesn't support low resolutions
> > in
> > YUV. You will have to set the format to MJPEG, or get a newer webcam if
> > you
> > absolutely need YUV at low resolutions.
>
> I don't need YUV, I need it to work :)
> How do I set it to stream in MJPEG-format?

Ask the ffmpeg developers :-) Sorry, but I can't help you there, I have no 
experience with ffmpeg.

Best regards,

Laurent Pinchart


From louisg00 at bellsouth.net  Tue Nov 14 20:55:24 2006
From: louisg00 at bellsouth.net (Louis E Garcia II)
Date: Tue, 14 Nov 2006 14:55:24 -0500
Subject: [Linux-uvc-devel] uvc 'split' driver problem with ekiga-2.0.2
Message-ID: <1163534124.16457.11.camel@sonlaptop>

I wanted to try the split branch driver with fc6, compiled and installed
fine. When I tried to use ekiga I get an error when opening my webcam
device. This was working with the trunk driver.

Error while opening video device USB 2.0 Camera

Your driver doesn't seem to support any of the color formats supported
by Ekiga.
Please check your kernel driver documentation in order to determine
which Palette is supported.

-Louis



From laurent.pinchart at skynet.be  Tue Nov 14 21:14:18 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 14 Nov 2006 21:14:18 +0100
Subject: [Linux-uvc-devel] uvc 'split' driver problem with ekiga-2.0.2
In-Reply-To: <1163534124.16457.11.camel@sonlaptop>
References: <1163534124.16457.11.camel@sonlaptop>
Message-ID: <200611142114.19541.laurent.pinchart@skynet.be>

Hi Louis,

> I wanted to try the split branch driver with fc6, compiled and installed
> fine. When I tried to use ekiga I get an error when opening my webcam
> device. This was working with the trunk driver.
>
> Error while opening video device USB 2.0 Camera
>
> Your driver doesn't seem to support any of the color formats supported
> by Ekiga.
> Please check your kernel driver documentation in order to determine
> which Palette is supported.

There's probably something wrong with your setup. Does the same version of 
Ekiga work with the trunk driver ? Could you set the trace parameter to 15 
(echo -n 15 > /sys/modules/uvcvideo/parameters/trace) before plugging the 
webcam, and send me the dmesg output after trying to run Ekiga ?

Cheers,

Laurent Pinchart


From louisg00 at bellsouth.net  Tue Nov 14 23:43:17 2006
From: louisg00 at bellsouth.net (Louis E Garcia II)
Date: Tue, 14 Nov 2006 17:43:17 -0500
Subject: [Linux-uvc-devel] uvc 'split' driver problem with ekiga-2.0.2
In-Reply-To: <200611142114.19541.laurent.pinchart@skynet.be>
References: <1163534124.16457.11.camel@sonlaptop>
	<200611142114.19541.laurent.pinchart@skynet.be>
Message-ID: <1163544197.19454.1.camel@sonlaptop>

On Tue, 2006-11-14 at 21:14 +0100, Laurent Pinchart wrote:
> Hi Louis,
> 
> > I wanted to try the split branch driver with fc6, compiled and installed
> > fine. When I tried to use ekiga I get an error when opening my webcam
> > device. This was working with the trunk driver.
> >
> > Error while opening video device USB 2.0 Camera
> >
> > Your driver doesn't seem to support any of the color formats supported
> > by Ekiga.
> > Please check your kernel driver documentation in order to determine
> > which Palette is supported.
> 
> There's probably something wrong with your setup. Does the same version of 
> Ekiga work with the trunk driver ? Could you set the trace parameter to 15 
> (echo -n 15 > /sys/modules/uvcvideo/parameters/trace) before plugging the 
> webcam, and send me the dmesg output after trying to run Ekiga ?
> 
> Cheers,
> 
> Laurent Pinchart

Yes, the same version of Ekiga works with the trunk driver. My webcam is
part of the laptop and can't be plugged out. Is their another way of
debuging?

-Louis



From ebi9 at ozob.net  Wed Nov 15 03:10:12 2006
From: ebi9 at ozob.net (Gene Imes)
Date: Tue, 14 Nov 2006 20:10:12 -0600
Subject: [Linux-uvc-devel] compile problems
Message-ID: <455A7704.7030004@ozob.net>

Check this out about two minutes ago and this is what I got:

root at go:/usr/src/trunk# mkae
Building USB Video Class driver...
make[1]: Entering directory `/usr/src/linux-2.6.19-rc2'
   CC [M]  /usr/src/trunk/uvcvideo.o
In file included from /usr/src/trunk/uvcvideo.c:49:
/usr/src/trunk/v4l2_enumfrmfmt.h:8: error: nested redefinition of 'enum 
v4l2_frmsizetypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:8: error: redeclaration of 'enum 
v4l2_frmsizetypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:9: error: redeclaration of enumerator 
'V4L2_FRMSIZE_TYPE_DISCRETE'
include/linux/videodev2.h:286: error: previous definition of 
'V4L2_FRMSIZE_TYPE_DISCRETE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:10: error: redeclaration of enumerator 
'V4L2_FRMSIZE_TYPE_CONTINUOUS'
include/linux/videodev2.h:287: error: previous definition of 
'V4L2_FRMSIZE_TYPE_CONTINUOUS' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:11: error: redeclaration of enumerator 
'V4L2_FRMSIZE_TYPE_STEPWISE'
include/linux/videodev2.h:288: error: previous definition of 
'V4L2_FRMSIZE_TYPE_STEPWISE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:14: error: nested redefinition of 'enum 
v4l2_frmivaltypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:14: error: redeclaration of 'enum 
v4l2_frmivaltypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:15: error: redeclaration of enumerator 
'V4L2_FRMIVAL_TYPE_DISCRETE'
include/linux/videodev2.h:326: error: previous definition of 
'V4L2_FRMIVAL_TYPE_DISCRETE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:16: error: redeclaration of enumerator 
'V4L2_FRMIVAL_TYPE_CONTINUOUS'
include/linux/videodev2.h:327: error: previous definition of 
'V4L2_FRMIVAL_TYPE_CONTINUOUS' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:17: error: redeclaration of enumerator 
'V4L2_FRMIVAL_TYPE_STEPWISE'
include/linux/videodev2.h:328: error: previous definition of 
'V4L2_FRMIVAL_TYPE_STEPWISE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:24: error: redefinition of 'struct 
v4l2_frmsize_discrete'
/usr/src/trunk/v4l2_enumfrmfmt.h:32: error: redefinition of 'struct 
v4l2_frmsize_stepwise'
/usr/src/trunk/v4l2_enumfrmfmt.h:52: error: redefinition of 'struct 
v4l2_frmsizeenum'
/usr/src/trunk/v4l2_enumfrmfmt.h:73: error: redefinition of 'struct 
v4l2_frmival_stepwise'
/usr/src/trunk/v4l2_enumfrmfmt.h:84: error: redefinition of 'struct 
v4l2_frmivalenum'
In file included from /usr/src/trunk/uvcvideo.c:49:
/usr/src/trunk/v4l2_enumfrmfmt.h:116:1: warning: 
"VIDIOC_ENUM_FRAMESIZES" redefined
In file included from include/linux/videodev.h:15,
                  from /usr/src/trunk/uvcvideo.c:38:
include/linux/videodev2.h:1329:1: warning: this is the location of the 
previous definition
In file included from /usr/src/trunk/uvcvideo.c:49:
/usr/src/trunk/v4l2_enumfrmfmt.h:117:1: warning: 
"VIDIOC_ENUM_FRAMEINTERVALS" redefined
In file included from include/linux/videodev.h:15,
                  from /usr/src/trunk/uvcvideo.c:38:
include/linux/videodev2.h:1330:1: warning: this is the location of the 
previous definition
/usr/src/trunk/uvcvideo.c: In function 'uvc_init_isoc':
/usr/src/trunk/uvcvideo.c:1555: warning: assignment from incompatible 
pointer type
/usr/src/trunk/uvcvideo.c: In function 'uvc_init_status':
/usr/src/trunk/uvcvideo.c:3736: warning: passing argument 6 of 
'usb_fill_int_urb' from incompatible pointer type
make[2]: *** [/usr/src/trunk/uvcvideo.o] Error 1
make[1]: *** [_module_/usr/src/trunk] Error 2
make[1]: Leaving directory `/usr/src/linux-2.6.19-rc2'
make: *** [uvcvideo] Error 2


Anyone know how to fix this?

Thanks,



-- 
Gene Imes ============================= ozob.net


From vidarno at gmail.com  Wed Nov 15 05:34:12 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Wed, 15 Nov 2006 05:34:12 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <200611141531.36667.laurent.pinchart@skynet.be>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611140911.41296.laurent.pinchart@skynet.be>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<200611141531.36667.laurent.pinchart@skynet.be>
Message-ID: <2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>

On 11/14/06, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
>
> > > > > The thing that I notice is the third last line, seems the
> v4l2-driver
> > > > > forces transfer in a 1024x576
> > > > > resolution? Other than that, I have no idea and I don't know what
> to
> > >
> > > do.
> > >
> > > > That looks weird, indeed. The UVC driver doesn't do that, however.
> > >
> > > Except when asked for it :-) You're probably asking the webcam to
> stream
> > > in
> > > YUV format, and first generation hardware doesn't support low
> resolutions
> > > in
> > > YUV. You will have to set the format to MJPEG, or get a newer webcam
> if
> > > you
> > > absolutely need YUV at low resolutions.
> >
> > I don't need YUV, I need it to work :)
> > How do I set it to stream in MJPEG-format?
>
> Ask the ffmpeg developers :-) Sorry, but I can't help you there, I have no
> experience with ffmpeg.
>
> Best regards,
>
> Laurent Pinchart
>


Hi again :)
As long as bandwidth is the only problem I should also be able to fix this
problem by
lowering the frames-per-second, right? When run in normal 24 fps-mode,ffmpeg
outputs
this line (among others):
Stream #0.0: Video: rawvideo, yuv422, 1024x576, 235929 kb/s, 25.00 fps(r)

Yet if I run the recording with only 5 fps I get this:
Stream #0.0: Video: rawvideo, yuv422, 1024x576, 47185 kb/s,  5.00 fps(r)

If I am able to use 235929 in one go I should be able to record 2 times
47185 easily, right?
I keep getting the same error as before:
ioctl(VIDIOC_STREAMON): No space left on device
Could not find video grab device

Haven't been able to find a way of setting capture method to MJPEG instead
of YUV, but
I'll keep looking although right now I'm not sure it'll help at all, seems
there is something
else causing this problem.

Regards,
Vidar Normann
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061115/5fa628e9/attachment.html>

From luca.risolia at studio.unibo.it  Wed Nov 15 07:48:42 2006
From: luca.risolia at studio.unibo.it (Luca Risolia)
Date: Wed, 15 Nov 2006 07:48:42 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611141531.36667.laurent.pinchart@skynet.be>
	<2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
Message-ID: <200611150748.42521.luca.risolia@studio.unibo.it>

Alle 05:34, mercoled? 15 novembre 2006, Vidar Normann ha scritto:

> I keep getting the same error as before:
> ioctl(VIDIOC_STREAMON): No space left on device

The amount of bandwidth usage does not depend on the image size.

Best regards
Luca


From mxhaard at magic.fr  Wed Nov 15 12:44:31 2006
From: mxhaard at magic.fr (Michel Xhaard)
Date: Wed, 15 Nov 2006 12:44:31 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611141531.36667.laurent.pinchart@skynet.be>
	<2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
Message-ID: <200611151244.31175.mxhaard@magic.fr>

Le Mercredi 15 Novembre 2006 05:34, Vidar Normann a ?crit?:
> On 11/14/06, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
> > > > > > The thing that I notice is the third last line, seems the
> >
> > v4l2-driver
> >
> > > > > > forces transfer in a 1024x576
> > > > > > resolution? Other than that, I have no idea and I don't know what
> >
> > to
> >
> > > > do.
> > > >
> > > > > That looks weird, indeed. The UVC driver doesn't do that, however.
> > > >
> > > > Except when asked for it :-) You're probably asking the webcam to
> >
> > stream
> >
> > > > in
> > > > YUV format, and first generation hardware doesn't support low
> >
> > resolutions
> >
> > > > in
> > > > YUV. You will have to set the format to MJPEG, or get a newer webcam
> >
> > if
> >
> > > > you
> > > > absolutely need YUV at low resolutions.
> > >
> > > I don't need YUV, I need it to work :)
> > > How do I set it to stream in MJPEG-format?
> >
> > Ask the ffmpeg developers :-) Sorry, but I can't help you there, I have
> > no experience with ffmpeg.
> >
> > Best regards,
> >
> > Laurent Pinchart
>
> Hi again :)
> As long as bandwidth is the only problem I should also be able to fix this
> problem by
> lowering the frames-per-second, right? When run in normal 24
> fps-mode,ffmpeg outputs
> this line (among others):
> Stream #0.0: Video: rawvideo, yuv422, 1024x576, 235929 kb/s, 25.00 fps(r)
>
> Yet if I run the recording with only 5 fps I get this:
> Stream #0.0: Video: rawvideo, yuv422, 1024x576, 47185 kb/s,  5.00 fps(r)
>
> If I am able to use 235929 in one go I should be able to record 2 times
> 47185 easily, right?
> I keep getting the same error as before:
> ioctl(VIDIOC_STREAMON): No space left on device
> Could not find video grab device
>
> Haven't been able to find a way of setting capture method to MJPEG instead
> of YUV, but
> I'll keep looking although right now I'm not sure it'll help at all, seems
> there is something
> else causing this problem.
>
> Regards,
> Vidar Normann
Vidar,
Your error ENOSPC problem come from the alternate setting choice in the 
driver. The best way is to used another Usb HCD (host controller device) from 
the motherboard or set up a PCI to USB add on card. As rule i used one HCD 
per webcam device to get the maximum performance :) 
regards
-- 
Michel Xhaard
http://mxhaard.free.fr


From linux at rubli.info  Wed Nov 15 11:13:54 2006
From: linux at rubli.info (Martin Rubli)
Date: Wed, 15 Nov 2006 11:13:54 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611140911.41296.laurent.pinchart@skynet.be>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<200611141531.36667.laurent.pinchart@skynet.be>
	<2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
Message-ID: <op.ti1ypgay42iof8@misha>

Hey Vidar,

I just did a little testing with two cameras, a QuickCam for Notebooks Pro  
(2006 model) and a QuickCam Orbit MP/Sphere MP (2006 model).

Using two instances of luvcview the following combinations work (only  
tested at the default resolutions):

MJPEG:
All combinations up to 2 x 640x480 (15 fps).
2 x 960x720 (theoretically 15 fps but my old laptop didn't manage to  
decode more than about 2 x 10 fps).

YUY2:
All combinations up to 2 x 640x480 (15 fps).
960x720 (10 fps) + 640x480 (15 fps).
1280x960 (7.5 fps) + 640x480 (15 fps).

The following failed with error -28:

YUY2:
2 x 960x720 (10 fps).
1280x960 (7.5 fps) + 640x480 (15 fps).
1280x960 (7.5 fps) + 960x720 (10 fps).

That should give you some indication of what you should be able to achieve  
with ffmpeg in terms of resolutions.

Cheers,
Martin


From linux at rubli.info  Wed Nov 15 11:47:38 2006
From: linux at rubli.info (Martin Rubli)
Date: Wed, 15 Nov 2006 11:47:38 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <op.ti1ypgay42iof8@misha>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611140911.41296.laurent.pinchart@skynet.be>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<200611141531.36667.laurent.pinchart@skynet.be>
	<2eed5f740611142034y3654aa44ke747de32a865d528@mail.gmail.com>
	<op.ti1ypgay42iof8@misha>
Message-ID: <op.ti1z9onw42iof8@misha>

Ok, another interesting test with the same cameras. This time I used  
luvcview for one camera and another program for the second that allows me  
to select the frame rate.

1st camera: YUY2 960x720 @ 10 fps
2nd camera: YUY2 640x480 @ 15 fps works but fails with error -28 at >= 20  
fps.

So you see that the bandwidth does indeed depend on the frame rate.

Also quite interesting

1st camera: YUY2 960x720 @ 10 fps
2nd camera: YUY2 960x720 @ 5 fps

Streaming starts but the picture of the second camera is completely messed  
up (the upper half is okay but the lower half is green and flickering)  
because packets are lost. I'll post more information as soon as I know  
where exactly the packets get lost but it might be a while ...

Cheers,
Martin


On Wed, 15 Nov 2006 11:13:54 +0100, Martin Rubli <linux at rubli.info> wrote:

> Hey Vidar,
>
> I just did a little testing with two cameras, a QuickCam for Notebooks  
> Pro
> (2006 model) and a QuickCam Orbit MP/Sphere MP (2006 model).
>
> Using two instances of luvcview the following combinations work (only
> tested at the default resolutions):
>
> MJPEG:
> All combinations up to 2 x 640x480 (15 fps).
> 2 x 960x720 (theoretically 15 fps but my old laptop didn't manage to
> decode more than about 2 x 10 fps).
>
> YUY2:
> All combinations up to 2 x 640x480 (15 fps).
> 960x720 (10 fps) + 640x480 (15 fps).
> 1280x960 (7.5 fps) + 640x480 (15 fps).
>
> The following failed with error -28:
>
> YUY2:
> 2 x 960x720 (10 fps).
> 1280x960 (7.5 fps) + 640x480 (15 fps).
> 1280x960 (7.5 fps) + 960x720 (10 fps).
>
> That should give you some indication of what you should be able to  
> achieve
> with ffmpeg in terms of resolutions.
>
> Cheers,
> Martin
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel




From pablo.dangelo at web.de  Wed Nov 15 09:07:47 2006
From: pablo.dangelo at web.de (Pablo d'Angelo)
Date: Wed, 15 Nov 2006 09:07:47 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>	<2eed5f740611131404q3b529cach42ded899c558bb0a@mail.gmail.com>	<op.tiy7enbr42iof8@misha>	<200611140911.41296.laurent.pinchart@skynet.be>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
Message-ID: <455ACAD3.8020909@web.de>

Hi Vidar,

> Hi,
> 
> On 11/14/06, *Laurent Pinchart* <laurent.pinchart at skynet.be
> <mailto:laurent.pinchart at skynet.be>> wrote:
> 
>     Except when asked for it :-) You're probably asking the webcam to
>     stream in
>     YUV format, and first generation hardware doesn't support low
>     resolutions in
>     YUV. You will have to set the format to MJPEG, or get a newer webcam
>     if you
>     absolutely need YUV at low resolutions.
> 
> 
> I don't need YUV, I need it to work :)
> How do I set it to stream in MJPEG-format?

You could use luvcview
http://mxhaard.free.fr/download.html
which seems to offer the ability to create mjpeg avi files directly, without
recoding, if I understood correctly.

ciao
  Pablo



From laurent.pinchart at skynet.be  Wed Nov 15 12:15:53 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Nov 2006 12:15:53 +0100
Subject: [Linux-uvc-devel] Hardware issues with UVC Linux driver and
	some USB controllers
In-Reply-To: <2eed5f740611111228t18c76748v79a78d65f50f433a@mail.gmail.com>
References: <20061107181352.8467.qmail@web60512.mail.yahoo.com>
	<200611102129.19688.laurent.pinchart@skynet.be>
	<2eed5f740611111228t18c76748v79a78d65f50f433a@mail.gmail.com>
Message-ID: <200611151215.53614.laurent.pinchart@skynet.be>

Hi Vidar,

> > The problem can occur at any time a control request is issued to the
> > camera. Control requests are used to change the controls (brightness,
> > contrast, ...) and initialise streaming. If you don't touch the controls,
> > no problem should occur while the camera is streaming.
>
> I'm suffering from the same problem, I have a script that runs ffmpeg over
> and over again and records 15-minutes of video. After some time I get the
> notorious error, would I bypass this error by just continually streaming and
> instead record 15 minutes from the stream?
> (If this is at all possible, I have not looked into it yet)

That should fix the problem. Once the webcam is streaming, it won't get stuck 
if you don't issue any control request.

Best regards,

Laurent Pinchart


From mxhaard at magic.fr  Wed Nov 15 15:46:38 2006
From: mxhaard at magic.fr (Michel Xhaard)
Date: Wed, 15 Nov 2006 15:46:38 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <455ACAD3.8020909@web.de>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<455ACAD3.8020909@web.de>
Message-ID: <200611151546.38796.mxhaard@magic.fr>

Le Mercredi 15 Novembre 2006 09:07, Pablo d'Angelo a ?crit?:
> Hi Vidar,
>
> > Hi,
> >
> > On 11/14/06, *Laurent Pinchart* <laurent.pinchart at skynet.be
> > <mailto:laurent.pinchart at skynet.be>> wrote:
> >
> >     Except when asked for it :-) You're probably asking the webcam to
> >     stream in
> >     YUV format, and first generation hardware doesn't support low
> >     resolutions in
> >     YUV. You will have to set the format to MJPEG, or get a newer webcam
> >     if you
> >     absolutely need YUV at low resolutions.
> >
> >
> > I don't need YUV, I need it to work :)
> > How do I set it to stream in MJPEG-format?
>
> You could use luvcview
> http://mxhaard.free.fr/download.html
> which seems to offer the ability to create mjpeg avi files directly,
> without recoding, if I understood correctly.
>
> ciao
>   Pablo
There are always a bandwith limit when asking video stream over usb pci agp 
ide ... bus :) that is why a mjpeg hardware compressor in the webcam help, 
but you loss some picture details. Setting a usb HCD per webcam give better 
performance (a PCI to USB add on card is not very expensive) and allow 
maximum frame rate on each webcam. Becare to remove all others usb device set 
on the same usb bus, specially the low one (mouse keyboard...).
luvcview record the mjpeg stream in an avi container if needed, you can used 
ffmpeg or transcode to change the video codec, I used  xvid or h264 with very 
good compression performance :)
regards
-- 
Michel Xhaard
http://mxhaard.free.fr


From mclaughlin.denis at gmail.com  Wed Nov 15 17:23:30 2006
From: mclaughlin.denis at gmail.com (Denis McLaughlin)
Date: Wed, 15 Nov 2006 11:23:30 -0500
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <200611151546.38796.mxhaard@magic.fr>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<455ACAD3.8020909@web.de> <200611151546.38796.mxhaard@magic.fr>
Message-ID: <74e91400611150823v2ec2a988t25a181b87fd3fae5@mail.gmail.com>

  Note that there was a discussion on the list a little while back about
streaming from multiple video cameras.  You can see the thread here:

http://www.mail-archive.com/linux-uvc-devel at lists.berlios.de/msg00255.html

  As a short summary, I've had success streaming from 8 QC fusions on a
single system, 640x480x15fps in MJPG format.  There is some jitter around
the 15fps mark, but only streaming from 2 cameras should certainly be no
less successful.  I put 4 cameras each on two USB 2 hubs (with no USB 1
devices present).

Denis

On 11/15/06, Michel Xhaard <mxhaard at magic.fr> wrote:
>
> Le Mercredi 15 Novembre 2006 09:07, Pablo d'Angelo a ?crit:
> > Hi Vidar,
> >
> > > Hi,
> > >
> > > On 11/14/06, *Laurent Pinchart* <laurent.pinchart at skynet.be
> > > <mailto:laurent.pinchart at skynet.be>> wrote:
> > >
> > >     Except when asked for it :-) You're probably asking the webcam to
> > >     stream in
> > >     YUV format, and first generation hardware doesn't support low
> > >     resolutions in
> > >     YUV. You will have to set the format to MJPEG, or get a newer
> webcam
> > >     if you
> > >     absolutely need YUV at low resolutions.
> > >
> > >
> > > I don't need YUV, I need it to work :)
> > > How do I set it to stream in MJPEG-format?
> >
> > You could use luvcview
> > http://mxhaard.free.fr/download.html
> > which seems to offer the ability to create mjpeg avi files directly,
> > without recoding, if I understood correctly.
> >
> > ciao
> >   Pablo
> There are always a bandwith limit when asking video stream over usb pci
> agp
> ide ... bus :) that is why a mjpeg hardware compressor in the webcam help,
> but you loss some picture details. Setting a usb HCD per webcam give
> better
> performance (a PCI to USB add on card is not very expensive) and allow
> maximum frame rate on each webcam. Becare to remove all others usb device
> set
> on the same usb bus, specially the low one (mouse keyboard...).
> luvcview record the mjpeg stream in an avi container if needed, you can
> used
> ffmpeg or transcode to change the video codec, I used  xvid or h264 with
> very
> good compression performance :)
> regards
> --
> Michel Xhaard
> http://mxhaard.free.fr
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061115/e74dcb50/attachment.html>

From vidarno at gmail.com  Wed Nov 15 21:29:41 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Wed, 15 Nov 2006 21:29:41 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611130408.20436.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611120258.30196.evgeny@indent.ru>
	<200611130408.20436.evgeny@indent.ru>
Message-ID: <2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>

On 11/13/06, Evgeny <evgeny at indent.ru> wrote:
>
> Hi, all
>
> Please look at this patch. It contains at least 500 microseconds delay
> before
> ?onsistent usb_control_msg() calls. Reset patch is also included, but
> disabled by default.
>
> In my test I never get -110 error. -32 returned in case of incorrect
> control
> value (for example changing white balance, when it's in auto mode), but
> this
> must not be a problem and never leads to -110.
>
> Regards, Evgeny
>
>
I really love this patch! It works much better than the reset patch for me.
I am able to
record alot more times before I get an error, but now I get a new, exciting
one. This is
the output from "dmesg | tail":
uvcvideo: Failed to resubmit isoc URB (-45).

I hope this helps somehow, keep up the great work!

Regards, Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061115/13a28f8b/attachment.html>

From ebi9 at ozob.net  Wed Nov 15 21:39:56 2006
From: ebi9 at ozob.net (Gene Imes)
Date: Wed, 15 Nov 2006 14:39:56 -0600
Subject: [Linux-uvc-devel] uvc fails to compile
Message-ID: <455B7B1C.8050400@ozob.net>

Sorry if this is a duplicate. I emailed before and I think it bounced.

I checked out 'trunk' about five minutes and tried to compile it and 
this is what I got:

root at go:/usr/src/trunk# mkae
Building USB Video Class driver...
make[1]: Entering directory `/usr/src/linux-2.6.19-rc2'
   CC [M]  /usr/src/trunk/uvcvideo.o
In file included from /usr/src/trunk/uvcvideo.c:49:
/usr/src/trunk/v4l2_enumfrmfmt.h:8: error: nested redefinition of 'enum 
v4l2_frmsizetypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:8: error: redeclaration of 'enum 
v4l2_frmsizetypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:9: error: redeclaration of enumerator 
'V4L2_FRMSIZE_TYPE_DISCRETE'
include/linux/videodev2.h:286: error: previous definition of 
'V4L2_FRMSIZE_TYPE_DISCRETE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:10: error: redeclaration of enumerator 
'V4L2_FRMSIZE_TYPE_CONTINUOUS'
include/linux/videodev2.h:287: error: previous definition of 
'V4L2_FRMSIZE_TYPE_CONTINUOUS' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:11: error: redeclaration of enumerator 
'V4L2_FRMSIZE_TYPE_STEPWISE'
include/linux/videodev2.h:288: error: previous definition of 
'V4L2_FRMSIZE_TYPE_STEPWISE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:14: error: nested redefinition of 'enum 
v4l2_frmivaltypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:14: error: redeclaration of 'enum 
v4l2_frmivaltypes'
/usr/src/trunk/v4l2_enumfrmfmt.h:15: error: redeclaration of enumerator 
'V4L2_FRMIVAL_TYPE_DISCRETE'
include/linux/videodev2.h:326: error: previous definition of 
'V4L2_FRMIVAL_TYPE_DISCRETE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:16: error: redeclaration of enumerator 
'V4L2_FRMIVAL_TYPE_CONTINUOUS'
include/linux/videodev2.h:327: error: previous definition of 
'V4L2_FRMIVAL_TYPE_CONTINUOUS' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:17: error: redeclaration of enumerator 
'V4L2_FRMIVAL_TYPE_STEPWISE'
include/linux/videodev2.h:328: error: previous definition of 
'V4L2_FRMIVAL_TYPE_STEPWISE' was here
/usr/src/trunk/v4l2_enumfrmfmt.h:24: error: redefinition of 'struct 
v4l2_frmsize_discrete'
/usr/src/trunk/v4l2_enumfrmfmt.h:32: error: redefinition of 'struct 
v4l2_frmsize_stepwise'
/usr/src/trunk/v4l2_enumfrmfmt.h:52: error: redefinition of 'struct 
v4l2_frmsizeenum'
/usr/src/trunk/v4l2_enumfrmfmt.h:73: error: redefinition of 'struct 
v4l2_frmival_stepwise'
/usr/src/trunk/v4l2_enumfrmfmt.h:84: error: redefinition of 'struct 
v4l2_frmivalenum'
In file included from /usr/src/trunk/uvcvideo.c:49:
/usr/src/trunk/v4l2_enumfrmfmt.h:116:1: warning: 
"VIDIOC_ENUM_FRAMESIZES" redefined
In file included from include/linux/videodev.h:15,
                  from /usr/src/trunk/uvcvideo.c:38:
include/linux/videodev2.h:1329:1: warning: this is the location of the 
previous definition
In file included from /usr/src/trunk/uvcvideo.c:49:
/usr/src/trunk/v4l2_enumfrmfmt.h:117:1: warning: 
"VIDIOC_ENUM_FRAMEINTERVALS" redefined
In file included from include/linux/videodev.h:15,
                  from /usr/src/trunk/uvcvideo.c:38:
include/linux/videodev2.h:1330:1: warning: this is the location of the 
previous definition
/usr/src/trunk/uvcvideo.c: In function 'uvc_init_isoc':
/usr/src/trunk/uvcvideo.c:1555: warning: assignment from incompatible 
pointer type
/usr/src/trunk/uvcvideo.c: In function 'uvc_init_status':
/usr/src/trunk/uvcvideo.c:3736: warning: passing argument 6 of 
'usb_fill_int_urb' from incompatible pointer type
make[2]: *** [/usr/src/trunk/uvcvideo.o] Error 1
make[1]: *** [_module_/usr/src/trunk] Error 2
make[1]: Leaving directory `/usr/src/linux-2.6.19-rc2'
make: *** [uvcvideo] Error 2
root at go:/usr/src/trunk#


Can anyone tell me how to get this right?

Thanks,


-- 
Gene Imes ============================= ozob.net


From ebi9 at ozob.net  Wed Nov 15 23:09:45 2006
From: ebi9 at ozob.net (Gene Imes)
Date: Wed, 15 Nov 2006 16:09:45 -0600
Subject: [Linux-uvc-devel] uvc fails to compile
Message-ID: <455B9029.6080804@ozob.net>

I have was checking out the trunk branch. I checked out the split branch 
and got it to compile and load. I then plugged in my "ProScope". This is 
the output of dmesg:

usbcore: registered new interface driver uvcvideo
USB Video Class driver (v0.1.0)
usb 1-1: new high speed USB device using ehci_hcd and address 88
usb 1-1: configuration #1 chosen from 1 choice
uvcvideo: Found UVC 1.00 device ProScope HR (19ab:1000)
uvcvideo: Unable to initialize the status endpoint (-22), status 
interrupt will not be supported.
hiddev96: USB HID v1.10 Device [Bodelin ProScope HR] on usb-0000:00:1d.7-1


So I started ekiga and I have a green screen. Ekiga settings indicate 
the it is using the ProScope.

What does this line mean?

uvcvideo: Unable to initialize the status endpoint (-22), status 
interrupt will not be supported.

Or should I say what is the significance of that line?

Also after that dmesg reports this:

uvcvideo: Failed to query (135) UVC control 9 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (130) UVC control 9 (unit 2) : -32 (exp. 2).
...
...


Thanks for any help,


-- 
Gene Imes ============================= ozob.net


From laurent.pinchart at skynet.be  Wed Nov 15 13:51:06 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Nov 2006 13:51:06 +0100
Subject: [Linux-uvc-devel] compile problems
In-Reply-To: <455A7704.7030004@ozob.net>
References: <455A7704.7030004@ozob.net>
Message-ID: <200611151351.06376.laurent.pinchart@skynet.be>

Hi Gene,

> Check this out about two minutes ago and this is what I got:
>
> root at go:/usr/src/trunk# mkae
> Building USB Video Class driver...
> make[1]: Entering directory `/usr/src/linux-2.6.19-rc2'
>    CC [M]  /usr/src/trunk/uvcvideo.o
> In file included from /usr/src/trunk/uvcvideo.c:49:
> /usr/src/trunk/v4l2_enumfrmfmt.h:8: error: nested redefinition of 'enum
> v4l2_frmsizetypes'
> /usr/src/trunk/v4l2_enumfrmfmt.h:8: error: redeclaration of 'enum
> v4l2_frmsizetypes'
> /usr/src/trunk/v4l2_enumfrmfmt.h:9: error: redeclaration of enumerator
> 'V4L2_FRMSIZE_TYPE_DISCRETE'
> include/linux/videodev2.h:286: error: previous definition of
> 'V4L2_FRMSIZE_TYPE_DISCRETE' was here
> /usr/src/trunk/v4l2_enumfrmfmt.h:10: error: redeclaration of enumerator
> 'V4L2_FRMSIZE_TYPE_CONTINUOUS'
> include/linux/videodev2.h:287: error: previous definition of
> 'V4L2_FRMSIZE_TYPE_CONTINUOUS' was here
> /usr/src/trunk/v4l2_enumfrmfmt.h:11: error: redeclaration of enumerator
> 'V4L2_FRMSIZE_TYPE_STEPWISE'
> include/linux/videodev2.h:288: error: previous definition of
> 'V4L2_FRMSIZE_TYPE_STEPWISE' was here
> /usr/src/trunk/v4l2_enumfrmfmt.h:14: error: nested redefinition of 'enum
> v4l2_frmivaltypes'
> /usr/src/trunk/v4l2_enumfrmfmt.h:14: error: redeclaration of 'enum
> v4l2_frmivaltypes'
> /usr/src/trunk/v4l2_enumfrmfmt.h:15: error: redeclaration of enumerator
> 'V4L2_FRMIVAL_TYPE_DISCRETE'
> include/linux/videodev2.h:326: error: previous definition of
> 'V4L2_FRMIVAL_TYPE_DISCRETE' was here
> /usr/src/trunk/v4l2_enumfrmfmt.h:16: error: redeclaration of enumerator
> 'V4L2_FRMIVAL_TYPE_CONTINUOUS'
> include/linux/videodev2.h:327: error: previous definition of
> 'V4L2_FRMIVAL_TYPE_CONTINUOUS' was here
> /usr/src/trunk/v4l2_enumfrmfmt.h:17: error: redeclaration of enumerator
> 'V4L2_FRMIVAL_TYPE_STEPWISE'
> include/linux/videodev2.h:328: error: previous definition of
> 'V4L2_FRMIVAL_TYPE_STEPWISE' was here
> /usr/src/trunk/v4l2_enumfrmfmt.h:24: error: redefinition of 'struct
> v4l2_frmsize_discrete'
> /usr/src/trunk/v4l2_enumfrmfmt.h:32: error: redefinition of 'struct
> v4l2_frmsize_stepwise'
> /usr/src/trunk/v4l2_enumfrmfmt.h:52: error: redefinition of 'struct
> v4l2_frmsizeenum'
> /usr/src/trunk/v4l2_enumfrmfmt.h:73: error: redefinition of 'struct
> v4l2_frmival_stepwise'
> /usr/src/trunk/v4l2_enumfrmfmt.h:84: error: redefinition of 'struct
> v4l2_frmivalenum'
> In file included from /usr/src/trunk/uvcvideo.c:49:
> /usr/src/trunk/v4l2_enumfrmfmt.h:116:1: warning:
> "VIDIOC_ENUM_FRAMESIZES" redefined
> In file included from include/linux/videodev.h:15,
>                   from /usr/src/trunk/uvcvideo.c:38:
> include/linux/videodev2.h:1329:1: warning: this is the location of the
> previous definition
> In file included from /usr/src/trunk/uvcvideo.c:49:
> /usr/src/trunk/v4l2_enumfrmfmt.h:117:1: warning:
> "VIDIOC_ENUM_FRAMEINTERVALS" redefined
> In file included from include/linux/videodev.h:15,
>                   from /usr/src/trunk/uvcvideo.c:38:
> include/linux/videodev2.h:1330:1: warning: this is the location of the
> previous definition
> /usr/src/trunk/uvcvideo.c: In function 'uvc_init_isoc':
> /usr/src/trunk/uvcvideo.c:1555: warning: assignment from incompatible
> pointer type
> /usr/src/trunk/uvcvideo.c: In function 'uvc_init_status':
> /usr/src/trunk/uvcvideo.c:3736: warning: passing argument 6 of
> 'usb_fill_int_urb' from incompatible pointer type
> make[2]: *** [/usr/src/trunk/uvcvideo.o] Error 1
> make[1]: *** [_module_/usr/src/trunk] Error 2
> make[1]: Leaving directory `/usr/src/linux-2.6.19-rc2'
> make: *** [uvcvideo] Error 2
>
>
> Anyone know how to fix this?

Edit uvc_compat.h, and replace line 76

#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,19)

by

#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,18)

Then search all occurences of

, struct pt_regs *regs

and remove them. A fix will be committed to SVN once 2.6.19 is out.

Laurent Pinchart


From evgeny at indent.ru  Thu Nov 16 12:41:49 2006
From: evgeny at indent.ru (Evgeny)
Date: Thu, 16 Nov 2006 14:41:49 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>
References: <op.tim8j4tc42iof8@misha> <200611130408.20436.evgeny@indent.ru>
	<2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>
Message-ID: <200611161441.49469.evgeny@indent.ru>

> I really love this patch! It works much better than the reset patch for me.
> I am able to
> record alot more times 
Nice to read this. Thank you for participation in this work.

>  before I get an error, but now I get a new, exciting 
> one. This is
> the output from "dmesg | tail":
> uvcvideo: Failed to resubmit isoc URB (-45).

Please try the next version attached.
-45 error seems to be related to usbaudio and audio stream capture. The 
solution provided is to resend URB in case of EL2NSYNC error. There are patch 
for 2.6.19-rc kernels, that fixed this issue. For older kernels we have to 
fix it in driver code.

Please note, that attached patch must be applied to the last revision of split 
branch (revision 68)

Feel free to report your results. All we need this driver to be as stable as 
possible.
>
> I hope this helps somehow, keep up the great work!

Definitely. I really need testers for this patch.

>
> Regards, Vidar



Regards, Evgeny Marchenko
-------------- next part --------------
A non-text attachment was scrubbed...
Name: delay.patch
Type: text/x-diff
Size: 5629 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061116/d95266d5/attachment.patch>

From evgeny at indent.ru  Thu Nov 16 13:03:09 2006
From: evgeny at indent.ru (Evgeny)
Date: Thu, 16 Nov 2006 15:03:09 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611130408.20436.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611120258.30196.evgeny@indent.ru>
	<200611130408.20436.evgeny@indent.ru>
Message-ID: <200611161503.09911.evgeny@indent.ru>

Hi, all

It seems that there is an interference between concurrent usb transfers. E.g. 
submitting isochronus URB and control URB. The source of problem is 
definitely in camera hardware, but we can avoid it in driver using software 
methods. 

Laurent and Martin, what do you think about using mutexes for this?


Regards, Evgeny


From ripnetuk at gmail.com  Thu Nov 16 15:35:44 2006
From: ripnetuk at gmail.com (George Styles)
Date: Thu, 16 Nov 2006 14:35:44 +0000
Subject: [Linux-uvc-devel] Which cam is best for Linux UVC?
Message-ID: <9398f0eb0611160635q47145142n6a21919f7c6644ce@mail.gmail.com>

Hi,

I think my logitech orbit has died. It was working fine, then the
machine into which is was plugged reset itself, now the camera gives
this in dmesg

usb 1-3: new high speed USB device using ehci_hcd and address 2
usb 1-3: device descriptor read/64, error -110
usb 1-3: device descriptor read/64, error -110

Googling says this is likely hardware failure (it is at a remote site,
so I havent been able to check if it works on WinXP yet).

Assuming it has failed, I want a new camera. Someone mentioned that
newer logitech cameras dont suffer from the 'reset usb' problem.

Can someone point me at a camera which works perfectly with your
drivers please? is the fixed model a new model number, or just a
revision?

Im looking for something that grabs at around 1024x768 resolution or higher.

I think UVC is the way to go, for fast updates isnt it? or should I be
looking at cameras that use other APIs?

thanks

George


From evgeny at indent.ru  Thu Nov 16 15:44:22 2006
From: evgeny at indent.ru (Evgeny)
Date: Thu, 16 Nov 2006 17:44:22 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611161441.49469.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha>
	<2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>
	<200611161441.49469.evgeny@indent.ru>
Message-ID: <200611161744.22422.evgeny@indent.ru>


> Please try the next version attached.

I faulty modified sleep code.
Please change schedule() call at line 43 of uvc_video.c to udelay(500);
schedule() is not suitable here

Evgeny Marchenko


From laurent.pinchart at skynet.be  Sat Nov 18 13:12:20 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 18 Nov 2006 13:12:20 +0100
Subject: [Linux-uvc-devel] uvc 'split' driver problem with ekiga-2.0.2
In-Reply-To: <1163542648.18367.7.camel@sonlaptop>
References: <1163534124.16457.11.camel@sonlaptop>
	<200611142114.19541.laurent.pinchart@skynet.be>
	<1163542648.18367.7.camel@sonlaptop>
Message-ID: <200611181312.20480.laurent.pinchart@skynet.be>

Hi Louis,

> > > I wanted to try the split branch driver with fc6, compiled and
> > > installed fine. When I tried to use ekiga I get an error when opening
> > > my webcam device. This was working with the trunk driver.
> > >
> > > Error while opening video device USB 2.0 Camera
> > >
> > > Your driver doesn't seem to support any of the color formats supported
> > > by Ekiga.
> > > Please check your kernel driver documentation in order to determine
> > > which Palette is supported.
> >
> > There's probably something wrong with your setup. Does the same version
> > of Ekiga work with the trunk driver ? Could you set the trace parameter
> > to 15 (echo -n 15 > /sys/modules/uvcvideo/parameters/trace) before
> > plugging the webcam, and send me the dmesg output after trying to run
> > Ekiga ?
> >
> Yes, the same version of Ekiga works with the trunk driver. My webcam is
> part of the laptop and can't be plugged out. Is their another way of
> debuging?

Yes, you can set the trace parameter when loading the module

modprobe uvcvideo trace=15

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Nov 18 13:24:02 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 18 Nov 2006 13:24:02 +0100
Subject: [Linux-uvc-devel] uvc fails to compile
In-Reply-To: <455B9029.6080804@ozob.net>
References: <455B9029.6080804@ozob.net>
Message-ID: <200611181324.02313.laurent.pinchart@skynet.be>

Hi Gene,

> I have was checking out the trunk branch. I checked out the split branch
> and got it to compile and load. I then plugged in my "ProScope". This is
> the output of dmesg:
>
> usbcore: registered new interface driver uvcvideo
> USB Video Class driver (v0.1.0)
> usb 1-1: new high speed USB device using ehci_hcd and address 88
> usb 1-1: configuration #1 chosen from 1 choice
> uvcvideo: Found UVC 1.00 device ProScope HR (19ab:1000)
> uvcvideo: Unable to initialize the status endpoint (-22), status
> interrupt will not be supported.
> hiddev96: USB HID v1.10 Device [Bodelin ProScope HR] on usb-0000:00:1d.7-1
>
> So I started ekiga and I have a green screen. Ekiga settings indicate
> the it is using the ProScope.
>
> What does this line mean?
>
> uvcvideo: Unable to initialize the status endpoint (-22), status
> interrupt will not be supported.

This is interesting, nobody had ever reported this before. For some reason the 
driver is unable to initialise the status interrupt endpoint, which is used 
by the webcam to report events such as button press, ... Are you using 
2.6.19-rc ? Could you try with 2.6.18 or 2.6.17 ?

> Or should I say what is the significance of that line?
>
> Also after that dmesg reports this:
>
> uvcvideo: Failed to query (135) UVC control 9 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (130) UVC control 9 (unit 2) : -32 (exp. 2).
> ...
> ...

Did you say ProScope ? So you're not using a Logitech webcam ? Do you know 
which USB controller is used by the ProScope ? If it uses the spca525, you 
might be suffering from the same hardware bug as Logitech users. If not, I 
don't think I could really help without getting my hands on the hardware.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Nov 18 13:25:37 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 18 Nov 2006 13:25:37 +0100
Subject: [Linux-uvc-devel] CPU Usage
In-Reply-To: <BAY109-F2380108B3D33F6F3A25CF2D4EA0@phx.gbl>
References: <BAY109-F2380108B3D33F6F3A25CF2D4EA0@phx.gbl>
Message-ID: <200611181325.37555.laurent.pinchart@skynet.be>

Hi Daniel,

> I am interested in running two camera with 30 fps. I found the CPU is 100%
> and system became not stable. (crashed or frozen). I am using LUVView. I
> can not figure out why the system crashed. Could anyone tests two cameras
> also take a look at CPU? Also how to get log about the crash?Thanks!

Does Linux crash, or just the application ? The kernel should definitely not 
crash. Do you get a kernel oops ? Does your system recover if you kill the 
application ?

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Nov 18 13:29:44 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 18 Nov 2006 13:29:44 +0100
Subject: [Linux-uvc-devel] Which cam is best for Linux UVC?
In-Reply-To: <9398f0eb0611160635q47145142n6a21919f7c6644ce@mail.gmail.com>
References: <9398f0eb0611160635q47145142n6a21919f7c6644ce@mail.gmail.com>
Message-ID: <200611181329.44531.laurent.pinchart@skynet.be>

Hi George,

> I think my logitech orbit has died. It was working fine, then the
> machine into which is was plugged reset itself, now the camera gives
> this in dmesg
>
> usb 1-3: new high speed USB device using ehci_hcd and address 2
> usb 1-3: device descriptor read/64, error -110
> usb 1-3: device descriptor read/64, error -110
>
> Googling says this is likely hardware failure (it is at a remote site,
> so I havent been able to check if it works on WinXP yet).

This looks like a hardware problem to me. It might either be your webcam or 
your USB controller. You might want to check that before buying a new webcam.

> Assuming it has failed, I want a new camera. Someone mentioned that
> newer logitech cameras dont suffer from the 'reset usb' problem.

That's not true, at least not yet. Logitech UVC webcams exist in two 
revisions, both of them suffering from the problem. The third revision should 
have the problem fixed.

> Can someone point me at a camera which works perfectly with your
> drivers please? is the fixed model a new model number, or just a
> revision?
>
> Im looking for something that grabs at around 1024x768 resolution or
> higher.
>
> I think UVC is the way to go, for fast updates isnt it? or should I be
> looking at cameras that use other APIs?

UVC is definitely the way to go, but I don't know of any high resolution UVC 
webcam other than the buggy Logitech ones. There might of course be some that 
I'm not aware of.

I've been told that the second revision webcams can have their firmware 
upgraded, but Logitech is not known to make firmware upgrades available to 
end-users. They could of course change their policy :-)

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Nov 18 13:35:01 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 18 Nov 2006 13:35:01 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611161503.09911.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611130408.20436.evgeny@indent.ru>
	<200611161503.09911.evgeny@indent.ru>
Message-ID: <200611181335.02105.laurent.pinchart@skynet.be>

Hi Evgeny,

> It seems that there is an interference between concurrent usb transfers.
> E.g. submitting isochronus URB and control URB. The source of problem is
> definitely in camera hardware, but we can avoid it in driver using software
> methods.

Are you sure about that ? Could you give more information about the 
interference you noticed ?

> Laurent and Martin, what do you think about using mutexes for this?

Isochronous URBs are submitted in interrupt context, so we can't use mutexes 
there.

Cheers,

Laurent Pinchart


From ralph at mueller-welt.net  Sat Nov 18 13:31:47 2006
From: ralph at mueller-welt.net (Ralph =?iso-8859-1?q?M=FCller-Welt?=)
Date: Sat, 18 Nov 2006 13:31:47 +0100 (MET)
Subject: [Linux-uvc-devel] Split experiences
Message-ID: <200611181331.46482.ralph@mueller-welt.net>

Hi alltogeher,

yesterday, i checked out the split branch rev 68, compiled and installed.
that worked really fine on amd64 with my orbit 046d:08c2.

Using Lucview's reset button worked unexpectedly!
OK, it resetted the Picture setting ok.
It moved Pan / Tilt to its extreme positions, but while doing this a bad sound 
came out of my cam and Tilt didnt come up to its middle again while pan did.
Shock!
I tried pan / tilt control from luvcview but only pan worked...
I tried all things of unplugging cam, reloading module, etc. but Tilt control 
was dead, and so was the reset button.

The Pan conrtol was also working not correctly. When keeping pressed a pan 
direction button, the camera moved not straight that way but back and forth 
that way...


Hope it helps,
Ralph.


From laurent.pinchart at skynet.be  Sat Nov 18 13:40:05 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 18 Nov 2006 13:40:05 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611161744.22422.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611161441.49469.evgeny@indent.ru>
	<200611161744.22422.evgeny@indent.ru>
Message-ID: <200611181340.06157.laurent.pinchart@skynet.be>

Hi Evgeny,

> > Please try the next version attached.
>
> I faulty modified sleep code.
> Please change schedule() call at line 43 of uvc_video.c to udelay(500);
> schedule() is not suitable here

That's not a good idea. You will end up with an non interruptible delay. Why 
was schedule not suitable ? Is the function called from interrupt context ?

Cheers,

Laurent Pinchart


From vidarno at gmail.com  Sat Nov 18 13:58:20 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sat, 18 Nov 2006 13:58:20 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611161744.22422.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha>
	<2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>
	<200611161441.49469.evgeny@indent.ru>
	<200611161744.22422.evgeny@indent.ru>
Message-ID: <2eed5f740611180458j7cab6ec4l23074fdab40522dd@mail.gmail.com>

On 11/16/06, Evgeny <evgeny at indent.ru> wrote:
>
>
> > Please try the next version attached.
>
> I faulty modified sleep code.
> Please change schedule() call at line 43 of uvc_video.c to udelay(500);
> schedule() is not suitable here
>

The new version seems to work even longer before causing trouble, as far as
I can tell.
But eventually it does crash, here is the pertinent information from "dmesg
| tail":
----
uvcvideo: Failed to resubmit isoc URB (-45).
uvcvideo: Failed to resubmit isoc URB (-45).
uvcvideo: Failed to resubmit isoc URB (-45).
uvcvideo: Failed to resubmit isoc URB (-45).
usb 1-4: USB disconnect, address 6
usb 1-4: new high speed USB device using ehci_hcd and address 7
----

Regard, Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061118/4b8f213e/attachment.html>

From pauljurczak at yahoo.com  Sat Nov 18 20:20:43 2006
From: pauljurczak at yahoo.com (Paul Jurczak)
Date: Sat, 18 Nov 2006 11:20:43 -0800 (PST)
Subject: [Linux-uvc-devel] Which cam is best for Linux UVC?
Message-ID: <20061118192043.98907.qmail@web60520.mail.yahoo.com>

Here are links to two new UVC cameras (available soon):

1. Creative Labs Live! Cam Optia <http://creative.com/products/product.asp?category=218&subcategory=219&product=15985>

2. V-Gear TalkCam MX6 <http://vgear.com/products/list.asp?ProdID=AMVG1-010-076-G>

I'm planning to get one or both of these and test them with Linux UVC driver.
 
Paul.
  

.........

> Can someone point me at a camera which works perfectly with your
> drivers please? is the fixed model a new model number, or just a
> revision?
>
> Im looking for something that grabs at around 1024x768 resolution or
> higher.
>
> I think UVC is the way to go, for fast updates isnt it? or should I be
> looking at cameras that use other APIs?







 
____________________________________________________________________________________
Sponsored Link

Mortgage rates near 39yr lows. 
$510k for $1,698/mo. Calculate new payment! 
www.LowerMyBills.com/lre


From jurij.purkat at gmail.com  Sun Nov 19 17:47:48 2006
From: jurij.purkat at gmail.com (Jurij Purkat)
Date: Sun, 19 Nov 2006 17:47:48 +0100
Subject: [Linux-uvc-devel] Support for 2.4 kernel
Message-ID: <faf005a80611190847y1882e126u12e02766539c478@mail.gmail.com>

Hi

I have a little problem with this driver. I want to insmod this driver to
the oleg's custom firmware on Asus wl-500gP router. I have little problem
becouse it is based only on 2.4.16 kernel.

TNX for sugestions Jorg

P.S. Sory for English
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061119/fb2e5994/attachment.html>

From alex at alexpounds.com  Sun Nov 19 21:33:10 2006
From: alex at alexpounds.com (Alex Pounds)
Date: Sun, 19 Nov 2006 20:33:10 +0000
Subject: [Linux-uvc-devel] Problem with linux-uvc and IM clients
Message-ID: <20061119203309.GA20093@localhost.localdomain>

Hello, 

I'm using the patched split driver (revision 68), which works fine with
luvcview. The thing is, it doesn't work with any instant messengers. 

aMSN gives me "Error getting camera capabilities". Kopete gives me a
variation on a green screen, a Q, and every so often it'll actually work
in the settings box but I've not yet got it to work in an actual IM
conversation. Ekiga says that it couldn't open the device. 

Anyway, I just thought I'd report this kind of semi-working state it's in.
I'm happy to supply any debugging information you want.

-- 
Alex Pounds (Creature)                  .~.         http://www.alexpounds.com/
                                        /V\        http://www.ethicsgirls.com/
                                       // \\
"Variables won't; Constants aren't"   /(   )\
                                       ^`~'^


From evgeny at indent.ru  Sun Nov 19 23:19:51 2006
From: evgeny at indent.ru (Evgeny)
Date: Mon, 20 Nov 2006 01:19:51 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <2eed5f740611180458j7cab6ec4l23074fdab40522dd@mail.gmail.com>
References: <op.tim8j4tc42iof8@misha> <200611161744.22422.evgeny@indent.ru>
	<2eed5f740611180458j7cab6ec4l23074fdab40522dd@mail.gmail.com>
Message-ID: <200611200119.51464.evgeny@indent.ru>

Hi, Vidar

> uvcvideo: Failed to resubmit isoc URB (-45).
> uvcvideo: Failed to resubmit isoc URB (-45).
> uvcvideo: Failed to resubmit isoc URB (-45).
> uvcvideo: Failed to resubmit isoc URB (-45).
> usb 1-4: USB disconnect, address 6
> usb 1-4: new high speed USB device using ehci_hcd and address 7
> ----
>

I cannot reproduce your error. How did you get it? What kernel do you use? Do 
you capture audio and video streams or only video?


Evgeny


From evgeny at indent.ru  Mon Nov 20 08:10:19 2006
From: evgeny at indent.ru (Evgeny)
Date: Mon, 20 Nov 2006 10:10:19 +0300
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611181335.02105.laurent.pinchart@skynet.be>
References: <op.tim8j4tc42iof8@misha> <200611161503.09911.evgeny@indent.ru>
	<200611181335.02105.laurent.pinchart@skynet.be>
Message-ID: <200611201010.20065.evgeny@indent.ru>

Hi, Laurent

> Are you sure about that ? Could you give more information about the
> interference you noticed ?

Almost sure. I investigate hardware bug, that leads to -32 and -110 error. I 
wrote small program that changes camera controls several hundreds times per 
second. I recieve -32 error after 2-3 seconds of changing controls. As you 
know, I posted small patch, that delays usb_control_msg() for at least 500 
microseconds after previous control message. With this patch I receive -32 
error not so often - after 100 - 200 thousands of changes. Then I modified 
driver to delay control message for at least 500 microseconds after ANY 
submitted URB. I never receive -32 nor -110 error anymore. Please note, that 
I perform video capture and manipulations with control in different threads.

After that, I think that camera hardware have not enough time to apply changes 
when we try  to change controls too quickly. Am I right? Can this be true?

Also, I noticed strange behavior in VIDIOC_S_CTRL. It always returns zero not 
depending is there an error in uvc_ctrl_commit or not. It looks like a typo. 
Do we need "return ret;" after line 518 in uvc_v4l2.c ?

> Isochronous URBs are submitted in interrupt context, so we can't use
> mutexes there.

What about to move submitting to interrupt bottom half?


Regards, Evgeny Marchenko.


From vidarno at gmail.com  Tue Nov 21 16:27:53 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Tue, 21 Nov 2006 16:27:53 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <200611151546.38796.mxhaard@magic.fr>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<455ACAD3.8020909@web.de> <200611151546.38796.mxhaard@magic.fr>
Message-ID: <2eed5f740611210727o30cbb2atba57047f1dc84711@mail.gmail.com>

Hello again,

after your recommendations I have now purchased a new USB controller,
installed it and have both cameras connected to each it's controller (one on
the onboard one). Both cameras work fine when run on it's own, and I am also
able to record from one with ffmpeg while using luvcview to view video from the
other - BUT when I try to record from both using ffmpeg (or view from both with
luvcview) I get the following error:

ioctl(VIDIOC_STREAMON): Cannot allocate memory
Could not find video grab device

Seems familiar? :)
I'll soon run out of hair to pull out from frustration if I cannot get
this to work.
Any and all help is, again, very much appreciated.

Regards,
Vidar Normann


From linux at rubli.info  Tue Nov 21 17:11:15 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 21 Nov 2006 17:11:15 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611161441.49469.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha> <200611130408.20436.evgeny@indent.ru>
	<2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>
	<200611161441.49469.evgeny@indent.ru>
Message-ID: <op.tjdi81wr42iof8@misha>

Hey Evgeny,

I've given your patches a little testing:

The first patch that spaces the control messages by 500 microseconds does  
very well for me. Keep in mind, though, that on my computer even the retry  
patch works fine, so I'm not sure how meaningful this result is.

The second patch that spaces all URBs is not really satisfying since  
changing any controls now delays video frames resulting in very bad video  
experience.

A few other comments:

> -45 error seems to be related to usbaudio and audio stream capture. The
> solution provided is to resend URB in case of EL2NSYNC error. There are  
> patch for 2.6.19-rc kernels, that fixed this issue. For older kernels we
> have to fix it in driver code.

I've never seen -45 before, so I'd really be interested in knowing whether  
this occurred while audio was active. Vidar, do you remember?

I would like to run some more tests. Could you please send me the little  
tool you're using to stress test the camera with hundreds of requests per  
second?

> So, I think, that we send controls to quickly. Yes, camera must
> acknowledge control packet only after it applied it to hardware. But who
> knows does it do so or not.

Not necessarily. The camera can acknowledge the control immediately and  
delay the internal processing. In such cases the camera may follow up with  
a status interrupt to signal the completion of the control change but that  
is not required if the SET_CUR request was acked within 10 ms (section  
2.4.4).

Cheers,
Martin


From linux at rubli.info  Tue Nov 21 17:23:23 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 21 Nov 2006 17:23:23 +0100
Subject: [Linux-uvc-devel] Problem with linux-uvc and IM clients
In-Reply-To: <20061119203309.GA20093@localhost.localdomain>
References: <20061119203309.GA20093@localhost.localdomain>
Message-ID: <op.tjdjs9z642iof8@misha>

On Sun, 19 Nov 2006 21:33:10 +0100, Alex Pounds <alex at alexpounds.com>  
wrote:

> aMSN gives me "Error getting camera capabilities".

IIRC aMSN is known to not work right with the uvcvideo driver. I haven't  
checked but I could imagine that it uses ioctls that aren't supported by  
uvcvideo.

> Kopete gives me a
> variation on a green screen, a Q, and every so often it'll actually work
> in the settings box but I've not yet got it to work in an actual IM
> conversation.

I've never gotten around to test Kopete. What version are you using? Does  
it use Phonon yet?  
(http://developer.kde.org/seasonofkde/project.php?kopete_phonon.xml)

> Ekiga says that it couldn't open the device.

Which version of Ekiga? We've had reports about Ekiga 2.0.2 not working  
with the split version. I'll look into that ...

> Anyway, I just thought I'd report this kind of semi-working state it's  
> in. I'm happy to supply any debugging information you want.

Thanks! Always useful! :-)

Cheers,
Martin


From linux at rubli.info  Tue Nov 21 17:32:13 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 21 Nov 2006 17:32:13 +0100
Subject: [Linux-uvc-devel] uvc 'split' driver problem with ekiga-2.0.2
In-Reply-To: <1163544197.19454.1.camel@sonlaptop>
References: <1163534124.16457.11.camel@sonlaptop>
	<200611142114.19541.laurent.pinchart@skynet.be>
	<1163544197.19454.1.camel@sonlaptop>
Message-ID: <op.tjdj7zsi42iof8@misha>

On Tue, 14 Nov 2006 23:43:17 +0100, Louis E Garcia II  
<louisg00 at bellsouth.net> wrote:

> Yes, the same version of Ekiga works with the trunk driver. My webcam is
> part of the laptop and can't be plugged out. Is their another way of
> debuging?

I'm running Ekiga 2.0.3 here and it seems to work fine with the latest  
split driver (r68). Telling from the changelog there were no significant  
changes between 2.0.2 and 2.0.3 as far as webcams go but you may want to  
try upgrading anyway just to be sure it's not Ekiga.

Cheers,
Martin


From linux at rubli.info  Tue Nov 21 17:34:06 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 21 Nov 2006 17:34:06 +0100
Subject: [Linux-uvc-devel] Problem with linux-uvc and IM clients
In-Reply-To: <op.tjdjs9z642iof8@misha>
References: <20061119203309.GA20093@localhost.localdomain>
	<op.tjdjs9z642iof8@misha>
Message-ID: <op.tjdka4ch42iof8@misha>

>> Ekiga says that it couldn't open the device.
>
> Which version of Ekiga? We've had reports about Ekiga 2.0.2 not working
> with the split version. I'll look into that ...

I've just tested 2.0.3 successfully with r68 of the split driver ...

Cheers,
Martin


From linux at rubli.info  Tue Nov 21 17:40:39 2006
From: linux at rubli.info (Martin Rubli)
Date: Tue, 21 Nov 2006 17:40:39 +0100
Subject: [Linux-uvc-devel] Split experiences
In-Reply-To: <200611181331.46482.ralph@mueller-welt.net>
References: <200611181331.46482.ralph@mueller-welt.net>
Message-ID: <op.tjdkl1v342iof8@misha>

> Using Lucview's reset button worked unexpectedly!
> OK, it resetted the Picture setting ok.
> It moved Pan / Tilt to its extreme positions, but while doing this a bad  
> sound came out of my cam and Tilt didnt come up to its middle again while
> pan did.
> Shock!

Is it still stuck? I've attached below an entry of the FAQ I'm about to  
prepare ...

> I tried pan / tilt control from luvcview but only pan worked...

There are different versions of the driver and different versions of  
luvcview that don't always work together because at some point the control  
IDs changed. Can you try to recompile the latest luvcview and make sure  
that its control IDs are the same as in your driver?

> I tried all things of unplugging cam, reloading module, etc. but Tilt  
> control was dead, and so was the reset button.

Did the tilt control ever work? (Tilt during the reset process doesn't  
count because that's controlled by the camera.)

Cheers,
Martin



=== The panning mechanism of my camera got stuck. How do I fix it? ===

There are different ways to resolve this problem. You should try the  
following points:

# Try to use the ''Pan/tilt reset'' control to reset the position of the  
camera head.
# Plug the camera into a Windows machine that has Logitech QuickCam  
installed. This should automatically reset the pan/tilt position.
# If none of the above work, you may need to carefully turn the camera  
head manually by different angles.


From mclaughlin.denis at gmail.com  Tue Nov 21 19:42:30 2006
From: mclaughlin.denis at gmail.com (Denis McLaughlin)
Date: Tue, 21 Nov 2006 13:42:30 -0500
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611210727o30cbb2atba57047f1dc84711@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<2eed5f740611140602v2ce13d47xfe1f2a1f4fb10a60@mail.gmail.com>
	<455ACAD3.8020909@web.de> <200611151546.38796.mxhaard@magic.fr>
	<2eed5f740611210727o30cbb2atba57047f1dc84711@mail.gmail.com>
Message-ID: <74e91400611211042u1a7561d5k7dd51c77bd1172@mail.gmail.com>

  What command lines are you using with luvcview?  You are specifying a
different video device file for each, right?  The two calls should look
something like:

luvcview  -d /dev/video0
luvcview  -d /dev/video1

Denis

On 11/21/06, Vidar Normann <vidarno at gmail.com> wrote:
>
> Hello again,
>
> after your recommendations I have now purchased a new USB controller,
> installed it and have both cameras connected to each it's controller (one
> on
> the onboard one). Both cameras work fine when run on it's own, and I am
> also
> able to record from one with ffmpeg while using luvcview to view video
> from the
> other - BUT when I try to record from both using ffmpeg (or view from both
> with
> luvcview) I get the following error:
>
> ioctl(VIDIOC_STREAMON): Cannot allocate memory
> Could not find video grab device
>
> Seems familiar? :)
> I'll soon run out of hair to pull out from frustration if I cannot get
> this to work.
> Any and all help is, again, very much appreciated.
>
> Regards,
> Vidar Normann
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061121/fcd2d7d5/attachment.html>

From vidarno at gmail.com  Tue Nov 21 21:22:02 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Tue, 21 Nov 2006 21:22:02 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <op.tjdi81wr42iof8@misha>
References: <op.tim8j4tc42iof8@misha> <200611130408.20436.evgeny@indent.ru>
	<2eed5f740611151229u4ed7ee20qf8247d724daf0310@mail.gmail.com>
	<200611161441.49469.evgeny@indent.ru> <op.tjdi81wr42iof8@misha>
Message-ID: <2eed5f740611211222h62fa1040n6490df02f5765198@mail.gmail.com>

On 11/21/06, Martin Rubli <linux at rubli.info> wrote:
>
>
> > -45 error seems to be related to usbaudio and audio stream capture. The
> > solution provided is to resend URB in case of EL2NSYNC error. There are
> > patch for 2.6.19-rc kernels, that fixed this issue. For older kernels we
> > have to fix it in driver code.
>
> I've never seen -45 before, so I'd really be interested in knowing whether
> this occurred while audio was active. Vidar, do you remember?


Audio was not active, at least I specified on the command line that ffmpeg
should
not record audio, only video.

On 11/19/06, Evgeny <evgeny at indent.ru> wrote:Hi, Vidar

>> uvcvideo: Failed to resubmit isoc URB (-45).
>> uvcvideo: Failed to resubmit isoc URB (-45).
>> uvcvideo: Failed to resubmit isoc URB (-45).
>> uvcvideo: Failed to resubmit isoc URB (-45).
>> usb 1-4: USB disconnect, address 6
>> usb 1-4: new high speed USB device using ehci_hcd and address 7
>> ----
>>
>
>I cannot reproduce your error. How did you get it? What kernel do you use?
Do
>you capture audio and video streams or only video?

I have not reproduced the error later, as I am currently attempting to start
a stream
instead and then record from the stream, to circumvent this issue.
Nevertheless,
the error came after a loop ran the following command several times (50+?):
/usr/local/bin/ffmpeg -t 900 -vd "/dev/video0" -an -vcodec mpeg4 -s 640x480
-y "/home/terje/cam1/`date +%A`/`date +%H%M`.avi"

This command records a 15 minute video in xvid-format from the webcam, audio
disabled or not captured. The kernel used was 2.6.17-2-686.
Hope this helps.

Also, this will probably interest you: Due to suggestions here I purchased
another
USB controller to be able to record from two webcams at the same time. After
installing it I tried to connect the two webcams after the computer was
booted up,
but this froze the machine. I tried both webcams, in both the old (onboard)
controller
and new (pci) controller but still the machine froze after outputting the
standard
messages from uvc. I also tried uninstalling the new controller, but to no
avail. After
a few attempts the only thing that worked was recompiling uvc without your
patches,
at which point it worked. Any ideas why?

Regards,
Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061121/c0fa62a9/attachment.html>

From laurent.pinchart at skynet.be  Tue Nov 21 22:04:36 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 21 Nov 2006 22:04:36 +0100
Subject: [Linux-uvc-devel] Split experiences
In-Reply-To: <op.tjdkl1v342iof8@misha>
References: <200611181331.46482.ralph@mueller-welt.net>
	<op.tjdkl1v342iof8@misha>
Message-ID: <200611212204.36921.laurent.pinchart@skynet.be>

Hi Ralph,

> > Using Lucview's reset button worked unexpectedly!
> > OK, it resetted the Picture setting ok.
> > It moved Pan / Tilt to its extreme positions, but while doing this a bad
> > sound came out of my cam and Tilt didnt come up to its middle again while
> > pan did.
> > Shock!
>
> Is it still stuck? I've attached below an entry of the FAQ I'm about to
> prepare ...
>
> > I tried pan / tilt control from luvcview but only pan worked...
>
> There are different versions of the driver and different versions of
> luvcview that don't always work together because at some point the control
> IDs changed. Can you try to recompile the latest luvcview and make sure
> that its control IDs are the same as in your driver?

The latest luvcview tarball available on Michel Xhaard's website still doesn't 
support the new pan/tilt controls introduced in the split branch. I plan to 
submit the pan/tilt controls for inclusion in V4L2. The pan/tilt controls IDs 
will thus be modified once again. Sorry for the inconvenience, but keep in 
mind the driver is under development :-)

In the meantime, I'm sure Michel would accept a patch to support the new 
pan/tilt controls.

> > I tried all things of unplugging cam, reloading module, etc. but Tilt
> > control was dead, and so was the reset button.
>
> Did the tilt control ever work? (Tilt during the reset process doesn't
> count because that's controlled by the camera.)

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Nov 21 22:10:08 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 21 Nov 2006 22:10:08 +0100
Subject: [Linux-uvc-devel] Support for 2.4 kernel
In-Reply-To: <faf005a80611190847y1882e126u12e02766539c478@mail.gmail.com>
References: <faf005a80611190847y1882e126u12e02766539c478@mail.gmail.com>
Message-ID: <200611212210.08926.laurent.pinchart@skynet.be>

Hi Jorg,

> I have a little problem with this driver. I want to insmod this driver to
> the oleg's custom firmware on Asus wl-500gP router. I have little problem
> becouse it is based only on 2.4.16 kernel.

The driver has been written for Linux 2.6.15 and newer. Backporting it to the 
2.4.x series might be possible, but is definitely not straightforward. There 
is currently no plan to do so. Sorry.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Nov 21 22:19:49 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 21 Nov 2006 22:19:49 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <2eed5f740611210727o30cbb2atba57047f1dc84711@mail.gmail.com>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611151546.38796.mxhaard@magic.fr>
	<2eed5f740611210727o30cbb2atba57047f1dc84711@mail.gmail.com>
Message-ID: <200611212219.49793.laurent.pinchart@skynet.be>

> Hello again,
>
> after your recommendations I have now purchased a new USB controller,
> installed it and have both cameras connected to each it's controller (one
> on the onboard one). Both cameras work fine when run on it's own, and I am
> also able to record from one with ffmpeg while using luvcview to view video
> from the other - BUT when I try to record from both using ffmpeg (or view
> from both with luvcview) I get the following error:
>
> ioctl(VIDIOC_STREAMON): Cannot allocate memory
> Could not find video grab device

I've never seen this happening before. Is your system really running low on 
memory or do you have plenty of RAM available ?

> Seems familiar? :)
> I'll soon run out of hair to pull out from frustration if I cannot get
> this to work.
> Any and all help is, again, very much appreciated.

Could you add printk() statements in uvc_video.c in the uvc_init_isoc(), right 
before the return -ENOMEM statements, to see what exactly returns -ENOMEM ? 
Try to print the npackets and size variable to see if they are computed 
properly.

Cheers,

Laurent Pinchart


From vidarno at gmail.com  Tue Nov 21 22:27:15 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Tue, 21 Nov 2006 22:27:15 +0100
Subject: [Linux-uvc-devel] Trouble recording from two webcams
In-Reply-To: <200611212219.49793.laurent.pinchart@skynet.be>
References: <2eed5f740611131046p6f70917dr18bba18f57573208@mail.gmail.com>
	<200611151546.38796.mxhaard@magic.fr>
	<2eed5f740611210727o30cbb2atba57047f1dc84711@mail.gmail.com>
	<200611212219.49793.laurent.pinchart@skynet.be>
Message-ID: <2eed5f740611211327q96975dcq4ec9efa2c36eec17@mail.gmail.com>

On 11/21/06, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
>
> > ioctl(VIDIOC_STREAMON): Cannot allocate memory
> > Could not find video grab device
>
> I've never seen this happening before. Is your system really running low
> on
> memory or do you have plenty of RAM available ?


Now this is getting really weird. After a few hours passed I attempted to
record from both
webcams (the computer has been running all the time) and now suddenly it
works! Two
instances of luvcview also work - Do not ask me why! I am using the exact
same commands.

> Seems familiar? :)
> > I'll soon run out of hair to pull out from frustration if I cannot get
> > this to work.
> > Any and all help is, again, very much appreciated.
>
> Could you add printk() statements in uvc_video.c in the uvc_init_isoc(),
> right
> before the return -ENOMEM statements, to see what exactly returns -ENOMEM
> ?
> Try to print the npackets and size variable to see if they are computed
> properly.


I'll wait on this one until I see a similar error again, if that is okay
with you. I have a feeling
that won't be too far into the future anyhow.

Regards,
Vidar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061121/939089a8/attachment.html>

From laurent.pinchart at skynet.be  Tue Nov 21 22:30:13 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 21 Nov 2006 22:30:13 +0100
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
In-Reply-To: <200611201010.20065.evgeny@indent.ru>
References: <op.tim8j4tc42iof8@misha>
	<200611181335.02105.laurent.pinchart@skynet.be>
	<200611201010.20065.evgeny@indent.ru>
Message-ID: <200611212230.13884.laurent.pinchart@skynet.be>

Hi Evgeny,

first of all, thank you for your help. You have spent quite a lot of time to 
try to fix the Logitech hardware issue, and I think I can speak in the name 
of everybody here to thank you for your efforts, even if the perfect patch 
hasn't been found yet :-)

> > Are you sure about that ? Could you give more information about the
> > interference you noticed ?
>
> Almost sure. I investigate hardware bug, that leads to -32 and -110 error.
> I wrote small program that changes camera controls several hundreds times
> per second. I recieve -32 error after 2-3 seconds of changing controls. As
> you know, I posted small patch, that delays usb_control_msg() for at least
> 500 microseconds after previous control message. With this patch I receive
> -32 error not so often - after 100 - 200 thousands of changes. Then I
> modified driver to delay control message for at least 500 microseconds
> after ANY submitted URB. I never receive -32 nor -110 error anymore. Please
> note, that I perform video capture and manipulations with control in
> different threads.

I'll try your patch in a few days. My computer isn't affected by the hardware 
bug, so I can't test fixes easily here. My boyfriend has a laptop which 
suffers a lot from the problem, so I can fortunately (for me, not for 
him :-)) test patches on his computer.

> After that, I think that camera hardware have not enough time to apply
> changes when we try  to change controls too quickly. Am I right? Can this
> be true?

Only the hardware/firmware developers could answer that. What really puzzles 
me is that the webcam works in Windows, and I've been told by Logitech that 
their driver contained no special workaround.

> Also, I noticed strange behavior in VIDIOC_S_CTRL. It always returns zero
> not depending is there an error in uvc_ctrl_commit or not. It looks like a
> typo. Do we need "return ret;" after line 518 in uvc_v4l2.c ?

You're right. I committed a patch to the split branch which fixes 
VIDIOC_S_CTRL and some other ioctls. Thanks a lot.

> > Isochronous URBs are submitted in interrupt context, so we can't use
> > mutexes there.
>
> What about to move submitting to interrupt bottom half?

I'd like to avoid that if possible. I would like to keep the driver as 
hardware independent as possible, and using a bottom half interrupt handler 
to work around a vendor bug is a big change. We're not even sure yet that it 
would work.

Cheers,

Laurent Pinchart


From alex at alexpounds.com  Wed Nov 22 01:22:57 2006
From: alex at alexpounds.com (Alex Pounds)
Date: Wed, 22 Nov 2006 00:22:57 +0000
Subject: [Linux-uvc-devel] Problem with linux-uvc and IM clients
In-Reply-To: <op.tjdjs9z642iof8@misha>
References: <20061119203309.GA20093@localhost.localdomain>
	<op.tjdjs9z642iof8@misha>
Message-ID: <20061122002257.GA11961@localhost.localdomain>

On Tue, Nov 21, 2006 at 05:23:23PM +0100, Martin Rubli wrote:
> On Sun, 19 Nov 2006 21:33:10 +0100, Alex Pounds <alex at alexpounds.com>  
> wrote:
> >aMSN gives me "Error getting camera capabilities".
> 
> IIRC aMSN is known to not work right with the uvcvideo driver. 

Well, it seems to suggest it supports V4L2, so I thought it would work OK. 

 
> >Kopete gives me a variation on a green screen, a Q, and every so often
> >it'll actually work in the settings box but I've not yet got it to work
> >in an actual IM conversation.
> 
> I've never gotten around to test Kopete. What version are you using?

Kopete 0.12.3. I don't know if it uses Phonon. 


> >Ekiga says that it couldn't open the device.
> 
> Which version of Ekiga? We've had reports about Ekiga 2.0.2 not working
> with the split version. I'll look into that ...

I'm on 2.0.3. I basically run a Debian Etch machine. I'll give a more
exact error at some point but it's a really hectic week for me and the
driver is playing up. I wasn't getting the camera as a video device, so 
I reloaded the module by doing an rmmod uvcvideo followed by
modprobe uvcvideo, and that modprobe has hung. :( No output in dmesg about
it. 

-- 
Alex Pounds (Creature)                  .~.         http://www.alexpounds.com/
                                        /V\        http://www.ethicsgirls.com/
                                       // \\
"Variables won't; Constants aren't"   /(   )\
                                       ^`~'^


From pauljurczak at yahoo.com  Wed Nov 22 01:56:25 2006
From: pauljurczak at yahoo.com (Paul Jurczak)
Date: Tue, 21 Nov 2006 16:56:25 -0800 (PST)
Subject: [Linux-uvc-devel] Experimental patch for USB problem with
	Logitech webcams
Message-ID: <20061122005625.10685.qmail@web60513.mail.yahoo.com>

Hi Laurent,

  in general, there are control requests for the image sensor that can take a few 
frame periods to take effect, which is much longer than 500us. On the other
hand, USB interface controller should insulate the user from such problems
in most cases. Under Windows, DirectShow API goes through so many layers,
it may be physically impossible to send requests spaced less than several 
hundreds us. I have a sneaky suspicion that going down with delay time to
slightly above 100us would still work. Can some one test it?

Regards,
Paul.

........................

> After that, I think that camera hardware have not enough time to apply
> changes when we try  to change controls too quickly. Am I right? Can this
> be true?

Only the hardware/firmware developers could answer that. What really puzzles 
me is that the webcam works in Windows, and I've been told by Logitech that 
their driver contained no special workaround.

..........................






 
____________________________________________________________________________________
Sponsored Link

Mortgage rates near 39yr lows. $510k for $1,698/mo. 
Calculate new payment! www.LowerMyBills.com/lre


From ralph at mueller-welt.net  Wed Nov 22 02:58:55 2006
From: ralph at mueller-welt.net (Ralph =?iso-8859-1?q?M=FCller-Welt?=)
Date: Wed, 22 Nov 2006 02:58:55 +0100 (MET)
Subject: [Linux-uvc-devel] Split experiences
In-Reply-To: <200611212204.36921.laurent.pinchart@skynet.be>
References: <200611181331.46482.ralph@mueller-welt.net>
	<op.tjdkl1v342iof8@misha>
	<200611212204.36921.laurent.pinchart@skynet.be>
Message-ID: <200611220258.54123.ralph@mueller-welt.net>

Am Dienstag, 21. November 2006 22:04 schrieb Laurent Pinchart:
> > > It moved Pan / Tilt to its extreme positions, but while doing this a
> > > bad sound came out of my cam and Tilt didnt come up to its middle again
> > > while pan did.
> > > Shock!
> > Is it still stuck? I've attached below an entry of the FAQ I'm about to
> > prepare ...
OK, forgot to tell, switching back to trunk driver everything is working again 
as expected. So don't worry. :-)


> > There are different versions of the driver and different versions of
> > luvcview that don't always work together because at some point the
> > control IDs changed. Can you try to recompile the latest luvcview and
> > make sure that its control IDs are the same as in your driver?

> The latest luvcview tarball available on Michel Xhaard's website still
> doesn't support the new pan/tilt controls introduced in the split branch. I
> plan to submit the pan/tilt controls for inclusion in V4L2. The pan/tilt
> controls IDs will thus be modified once again. Sorry for the inconvenience,
> but keep in mind the driver is under development :-)

> In the meantime, I'm sure Michel would accept a patch to support the new
> pan/tilt controls.
OK, I allways had the cam working with the trunk driver and try using split 
from time to time. So was with rev 68.
As i'm no programmer, could u point me where to compare control IDs and / or 
what to do to luvcview-code?
I don't know how to create a patch - yet - but do know how to patch.

Next i get and compile a newer luvcview.

> > > I tried all things of unplugging cam, reloading module, etc. but Tilt
> > > control was dead, and so was the reset button.
> > Did the tilt control ever work? (Tilt during the reset process doesn't
> > count because that's controlled by the camera.)
As said before, it worked with trunk, some time i think it worked with split 
too (iirc) and works with trunk again. Don't worry here.

> Laurent Pinchart
Thank you for your answere and your work.
Ralph.

> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From schmid.thomas at gmx.ch  Wed Nov 22 14:05:23 2006
From: schmid.thomas at gmx.ch (Thomas Schmid)
Date: Wed, 22 Nov 2006 14:05:23 +0100
Subject: [Linux-uvc-devel] logitech pro 5000
Message-ID: <45644B13.1020601@gmx.ch>

hi list,

just a question, i've checked out the sources and builded them, but i've
still no success.

in my dmesg there's some lines like
Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
about version of symbol video_devdata

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
symbol video_devdata

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
about version of symbol video_unregister_device

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
symbol video_unregister_device

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
about version of symbol video_device_alloc

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
symbol video_device_alloc

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
about version of symbol video_register_device

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
symbol video_register_device

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
about version of symbol video_device_release

Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
symbol video_device_release

I also use a Hauppauge WinTVGo2 with the actuall dvb-tree sources, could
this be the problem?

Best Regards
Tom



From laurent.pinchart at skynet.be  Wed Nov 22 20:42:14 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 22 Nov 2006 20:42:14 +0100
Subject: [Linux-uvc-devel] Problem with linux-uvc and IM clients
In-Reply-To: <20061122002257.GA11961@localhost.localdomain>
References: <20061119203309.GA20093@localhost.localdomain>
	<op.tjdjs9z642iof8@misha>
	<20061122002257.GA11961@localhost.localdomain>
Message-ID: <200611222042.15701.laurent.pinchart@skynet.be>

On Wednesday 22 November 2006 01:22, Alex Pounds wrote:
> On Tue, Nov 21, 2006 at 05:23:23PM +0100, Martin Rubli wrote:
> > On Sun, 19 Nov 2006 21:33:10 +0100, Alex Pounds <alex at alexpounds.com>
> >
> > wrote:
> > >aMSN gives me "Error getting camera capabilities".
> >
> > IIRC aMSN is known to not work right with the uvcvideo driver.
>
> Well, it seems to suggest it supports V4L2, so I thought it would work OK.

aMSN developers probably tested the software using another V4L2 driver which 
didn't complain. I'm pretty sure the Linux UVC driver is not at fault here, 
it just doesn't implement some non-mandatory functions which don't make sense 
for webcams, or is stricter when checking parameters.

> > >Kopete gives me a variation on a green screen, a Q, and every so often
> > >it'll actually work in the settings box but I've not yet got it to work
> > >in an actual IM conversation.
> >
> > I've never gotten around to test Kopete. What version are you using?
>
> Kopete 0.12.3. I don't know if it uses Phonon.

Kopete doesn't use Phonon yet. It will in KDE4. Kopete's V4L2 support isn't 
stable yet, and I don't think the developers plan to do anything about it 
before KDE4.

> > >Ekiga says that it couldn't open the device.
> >
> > Which version of Ekiga? We've had reports about Ekiga 2.0.2 not working
> > with the split version. I'll look into that ...
>
> I'm on 2.0.3. I basically run a Debian Etch machine. I'll give a more
> exact error at some point but it's a really hectic week for me and the
> driver is playing up. I wasn't getting the camera as a video device, so
> I reloaded the module by doing an rmmod uvcvideo followed by
> modprobe uvcvideo, and that modprobe has hung. :( No output in dmesg about
> it.

modprobe hung with no message in dmesg ? That's weird. Try modprobe trace=15 
to make the driver more verbose.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Nov 22 21:47:11 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 22 Nov 2006 21:47:11 +0100
Subject: [Linux-uvc-devel] Split experiences
In-Reply-To: <200611220258.54123.ralph@mueller-welt.net>
References: <200611181331.46482.ralph@mueller-welt.net>
	<200611212204.36921.laurent.pinchart@skynet.be>
	<200611220258.54123.ralph@mueller-welt.net>
Message-ID: <200611222147.12042.laurent.pinchart@skynet.be>

Hi Ralph,

[...]
> > > There are different versions of the driver and different versions of
> > > luvcview that don't always work together because at some point the
> > > control IDs changed. Can you try to recompile the latest luvcview and
> > > make sure that its control IDs are the same as in your driver?
> >
> > The latest luvcview tarball available on Michel Xhaard's website still
> > doesn't support the new pan/tilt controls introduced in the split branch.
> > I plan to submit the pan/tilt controls for inclusion in V4L2. The
> > pan/tilt controls IDs will thus be modified once again. Sorry for the
> > inconvenience, but keep in mind the driver is under development :-)
> >
> > In the meantime, I'm sure Michel would accept a patch to support the new
> > pan/tilt controls.
>
> OK, I allways had the cam working with the trunk driver and try using split
> from time to time. So was with rev 68.
> As i'm no programmer, could u point me where to compare control IDs and /
> or what to do to luvcview-code?
> I don't know how to create a patch - yet - but do know how to patch.

Applications have several ways to interact with V4L2 devices. One of those is 
called the controls API. A control is usually any parameter that doesn't 
directly influence streaming: brightness, contrast, autofocus, zoom, pan, 
tilt, ... User-space applications can read (get) or write (set) the value of 
any control the device supports at any time.

The Logitech Quickcam Orbit MP has a single pan/tilt control. Writing a new 
value makes the webcam perform a pan motion (if the tilt value is zero), a 
tilt motion (if the pan value is zero) or a combined pan/tilt motion (if no 
value is zero).

The straightforward approach was to implement a pan control and a tilt 
control. Setting the pan control would pan the webcam, setting the tilt 
control would tilt it, but they was no way to pan and tilt the webcam in a 
single motion.

V4L2 only supported setting a single control at once, with the control value 
being a 32 bits integer. As there was no way to set two the pan and tilt 
controls in a single operation, I decided to hack around the limit and create 
a single pan/tilt control. The 32 bit value was split in two 16 bits numbers, 
controlling pan and tilt. The pan/tilt control was defined as

#define V4L2_CID_PANTILT_RELATIVE               (V4L2_CID_PRIVATE_BASE+7)

and the 32 bit value was assigned using the following union.

union pantilt {
        struct {
                short pan;
                short tilt;
        } s16;
        int value;
} pantilt;

Check the v4L2UpDownPan() and v4L2UpDownTilt() functions in luvcview (file 
v4l2uvc.c) to see how V4L2_CID_PANTILT_RELATIVE was used.

The control API has recently been enhanced by the extended control API (note: 
extended refers to the API, not the controls). This new API offers a way to 
set several controls at once, so the Linux UVC driver has been modified (in 
the split branch) to remove the V4L2_CID_PANTILT_RELATIVE control and 
introduce two new controls defined as

#define V4L2_CID_PAN_RELATIVE                   (V4L2_CID_PRIVATE_BASE+7)
#define V4L2_CID_TILT_RELATIVE                  (V4L2_CID_PRIVATE_BASE+8)

controlling pan and tilt respectively. The control values are signed number 
expressed in 1/64th degrees.

As luvcview controls pan and tilt separately, you don't have to use the new 
API. Using the old API with the two new controls should be fine. You might 
have to scale the angle passed to v4L2UpDownPan() and v4L2UpDownTilt(), as 
too small increments might not be processed properly by the webcam.

> Next i get and compile a newer luvcview.
>
> > > > I tried all things of unplugging cam, reloading module, etc. but Tilt
> > > > control was dead, and so was the reset button.
> > >
> > > Did the tilt control ever work? (Tilt during the reset process doesn't
> > > count because that's controlled by the camera.)
>
> As said before, it worked with trunk, some time i think it worked with
> split too (iirc) and works with trunk again. Don't worry here.

The split branch should work at least as good as the trunk. The only 
user-visible difference is the control IDs. I will merge the split branch 
into the trunk soon.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Nov 22 21:51:34 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 22 Nov 2006 21:51:34 +0100
Subject: [Linux-uvc-devel] logitech pro 5000
In-Reply-To: <45644B13.1020601@gmx.ch>
References: <45644B13.1020601@gmx.ch>
Message-ID: <200611222151.34615.laurent.pinchart@skynet.be>

Hi Thomas,

> just a question, i've checked out the sources and builded them, but i've
> still no success.
>
> in my dmesg there's some lines like
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
> about version of symbol video_devdata
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
> symbol video_devdata
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
> about version of symbol video_unregister_device
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
> symbol video_unregister_device
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
> about version of symbol video_device_alloc
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
> symbol video_device_alloc
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
> about version of symbol video_register_device
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
> symbol video_register_device
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: disagrees
> about version of symbol video_device_release
>
> Nov 22 13:56:22 atlantis kernel: [17180322.812000] uvcvideo: Unknown
> symbol video_device_release
>
> I also use a Hauppauge WinTVGo2 with the actuall dvb-tree sources, could
> this be the problem?

Ah yes it probably is. The messages in the kernel log seems to indicate that 
the module has been linked against a different kernel tree that the one your 
are running.

Cheers,

Laurent Pinchart


From pmarques at grupopie.com  Fri Nov 24 16:50:43 2006
From: pmarques at grupopie.com (Paulo Marques)
Date: Fri, 24 Nov 2006 15:50:43 +0000
Subject: [Linux-uvc-devel] Logitech Quickcam Ultra Vision: "No valid video
	chain found"
Message-ID: <456714D3.6030008@grupopie.com>


Hi all,

I bought a Quickcam UltraVision (VID/PID: 046d/08c9) to use with Linux.

I downloaded the driver using subversion and tested both the one in 
"trunk" and the one in "branches". They both gave the same error message:

"No valid video chain found."

I used a 2.6.17-mdv6 kernel (the one that comes with Mandriva 2007). I 
can test with a later kernel if you think that will make a difference.

Is this a known problem? Are there any patches I can try or is there 
some more information I can provide to try to find out what's going on?

-- 
Paulo Marques - www.grupopie.com

"The face of a child can say it all, especially the
mouth part of the face."


From laurent.pinchart at skynet.be  Sat Nov 25 18:09:26 2006
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 25 Nov 2006 18:09:26 +0100
Subject: [Linux-uvc-devel] Logitech Quickcam Ultra Vision: "No valid
	video chain found"
In-Reply-To: <456714D3.6030008@grupopie.com>
References: <456714D3.6030008@grupopie.com>
Message-ID: <200611251809.27268.laurent.pinchart@skynet.be>

Hi Paulo,

> I bought a Quickcam UltraVision (VID/PID: 046d/08c9) to use with Linux.
>
> I downloaded the driver using subversion and tested both the one in
> "trunk" and the one in "branches". They both gave the same error message:
>
> "No valid video chain found."
>
> I used a 2.6.17-mdv6 kernel (the one that comes with Mandriva 2007). I
> can test with a later kernel if you think that will make a difference.
>
> Is this a known problem? Are there any patches I can try or is there
> some more information I can provide to try to find out what's going on?

I have no Quickcam UltraVision, so I can't tell for sure where the problem 
comes from.

Could you try setting the parameters trace to 15 (either with 'modprobe 
uvcvideo trace=15' or 'echo -n 15 > /sys/modules/uvcvideo/parameters/trace' 
when the module is loaded) before plugging the webcam ? Then please send me 
all the messages output by the driver to the kernel log, as well as the 
device USB descriptors ('lsusb -d 046d: -v' with usbutils >= 0.72 or usbutils 
CVS).

Cheers,

Laurent Pinchart


From vidarno at gmail.com  Sun Nov 26 21:58:49 2006
From: vidarno at gmail.com (Vidar Normann)
Date: Sun, 26 Nov 2006 21:58:49 +0100
Subject: [Linux-uvc-devel] Anyone able to stream video from a uvc-device?
Message-ID: <2eed5f740611261258j52195576sf74cf4454c402d08@mail.gmail.com>

Hi again!

After some intense work it would seem that ffserver actually doesn't work.
At least I am unable to get it working according to the documentation.
Therefore, has anyone had any success with streaming software and
a uvc-device?

Regards,
Vidar Normann
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061126/9dbbb280/attachment.html>

From juha.leino at kapsi.fi  Mon Nov 27 08:50:18 2006
From: juha.leino at kapsi.fi (Juha Leino)
Date: Mon, 27 Nov 2006 09:50:18 +0200 (EET)
Subject: [Linux-uvc-devel] Problems with Logitech Fusion
Message-ID: <22555.192.100.116.143.1164613818.squirrel@mail.kapsi.fi>

Hello!

I have some problems with Logitech Fusion webcam. I'm using Ekiga for video
conferencing. After I updated my OS to ubuntu Edgy (2.6.17.1 kernel), the
webcam stopped working as reliable as it used to.

- The preview in Ekiga is ok. When I start a video call, the video
disappears.
First I thought that it would be an Ekiga problem but later I figured out
that apparently Ekiga is changing its video mode (colors, frame rate,
resolution) when the actual conference starts and the driver fails.

- Time to time Ekiga even complains that there are no compatible video
modes available with my webcam. This does not happen often though.

- I have an old copy of luvcview. That refuses to connect to my camera
completely. Perhaps I need to update it?

All this used to work very well with my last Ubuntu installation? I have
tried both trunk and split branches of the driver with not much difference
in behaviour.

Any ideas how to debug this further?

With best regards, Juha Leino



From federico at quagliata.org  Tue Nov 28 16:58:46 2006
From: federico at quagliata.org (Federico Quagliata)
Date: Tue, 28 Nov 2006 16:58:46 +0100
Subject: [Linux-uvc-devel] Integrated HP dv6000 laptop webcam
Message-ID: <ekhmbn$t2l$1@sea.gmane.org>

So far I managed to get it working only in Ekiga.

Kopete shows a green screen, and both xawtv and mplayer complain about ioctl
invalid arguments errors.

Here's mplayer (green screen too) output:

----------------------------------------
$ mplayer tv:// -tv driver=v4l2
MPlayer 1.0rc1-4.1.2 (C) 2000-2006 MPlayer Team
(...)
Playing tv://.
TV file format detected.
Selected driver: v4l2
 name: Video 4 Linux 2 input
 author: Martin Olschewski <olschewski at zpr.uni-koeln.de>
 comment: first try, more to come ;-)
v4l2: ioctl get standard failed: Invalid argument
Selected device: USB 2.0 Camera
 Capabilites:  video capture  streaming
 supported norms:
 inputs: 0 = Camera;
 Current input: 0
 Current format: YUYV
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl enum norm failed: Invalid argument
Error: Cannot set norm!
Selected input hasn't got a tuner!
v4l2: ioctl set mute failed: Invalid argument
FPS not specified in the header or invalid, use the -fps option.
No stream found.

v4l2: ioctl set mute failed: Invalid argument
v4l2: 0 frames successfully processed, 0 frames dropped.

Exiting... (End of file)
----------------------------------------

Output from dmesg:
----------------------------------------
uvcvideo: Found UVC 1.00 device USB 2.0 Camera (0c45:62c0)
usbcore: registered new driver uvcvideo
uvcvideo: Failed to query (1) UVC control 2 (unit 3) : -32.
uvcvideo: Failed to query (1) UVC control 6 (unit 3) : -32.
uvcvideo: Failed to query (1) UVC control 2 (unit 3) : -32.
uvcvideo: Failed to query (1) UVC control 6 (unit 3) : -32.
(and so on...)
----------------------------------------

Greetings,
Federico
-- 
On the web:  http://www.quaqo.org - OpenPGP KeyID: 0x1D535856
Jabber: quaqo at jabber.org - MSN: quaqo at msn.com - ICQ: 48618109
Linux User: #263663 / Machine: #341187 (Arch Linux / Gimmick)



From hexa00 at gmail.com  Wed Nov 29 23:18:27 2006
From: hexa00 at gmail.com (Antoine Tremblay)
Date: Wed, 29 Nov 2006 17:18:27 -0500
Subject: [Linux-uvc-devel] Logitech Orbit Mp Stability problems,
	is a recent camera stable ?
Message-ID: <6bd63b970611291418x145ec73bjcafffea0645c28bf@mail.gmail.com>

Hi all ,
  I've been playing around with the uvc driver with a Logitech Orbit MP
(08c2)

I'm using uvcvideo svn checkout from the 27 November 2006 and
luvcview-20060920 to test, on kernel 2.6.15

When I plug the camera I get :

[17204019.140000] uvcvideo: Found UVC 1.00 device <unnamed> (046d:08c2)
[17204020.156000] 13:3:1: cannot set freq 0 to ep 0x86
[17204021.156000] 13:3:2: cannot set freq 0 to ep 0x86
[17204022.168000] 13:3:3: cannot get freq at ep 0x86

But if I try with luvcview it works properly,,, the problem is that after
starting stopping the camera a few times (10-20 times,,,) I get :

[17204111.756000] uvcvideo: Failed to query (130) UVC control 1 (unit 0) :
-32.
[17204114.360000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
-32.
[17204115.508000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
-110.

messages like these :( , and the camera stops working

I've found
http://developer.berlios.de/bugs/?func=detailbug&bug_id=7605&group_id=5681

That seems to be similar,, it states hardware problems... but I'm not sure
it's the case here since if I remove the driver and reload it,, it will work
again..

Any ideas on this ?

All I really want is a recent camera that works and is quite sable .. any
suggestions ?

Thank  you

Antoine
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061129/e257b385/attachment.html>

From linux at rubli.info  Thu Nov 30 08:46:16 2006
From: linux at rubli.info (Martin Rubli)
Date: Thu, 30 Nov 2006 08:46:16 +0100
Subject: [Linux-uvc-devel] Logitech Orbit Mp Stability problems,
	is a recent camera stable ?
In-Reply-To: <6bd63b970611291418x145ec73bjcafffea0645c28bf@mail.gmail.com>
References: <6bd63b970611291418x145ec73bjcafffea0645c28bf@mail.gmail.com>
Message-ID: <op.tjtjvexy42iof8@maya>

> When I plug the camera I get :
>
> [17204020.156000] 13:3:1: cannot set freq 0 to ep 0x86
> [17204021.156000] 13:3:2: cannot set freq 0 to ep 0x86
> [17204022.168000] 13:3:3: cannot get freq at ep 0x86

These three lines come from the USB audio driver and have nothing to do  
with uvcvideo, so no need to worry.

> But if I try with luvcview it works properly,,, the problem is that after
> starting stopping the camera a few times (10-20 times,,,) I get :
>
> [17204111.756000] uvcvideo: Failed to query (130) UVC control 1 (unit 0)  
> : -32.
> [17204114.360000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :  
> -32.
> [17204115.508000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :  
> -110.
>
> messages like these :( , and the camera stops working
>
> I've found
> http://developer.berlios.de/bugs/?func=detailbug&bug_id=7605&group_id=5681
>
> That seems to be similar,, it states hardware problems... but I'm not  
> sure it's the case here since if I remove the driver and reload it,, it  
> will work again..

It's indeed a hardware problem. If you're browsing through the mailing  
list archive you'll find quite a few threads about that problem. We're  
still looking for a good workaround for the UVC driver.

Cheers,
Martin


From hexa00 at gmail.com  Thu Nov 30 15:58:16 2006
From: hexa00 at gmail.com (Antoine Tremblay)
Date: Thu, 30 Nov 2006 09:58:16 -0500
Subject: [Linux-uvc-devel] Logitech Orbit Mp Stability problems,
	is a recent camera stable ?
In-Reply-To: <op.tjtjvexy42iof8@maya>
References: <6bd63b970611291418x145ec73bjcafffea0645c28bf@mail.gmail.com>
	<op.tjtjvexy42iof8@maya>
Message-ID: <6bd63b970611300658p6e319c20xf435308641241d3a@mail.gmail.com>

I was browsing the v4l wiki at
http://www.linuxtv.org/v4lwiki/index.php/Webcams

And it's written :

"In the meantime, a patch is available to reset the webcam when a problem is
detected. " concerning the bug in the firmware of the logitech cams...

Does anyone have that patch ? is it a patch in the driver itself ? is it
transparent (does it have a big impact on the video shown... stop for x
seconds then restart .. or restart without the user noticing ) ? or is it
just to close the device an reopend it when ioctl fails ?

I would be very interested in any workaround possible..., if I can help in
any way...

Thanks

Antoine


On 11/30/06, Martin Rubli <linux at rubli.info> wrote:
>
> > When I plug the camera I get :
> >
> > [17204020.156000] 13:3:1: cannot set freq 0 to ep 0x86
> > [17204021.156000] 13:3:2: cannot set freq 0 to ep 0x86
> > [17204022.168000] 13:3:3: cannot get freq at ep 0x86
>
> These three lines come from the USB audio driver and have nothing to do
> with uvcvideo, so no need to worry.
>
> > But if I try with luvcview it works properly,,, the problem is that
> after
> > starting stopping the camera a few times (10-20 times,,,) I get :
> >
> > [17204111.756000] uvcvideo: Failed to query (130) UVC control 1 (unit 0)
> > : -32.
> > [17204114.360000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
> > -32.
> > [17204115.508000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
> > -110.
> >
> > messages like these :( , and the camera stops working
> >
> > I've found
> >
> http://developer.berlios.de/bugs/?func=detailbug&bug_id=7605&group_id=5681
> >
> > That seems to be similar,, it states hardware problems... but I'm not
> > sure it's the case here since if I remove the driver and reload it,, it
> > will work again..
>
> It's indeed a hardware problem. If you're browsing through the mailing
> list archive you'll find quite a few threads about that problem. We're
> still looking for a good workaround for the UVC driver.
>
> Cheers,
> Martin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20061130/13e02607/attachment.html>

From phobosk at kdemail.net  Thu Nov 30 20:25:29 2006
From: phobosk at kdemail.net (PhobosK)
Date: Thu, 30 Nov 2006 21:25:29 +0200
Subject: [Linux-uvc-devel] Logitech Orbit Mp Stability problems,
	is a recent camera stable ?
In-Reply-To: <op.tjtjvexy42iof8@maya>
References: <6bd63b970611291418x145ec73bjcafffea0645c28bf@mail.gmail.com>
	<op.tjtjvexy42iof8@maya>
Message-ID: <200611302125.29626.phobosk@kdemail.net>

Hi all,

> But if I try with luvcview it works properly,,, the problem is that after
> starting stopping the camera a few times (10-20 times,,,) I get :
>
> [17204111.756000] uvcvideo: Failed to query (130) UVC control 1 (unit 0)
>
> : -32.
>
> [17204114.360000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
> -32.
> [17204115.508000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
> -110.
>
> messages like these :( , and the camera stops working
>
> I've found
> http://developer.berlios.de/bugs/?func=detailbug&bug_id=7605&group_id=568
>1
>
> That seems to be similar,, it states hardware problems... but I'm not
> sure it's the case here since if I remove the driver and reload it,, it
> will work again..
I am not quite sure that it is a hardware problem too. I have the same 
problems with "Logitech QC Fusion", the difference is that once the camera 
driver blocks there is no way to use it except a reboot of the system. 
Sometimes even the whole system freezes after a block of the driver.


>
> It's indeed a hardware problem. If you're browsing through the mailing
> list archive you'll find quite a few threads about that problem. We're
> still looking for a good workaround for the UVC driver.
>
> Cheers,
> Martin
If there is anyway I can help for QC Fusion (debugging or anything) just tell 
me....

-- 
PhobosK - A KBFX Team Member



