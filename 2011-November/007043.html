<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Dual sensor, single controller, one USB Device
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2011-November/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Dual%20sensor%2C%20single%20controller%2C%20one%20USB%20Device&In-Reply-To=%3C1320433523.24915.57.camel%40Nadie%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007034.html">
   <LINK REL="Next"  HREF="006993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Dual sensor, single controller, one USB Device</H1>
    <B>cheshirekow</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Dual%20sensor%2C%20single%20controller%2C%20one%20USB%20Device&In-Reply-To=%3C1320433523.24915.57.camel%40Nadie%3E"
       TITLE="[Linux-uvc-devel] Dual sensor, single controller, one USB Device">cheshirekow at gmail.com
       </A><BR>
    <I>Fri Nov  4 20:05:23 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="007034.html">[Linux-uvc-devel] Dual sensor, single controller, one USB Device
</A></li>
        <LI>Next message: <A HREF="006993.html">[Linux-uvc-devel] Microsoft Lifecam Studio catch button
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7043">[ date ]</a>
              <a href="thread.html#7043">[ thread ]</a>
              <a href="subject.html#7043">[ subject ]</a>
              <a href="author.html#7043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2011-11-04 at 14:44 +0100, Laurent Pinchart wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On Friday 04 November 2011 13:46:36 cheshirekow wrote:
</I>&gt;<i> &gt; On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
</I>&gt;<i> &gt; &gt; On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
</I>&gt;<i> &gt; &gt; &gt; Am 28.10.2011 18:01, schrieb cheshirekow:
</I>&gt;<i> &gt; &gt; &gt; &gt; On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt; On 10/22/2011 03:16 AM, Alexey Fisher wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt;&gt; Can you please attach the output of this command:
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt;&gt; lsusb -vd 10f1:1a26&gt;  lsusb_dump
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt; Sure. The dump file is attached.
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt;&gt; Thanks!
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; Has anyone by chance managed to take a look at this lsusb dump?
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; To recap:
</I>&gt;<i> &gt; &gt; &gt; &gt; the HP Slate has two integrated we cams: One forward facing for video
</I>&gt;<i> &gt; &gt; &gt; &gt; calls, and one higher-resolution rear-facing for snapping photos.
</I>&gt;<i> &gt; &gt; &gt; &gt; There appears to be a single controller for both cameras. In linux,
</I>&gt;<i> &gt; &gt; &gt; &gt; lsusb only shows one webcam device. In windows, the device manager
</I>&gt;<i> &gt; &gt; &gt; &gt; also shows only one device for the webcam. However, in windows
</I>&gt;<i> &gt; &gt; &gt; &gt; applications that use the webcam (i.e. HP's webcam application, and
</I>&gt;<i> &gt; &gt; &gt; &gt; in skype) I'm able to select which one to use as an option. In
</I>&gt;<i> &gt; &gt; &gt; &gt; linux, there is only one video device, /dev/video0.
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; There does not appear to be any control available from uvcdynctrl or
</I>&gt;<i> &gt; &gt; &gt; &gt; within vlc to select which physical camera to use. I've tried setting
</I>&gt;<i> &gt; &gt; &gt; &gt; the resolution in vlc when I use the &quot;open capture device&quot; menu item.
</I>&gt;<i> &gt; &gt; &gt; &gt; I know that the forward facing camera is VGA so I tried specifying
</I>&gt;<i> &gt; &gt; &gt; &gt; 640x480, but the result is that it shows the rear-camera stream at a
</I>&gt;<i> &gt; &gt; &gt; &gt; low resolution, rather then showing the forward-camera stream.
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; I'd appreciate any suggestions on how to get the forward-facing
</I>&gt;<i> &gt; &gt; &gt; &gt; camera to work in linux (for skype/google video calls). Also, if it
</I>&gt;<i> &gt; &gt; &gt; &gt; is clear that this facility is not available in UVC and that there
</I>&gt;<i> &gt; &gt; &gt; &gt; is no way this is possilble, that would also be useful information.
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; Thanks again
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; suddenly i do not see any control to switch the sensor. I assume there
</I>&gt;<i> &gt; &gt; &gt; can be two variants how it may work:
</I>&gt;<i> &gt; &gt; &gt; 1. vendor specific extension unit for uvc
</I>&gt;<i> &gt; &gt; &gt; 2. or usb mode switcher
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; if both sensors have same capabilities, the 1. make sense. If not then
</I>&gt;<i> &gt; &gt; &gt; second. Because this usb dump report settings only for one sensor.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; For 1. it will be probably possible to control it with libwebcam. For
</I>&gt;<i> &gt; &gt; &gt; 2. it should be possible to control it with some kind of
</I>&gt;<i> &gt; &gt; &gt; usb_modeswitch (i'm not up to date).
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; To find what it is actually, there can be fallowing options:
</I>&gt;<i> &gt; &gt; &gt; 1. sniff usb traffic
</I>&gt;<i> &gt; &gt; &gt; 2. see if the windows driver has some advise for us
</I>&gt;<i> &gt; &gt; &gt; 3. unscrew your laptop and find what control use your webcam.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; My guess is that the camera uses either an extension unit (XU) control or
</I>&gt;<i> &gt; &gt; a vendor-specific request to select between the two sensors (which is
</I>&gt;<i> &gt; &gt; very unfortunate, given that the UVC specification has explicit support
</I>&gt;<i> &gt; &gt; for dual- sensor cameras, and I would have liked to test that code :-)).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks for the information. It is unfortunate that the camera doesn't
</I>&gt;<i> &gt; take advantage of what is already in the spec.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; Let's start with the XU control. I've attached a patch for the yavta test
</I>&gt;<i> &gt; &gt; application (<A HREF="http://git.ideasonboard.org/?p=yavta.git;a=summary">http://git.ideasonboard.org/?p=yavta.git;a=summary</A>) to this
</I>&gt;<i> &gt; &gt; e- mail. Could you please apply it, compile the application with
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Ok sure. I downloaded the test, applied the patch, and ran it with the
</I>&gt;<i> &gt; following output:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Device /dev/video0 opened.
</I>&gt;<i> &gt; Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
</I>&gt;<i> &gt; XU control 0: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; XU control 1: info GET SET (0x03) 64 bytes
</I>&gt;<i> &gt; XU control 2: info GET SET (0x03) 64 bytes
</I>&gt;<i> &gt; XU control 3: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; XU control 4: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; XU control 5: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; XU control 6: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; XU control 7: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; Video format: YUYV (56595559) 640x480 buffer size 614400
</I>&gt;<i> 
</I>&gt;<i> Those XU controls seem to be quite generic, and are found in other webcams 
</I>&gt;<i> that use the same chipset. They probably allow direct access to the sensor and 
</I>&gt;<i> bridge registers.
</I>&gt;<i> 
</I>&gt;<i> More information will be needed to find out how to select the sensor. I'm 
</I>&gt;<i> afraid USB sniffing in windows seems to be unavoidable. I will need a trace of 
</I>&gt;<i> all USB control requests (if your USB sniffer allows filtering out the 
</I>&gt;<i> isochronous transfers, please do so) sent to the device when you switch from 
</I>&gt;<i> one sensor to the other one.
</I>

Ok, so I've started trying to sniff some data from windows. I've done
this before but it was so long ago I think I forgot everything I knew
about USB hardware stuff. Anyway, I'm trying to use usbsnoopy
(sourceforge.net/projects/usbsnoop). I'm not sure this is working.

There are two devices listed which have a VID/PID that matches from
device manager. One is listed as &quot;HP Webcam&quot; and the other &quot;USB
Composite Device&quot;. I installed a sniffer on both, and &quot;restart&quot; the
device. Then approximately 5 seconds later I start the webcam
application. Around 3 seconds after that the application starts showing
images. I wait 10 seconds and then press the button to switch to the
other input. After a few more seconds I close the application, and then
stop the log in usbsnoopy. 

However, the last event that is recorded by usbsnoopy is at about 7,8
seconds, roughly corresponding to when the webcam started up. Nothing is
recorded after that. I've attached the log anyway, but I suspect it is
maybe not useful. It looks like it's not a plain text format. I'm not
sure if the format is any kind of standard thing. It looks like
usbsnoopy has an export option so I can send this in another format if
it'd be better. 

Lastly, just to do some experimentation. I tried opening the camera from
two separate applications in windows. If I open the HP Webcam
application it shows the image from the rear camera (I don't press the
button to switch input), and then I open skype's video settings and
select the VGA camera. When I do this the image in the other application
changes to that of the forward facing camera, and then freezes. Skype
never actually displays anything while doing this. Anyway, I'm not sure
that information is useful in anyway but there it is.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: HPWebcam.usblog
Type: application/octet-stream
Size: 140298 bytes
Desc: not available
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111104/aec9980f/attachment.obj">https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111104/aec9980f/attachment.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007034.html">[Linux-uvc-devel] Dual sensor, single controller, one USB Device
</A></li>
	<LI>Next message: <A HREF="006993.html">[Linux-uvc-devel] Microsoft Lifecam Studio catch button
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7043">[ date ]</a>
              <a href="thread.html#7043">[ thread ]</a>
              <a href="subject.html#7043">[ subject ]</a>
              <a href="author.html#7043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
