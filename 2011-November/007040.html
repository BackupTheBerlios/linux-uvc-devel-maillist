<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Dual sensor, single controller, one USB Device
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2011-November/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Dual%20sensor%2C%20single%20controller%2C%20one%20USB%20Device&In-Reply-To=%3C201111071729.42351.laurent.pinchart%40ideasonboard.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007039.html">
   <LINK REL="Next"  HREF="007041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Dual sensor, single controller, one USB Device</H1>
    <B>Laurent Pinchart</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Dual%20sensor%2C%20single%20controller%2C%20one%20USB%20Device&In-Reply-To=%3C201111071729.42351.laurent.pinchart%40ideasonboard.com%3E"
       TITLE="[Linux-uvc-devel] Dual sensor, single controller, one USB Device">laurent.pinchart at ideasonboard.com
       </A><BR>
    <I>Mon Nov  7 17:29:41 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="007039.html">[Linux-uvc-devel] Z-star Camera Problem
</A></li>
        <LI>Next message: <A HREF="007041.html">[Linux-uvc-devel] Frame rate for Logitech QuickCam Pro for Notebooks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7040">[ date ]</a>
              <a href="thread.html#7040">[ thread ]</a>
              <a href="subject.html#7040">[ subject ]</a>
              <a href="author.html#7040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Friday 04 November 2011 20:05:23 cheshirekow wrote:
&gt;<i> On Fri, 2011-11-04 at 14:44 +0100, Laurent Pinchart wrote:
</I>&gt;<i> &gt; On Friday 04 November 2011 13:46:36 cheshirekow wrote:
</I>&gt;<i> &gt; &gt; On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
</I>&gt;<i> &gt; &gt; &gt; On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Am 28.10.2011 18:01, schrieb cheshirekow:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt; On 10/22/2011 03:16 AM, Alexey Fisher wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt;&gt; Can you please attach the output of this command:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt;&gt; lsusb -vd 10f1:1a26&gt;  lsusb_dump
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt; Sure. The dump file is attached.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;&gt; Thanks!
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Has anyone by chance managed to take a look at this lsusb dump?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; To recap:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; the HP Slate has two integrated we cams: One forward facing for
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; video calls, and one higher-resolution rear-facing for snapping
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; photos. There appears to be a single controller for both
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; cameras. In linux, lsusb only shows one webcam device. In
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; windows, the device manager also shows only one device for the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; webcam. However, in windows applications that use the webcam
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; (i.e. HP's webcam application, and in skype) I'm able to select
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; which one to use as an option. In linux, there is only one video
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; device, /dev/video0.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; There does not appear to be any control available from uvcdynctrl
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; or within vlc to select which physical camera to use. I've tried
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; setting the resolution in vlc when I use the &quot;open capture
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; device&quot; menu item. I know that the forward facing camera is VGA
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; so I tried specifying 640x480, but the result is that it shows
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; the rear-camera stream at a low resolution, rather then showing
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; the forward-camera stream.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; I'd appreciate any suggestions on how to get the forward-facing
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; camera to work in linux (for skype/google video calls). Also, if
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; it is clear that this facility is not available in UVC and that
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; there is no way this is possilble, that would also be useful
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; information.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Thanks again
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; suddenly i do not see any control to switch the sensor. I assume
</I>&gt;<i> &gt; &gt; &gt; &gt; there can be two variants how it may work:
</I>&gt;<i> &gt; &gt; &gt; &gt; 1. vendor specific extension unit for uvc
</I>&gt;<i> &gt; &gt; &gt; &gt; 2. or usb mode switcher
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; if both sensors have same capabilities, the 1. make sense. If not
</I>&gt;<i> &gt; &gt; &gt; &gt; then second. Because this usb dump report settings only for one
</I>&gt;<i> &gt; &gt; &gt; &gt; sensor.
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; For 1. it will be probably possible to control it with libwebcam.
</I>&gt;<i> &gt; &gt; &gt; &gt; For 2. it should be possible to control it with some kind of
</I>&gt;<i> &gt; &gt; &gt; &gt; usb_modeswitch (i'm not up to date).
</I>&gt;<i> &gt; &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; &gt; To find what it is actually, there can be fallowing options:
</I>&gt;<i> &gt; &gt; &gt; &gt; 1. sniff usb traffic
</I>&gt;<i> &gt; &gt; &gt; &gt; 2. see if the windows driver has some advise for us
</I>&gt;<i> &gt; &gt; &gt; &gt; 3. unscrew your laptop and find what control use your webcam.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; My guess is that the camera uses either an extension unit (XU)
</I>&gt;<i> &gt; &gt; &gt; control or a vendor-specific request to select between the two
</I>&gt;<i> &gt; &gt; &gt; sensors (which is very unfortunate, given that the UVC specification
</I>&gt;<i> &gt; &gt; &gt; has explicit support for dual- sensor cameras, and I would have
</I>&gt;<i> &gt; &gt; &gt; liked to test that code :-)).
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Thanks for the information. It is unfortunate that the camera doesn't
</I>&gt;<i> &gt; &gt; take advantage of what is already in the spec.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Let's start with the XU control. I've attached a patch for the yavta
</I>&gt;<i> &gt; &gt; &gt; test application
</I>&gt;<i> &gt; &gt; &gt; (<A HREF="http://git.ideasonboard.org/?p=yavta.git;a=summary">http://git.ideasonboard.org/?p=yavta.git;a=summary</A>) to this e-
</I>&gt;<i> &gt; &gt; &gt; mail. Could you please apply it, compile the application with
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Ok sure. I downloaded the test, applied the patch, and ran it with the
</I>&gt;<i> &gt; &gt; following output:
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Device /dev/video0 opened.
</I>&gt;<i> &gt; &gt; Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
</I>&gt;<i> &gt; &gt; XU control 0: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; &gt; XU control 1: info GET SET (0x03) 64 bytes
</I>&gt;<i> &gt; &gt; XU control 2: info GET SET (0x03) 64 bytes
</I>&gt;<i> &gt; &gt; XU control 3: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; &gt; XU control 4: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; &gt; XU control 5: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; &gt; XU control 6: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; &gt; XU control 7: info GET SET (0x03) 2 bytes
</I>&gt;<i> &gt; &gt; Video format: YUYV (56595559) 640x480 buffer size 614400
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Those XU controls seem to be quite generic, and are found in other
</I>&gt;<i> &gt; webcams that use the same chipset. They probably allow direct access to
</I>&gt;<i> &gt; the sensor and bridge registers.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; More information will be needed to find out how to select the sensor. I'm
</I>&gt;<i> &gt; afraid USB sniffing in windows seems to be unavoidable. I will need a
</I>&gt;<i> &gt; trace of all USB control requests (if your USB sniffer allows filtering
</I>&gt;<i> &gt; out the isochronous transfers, please do so) sent to the device when you
</I>&gt;<i> &gt; switch from one sensor to the other one.
</I>&gt;<i> 
</I>&gt;<i> Ok, so I've started trying to sniff some data from windows. I've done
</I>&gt;<i> this before but it was so long ago I think I forgot everything I knew
</I>&gt;<i> about USB hardware stuff. Anyway, I'm trying to use usbsnoopy
</I>&gt;<i> (sourceforge.net/projects/usbsnoop). I'm not sure this is working.
</I>&gt;<i> 
</I>&gt;<i> There are two devices listed which have a VID/PID that matches from
</I>&gt;<i> device manager. One is listed as &quot;HP Webcam&quot; and the other &quot;USB
</I>&gt;<i> Composite Device&quot;. I installed a sniffer on both, and &quot;restart&quot; the
</I>&gt;<i> device. Then approximately 5 seconds later I start the webcam
</I>&gt;<i> application. Around 3 seconds after that the application starts showing
</I>&gt;<i> images. I wait 10 seconds and then press the button to switch to the
</I>&gt;<i> other input. After a few more seconds I close the application, and then
</I>&gt;<i> stop the log in usbsnoopy.
</I>&gt;<i> 
</I>&gt;<i> However, the last event that is recorded by usbsnoopy is at about 7,8
</I>&gt;<i> seconds, roughly corresponding to when the webcam started up. Nothing is
</I>&gt;<i> recorded after that. I've attached the log anyway, but I suspect it is
</I>&gt;<i> maybe not useful. It looks like it's not a plain text format. I'm not
</I>&gt;<i> sure if the format is any kind of standard thing. It looks like
</I>&gt;<i> usbsnoopy has an export option so I can send this in another format if
</I>&gt;<i> it'd be better.
</I>
I'd appreciate if you could try the export option, as the binary log is not 
very useful in Linux.

&gt;<i> Lastly, just to do some experimentation. I tried opening the camera from
</I>&gt;<i> two separate applications in windows. If I open the HP Webcam
</I>&gt;<i> application it shows the image from the rear camera (I don't press the
</I>&gt;<i> button to switch input), and then I open skype's video settings and
</I>&gt;<i> select the VGA camera. When I do this the image in the other application
</I>&gt;<i> changes to that of the forward facing camera, and then freezes. Skype
</I>&gt;<i> never actually displays anything while doing this. Anyway, I'm not sure
</I>&gt;<i> that information is useful in anyway but there it is.
</I>
-- 
Regards,

Laurent Pinchart

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007039.html">[Linux-uvc-devel] Z-star Camera Problem
</A></li>
	<LI>Next message: <A HREF="007041.html">[Linux-uvc-devel] Frame rate for Logitech QuickCam Pro for Notebooks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7040">[ date ]</a>
              <a href="thread.html#7040">[ thread ]</a>
              <a href="subject.html#7040">[ subject ]</a>
              <a href="author.html#7040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
