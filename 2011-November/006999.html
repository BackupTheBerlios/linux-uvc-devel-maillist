<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb	bandwidth issue under Windows
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2011-November/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20MS%20LifeCam%20Cinema%20and%20Studio%20have%20no%20usb%0A%09bandwidth%20issue%20under%20Windows&In-Reply-To=%3C201111021838.32724.laurent.pinchart%40ideasonboard.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006998.html">
   <LINK REL="Next"  HREF="007003.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb	bandwidth issue under Windows</H1>
    <B>Laurent Pinchart</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20MS%20LifeCam%20Cinema%20and%20Studio%20have%20no%20usb%0A%09bandwidth%20issue%20under%20Windows&In-Reply-To=%3C201111021838.32724.laurent.pinchart%40ideasonboard.com%3E"
       TITLE="[Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb	bandwidth issue under Windows">laurent.pinchart at ideasonboard.com
       </A><BR>
    <I>Wed Nov  2 18:38:32 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="006998.html">[Linux-uvc-devel] Accessing XU controls in an UVC webcam
</A></li>
        <LI>Next message: <A HREF="007003.html">[Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb bandwidth issue under Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6999">[ date ]</a>
              <a href="thread.html#6999">[ thread ]</a>
              <a href="subject.html#6999">[ subject ]</a>
              <a href="author.html#6999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sebastian,

On Friday 07 October 2011 14:00:03 Sebastian Arcus wrote:
&gt;<i> On 07/10/11 10:42, Alexey Fisher wrote:
</I>&gt;<i> &gt; Am 07.10.2011 10:59, schrieb Sebastian Arcus:
</I>&gt;<i> &gt;&gt; On 06/10/11 17:28, Alexey Fisher wrote:
</I>&gt;<i> &gt;&gt;&gt; On 06.10.2011 18:16, Sebastian Arcus wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt; On 06/10/11 15:59, Alexey Fisher wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; On 06.10.2011 14:32, Sebastian Arcus wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; Hello list,
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; The above two cameras, which have the well known usb bandwidth bug
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; under Linux don't seem to display the same problems under Windows.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; I've tried them under Windows Vista and Windows 7 32bit. I've managed
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; to display a LifeCam Studio and LifeCam Cinema at the same time
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; through separate instances of VLC all the way to 1920x1080 for
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; LifeCam Studio and 1280x720 for the LifeCam Cinema - which I believe
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; are the maximum video resolutions for both cameras. I've forced VLC
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; on 25fps - and the Cinema seems to do that. However, looking at the
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; footage from the Studio at maximum resolution - it looks more like
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; 5fps.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; However, what all the above means is that these cameras don't seem to
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; suffer from the usb bandwidth bug under Windows. I've input &quot;mjpg&quot;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; under chroma settings for VLC - but I can't find a way to tell for
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; sure if VLC is using the mjpeg stream from the camera, or raw.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; Can someone here help me push this further? Is there any way of
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; debugging what is happening under Windows - so that maybe the Linux
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; uvc&gt; driver can be modified to get these cameras to work properly?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Probably usb sniffing will be most correct option, but currently i'll
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; would not interpret usb dump.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Other option is visual test:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; - Jpeg stream has lower quality, try it under linux and you will see
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; the difference.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; - according to frame rate the webcam controller will change
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; demosaicing algorithm. Simple alorithm produce pure qualithy, and
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; image looks like up scaled image from smaller image. Logitech webcams
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; use better algorithm before 15 fps and pure after 15 fps.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; - you can check frame rate by capturing some timer with milliseconds:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; <A HREF="http://tools.arantius.com/stopwatch">http://tools.arantius.com/stopwatch</A>
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; Thank you Alexey. Looking at the quality of the footage - I would
</I>&gt;<i> &gt;&gt;&gt;&gt; guess it is not mjpeg. However, it still means that the camera is not
</I>&gt;<i> &gt;&gt;&gt;&gt; grabbing all the available usb bandwidth like it does under Linux -
</I>&gt;<i> &gt;&gt;&gt;&gt; which is good news.
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; Then try bandwidth quirk:
</I>&gt;<i> &gt;&gt;&gt; sudo rmmod&amp;&amp; sudo modprobe uvcvideo quirks=0x80
</I>&gt;<i> &gt;&gt;&gt; But reduce frame rate, 1280x720 at 30 fps will take complete bindwidth,
</I>&gt;<i> &gt;&gt;&gt; try 10fps if you wont to use two webcams.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Anybody knows if I can use VLC or some other software under windows to
</I>&gt;<i> &gt;&gt; view the mjpeg stream? I could then test how many cameras I can use at
</I>&gt;<i> &gt;&gt; the same time under Windows with mjpeg. This should tell us if the
</I>&gt;<i> &gt;&gt; Windows driver doesn't have any of the usb bandwidth problems which
</I>&gt;<i> &gt;&gt; exist under Linux for these cameras.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It is not a driver problem,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; the webcam tell how match it need, the driver will give it. If cam tell
</I>&gt;<i> &gt; it need every thing we have, the driver will give it. It is defined
</I>&gt;<i> &gt; behavior of UVC, if device is broken, there is nothing driver can do. I
</I>&gt;<i> &gt; will not wonder if Microsoft will have quirks for devices it produce.
</I>&gt;<i> &gt; For some time i send here some jpeg patches, you can test it on your own
</I>&gt;<i> &gt; risk and force the bandwidth. But this patches will probably never go to
</I>&gt;<i> &gt; upstream.
</I>&gt;<i> 
</I>&gt;<i> Thanks Alexey. What I was suggesting is that, under Windows, the camera
</I>&gt;<i> doesn't seem to suffer from this bug - as it is possible to run two of
</I>&gt;<i> them at the same time. I don't know how this is accomplished, I don't
</I>&gt;<i> know if the Windows driver makes use of special signalling to stop the
</I>&gt;<i> camera from asking for all the available usb bandwidth. I was only
</I>&gt;<i> thinking that if it would be possible to find out how the camera is
</I>&gt;<i> &quot;convinced&quot; to not asked for full bandwidth under Windows - maybe that
</I>&gt;<i> can be replicated in the uvc driver under Linux.
</I>
I don't think Windows tells the camera to use less bandwidth. I obviously 
can't tell for sure what the Windows driver does, but I expected it to either

- use heuristics to compute the amount of bandwidth a webcam really requires
- have device-specific quirks (quite unlikely though, unless the webcam comes 
with its specific driver)
- allow allocation of more than 80% of the USB bandwidth to periodic USB 
transfers

If I'm not mistaken Linux recently got support for the third option, maybe 
this could help you. Details can be found on the linux-usb mailing list AFAIR.

Another option would be to snoop USB transfers in Windows to find out how much 
bandwidth the webcam requests and how much bandwidth Windows allocates.

&gt;<i> However, I know almost nothing about the intricacies of the uvc standard and
</I>&gt;<i> the corresponding Linux (or Windows) implementation - that is why I was
</I>&gt;<i> asking if there is anyway to probe the uvc driver in Windows and find out
</I>&gt;<i> more that way.
</I>
-- 
Regards,

Laurent Pinchart

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006998.html">[Linux-uvc-devel] Accessing XU controls in an UVC webcam
</A></li>
	<LI>Next message: <A HREF="007003.html">[Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb bandwidth issue under Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6999">[ date ]</a>
              <a href="thread.html#6999">[ thread ]</a>
              <a href="subject.html#6999">[ subject ]</a>
              <a href="author.html#6999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
