<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Dual sensor, single controller, one USB Device
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2011-November/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Dual%20sensor%2C%20single%20controller%2C%20one%20USB%20Device&In-Reply-To=%3C201111041444.42202.laurent.pinchart%40ideasonboard.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007033.html">
   <LINK REL="Next"  HREF="007043.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Dual sensor, single controller, one USB Device</H1>
    <B>Laurent Pinchart</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Dual%20sensor%2C%20single%20controller%2C%20one%20USB%20Device&In-Reply-To=%3C201111041444.42202.laurent.pinchart%40ideasonboard.com%3E"
       TITLE="[Linux-uvc-devel] Dual sensor, single controller, one USB Device">laurent.pinchart at ideasonboard.com
       </A><BR>
    <I>Fri Nov  4 14:44:41 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="007033.html">[Linux-uvc-devel] Dual sensor, single controller, one USB Device
</A></li>
        <LI>Next message: <A HREF="007043.html">[Linux-uvc-devel] Dual sensor, single controller, one USB Device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7034">[ date ]</a>
              <a href="thread.html#7034">[ thread ]</a>
              <a href="subject.html#7034">[ subject ]</a>
              <a href="author.html#7034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Friday 04 November 2011 13:46:36 cheshirekow wrote:
&gt;<i> On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
</I>&gt;<i> &gt; On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
</I>&gt;<i> &gt; &gt; Am 28.10.2011 18:01, schrieb cheshirekow:
</I>&gt;<i> &gt; &gt; &gt; On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
</I>&gt;<i> &gt; &gt; &gt;&gt; On 10/22/2011 03:16 AM, Alexey Fisher wrote:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; Can you please attach the output of this command:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; lsusb -vd 10f1:1a26&gt;  lsusb_dump
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; Sure. The dump file is attached.
</I>&gt;<i> &gt; &gt; &gt;&gt; 
</I>&gt;<i> &gt; &gt; &gt;&gt; Thanks!
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Has anyone by chance managed to take a look at this lsusb dump?
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; To recap:
</I>&gt;<i> &gt; &gt; &gt; the HP Slate has two integrated we cams: One forward facing for video
</I>&gt;<i> &gt; &gt; &gt; calls, and one higher-resolution rear-facing for snapping photos.
</I>&gt;<i> &gt; &gt; &gt; There appears to be a single controller for both cameras. In linux,
</I>&gt;<i> &gt; &gt; &gt; lsusb only shows one webcam device. In windows, the device manager
</I>&gt;<i> &gt; &gt; &gt; also shows only one device for the webcam. However, in windows
</I>&gt;<i> &gt; &gt; &gt; applications that use the webcam (i.e. HP's webcam application, and
</I>&gt;<i> &gt; &gt; &gt; in skype) I'm able to select which one to use as an option. In
</I>&gt;<i> &gt; &gt; &gt; linux, there is only one video device, /dev/video0.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; There does not appear to be any control available from uvcdynctrl or
</I>&gt;<i> &gt; &gt; &gt; within vlc to select which physical camera to use. I've tried setting
</I>&gt;<i> &gt; &gt; &gt; the resolution in vlc when I use the &quot;open capture device&quot; menu item.
</I>&gt;<i> &gt; &gt; &gt; I know that the forward facing camera is VGA so I tried specifying
</I>&gt;<i> &gt; &gt; &gt; 640x480, but the result is that it shows the rear-camera stream at a
</I>&gt;<i> &gt; &gt; &gt; low resolution, rather then showing the forward-camera stream.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; I'd appreciate any suggestions on how to get the forward-facing
</I>&gt;<i> &gt; &gt; &gt; camera to work in linux (for skype/google video calls). Also, if it
</I>&gt;<i> &gt; &gt; &gt; is clear that this facility is not available in UVC and that there
</I>&gt;<i> &gt; &gt; &gt; is no way this is possilble, that would also be useful information.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Thanks again
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; suddenly i do not see any control to switch the sensor. I assume there
</I>&gt;<i> &gt; &gt; can be two variants how it may work:
</I>&gt;<i> &gt; &gt; 1. vendor specific extension unit for uvc
</I>&gt;<i> &gt; &gt; 2. or usb mode switcher
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; if both sensors have same capabilities, the 1. make sense. If not then
</I>&gt;<i> &gt; &gt; second. Because this usb dump report settings only for one sensor.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; For 1. it will be probably possible to control it with libwebcam. For
</I>&gt;<i> &gt; &gt; 2. it should be possible to control it with some kind of
</I>&gt;<i> &gt; &gt; usb_modeswitch (i'm not up to date).
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; To find what it is actually, there can be fallowing options:
</I>&gt;<i> &gt; &gt; 1. sniff usb traffic
</I>&gt;<i> &gt; &gt; 2. see if the windows driver has some advise for us
</I>&gt;<i> &gt; &gt; 3. unscrew your laptop and find what control use your webcam.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; My guess is that the camera uses either an extension unit (XU) control or
</I>&gt;<i> &gt; a vendor-specific request to select between the two sensors (which is
</I>&gt;<i> &gt; very unfortunate, given that the UVC specification has explicit support
</I>&gt;<i> &gt; for dual- sensor cameras, and I would have liked to test that code :-)).
</I>&gt;<i> 
</I>&gt;<i> Thanks for the information. It is unfortunate that the camera doesn't
</I>&gt;<i> take advantage of what is already in the spec.
</I>&gt;<i> 
</I>&gt;<i> &gt; Let's start with the XU control. I've attached a patch for the yavta test
</I>&gt;<i> &gt; application (<A HREF="http://git.ideasonboard.org/?p=yavta.git;a=summary">http://git.ideasonboard.org/?p=yavta.git;a=summary</A>) to this
</I>&gt;<i> &gt; e- mail. Could you please apply it, compile the application with
</I>&gt;<i> 
</I>&gt;<i> Ok sure. I downloaded the test, applied the patch, and ran it with the
</I>&gt;<i> following output:
</I>&gt;<i> 
</I>&gt;<i> Device /dev/video0 opened.
</I>&gt;<i> Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
</I>&gt;<i> XU control 0: info GET SET (0x03) 2 bytes
</I>&gt;<i> XU control 1: info GET SET (0x03) 64 bytes
</I>&gt;<i> XU control 2: info GET SET (0x03) 64 bytes
</I>&gt;<i> XU control 3: info GET SET (0x03) 2 bytes
</I>&gt;<i> XU control 4: info GET SET (0x03) 2 bytes
</I>&gt;<i> XU control 5: info GET SET (0x03) 2 bytes
</I>&gt;<i> XU control 6: info GET SET (0x03) 2 bytes
</I>&gt;<i> XU control 7: info GET SET (0x03) 2 bytes
</I>&gt;<i> Video format: YUYV (56595559) 640x480 buffer size 614400
</I>
Those XU controls seem to be quite generic, and are found in other webcams 
that use the same chipset. They probably allow direct access to the sensor and 
bridge registers.

More information will be needed to find out how to select the sensor. I'm 
afraid USB sniffing in windows seems to be unavoidable. I will need a trace of 
all USB control requests (if your USB sniffer allows filtering out the 
isochronous transfers, please do so) sent to the device when you switch from 
one sensor to the other one.

-- 
Regards,

Laurent Pinchart

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007033.html">[Linux-uvc-devel] Dual sensor, single controller, one USB Device
</A></li>
	<LI>Next message: <A HREF="007043.html">[Linux-uvc-devel] Dual sensor, single controller, one USB Device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7034">[ date ]</a>
              <a href="thread.html#7034">[ thread ]</a>
              <a href="subject.html#7034">[ subject ]</a>
              <a href="author.html#7034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
