<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Strange issue with V4L, Gumstix,	and VIDIOC_REQBUFS/VIDIOC_QUERYBUF
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Strange%20issue%20with%20V4L%2C%20Gumstix%2C%0A%09and%20VIDIOC_REQBUFS/VIDIOC_QUERYBUF&In-Reply-To=%3C49A83B16.8080506%40atl.lmco.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004596.html">
   <LINK REL="Next"  HREF="004584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Strange issue with V4L, Gumstix,	and VIDIOC_REQBUFS/VIDIOC_QUERYBUF</H1>
    <B>Tom Moore</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Strange%20issue%20with%20V4L%2C%20Gumstix%2C%0A%09and%20VIDIOC_REQBUFS/VIDIOC_QUERYBUF&In-Reply-To=%3C49A83B16.8080506%40atl.lmco.com%3E"
       TITLE="[Linux-uvc-devel] Strange issue with V4L, Gumstix,	and VIDIOC_REQBUFS/VIDIOC_QUERYBUF">thomas.a.moore at lmco.com
       </A><BR>
    <I>Fri Feb 27 20:12:22 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004596.html">[Linux-uvc-devel] Strange issue with V4L, Gumstix,	and VIDIOC_REQBUFS/VIDIOC_QUERYBUF
</A></li>
        <LI>Next message: <A HREF="004584.html">[Linux-uvc-devel] [UVC] [Still-image] Has Creative Live! Cam Optia	AF capture still-image feature?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4607">[ date ]</a>
              <a href="thread.html#4607">[ thread ]</a>
              <a href="subject.html#4607">[ subject ]</a>
              <a href="author.html#4607">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello again,

I re-compiled the driver with tracing enabled on pretty much everything, 
and below is the output I received from plugging in the camera and 
running my control program (the output from the uvccapture program is 
very similar). Why is the camera using the MJPEG format? On my desktop 
machine (Ubunto 8.10, kernel 2.6.27), I specify that I want the image 
format to be YUYV and it works fine. I'm even able to output .ppm files 
to disk. Does the camera support more than one format? Also, when I run 
uvccapture, the output file is about 8 KB for a 320x240 image, and it 
will not open in any standard image viewer.

Thanks,
Tom

==============================================================================
&lt;6&gt;Linux video capture interface: v2.00
&lt;7&gt;uvcvideo: Adding mapping Brightness to control 
00000000-0000-0000-0000-000000000101/2.
&lt;7&gt;uvcvideo: Adding mapping Contrast to control 
00000000-0000-0000-0000-000000000101/3.
&lt;7&gt;uvcvideo: Adding mapping Hue to control 
00000000-0000-0000-0000-000000000101/6.
&lt;7&gt;uvcvideo: Adding mapping Saturation to control 
00000000-0000-0000-0000-000000000101/7.
&lt;7&gt;uvcvideo: Adding mapping Sharpness to control 
00000000-0000-0000-0000-000000000101/8.
&lt;7&gt;uvcvideo: Adding mapping Gamma to control 
00000000-0000-0000-0000-000000000101/9.
&lt;7&gt;uvcvideo: Adding mapping Backlight Compensation to control 
00000000-0000-0000-0000-000000000101/1.
&lt;7&gt;uvcvideo: Adding mapping Gain to control 
00000000-0000-0000-0000-000000000101/4.
&lt;7&gt;uvcvideo: Adding mapping Power Line Frequency to control 
00000000-0000-0000-0000-000000000101/5.
&lt;7&gt;uvcvideo: Adding mapping Hue, Auto to control 
00000000-0000-0000-0000-000000000101/16.
&lt;7&gt;uvcvideo: Adding mapping Exposure, Auto to control 
00000000-0000-0000-0000-000000000001/2.
&lt;7&gt;uvcvideo: Adding mapping Exposure, Auto Priority to control 
00000000-0000-0000-0000-000000000001/3.
&lt;7&gt;uvcvideo: Adding mapping Exposure (Absolute) to control 
00000000-0000-0000-0000-000000000001/4.
&lt;7&gt;uvcvideo: Adding mapping White Balance Temperature, Auto to control 
00000000-0000-0000-0000-000000000101/11.
&lt;7&gt;uvcvideo: Adding mapping White Balance Temperature to control 
00000000-0000-0000-0000-000000000101/10.
&lt;7&gt;uvcvideo: Adding mapping White Balance Component, Auto to control 
00000000-0000-0000-0000-000000000101/13.
&lt;7&gt;uvcvideo: Adding mapping White Balance Blue Component to control 
00000000-0000-0000-0000-000000000101/12.
&lt;7&gt;uvcvideo: Adding mapping White Balance Red Component to control 
00000000-0000-0000-0000-000000000101/12.
&lt;7&gt;uvcvideo: Adding mapping Focus (absolute) to control 
00000000-0000-0000-0000-000000000001/6.
&lt;7&gt;uvcvideo: Adding mapping Focus, Auto to control 
00000000-0000-0000-0000-000000000001/8.
&lt;7&gt;uvcvideo: Adding mapping Zoom, Absolute to control 
00000000-0000-0000-0000-000000000001/11.
&lt;7&gt;uvcvideo: Adding mapping Zoom, Continuous to control 
00000000-0000-0000-0000-000000000001/12.
&lt;7&gt;uvcvideo: Adding mapping Privacy to control 
00000000-0000-0000-0000-000000000001/17.
&lt;7&gt;uvcvideo: Probing generic UVC device 2
&lt;7&gt;uvcvideo: Found format MJPEG.
&lt;7&gt;uvcvideo: - 640x480 (15.0 fps)
&lt;7&gt;uvcvideo: - 352x288 (30.0 fps)
&lt;7&gt;uvcvideo: - 320x240 (30.0 fps)
&lt;7&gt;uvcvideo: - 176x144 (30.0 fps)
&lt;7&gt;uvcvideo: - 160x120 (30.0 fps)
&lt;7&gt;uvcvideo: Found a Status endpoint (addr 83).
&lt;6&gt;uvcvideo: Found UVC 1.00 device Dynex 1.3MP Webcam (19ff:0102)
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/4 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to 
device 2 entity 3
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000001/2 to 
device 2 entity 1
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000001/3 to 
device 2 entity 1
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000001/4 to 
device 2 entity 1
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000001/11 to 
device 2 entity 1
&lt;7&gt;uvcvideo: Added control 00000000-0000-0000-0000-000000000001/13 to 
device 2 entity 1
&lt;7&gt;uvcvideo: Scanning UVC chain: OT 2&lt;4&gt;videodev: &quot;&quot; has no release 
callback. Please fix your driver for proper sysfs support, see 
<A HREF="http://lwn.net/Articles/36850/">http://lwn.net/Articles/36850/</A>
&lt;6&gt;input: Dynex 1.3MP Webcam as /class/input/input0
&lt;7&gt;uvcvideo: UVC device initialized.
&lt;6&gt;usbcore: registered new interface driver uvcvideo
&lt;6&gt;USB Video Class driver (v0.1.0)
&lt;4&gt;3:3:1: cannot get freq at ep 0x84



&lt;7&gt;uvcvideo: uvc_v4l2_open
&lt;7&gt;uvcvideo: Unknown ioctl 0x800e7606
&lt;7&gt;uvcvideo: Unknown ioctl 0x400e7607
&lt;7&gt;uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
&lt;7&gt;uvcvideo: Using default frame interval 33333.3 us (30.0 fps).
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: Queuing buffer 1.
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Frame complete (EOF found).
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dequeuing buffer 1 (3, 17584 bytes).
&lt;7&gt;uvcvideo: Queuing buffer 2.
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Frame complete (EOF found).
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dequeuing buffer 2 (3, 17640 bytes).
&lt;7&gt;uvcvideo: Queuing buffer 3.
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Frame complete (EOF found).
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dequeuing buffer 3 (3, 17696 bytes).
&lt;7&gt;uvcvideo: uvc_v4l2_release
&lt;7&gt;uvcvideo: uvc_v4l2_open
&lt;7&gt;uvcvideo: Unknown ioctl 0x800e7606
&lt;7&gt;uvcvideo: Unknown ioctl 0x400e7607
&lt;7&gt;uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
&lt;7&gt;uvcvideo: Using default frame interval 33333.3 us (30.0 fps).
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: uvc_v4l2_mmap
&lt;7&gt;uvcvideo: Queuing buffer 1.
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Frame complete (EOF found).
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dequeuing buffer 1 (3, 16352 bytes).
&lt;7&gt;uvcvideo: Queuing buffer 2.
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Frame complete (EOF found).
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dequeuing buffer 2 (3, 10096 bytes).
&lt;7&gt;uvcvideo: Queuing buffer 3.
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Dropping payload (out of sync).
&lt;7&gt;uvcvideo: Frame complete (EOF found).
&lt;7&gt;uvcvideo: uvc_v4l2_poll
&lt;7&gt;uvcvideo: Dequeuing buffer 3 (3, 9720 bytes).
&lt;7&gt;uvcvideo: uvc_v4l2_release

==============================================================================



Laurent Pinchart wrote:
&gt;<i> Hi Tom,
</I>&gt;<i> 
</I>&gt;<i> On Tuesday 24 February 2009 12:51:47 Tom Moore wrote:
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wrote some capture code and tested it out on Ubuntu 8.10 (kernel
</I>&gt;&gt;<i> 2.6.27.11). My Dynex 1.3 MP camera supports memory mapping and works
</I>&gt;&gt;<i> just fine on my Ubuntu box. However, I have cross-compiled the UVC
</I>&gt;&gt;<i> driver for my Gumstix (the target platform for capture - kernel is
</I>&gt;&gt;<i> 2.6.21) and though I was able to successfully install the driver, my
</I>&gt;&gt;<i> capture code doesn't seem to work. I've traced the problem to to ioctl
</I>&gt;&gt;<i> call with VIDIOC_QUERYBUF. On my box, that function call returns a
</I>&gt;&gt;<i> buffer length of width * height * 2 (format is YUYV, so this is right).
</I>&gt;&gt;<i> On my Gumstix, it returns width * height + 589 (the 589 is the same
</I>&gt;&gt;<i> regardless of the frame size).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is there any reason why this would be happening? I appear to be
</I>&gt;&gt;<i> unfamilar with the behavior of VIDIOC_QUERYBUF, but it looks like it
</I>&gt;&gt;<i> ought to be pretty straightforward.
</I>&gt;<i> 
</I>&gt;<i> None that I can think of (at least at this time of the night). Would you mind 
</I>&gt;<i> adding a few printk's to the driver code to hunt the bug down ?
</I>&gt;<i> 
</I>&gt;&gt;<i> Oh, I should point out that calls to VIDIOCSPICT and VIDIOCGPICT on my
</I>&gt;&gt;<i> Ubuntu box works just fine, but returns -1 for the Gumstix.
</I>&gt;<i> 
</I>&gt;<i> The uvcvideo driver relies on the videodev compatibility layer to handle V4L1 
</I>&gt;<i> ioctls. The Gumstix kernel might come with those disabled.
</I>&gt;<i> 
</I>&gt;&gt;<i> This camera requires that I use some bizarre combinations of V4L1 and V4L2
</I>&gt;&gt;<i> code to access all of its functionality. I'm not sure what versions of the
</I>&gt;&gt;<i> various V4L modules and camera drivers are.
</I>&gt;<i> 
</I>&gt;<i> That's definitely not normal. The uvcvideo driver implement V4L2 only. The 
</I>&gt;<i> V4L1 ioctls are translated to V4L2 ioctls by the videodev compatibility layer, 
</I>&gt;<i> there's no added functionality for the V4L1 API.
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> 
</I>&gt;<i> Laurent Pinchart
</I>
-- 

Tom Moore
Member, Engineering Staff
Lockheed Martin Advanced Technology Laboratories
3 Executive Campus, Suite 600
Cherry Hill, NJ 08002
Phone: 856-792-9750
E-mail: <A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">tmoore at atl.lmco.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004596.html">[Linux-uvc-devel] Strange issue with V4L, Gumstix,	and VIDIOC_REQBUFS/VIDIOC_QUERYBUF
</A></li>
	<LI>Next message: <A HREF="004584.html">[Linux-uvc-devel] [UVC] [Still-image] Has Creative Live! Cam Optia	AF capture still-image feature?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4607">[ date ]</a>
              <a href="thread.html#4607">[ thread ]</a>
              <a href="subject.html#4607">[ subject ]</a>
              <a href="author.html#4607">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
