From hartmut.geissbauer at gbhardy.ch  Sun Apr  1 15:19:09 2007
From: hartmut.geissbauer at gbhardy.ch (Hartmut Geissbauer)
Date: Sun, 01 Apr 2007 15:19:09 +0200
Subject: [Linux-uvc-devel] Reporting Panasonic NV-GS27EG to work
Message-ID: <1175433549.3022.11.camel@chief.local>

Hi all,

I just want to report my Panasonic Camcorder NV-GS27EG to work with the
uvcvideo driver.

It shows up with "DVC  (04da:231d)"

I tested it with luvcview (20070107).

Thank you for your great work.


Hartmut




From Serge.A.S at tochka.ru  Sun Apr  1 16:06:12 2007
From: Serge.A.S at tochka.ru (Serge A. Suchkov)
Date: Sun, 1 Apr 2007 18:06:12 +0400
Subject: [Linux-uvc-devel] Reporting Panasonic NV-GS27EG to work
In-Reply-To: <1175433549.3022.11.camel@chief.local>
References: <1175433549.3022.11.camel@chief.local>
Message-ID: <200704011806.12254.Serge.A.S@tochka.ru>

> Hi all,
> 
> I just want to report my Panasonic Camcorder NV-GS27EG to work with the
> uvcvideo driver.
> 
> It shows up with "DVC  (04da:231d)"
> 
> I tested it with luvcview (20070107).
> 
> Thank you for your great work.
> 
> 
> Hartmut
> 
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 

Hmm...confirm, my old Panasonic Camcorder NV-GS11 (04da:2318)
works too...pleasant surprise.... ;)

But it have some problem with controls... (see dmesg output)

usb 1-2.2: new full speed USB device using ohci_hcd and address 6
usb 1-2.2: configuration #1 chosen from 1 choice
uvcvideo: Found UVC 1.00 device Web-Camera (04da:2318)
uvcvideo: Failed to query (1) UVC control 2 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 2 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 2 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 2 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 2 (unit 0) : -32 (exp. 26).
BUG: unable to handle kernel NULL pointer dereference at virtual address 00000070
 printing eip:
f8fa22bd
*pde = 00000000
Oops: 0000 [#1]
Modules linked in: uvcvideo snd_pcm_oss snd_mixer_oss usblp pcspkr rtc sunplus_jpeg(F) vimicro(F) gspca_core snd_ali5451 snd_ac97_codec snd_ac97_bus snd_pcm snd_timer snd_page_alloc ehci_hcd ohci1394 ieee1394 alim7101_wdt i2c_ali15x3 i2c_ali1535 nvidia(P) nls_cp866 nls_koi8_r ntfs ov519_decomp ov51x videodev v4l1_compat v4l2_common ide_cd cdrom gl520sm hwmon_vid sd_mod
CPU:    0
EIP:    0060:[<f8fa22bd>]    Tainted: PF     VLI
EFLAGS: 00210292   (2.6.19.2-jm #2)
EIP is at __uvc_find_control+0x14/0x70 [uvcvideo]
eax: 00000000   ebx: 00000000   ecx: df851dec   edx: 0800000c
esi: 0800000c   edi: df851dec   ebp: ef79e030   esp: df851d98
ds: 007b   es: 007b   ss: 0068
Process luvcview (pid: 15076, ti=df850000 task=e34aa590 task.ti=df850000)
Stack: df851dec 0800000c 00000000 df851ec4 0800000c df851dec ef79e030 f8fa232d
       df851ec4 df851ec4 df851ec4 df851e58 df851e6c ef79e030 f8fa276c 00200282
       e23f4380 00200246 00000020 df851e58 ef79e030 c03625f9 df851ec4 df851e58
Call Trace:
 [<f8fa232d>] uvc_find_control+0x14/0x67 [uvcvideo]
 [<f8fa276c>] uvc_ctrl_set+0x1e/0x115 [uvcvideo]
 [<c03625f9>] unix_stream_recvmsg+0x2f3/0x384
 [<f8fa0b48>] uvc_v4l2_do_ioctl+0x347/0x936 [uvcvideo]
 [<c01576db>] core_sys_select+0x27c/0x311
 [<c030cb64>] sock_aio_read+0x52/0x5e
 [<f94ea50d>] rm_set_interrupts+0x129/0x15c [nvidia]
 [<f8cdb2fc>] video_usercopy+0x113/0x19c [videodev]
 [<c014d2b1>] do_sync_read+0xc2/0xff
 [<c0125f52>] autoremove_wake_function+0x0/0x33
 [<c02eca10>] i8042_interrupt+0x1dc/0x1ee
 [<f8fa1171>] uvc_v4l2_ioctl+0x3a/0x40 [uvcvideo]
 [<f8fa0801>] uvc_v4l2_do_ioctl+0x0/0x936 [uvcvideo]
 [<c0156881>] do_ioctl+0x41/0x46
 [<c0156a98>] vfs_ioctl+0x16c/0x178
 [<c0156ad7>] sys_ioctl+0x33/0x4c
 [<c0102bcf>] syscall_call+0x7/0xb
 =======================
Code: 00 00 89 df 89 c1 fc f3 a6 0f 94 c0 0f b6 c0 eb 02 31 c0 5b 5e 5f c3 55 57 56 53 31 db 83 ec 0c 89 44 24 08 89 54 24 04 89 0c 24 <8b> 68 70 39 eb 73 4b 31 f6 8b 44 24 08 8b 78 74 01 f7 8b 4f 04
EIP: [<f8fa22bd>] __uvc_find_control+0x14/0x70 [uvcvideo] SS:ESP 0068:df851d98
 


-- 
Regards,
Serge A. Suchkov
--
The human race is a race of cowards; and I am not only marching in that
procession but carrying a banner.
		-- Mark Twain


From Serge.A.S at tochka.ru  Mon Apr  2 05:56:10 2007
From: Serge.A.S at tochka.ru (Serge A. Suchkov)
Date: Mon, 2 Apr 2007 07:56:10 +0400
Subject: [Linux-uvc-devel] small fixes in uvc_ctrl.c
In-Reply-To: <200704011806.12254.Serge.A.S@tochka.ru>
References: <1175433549.3022.11.camel@chief.local>
	<200704011806.12254.Serge.A.S@tochka.ru>
Message-ID: <200704020756.10246.Serge.A.S@tochka.ru>

Hi all,

Two small fixes in uvc_find_control() and uvc_ctrl_commit_entity() prevents kernel bug of NULL pointer usage.
See my previous message concerning controls problem in Panasonic Camcorder NV-GS11 (04da:2318).

Patch attached.

-- 
Regards,
Serge A. Suchkov
--
Fifth Law of Procrastination:
	Procrastination avoids boredom; one never has the feeling that
there is nothing important to do.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: uvcvideo_null_entity_fix.diff
Type: text/x-diff
Size: 846 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070402/ff27c1d3/attachment.diff>

From laurent.pinchart at skynet.be  Mon Apr  2 11:25:53 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 11:25:53 +0200
Subject: [Linux-uvc-devel] small fixes in uvc_ctrl.c
In-Reply-To: <200704020756.10246.Serge.A.S@tochka.ru>
References: <1175433549.3022.11.camel@chief.local>
	<200704011806.12254.Serge.A.S@tochka.ru>
	<200704020756.10246.Serge.A.S@tochka.ru>
Message-ID: <200704021125.53365.laurent.pinchart@skynet.be>

Hi Serge,

> Two small fixes in uvc_find_control() and uvc_ctrl_commit_entity() prevents
> kernel bug of NULL pointer usage. See my previous message concerning
> controls problem in Panasonic Camcorder NV-GS11 (04da:2318).

Thanks for your patch. The fix is now in SVN. I added an entry in the 
supported device list.

Best regards,

Laurent Pinchart




From laurent.pinchart at skynet.be  Mon Apr  2 11:26:32 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 11:26:32 +0200
Subject: [Linux-uvc-devel] Reporting Panasonic NV-GS27EG to work
In-Reply-To: <1175433549.3022.11.camel@chief.local>
References: <1175433549.3022.11.camel@chief.local>
Message-ID: <200704021126.32385.laurent.pinchart@skynet.be>

Hi Hartmut,

> Hi all,
>
> I just want to report my Panasonic Camcorder NV-GS27EG to work with the
> uvcvideo driver.
>
> It shows up with "DVC  (04da:231d)"
>
> I tested it with luvcview (20070107).
>
> Thank you for your great work.

Thanks for the report. I added an entry in the supported devices list.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 11:30:49 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 11:30:49 +0200
Subject: [Linux-uvc-devel] Sony DCR-HC40(E) camcoer live video streaming
	from usb port
In-Reply-To: <47b5508f0703281106l5996f00erf6a3c235203fcc7a@mail.gmail.com>
References: <47b5508f0703281106l5996f00erf6a3c235203fcc7a@mail.gmail.com>
Message-ID: <200704021130.49369.laurent.pinchart@skynet.be>

Hi Jenny,

> I  acquired a Camcorder Sony DCR-HC40(E). I am using fedora 5 with
>  kernel 2.6.18. On my pc  I only have a USB port and  and   I can  catch
> the pictures saved  in the memory stick  . I  would like also to catch the
> 'live video stream' from its USB port.. Under Windows it is feasible  .And
> I would like to make it work on my linux os.I will be very thankful if you
> can provide details regarding this

First of all, make sure your camcorder is a UVC device. Have a look at 
http://linux-uvc.berlios.de/faq/ to find out how.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 11:53:50 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 11:53:50 +0200
Subject: [Linux-uvc-devel] uvcvideo driver for x86_64
In-Reply-To: <32209efe0703272038k10a6f281v6cf0121e2442aefb@mail.gmail.com>
References: <32209efe0703272038k10a6f281v6cf0121e2442aefb@mail.gmail.com>
Message-ID: <200704021153.50682.laurent.pinchart@skynet.be>

Hi Natalie,

> I am trying to use Logitech Pro 5000 web cam under Linux x86_64. I don't
> seem to have any problems with the webcam under Linux i386. But when I am
> trying to run it under x86_64, the application doesn't work. I heard some
> opinions about no support for video4linux L2 in the uvcvideo driver, but
> both the application and the driver seem to use l2 calls and have full L2
> support. However, the driver doesn't work which makes me think that this
> might be  the compat_ioctl32 layer in the linux kernel. The kernel level is
> 2.6.18.5, and I am also planning to test with the newest kernel, either -rc
> or even -mm tree.
> I've collected some traces to check if something is missing still in
> the UVCapplication/driver/kernel chain, or this is just some bugs in
> the compat
> layers.
> I was using Marratech application, uvccapture, and luvcview with similar
> results.
> Here some sample traces (with my debug):
>
> Marratech conferencing application:
>
> natalie at 4300-test:~/Desktop/uvccapture-0.4$ /usr/local/marratech/Marratech6
> .1/bin/Marratech
> Virtual screensize: java.awt.Rectangle[x=0,y=0,width=1600,height=1024]
> ALSA lib control.c:817:(snd_ctl_open_noupdate) Invalid CTL
> ioctl VIDIOCGCHAN: Invalid argument
> V4l: failed to find a supported format.
> ioctl VIDIOCGCHAN: Invalid argument
> ioctl VIDIOCGMBUF: Invalid argument
> mmap: Invalid argument
> V4l: device has no mmap support
> ioctl VIDIOCSWIN: Input/output error
> ioctl VIDIOCGWIN: Invalid argument
> ioctl VIDIOCGCHAN: Invalid argument
> ioctl VIDIOCGWIN: Invalid argument
> yuvgrab, read failed!
> yuvgrab, read failed!
> yuvgrab, read failed!

Those ioctls are from the V4L1 API, which the Linux UVC driver doesn't 
support. It might be possible to use the V4L1 compatibility layer, and that's 
probably what you're doing already (maybe without even being aware) if 
Marratech works on a 32 bits machine. In that case, there might be some 
issues with the V4L1 compatibility layer on 64 bit architectures.

> uvccapture and luvcview:
>
> nataliep at 4300-test:/tmp$ ./uvccapture
> sending ioctl VIDIOC_QUERYCAP
> sending ioctl VIDIOC_S_FMT
> Unable to set format: 22.
>  Init v4L2 failed !! exit fatal

Those are definitely V4L2 calls. -22 means invalid argument. There might again 
be some issue with 64 bit architectures, either in the driver or in luvcview. 
I can't help you much as I have no 64 bit machine to test this on.

> I also have a kernel trace with my debug, this is a part of it that shows
> that the driver calls into the l1 compat layer, which seems odd to me since
> everything from application to kernel is all l2:

compat_ioctl32 is the 32bit/64bit compatibility layer, not the V4L1 
compatibility layer.

[snip]
> Mar 27 19:07:36 4300-test kernel: [  587.417071] uvcvideo: Unknown ioctl
> 0xc0cc5605
> Mar 27 19:07:36 4300-test kernel: [  587.417075] NBP: compat_ioctl32:ret
> ffffffea -
>
> and the compat_ioctl32 fails, which makes me think this is a culprit.

compat_ioctl32 fails because the requested ioctl is not recognised by the 
Linux UVC driver. The issue is either the user space application calling an 
unsupported ioctl (seems to be VIDIOC_G_FBUF), or the 32bit/64bit 
compatibility layer failing to translate the ioctl properly.

> I will sure appreciate some help with all this...

I have no idea why the 32bit/64bit compatibility layer is called, as it is not 
explicitly supported by the driver (that might be a bug though). Do you use 
the vanilla driver, or some patched version provided by your distribution ?

Compiling the user space applications as native 64 bit binaries might help as 
well.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 13:11:00 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 13:11:00 +0200
Subject: [Linux-uvc-devel] (no subject)
In-Reply-To: <1175008177.460933b1494bc@webmail.nist.gov>
References: <1175008177.460933b1494bc@webmail.nist.gov>
Message-ID: <200704021311.00877.laurent.pinchart@skynet.be>

Hi Lukas,

> the uvc driver works great from the scratch for my logitech quickcam 5000
> pro. Gratulations on this nice job done !

Thanks :-)

> There are some issues while capturing (using opencv) like:
> Corrupt JPEG data: premature end of data segment
> Corrupt JPEG data: 403 extraneous bytes before marker 0xd9
> .
> which actually mess up the image, but don't occur too often so the
> stream is nearly ok. I'm sure you're already aware of that.

This occurs when some USB data packets are lost. Most webcams use isochronous 
transfers, which don't provide any delivery guarantee, so this can happen 
from times to times depending on USB bandwidth usage. Unfortunately, data 
packets don't include a position indication, so there's no way to find out 
that a packet was missing to recover gracefully (by padding the image with 
blank space for instances).

> I have one question regarding the driver:
>
> is it possible to set some capture properties with modprobe while
> loading the driver ? Capture image size and framerate would be
> interesting for webcams. (quickcam pro 5k is able to capture at about
> 1200x900 which is not allways desired, especially in the field of real time
> object recognition) The capturing takes about 41% of cpu power on an athlon
> 64 bit 3700+ processor which is quite a bit.

This is not currently supported. However, you can easily set the image size 
and frame rate from user space applications using the VIDIOC_S_FMT and 
VIDIOC_S_PARM ioctls.

> regarding to the old pwcx phillips driver the quickcam 4000 takes about
> 15%-25% of CPU power for 640x480 pix. the capture image size can be set by
> a parameter like 'modprobe pwcx size=sif fps=15' which is very convenient.

Are you aware of any application that doesn't set the size before streaming ?

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 13:16:07 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 13:16:07 +0200
Subject: [Linux-uvc-devel] LQC Pro 5000 picture quality settings
In-Reply-To: <200703271043.l2RAheeU018370@singularity.tronunltd.com>
References: <200703271043.l2RAheeU018370@singularity.tronunltd.com>
Message-ID: <200704021316.08162.laurent.pinchart@skynet.be>

Hi Ian,

>   I'm a little less interested in looking at this patch
> given your comments (that the highest quality is already
> being set), but I will take a look at it.

Thought so. I was half tempted by letting you write a patch before mentioning 
that "detail", but it wouldn't have been very nice of me :-)

>   RE the 2006 cameras, according to luvcview, I don't
> have YUYV support for high resolutions - are you sure
> about this?  I'd love to get a higher quality high res
> image.  Output is;
[snip]

According to information I got from Logitech, the 2006 model should support 
YUYV streaming for all the MJPEG resolutions. Could you post the output of 
lsusb -v (usbutils-0.72 or newer) ? Thanks.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 13:22:18 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 13:22:18 +0200
Subject: [Linux-uvc-devel] LQC Pro 5000 picture quality settings
In-Reply-To: <200703271305.59104.martijn@uncinc.nl>
References: <200703271043.l2RAheeU018370@singularity.tronunltd.com>
	<200703271305.59104.martijn@uncinc.nl>
Message-ID: <200704021322.19099.laurent.pinchart@skynet.be>

> >   I'm a little less interested in looking at this patch
> > given your comments (that the highest quality is already
> > being set), but I will take a look at it.
>
> Yeah, so am I, but still it would be a nice feature to have. I am however
> more interested in how to set this Bayer mode.
>
> >   RE the 2006 cameras, according to luvcview, I don't
> > have YUYV support for high resolutions - are you sure
> > about this?  I'd love to get a higher quality high res
> > image.
>
> *snip*
>
> It is the same was what I get on an USB 1.1 port, but on a USB 2.0 port I
> can grab YUYV at 640x480 at 30, according to the output. I have yet to test
> it.

Ah, that might be the problem. I hadn't thought about it.

> What I need is a good quality picture with as little compression artifacts
> as possible and good colors (preferably no chroma subsampling like JPEG
> does). I hope Bayer mode helps?

For more information about Bayer mode, have a look at 
http://en.wikipedia.org/wiki/Bayer_filter. The required bandwidth will be 
halved compared to YUYV mode (8 bits per pixel for Bayer mode instead of 16 
bits per pixel for YUYV mode). Bayer sensors perform color subsampling in the 
RGB space. The webcam interpolates the Bayer data to create a YUYV stream, 
and then optionally compress it to MJPEG. You won't loose any color 
information by using Bayer mode, but the image will still suffer from color 
subsampling artifacts.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 13:31:11 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 13:31:11 +0200
Subject: [Linux-uvc-devel] How to reset Quickcam Fusion if it locks up
	(USB timing bug in hardware)?
In-Reply-To: <jwv648naokz.fsf-monnier+gmane.linux.drivers.uvc.devel@gnu.org>
References: <200703152341.l2FNfMMP000863@singularity.tronunltd.com>
	<200703241140.45096.laurent.pinchart@skynet.be>
	<jwv648naokz.fsf-monnier+gmane.linux.drivers.uvc.devel@gnu.org>
Message-ID: <200704021331.12125.laurent.pinchart@skynet.be>

Hi Stefan,

> >> https://lists.berlios.de/pipermail/linux-uvc-devel/2007-March/001476.htm
> >>l
> >>
> >> .. the reset functionality is a part of a patch that is applied against
> >> the UVC Module that get compiled and included in the kernel.  From
> >> my reading of the code, it automatically resets the USB device (without
> >> user intervention).  Thus no command is required.
> >>
> >> But, to my understanding, this patch is not included by default in UVC.
> >
> > That's right.  The patch helped a few people, but failed to fix the bug
> > for others.  As this is a pretty intrusive workaround, I'm not really
> > keen on including it by default if it can't fix the problem for most
> > users.
>
> Hmm... I'm not sure what you mean by "intrusive" here (I don't understand
> the UVC code, really, but when I applied the patch by hand, it seemed
> reasonably conceptually clean and unintrusive in that it just hooks into
> a few places that are not performance sensitive;  Its behavior is obviously
> an ugly hack).
>
> I wouldn't want to have the patch included as-is, and especially the hack
> shouldn't be enabled by default, but I'm wondering: what changes would you
> want to see before such a patch could be considered as acceptable.
> I'd obviously start with adding a module argument named something like
> "use_reset_hack", but what else?
> Would you want the whole hack to be carefully wrapped in #ifdefs?

Before including such hacks in the driver, I want to make sure they are 
actually helpful for more than a few users. If the patch can solve timeout 
issues for more than 50% of the user base (which does not mean preventing 
timeouts once every other time, but really preventing all timeouts to happen 
for most users), I would considering including it. A friend of mine has a 
laptop which suffers a lot from the hardware bug. Until now no patch has been 
able to help him.

The other issue is that such a fix would better be made in the USB core, not 
in the UVC driver. Basically, I'd like a "this works because..." patch better 
than a "this seems to work but I don't know why" patch.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 13:33:56 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 13:33:56 +0200
Subject: [Linux-uvc-devel] Logitech QuickCam Orbit MP: "No such device"
	when reading from /dev/video0
In-Reply-To: <20070325190929.GO12271@netisland.net>
References: <20070323172627.GH12271@netisland.net>
	<200703252009.19534.laurent.pinchart@skynet.be>
	<20070325190929.GO12271@netisland.net>
Message-ID: <200704021333.56749.laurent.pinchart@skynet.be>

Hi Michael,

> > The Linux UVC driver doesn't support reading directly from the device
> > (yet).  Only the streaming I/O method (using mmap) is supported. You can
> > test your webcam with luvcview.
>
> Thanks for the feedback.  I had tried a few other utilities to read from
> /dev/vide0, but they were giving me errors as well.  I thought that cat(1)
> would be the simplest way to demonstrate the problem, but I guess not :-)
>
> When I try using the luvcview utility, the error messages I'm seeing are:
>
> 	[mct at dragonfly ~/luvcview-20060920]$ ./luvcview
> 	uvcview version 0.1.7
> 	Video driver: x11
> 	A window manager is available
> 	video /dev/video0
> 	Unable to set format: 5.
> 	 Init v4L2 failed !! exit fatal
>
> And in dmesg, I see:
>
> 	[17357520.848000] uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
> 	[17357520.848000] uvcvideo: Using default frame interval 66666.6 us (15.0
> fps). [17357521.148000] uvcvideo: Failed to query (1) UVC control 1 (unit
> 0) : -110 (exp. 26).

Welcome to the "Logitech hardware bug victims" club. You are experiencing a 
know hardware problem for which no proper solution exists yet. A patch has 
been posted some times ago on this list. Depending on how much your computer 
is affected by the bug, it might help you.

> Looking at the luvcview-20060920/v4l2uvc.c file, the codepath that
> generates the "Unable to set format" error is:
>
> 	/* set format in */
> 	memset(&vd->fmt, 0, sizeof(struct v4l2_format));
> 	vd->fmt.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
> 	vd->fmt.fmt.pix.width = vd->width;
> 	vd->fmt.fmt.pix.height = vd->height;
> 	vd->fmt.fmt.pix.pixelformat = vd->formatIn;
> 	vd->fmt.fmt.pix.field = V4L2_FIELD_ANY;
> 	ret = ioctl(vd->fd, VIDIOC_S_FMT, &vd->fmt);
> 	if (ret < 0) {
> 	    printf("Unable to set format: %d.\n", errno);
> 	    goto fatal;
> 	}
>
> Which I thought that may be an indication that I needed to use the "-f"
> or "-s" command line arguments to change the requested format or size to
> something that may be better supported by my camera, so I tried a number
> of different permutations with:
>
> 	for f in yuv jpg; do
> 	for s in 1024x576 1280x960 160x120 176x144 320x240 352x288 432x240 \
> 		 480x360 512x288 640x360 640x480 704x576 864x480 960x720; do
> 			./luvcview -f $f -s $s -o ~/foo
> 	done
> 	done
>
> However, none of them appeared to be successful.
>
> Searching around for the "Failed to query" error message that appeared in
> dmesg seems to suggest that I may be hitting a Logitech hardware bug :-(

Exactly :-( You might be lucky with the so-called "reset patch". Please search 
the list archive.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 13:36:54 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 13:36:54 +0200
Subject: [Linux-uvc-devel] V-Gear TalkCam MX6 AF
In-Reply-To: <928818.80166.qm@web60515.mail.yahoo.com>
References: <928818.80166.qm@web60515.mail.yahoo.com>
Message-ID: <200704021336.55191.laurent.pinchart@skynet.be>

Hi Paul,

> I'm running luvcview with text output - brightness and other parameters are
> within bounds and acknowledged to be set correctly by the driver, but
> preview image doesn't change.

I can't think of a way to solve this, sorry. I'll see if I have any webcam 
similar to yours to test this on.

Does any of the supported control (Brightness, Contrast, Hue, Saturation, 
Sharpness, Gamma, Backlight Compensation, Power Line Frequency) work, or do 
they all seem to be non effective ?

Best regards,

Laurent Pinchart


From marcel at datkan.net  Mon Apr  2 13:36:42 2007
From: marcel at datkan.net (Marcel van Beurden)
Date: Mon, 02 Apr 2007 13:36:42 +0200
Subject: [Linux-uvc-devel] Logitech QuickCam Orbit MP: "No such device"
 when reading from /dev/video0
In-Reply-To: <200704021333.56749.laurent.pinchart@skynet.be>
References: <20070323172627.GH12271@netisland.net>	<200703252009.19534.laurent.pinchart@skynet.be>	<20070325190929.GO12271@netisland.net>
	<200704021333.56749.laurent.pinchart@skynet.be>
Message-ID: <4610EACA.5000706@datkan.net>

Laurent Pinchart wrote:
> Welcome to the "Logitech hardware bug victims" club. You are experiencing a 
> know hardware problem for which no proper solution exists yet. A patch has 
> been posted some times ago on this list. Depending on how much your computer 
> is affected by the bug, it might help you.

I have a Logitech QuickCam Fusion too and it's giving my headaches in Windows (I 
didn't jump to Linux yet). I wonder if Logitech is willing to replace webcams 
which have known hardware faults and for which no software fix exists. Does 
anyone have experience with this?

Regards,
Marcel



From laurent.pinchart at skynet.be  Mon Apr  2 14:00:53 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 14:00:53 +0200
Subject: [Linux-uvc-devel] The source clock
In-Reply-To: <53617.85841.qm@web60522.mail.yahoo.com>
References: <53617.85841.qm@web60522.mail.yahoo.com>
Message-ID: <200704021400.53287.laurent.pinchart@skynet.be>

Hi Paul,

> > The SCR value increases with each incoming isochronous packet, so it's
> > not constant across a video frame.
>
> You are right, but this is the only field having device SOF counter value.
> It is needed to establish correspondence between device internal clock
> (STC) and device SOF counter.

Actually, the idea isn't to establish a correspondence between the device 
internal clock and the SOF counter, but to allow the host to compensate for 
the device internal clock drift (mostly for audio/video synchronisation in a 
single USB device).

> It is not needed every video frame, in fact, 
> single value should be sufficient assuming we know details about STC and
> SOF counter period/overflow/reload. Value of PTS is probably not a good
> alternative for synchronizing two devices, because it would be really
> surprising to see their internal clocks synchronized. All above concerns
> only experimental driver, it doesn't have to be a part of final driver.
>
> I went through section 5.12 twice and I don't see anything helpful there,
> in fact it is discouraging. UVC stipulates that compliant devices use
> Isochronous Asynchronous mode, which means that device internal clock (STC)
> is free running and doesn't synchronize with USB bus. It is perfectly
> reasonable, since most users don't care about camera pixel clock being
> synchronized with USB clock. They care about frame rate being stable and
> possibly synchronized with audio. It seems that what I described in
> previous paragraph is the only way to synchronize the device and USB
> clocks.

Synchronising multiple devices can only be achieved if their internal SOF 
counter is synchronised with the host. This is possible with at least current 
Logitech webcams.

Both the PTS and SCR fields are needed to synchronise devices. The image 
timestamp expressed in internal device clock units is available through PTS. 
We need to convert that timestamp to host clock units. This is were SCR gets 
helpful, as it reports a relation between the internal device clock and the 
USB SOF counter. If you can find a way to get the relation between the USB 
SOF counter and the host clock, you could convert the PTS field to a host 
timestamp using some kind of (basic or advanced, I don't know) statistical 
processing.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr  2 14:07:38 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 2 Apr 2007 14:07:38 +0200
Subject: [Linux-uvc-devel] Logitech QuickCam Orbit MP: "No such device"
	when reading from /dev/video0
In-Reply-To: <4610EACA.5000706@datkan.net>
References: <20070323172627.GH12271@netisland.net>
	<200704021333.56749.laurent.pinchart@skynet.be>
	<4610EACA.5000706@datkan.net>
Message-ID: <200704021407.38421.laurent.pinchart@skynet.be>

Hi Marcel,

> > Welcome to the "Logitech hardware bug victims" club. You are experiencing
> > a know hardware problem for which no proper solution exists yet. A patch
> > has been posted some times ago on this list. Depending on how much your
> > computer is affected by the bug, it might help you.
>
> I have a Logitech QuickCam Fusion too and it's giving my headaches in
> Windows (I didn't jump to Linux yet). I wonder if Logitech is willing to
> replace webcams which have known hardware faults and for which no software
> fix exists. Does anyone have experience with this?

That's interesting. Could you give me more information about the problems you 
experience in Windows ? Please post details about your hardware configuration 
as well (especially processor speed and USB bus controller).

Best regards,

Laurent Pinchart


From ian.latter at midnightcode.org  Mon Apr  2 14:26:45 2007
From: ian.latter at midnightcode.org (Ian Latter)
Date: Mon, 02 Apr 2007 22:26:45 +1000
Subject: [Linux-uvc-devel] LQC Pro 5000 picture quality settings
Message-ID: <200704021226.l32CQjp9016042@singularity.tronunltd.com>



> >   I'm a little less interested in looking at this patch
> > given your comments (that the highest quality is already
> > being set), but I will take a look at it.
> 
> Thought so. I was half tempted by letting you write a
patch before mentioning 
> that "detail", but it wouldn't have been very nice of me :-)

Heh.  The heads up was appreciated - tho I'm still interested
in having a shot at it.  I've looked at all the references you
mentioned in earlier email (where you practically pseudo 
coded it), but I still need to get a little closer .. I'm
not there
yet.  The get and set functions are definitely the key, but
I need to be smart about how I use them.
  There's a 5 day weekend coming up for me this weekend,
so I might get a real chance to play then.

 
> >   RE the 2006 cameras, according to luvcview, I don't
> > have YUYV support for high resolutions - are you sure
> > about this?  I'd love to get a higher quality high res
> > image.  Output is;
> [snip]
> 
> According to information I got from Logitech, the 2006
model should support 
> YUYV streaming for all the MJPEG resolutions. Could you
post the output of 
> lsusb -v (usbutils-0.72 or newer) ? Thanks.

Thanks Laurent - I'm confident (tho not certain) that this is
a USB 1.1 issue for me.  If I get a chance, I might see if I can
add a kernel warning for UVC devices that are detected at
1.0 or 1.1 connectivity.  This info (from a dmesg) would be 
useful for noob users (and noob devs alike ;-)






--
Ian Latter
Late night coder ..
http://midnightcode.org/


From monnier at iro.umontreal.ca  Mon Apr  2 16:16:23 2007
From: monnier at iro.umontreal.ca (Stefan Monnier)
Date: Mon, 02 Apr 2007 10:16:23 -0400
Subject: [Linux-uvc-devel] How to reset Quickcam Fusion if it locks up
	(USB timing bug in hardware)?
References: <200703152341.l2FNfMMP000863@singularity.tronunltd.com>
	<200703241140.45096.laurent.pinchart@skynet.be>
	<jwv648naokz.fsf-monnier+gmane.linux.drivers.uvc.devel@gnu.org>
	<200704021331.12125.laurent.pinchart@skynet.be>
Message-ID: <jwvejn2swha.fsf-monnier+gmane.linux.drivers.uvc.devel@gnu.org>

> Before including such hacks in the driver, I want to make sure they are 
> actually helpful for more than a few users.

I can't help you with that: I have no idea how many people could benefit
from such a patch, and neither do I know how many people do benefit from
this patch.

> If the patch can solve timeout issues for more than 50% of the user base
> (which does not mean preventing timeouts once every other time, but really
> preventing all timeouts to happen  for most users), I would considering
> including it.  A friend of mine has a laptop which suffers a lot from the
> hardware bug.  Until now no patch has been able to help him.

Well, at least for me it turned a "basically unusable" Orbit MP webcam into
a "fully functional" webcam.  I'd expect you'd get more data/info about the
problem and its various manifestations if the patch were made more easily
available, e.g. with a -DUSB_RESET_HACK switch, and with explicit mentions
of it in READMEs and websites (accompanied with "please tell us your
experience with it").

As long as the patch doesn't get in the way of the actual main
development/maintenance, given the widespread problem, I'd think it'd be
worth it to include such a hack.

> The other issue is that such a fix would better be made in the USB core,
> not in the UVC driver.  Basically, I'd like a "this works because..."
> patch better than a "this seems to work but I don't know why" patch.

I'm pretty sure that if we ever get to know *why* it "works", we'll then be
in a position to write a real patch rather than a hack.


        Stefan



From edubezval at gmail.com  Mon Apr  2 21:06:38 2007
From: edubezval at gmail.com (Eduardo Valentin)
Date: Mon, 2 Apr 2007 15:06:38 -0400
Subject: [Linux-uvc-devel] Zoom, crop and scaling device capabilities
Message-ID: <a0580c510704021206q408a4832wffa704cb8d0ecdc7@mail.gmail.com>

Hello all,


   I'm currently starting to work with v4l. I'm not sure if this is
the right place to post this question, but as this group has relation
with v4l, I'll try also here.

   The question is about digital zoom capabilities. I'm a little
confused about how to implement crop related ioctls in a v4l2 driver.

   First of all, what is the common application flow to probe zoom
capabilities from
a v4l2 driver? What is the common application flow to get and set current zoom
settings from a v4l2 driver? AFAIU, applications must combine
VIDIOC_CROPCAP, VIDIOC_[S,G]_CROP with VIDIOC_[S,G]_FMT.
What application is a good example for this issue?

   Suppose a device which supports following modes:
- mode 1 (640, 480),
- mode 2 (320, 240) from window (0,0) to (640, 480) and
- mode 3 (320, 240) from  window (161, 121) to (480, 360)

   What is the best way to implement this support? I can see at least
one option here: export the bounds and defrect for cropcap as 640x480.
When applications request formats, return to them what best fits
between 640x480 or 320x240. And then, when applications request crop
window modification, the behaviour would be, if they request a crop
window equal to defrect, the device is changed to mode 1 or 2
(depending on the current format).  however if the crop window
requested is smaller then defrect, the mode 3 is configured. Is this
behaviour expected or I misunderstood something?


Cheers,

--
Eduardo Bezerra Valentin


From pauljurczak at yahoo.com  Tue Apr  3 04:57:54 2007
From: pauljurczak at yahoo.com (Paul Jurczak)
Date: Mon, 2 Apr 2007 19:57:54 -0700 (PDT)
Subject: [Linux-uvc-devel] V-Gear TalkCam MX6 AF
Message-ID: <638057.25083.qm@web60522.mail.yahoo.com>

Hi Laurent,

none of controls available in luvcview has any effect on preview image. What do you think about me sending you this camera, would that be of any help? You could keep the camera of course, as a token of appreciation for all your hard work on UVC driver.

Regards, 

Paul

----- Original Message ----
From: Laurent Pinchart <laurent.pinchart at skynet.be>
To: linux-uvc-devel at lists.berlios.de
Cc: Paul Jurczak <pauljurczak at yahoo.com>
Sent: Monday, April 2, 2007 6:36:54 AM
Subject: Re: [Linux-uvc-devel] V-Gear TalkCam MX6 AF

Hi Paul,

> I'm running luvcview with text output - brightness and other parameters are
> within bounds and acknowledged to be set correctly by the driver, but
> preview image doesn't change.

I can't think of a way to solve this, sorry. I'll see if I have any webcam 
similar to yours to test this on.

Does any of the supported control (Brightness, Contrast, Hue, Saturation, 
Sharpness, Gamma, Backlight Compensation, Power Line Frequency) work, or do 
they all seem to be non effective ?

Best regards,

Laurent Pinchart





 
____________________________________________________________________________________
Get your own web address.  
Have a HUGE year through Yahoo! Small Business.
http://smallbusiness.yahoo.com/domains/?p=BESTDEAL


From jbebel at google.com  Thu Apr  5 21:02:20 2007
From: jbebel at google.com (Joel Ebel)
Date: Thu, 05 Apr 2007 12:02:20 -0700
Subject: [Linux-uvc-devel] Recommended, best supported/least buggy camera
Message-ID: <461547BC.1060200@google.com>

I had been planning to recommend the use of the QuickCam Fusion camera, 
but I see on this mailing list that some bugs may exist with the 
hardware.  Are there any particular models that are most likely to work 
without problems?  Any that I should particularly avoid?

Thanks,
Joel Ebel


From tmbinc at elitedvb.net  Thu Apr  5 23:06:52 2007
From: tmbinc at elitedvb.net (Felix Domke)
Date: Thu, 05 Apr 2007 23:06:52 +0200
Subject: [Linux-uvc-devel] 64bit kernel+32bit userspace support, once again.
Message-ID: <461564EC.5040309@elitedvb.net>

Hi,

Is there are reason for uvc_v4l2.c not implementing the compat_ioctl?

This patch from Arnd Bergmann fixes the "Unkonwn cmd" issue for me on
PowerPC64 with 32bit userspace.

--- uvc_v4l2.c  (revision 91)
+++ uvc_v4l2.c  (working copy)
@@ -971,6 +971,7 @@
        .open           = uvc_v4l2_open,
        .release        = uvc_v4l2_release,
        .ioctl          = uvc_v4l2_ioctl,
+       .compat_ioctl   = v4l_compat_ioctl32,
        .llseek         = no_llseek,
        .read           = uvc_v4l2_read,
        .mmap           = uvc_v4l2_mmap,



regards,
Felix


From ian.latter at midnightcode.org  Fri Apr  6 00:28:09 2007
From: ian.latter at midnightcode.org (Ian Latter)
Date: Fri, 06 Apr 2007 08:28:09 +1000
Subject: [Linux-uvc-devel] How to reset Quickcam Fusion if it locks
	up	(USB timing bug in hardware)?
Message-ID: <200704052228.l35MS9IH032421@singularity.tronunltd.com>


Can I add one thought to the root cause;  I haven't seen
this problem and I'm stuck on USB 1.1.  Since the problem
is believed to have been traced back to a timing issue - is
it possible that this is a USB 2.0 issue (as in, those seeing
the problem are using USB 2.0, and could make the 
problem go away if they connected the same device to a
hub, on the same PC, that forced the interface/speed down to 
USB 1.1)?



----- Original Message -----
>From: "Stefan Monnier" <monnier at iro.umontreal.ca>
>To: <linux-uvc-devel at lists.berlios.de>
>Subject:  Re: [Linux-uvc-devel] How to reset Quickcam
Fusion if it locks up	(USB timing bug in hardware)?
>Date: Mon, 02 Apr 2007 16:16:23 -0400
>
> > Before including such hacks in the driver, I want to
make sure they are 
> > actually helpful for more than a few users.
> 
> I can't help you with that: I have no idea how many people
could benefit
> from such a patch, and neither do I know how many people
do benefit from
> this patch.
> 
> > If the patch can solve timeout issues for more than 50%
of the user base
> > (which does not mean preventing timeouts once every
other time, but really
> > preventing all timeouts to happen  for most users), I
would considering
> > including it.  A friend of mine has a laptop which
suffers a lot from the
> > hardware bug.  Until now no patch has been able to help him.
> 
> Well, at least for me it turned a "basically unusable"
Orbit MP webcam into
> a "fully functional" webcam.  I'd expect you'd get more
data/info about the
> problem and its various manifestations if the patch were
made more easily
> available, e.g. with a -DUSB_RESET_HACK switch, and with
explicit mentions
> of it in READMEs and websites (accompanied with "please
tell us your
> experience with it").
> 
> As long as the patch doesn't get in the way of the actual main
> development/maintenance, given the widespread problem, I'd
think it'd be
> worth it to include such a hack.
> 
> > The other issue is that such a fix would better be made
in the USB core,
> > not in the UVC driver.  Basically, I'd like a "this
works because..."
> > patch better than a "this seems to work but I don't know
why" patch.
> 
> I'm pretty sure that if we ever get to know *why* it
"works", we'll then be
> in a position to write a real patch rather than a hack.
> 
> 
>         Stefan
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 


--
Ian Latter
Late night coder ..
http://midnightcode.org/


From nick at customdesigns.ca  Fri Apr  6 00:39:32 2007
From: nick at customdesigns.ca (Nick Wiltshire)
Date: Thu, 5 Apr 2007 16:39:32 -0600
Subject: [Linux-uvc-devel]
	=?iso-8859-1?q?How_to_reset_Quickcam_Fusion_if_?=
	=?iso-8859-1?q?it_locks_up_=28USB_timing_bug_in_hardware=29=3F?=
In-Reply-To: <200704052228.l35MS9IH032421@singularity.tronunltd.com>
References: <200704052228.l35MS9IH032421@singularity.tronunltd.com>
Message-ID: <200704051639.32192.nick@customdesigns.ca>

Here's my story with QC Fusion....

I got it when they first came out, and had the lockup problem. I applied the 
patch and it worked.

Recently I did a svn up, recompiled with no patching and it seems fine, though 
I'm waiting impatiently for Kopete :) I have USB 2.0 and the camera is 
plugged directly into my laptop.

The only thing that *might* have changed is which port it is plugged into, but 
always direct as my hub is old and only USB 1.? 

I tinker and constantly change software including tweaking my kernel, but 
AFAIK haven't done anything that *should* have made the PMFI.

# uname -a
Linux gambit 2.6.17.9 #3 SMP PREEMPT Tue Oct 17 13:46:55 MDT 2006 i686 
Intel(R) Pentium(R) M processor 1.86GHz GenuineIntel GNU/Linux

Nick

On Thursday 05 April 2007 16:28, Ian Latter wrote:
> Can I add one thought to the root cause;  I haven't seen
> this problem and I'm stuck on USB 1.1.  Since the problem
> is believed to have been traced back to a timing issue - is
> it possible that this is a USB 2.0 issue (as in, those seeing
> the problem are using USB 2.0, and could make the
> problem go away if they connected the same device to a
> hub, on the same PC, that forced the interface/speed down to
> USB 1.1)?
>
>
>
> ----- Original Message -----
>
> >From: "Stefan Monnier" <monnier at iro.umontreal.ca>
> >To: <linux-uvc-devel at lists.berlios.de>
> >Subject:  Re: [Linux-uvc-devel] How to reset Quickcam
>
> Fusion if it locks up	(USB timing bug in hardware)?
>
> >Date: Mon, 02 Apr 2007 16:16:23 -0400
> >
> > > Before including such hacks in the driver, I want to
>
> make sure they are
>
> > > actually helpful for more than a few users.
> >
> > I can't help you with that: I have no idea how many people
>
> could benefit
>
> > from such a patch, and neither do I know how many people
>
> do benefit from
>
> > this patch.
> >
> > > If the patch can solve timeout issues for more than 50%
>
> of the user base
>
> > > (which does not mean preventing timeouts once every
>
> other time, but really
>
> > > preventing all timeouts to happen  for most users), I
>
> would considering
>
> > > including it.  A friend of mine has a laptop which
>
> suffers a lot from the
>
> > > hardware bug.  Until now no patch has been able to help him.
> >
> > Well, at least for me it turned a "basically unusable"
>
> Orbit MP webcam into
>
> > a "fully functional" webcam.  I'd expect you'd get more
>
> data/info about the
>
> > problem and its various manifestations if the patch were
>
> made more easily
>
> > available, e.g. with a -DUSB_RESET_HACK switch, and with
>
> explicit mentions
>
> > of it in READMEs and websites (accompanied with "please
>
> tell us your
>
> > experience with it").
> >
> > As long as the patch doesn't get in the way of the actual main
> > development/maintenance, given the widespread problem, I'd
>
> think it'd be
>
> > worth it to include such a hack.
> >
> > > The other issue is that such a fix would better be made
>
> in the USB core,
>
> > > not in the UVC driver.  Basically, I'd like a "this
>
> works because..."
>
> > > patch better than a "this seems to work but I don't know
>
> why" patch.
>
> > I'm pretty sure that if we ever get to know *why* it
>
> "works", we'll then be
>
> > in a position to write a real patch rather than a hack.
> >
> >
> >         Stefan
> >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
> --
> Ian Latter
> Late night coder ..
> http://midnightcode.org/
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From sam.revitch at gmail.com  Sun Apr  8 22:10:42 2007
From: sam.revitch at gmail.com (Sam Revitch)
Date: Sun, 8 Apr 2007 13:10:42 -0700
Subject: [Linux-uvc-devel] Ricoh UVC webcams
Message-ID: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>

Hi Laurent and all,

I'm currently working on a V4L driver for Ricoh webcams.  I write to
you because there is some apparent device support overlap that should
be resolved.

To give a brief description of this type of hardware, all known
webcams of this sort are built in to laptops, including a handful of
models from Sony and HP, and they are built around an 8051
microcontroller.  Some of these devices report video class interface
descriptors.  Older devices report some sort of interface descriptor
claiming to be image class, but are nothing of the sort, and they even
managed to create at least two distinct non-UVC devices that report
the same 05ca:1870 device ID.

The Ricoh webcams that claim to support UVC indeed behave as true UVC
devices, and even work with uvcvideo, but with two caveats:

1. A microcode image must be uploaded the first time the device is
used since the machine has been powered on.

2. Some picture controls are not described in the UVC interface
descriptors, and in fact these picture controls are set using the same
commands as non-UVC Ricoh webcams.

I have implemented complete support for three Ricoh UVC devices in my
driver, using a minimal UVC implementation.  These include:

05ca:1810 - HP Pavilion Webcam
05ca:1835 - Sony VGP-VCC5
05ca:1836 - Sony VGP-VCC4

Getting to the point, a system with both uvcvideo and r5u870 installed
will be a source of confusion.  Both uvcvideo and r5u870 will try to
attach to the above devices -- uvcvideo because of the video class
interface, r5u870 because of the device ID.  If the webcam does not
have microcode, uvcvideo will fail and r5u870 will succeed.  If the
webcam does have microcode, such as after unloading r5u870 and loading
uvcvideo, or after a warm boot, uvcvideo will succeed.  This is very
inconsistent.

Either uvcvideo should fully support these three devices and future
Ricoh UVC devices, or it should blacklist them.  Adding support to
uvcvideo should not be terribly difficult and I'm willing to propose a
patch -- but if we go this route, I will grill other aspects of
uvcvideo to ensure that my users don't lose any application support.

Aside, the Windows drivers for these devices are apparently
implemented as a pair of filter drivers around usbvideo.sys.  The
lower filter contains the microcode and handles the upload process,
and also handles the non-UVC picture control requests.

Thanks.
-Sam Revitch


From richard at rsk.demon.co.uk  Mon Apr  9 12:56:33 2007
From: richard at rsk.demon.co.uk (richard)
Date: Mon, 09 Apr 2007 10:56:33 -0000
Subject: [Linux-uvc-devel] logitech control query fail
Message-ID: <1172848086.3473.15.camel@localhost.localdomain>

Hi,
I'm trying to get a logitech pro 5000 working with ekiga on fedora fc6
on an AMD 64X2.

The driver loads ok 

> uvcvideo: Found UVC 1.00 device <unnamed> (046d:08c5)

and will work for a while but if I close a connection, or disable then
re-enable the video, it will start to fail 

uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -75 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).

any idea what's going wrong and how I might fix it? 

thanks

Richard




From luca2020 at hotmail.com  Tue Apr 10 02:53:30 2007
From: luca2020 at hotmail.com (luke peters)
Date: Tue, 10 Apr 2007 01:53:30 +0100
Subject: [Linux-uvc-devel] Make problem
Message-ID: <BAY134-F31E51709C5265CF5711F69D4580@phx.gbl>

Hi there,

When I try to Make I get this:

Building USB Video Class driver...
make[1]: Entering directory '/usr/src/linux - 2.6.18.2-34.obj/i386/default'
make -C ../../../linux-2.6.18.2-34 0=../linux-2.6.18.2-34-obj/i386/default 
webcam
make[3]: *** No rule to make target 'webcam'. Stop.
make[2]: *** [webcam] Error 2
make[1]: *** [webcam] Error 2
make[1]: Leaving directory '/usr/src/linux - 2.6.18.2-34-obj/i386/default'

make: *** [uvcvideo] Error 2

ANy ideas?

Many thanks

Luke

_________________________________________________________________
Match.com - Click Here To Find Singles In Your Area Today! 
http://msnuk.match.com/



From linux at rubli.info  Tue Apr 10 05:17:47 2007
From: linux at rubli.info (Martin Rubli)
Date: Tue, 10 Apr 2007 11:17:47 +0800
Subject: [Linux-uvc-devel] (no subject)
In-Reply-To: <1175008177.460933b1494bc@webmail.nist.gov>
References: <1175008177.460933b1494bc@webmail.nist.gov>
Message-ID: <op.tqjsrxey42iof8@nb-mrublixp.am.logitech.com>

On Tue, 27 Mar 2007 23:09:37 +0800, <ldiduch at nist.gov> wrote:

> is it possible to set some capture properties with modprobe while
> loading the driver ? Capture image size and framerate would be
> interesting for webcams. (quickcam pro 5k is able to capture at about  
> 1200x900 which is not allways desired, especially in the field of real  
> time object
> recognition) The capturing takes about 41% of cpu power on an athlon 64  
> bit 3700+ processor which is quite a bit.

How do you get this high resolution? The camera only has a VGA sensor. I'm  
assuming you're using the Windows driver, which might allow for software  
upscaling. If so, did you measure the CPU usage on Windows or Linux?

Cheers,
Martin


From linux at rubli.info  Tue Apr 10 05:26:44 2007
From: linux at rubli.info (Martin Rubli)
Date: Tue, 10 Apr 2007 11:26:44 +0800
Subject: [Linux-uvc-devel] How to reset Quickcam Fusion if it locks up
	(USB timing bug in hardware)?
In-Reply-To: <200704052228.l35MS9IH032421@singularity.tronunltd.com>
References: <200704052228.l35MS9IH032421@singularity.tronunltd.com>
Message-ID: <op.tqjs6ujf42iof8@nb-mrublixp.am.logitech.com>

On Fri, 06 Apr 2007 06:28:09 +0800, Ian Latter  
<ian.latter at midnightcode.org> wrote:

>
> Can I add one thought to the root cause;  I haven't seen
> this problem and I'm stuck on USB 1.1.  Since the problem
> is believed to have been traced back to a timing issue - is
> it possible that this is a USB 2.0 issue (as in, those seeing
> the problem are using USB 2.0, and could make the
> problem go away if they connected the same device to a
> hub, on the same PC, that forced the interface/speed down to
> USB 1.1)?

Yes, it's pretty much confirmed to be a USB 2.0 only issue. Running the  
camera on a USB 1.1 port or unloading the ehci_hcd driver before plugging  
it is a feasible workaround, i.e. if you can do without some of the higher  
YUYV resolutions that require USB 2.0 throughput.

Cheers,
Martin


From linux at rubli.info  Tue Apr 10 05:38:25 2007
From: linux at rubli.info (Martin Rubli)
Date: Tue, 10 Apr 2007 11:38:25 +0800
Subject: [Linux-uvc-devel] LQC Pro 5000 picture quality settings
In-Reply-To: <200703271231.l2RCVas2019388@singularity.tronunltd.com>
References: <200703271231.l2RCVas2019388@singularity.tronunltd.com>
Message-ID: <op.tqjtqbg142iof8@nb-mrublixp.am.logitech.com>

On Tue, 27 Mar 2007 20:31:36 +0800, Ian Latter  
<ian.latter at midnightcode.org> wrote:

>   I hadn't heard of "Bayer" mode before.  Seems the PWC
> project has support for Bayer decoding in pwc-dec23.c;
> http://iphitus.loudas.com/beyond/2.6.17/2.6.17-beyond3/patches/pwc-2.6.18-backport-fixed.patch

Bayer mode is an image encoding standard that's not currently supported by  
the UVC specification, which is one of the reasons why it probably won't  
make its way into the UVC driver.

Another one is that V4L2 drivers are not supposed to decode the image  
data. There was a lot of discussion on that topic in the past and the  
bottom line is that even though there's no unified V4L2 library that could  
take care of this, drivers are not supposed to do it. This leaves it up to  
the app to do any sort of decoding.

That being said, the UVC driver doesn't really care about the video data  
that it relays to the app. In the case of some Logitech cameras you can  
switch them to Bayer mode and then do the decoding in user space. I posted  
a quick how-to on this topic a while ago, you should be able to find it in  
the archives.

> .. and makes mention of this special case;
>  	/* special case: VGA @ 5 fps and snapshot is raw bayer mode */
>
>   I take it this is the single image capture mode that
> UVC doesn't support yet?

Still image capture is indeed not supported yet. It shouldn't be too  
difficult to implement but the main question to resolve is: How do you get  
the still image to the app? V4L2 has no support for this today, so you'd  
have to come up with another interface. My favorite is "dd if=/dev/video0  
of=mypic.jpg" but nobody's had time to implement that so far. :-)

Cheers,
Martin


From pawankumar.gupta at ittiam.com  Tue Apr 10 11:26:19 2007
From: pawankumar.gupta at ittiam.com (Pawan Kumar Gupta)
Date: Tue, 10 Apr 2007 14:56:19 +0530
Subject: [Linux-uvc-devel] Logitech Pro5000: uncompressed format
In-Reply-To: <904DEC693BE1AB429622C6F5ABA7E0B801CED70E@is01ex02.ittiam.com>
Message-ID: <904DEC693BE1AB429622C6F5ABA7E0B801CED9E4@is01ex02.ittiam.com>

Hi,

I am trying to use Logitech Pro5000 for uncompressed data format but I
am not able to start streaming. When I use MJPEG format, I can get video
from the camera but for uncompressed data format "STREAMON" ioctl does
not succeed.

Can somebody tell me about it? Has anybody used Logitech camera for
uncompressed video output?

Regards,
Pawan


**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
helpdesk at ittiam.com.
**********************************************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070410/416920e2/attachment.html>

From laurent.pinchart at skynet.be  Wed Apr 11 22:30:54 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 22:30:54 +0200
Subject: [Linux-uvc-devel] 64bit kernel+32bit userspace support,
	once again.
In-Reply-To: <461564EC.5040309@elitedvb.net>
References: <461564EC.5040309@elitedvb.net>
Message-ID: <200704112230.55058.laurent.pinchart@skynet.be>

Hi,

> Is there are reason for uvc_v4l2.c not implementing the compat_ioctl?

None at all.

> This patch from Arnd Bergmann fixes the "Unkonwn cmd" issue for me on
> PowerPC64 with 32bit userspace.

Applied. Thanks a lot :-)

> --- uvc_v4l2.c  (revision 91)
> +++ uvc_v4l2.c  (working copy)
> @@ -971,6 +971,7 @@
>         .open           = uvc_v4l2_open,
>         .release        = uvc_v4l2_release,
>         .ioctl          = uvc_v4l2_ioctl,
> +       .compat_ioctl   = v4l_compat_ioctl32,
>         .llseek         = no_llseek,
>         .read           = uvc_v4l2_read,
>         .mmap           = uvc_v4l2_mmap,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 11 22:14:21 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 22:14:21 +0200
Subject: [Linux-uvc-devel] V-Gear TalkCam MX6 AF
In-Reply-To: <638057.25083.qm@web60522.mail.yahoo.com>
References: <638057.25083.qm@web60522.mail.yahoo.com>
Message-ID: <200704112214.21589.laurent.pinchart@skynet.be>

Hi Paul,

> none of controls available in luvcview has any effect on preview image.

Hmmm... I'm sorry but I have no idea why this happens :-/

> What do you think about me sending you this camera, would that be of any
> help? You could keep the camera of course, as a token of appreciation for
> all your hard work on UVC driver.

That would be very nice. I of course can't promise to solve the problem, but I 
could have an in-depth look. I'm quite busy right now with another project 
until next Monday. I'll then have more time to work on the UVC driver.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 11 22:53:28 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 22:53:28 +0200
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
Message-ID: <200704112253.28859.laurent.pinchart@skynet.be>

Hi Sam,

> I'm currently working on a V4L driver for Ricoh webcams.  I write to
> you because there is some apparent device support overlap that should
> be resolved.
>
> To give a brief description of this type of hardware, all known
> webcams of this sort are built in to laptops, including a handful of
> models from Sony and HP, and they are built around an 8051
> microcontroller.  Some of these devices report video class interface
> descriptors.  Older devices report some sort of interface descriptor
> claiming to be image class, but are nothing of the sort, and they even
> managed to create at least two distinct non-UVC devices that report
> the same 05ca:1870 device ID.

This explains why many users reported problems with their Ricoh webcams being 
unsupported.

> The Ricoh webcams that claim to support UVC indeed behave as true UVC
> devices, and even work with uvcvideo, but with two caveats:
>
> 1. A microcode image must be uploaded the first time the device is
> used since the machine has been powered on.

We already had to deal with this issue for the iSight webcams integrated in 
the mactel notebooks.

> 2. Some picture controls are not described in the UVC interface
> descriptors, and in fact these picture controls are set using the same
> commands as non-UVC Ricoh webcams.

Is there any known reason for that ? That sounds a bit against the UVC spec.

> I have implemented complete support for three Ricoh UVC devices in my
> driver, using a minimal UVC implementation.  These include:
>
> 05ca:1810 - HP Pavilion Webcam
> 05ca:1835 - Sony VGP-VCC5
> 05ca:1836 - Sony VGP-VCC4
>
> Getting to the point, a system with both uvcvideo and r5u870 installed
> will be a source of confusion.  Both uvcvideo and r5u870 will try to
> attach to the above devices -- uvcvideo because of the video class
> interface, r5u870 because of the device ID.  If the webcam does not
> have microcode, uvcvideo will fail and r5u870 will succeed.  If the
> webcam does have microcode, such as after unloading r5u870 and loading
> uvcvideo, or after a warm boot, uvcvideo will succeed.  This is very
> inconsistent.

Indeed. Users will get confused.

> Either uvcvideo should fully support these three devices and future
> Ricoh UVC devices, or it should blacklist them.

Agreed. I'd rather go for the first solution.

> Adding support to uvcvideo should not be terribly difficult and I'm willing
> to propose a patch -- but if we go this route, I will grill other aspects of
> uvcvideo to ensure that my users don't lose any application support.

Can we discuss the issues you mentioned, as well as all other issues you can 
foresee ?

> Aside, the Windows drivers for these devices are apparently
> implemented as a pair of filter drivers around usbvideo.sys.  The
> lower filter contains the microcode and handles the upload process,
> and also handles the non-UVC picture control requests.

I'm still not sure if the firmware download operation should be handled by the 
driver or by a userspace utility. The fxload software from the usbutils 
package is meant to be called by the hotplug system. This would obviously be 
easier for the driver :-)

Do all Ricoh devices advertise a different class and/or USB pid before and 
after loading the firmware ?

We will also have to sort out legal problems associated with firmware 
redistribution.

Thank you for your work on UVC Ricoh devices. I hope to find a way to support 
those devices in the Linux UVC driver.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 11 23:11:51 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 23:11:51 +0200
Subject: [Linux-uvc-devel] Recommended, best supported/least buggy camera
In-Reply-To: <461547BC.1060200@google.com>
References: <461547BC.1060200@google.com>
Message-ID: <200704112311.51581.laurent.pinchart@skynet.be>

Hi Joel,

> I had been planning to recommend the use of the QuickCam Fusion camera,
> but I see on this mailing list that some bugs may exist with the
> hardware.  Are there any particular models that are most likely to work
> without problems?  Any that I should particularly avoid?

Unfortunately, no. All Logitech webcams suffer from the same bug. Depending on 
your computer, you might not notice the problem at all, or get a completely 
unusable webcam. The latest seems to be quite uncommon, especially with the 
reset patch.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 11 23:15:08 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 23:15:08 +0200
Subject: [Linux-uvc-devel] Make problem
In-Reply-To: <BAY134-F31E51709C5265CF5711F69D4580@phx.gbl>
References: <BAY134-F31E51709C5265CF5711F69D4580@phx.gbl>
Message-ID: <200704112315.08373.laurent.pinchart@skynet.be>

On Tuesday 10 April 2007, luke peters wrote:
> Hi there,
>
> When I try to Make I get this:
>
> Building USB Video Class driver...
> make[1]: Entering directory '/usr/src/linux - 2.6.18.2-34.obj/i386/default'
> make -C ../../../linux-2.6.18.2-34 0=../linux-2.6.18.2-34-obj/i386/default
> webcam
> make[3]: *** No rule to make target 'webcam'. Stop.
> make[2]: *** [webcam] Error 2
> make[1]: *** [webcam] Error 2
> make[1]: Leaving directory '/usr/src/linux - 2.6.18.2-34-obj/i386/default'
>
> make: *** [uvcvideo] Error 2
>
> ANy ideas?

Are you using a patched source package ?

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 11 23:16:57 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 23:16:57 +0200
Subject: [Linux-uvc-devel] Logitech Pro5000: uncompressed format
In-Reply-To: <904DEC693BE1AB429622C6F5ABA7E0B801CED9E4@is01ex02.ittiam.com>
References: <904DEC693BE1AB429622C6F5ABA7E0B801CED9E4@is01ex02.ittiam.com>
Message-ID: <200704112316.57609.laurent.pinchart@skynet.be>

Hi Pawan,

> I am trying to use Logitech Pro5000 for uncompressed data format but I
> am not able to start streaming. When I use MJPEG format, I can get video
> from the camera but for uncompressed data format "STREAMON" ioctl does
> not succeed.

What error does VIDIOC_STREAMON return ?

> Can somebody tell me about it? Has anybody used Logitech camera for
> uncompressed video output?

Uncompressed video output should work fine. Make sure your webcam is plugged 
in a USB 2.0 port.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 11 23:23:18 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 11 Apr 2007 23:23:18 +0200
Subject: [Linux-uvc-devel] Zoom, crop and scaling device capabilities
In-Reply-To: <a0580c510704021206q408a4832wffa704cb8d0ecdc7@mail.gmail.com>
References: <a0580c510704021206q408a4832wffa704cb8d0ecdc7@mail.gmail.com>
Message-ID: <200704112323.18452.laurent.pinchart@skynet.be>

Hi Eduardo,

>    I'm currently starting to work with v4l. I'm not sure if this is
> the right place to post this question, but as this group has relation
> with v4l, I'll try also here.
>
>    The question is about digital zoom capabilities. I'm a little
> confused about how to implement crop related ioctls in a v4l2 driver.
>
>    First of all, what is the common application flow to probe zoom
> capabilities from
> a v4l2 driver? What is the common application flow to get and set current
> zoom settings from a v4l2 driver? AFAIU, applications must combine
> VIDIOC_CROPCAP, VIDIOC_[S,G]_CROP with VIDIOC_[S,G]_FMT.
> What application is a good example for this issue?
>
>    Suppose a device which supports following modes:
> - mode 1 (640, 480),
> - mode 2 (320, 240) from window (0,0) to (640, 480) and
> - mode 3 (320, 240) from  window (161, 121) to (480, 360)
>
>    What is the best way to implement this support? I can see at least
> one option here: export the bounds and defrect for cropcap as 640x480.
> When applications request formats, return to them what best fits
> between 640x480 or 320x240. And then, when applications request crop
> window modification, the behaviour would be, if they request a crop
> window equal to defrect, the device is changed to mode 1 or 2
> (depending on the current format).  however if the crop window
> requested is smaller then defrect, the mode 3 is configured. Is this
> behaviour expected or I misunderstood something?

The behaviour you described is what I would expect, with a small change. If 
the crop window requested is different from defrect, you should select mode 
1/2 or 3 depending on which window size is closer to the requested one.

Best regards,

Laurent Pinchart


From jbebel at google.com  Wed Apr 11 23:30:33 2007
From: jbebel at google.com (Joel Ebel)
Date: Wed, 11 Apr 2007 14:30:33 -0700
Subject: [Linux-uvc-devel] Recommended, best supported/least buggy camera
In-Reply-To: <200704112311.51581.laurent.pinchart@skynet.be>
References: <461547BC.1060200@google.com>
	<200704112311.51581.laurent.pinchart@skynet.be>
Message-ID: <461D5379.8090202@google.com>

Ah. ok.  I was under the impression the bug was only in the Fusion.  I 
like the design of the Fusion, so I guess we'll run with it, and if we 
have problems, we'll try the reset patch.

Thanks,
Joel

Laurent Pinchart wrote:
> Hi Joel,
> 
>> I had been planning to recommend the use of the QuickCam Fusion camera,
>> but I see on this mailing list that some bugs may exist with the
>> hardware.  Are there any particular models that are most likely to work
>> without problems?  Any that I should particularly avoid?
> 
> Unfortunately, no. All Logitech webcams suffer from the same bug. Depending on 
> your computer, you might not notice the problem at all, or get a completely 
> unusable webcam. The latest seems to be quite uncommon, especially with the 
> reset patch.
> 
> Best regards,
> 
> Laurent Pinchart


From jim at federated.com  Thu Apr 12 03:15:51 2007
From: jim at federated.com (Jim Studt)
Date: Wed, 11 Apr 2007 20:15:51 -0500
Subject: [Linux-uvc-devel] [PATCH] VIDIOC_[GS]_JPEGCOMP support
Message-ID: <EFE3E62A-C489-45B7-A4B2-B0E53E953AB3@federated.com>

I had a sneaky suspicion my camera was stuck in top quality. Laurent  
Pinchart's comments from March 25th confirmed and were a nice  
blueprint for this patch.

Possible rough edges:

-  I was unable to determine what the range of the  
v4l2_jpegcompression.quality field should be, so I chose 0-100 since  
that is familiar to users of JPEG, it is mapped to the allowed ranges  
of the device, respecting the resolution.

-  I didn't really understand the privilege issues, so I copied the  
code from the VIDIOC_S_PARM, maybe the priv check should be removed.

-  The code now defaults to the minimum quality instead of the  
maximum. This is an unfortunate effect of getting a 0 passed in the  
first time. There is a probably a good place to stick in a 10000 for  
the first probe somewhere in the startup code.

- At the bottom of uvc_probe_video() where it tries to fall back to a  
lesser bandwidth mode (I think), I switched it to fall back to the  
minimum quality instead of the maximum.

- It only supports the quality field of the ioctl, but I think that  
is appropriate.

- If the reported range and resolution would cause a divide by zero  
error in the computation we just take the maximum.

- The "get" function returns the actual quality, not the requested. I  
think that is appropriate, it expose the granularity to the application.

Now I can drop my 640x480 frames from 100+kb/frame to 25kb or so.

Index: uvc_video.c
===================================================================
--- uvc_video.c	(revision 93)
+++ uvc_video.c	(working copy)
@@ -150,7 +150,7 @@
int uvc_probe_video(struct uvc_video_device *video, struct  
uvc_streaming_control *probe)
{
-	struct uvc_streaming_control probe_min, probe_max;
+	struct uvc_streaming_control probe_min, probe_max, probe_res;
	__u16 bandwidth;
	unsigned int i;
	int ret;
@@ -170,10 +170,26 @@
	/* Get the minimum and maximum values for compression settings. */
	if (!(video->dev->quirks & UVC_QUIRK_PROBE_MINMAX)) {
		if ((ret = uvc_get_video_ctrl(video, &probe_min, 1, GET_MIN)) < 0 ||
-		    (ret = uvc_get_video_ctrl(video, &probe_max, 1, GET_MAX)) < 0)
+		    (ret = uvc_get_video_ctrl(video, &probe_max, 1, GET_MAX)) < 0 ||
+		    (ret = uvc_get_video_ctrl(video, &probe_res, 1, GET_RES)) < 0)
			goto done;
+		/* pin wCompQuality to the legal range */
+		if ( probe->wCompQuality < probe_min.wCompQuality) probe- 
 >wCompQuality = probe_min.wCompQuality;
+		else if ( probe->wCompQuality > probe_max.wCompQuality) probe- 
 >wCompQuality = probe_max.wCompQuality;
+		else {
+		    int range, steps, step_size;
-		probe->wCompQuality = probe_max.wCompQuality;
+		    /* this mess of code makes sure wCompQuality lands on one of  
the legal values */
+		    step_size = probe_res.wCompQuality;
+		    range = probe_max.wCompQuality - probe_min.wCompQuality;
+		    if ( range != 0 && step_size != 0) {
+			steps = range / step_size;
+			probe->wCompQuality = probe_min.wCompQuality +
+			    (probe->wCompQuality - probe_min.wCompQuality + step_size/2) 
*steps/range*step_size;
+		    } else {
+			probe->wCompQuality = probe_max.wCompQuality;
+		    }
+		}
	}
	for (i = 0; i < 2; ++i) {
@@ -193,7 +209,7 @@
		/* TODO: negotiate compression parameters */
		probe->wKeyFrameRate = probe_min.wKeyFrameRate;
		probe->wPFrameRate = probe_min.wPFrameRate;
-		probe->wCompQuality = probe_max.wCompQuality;
+		probe->wCompQuality = probe_min.wCompQuality;
		probe->wCompWindowSize = probe_min.wCompWindowSize;
	}
Index: uvc_v4l2.c
===================================================================
--- uvc_v4l2.c	(revision 93)
+++ uvc_v4l2.c	(working copy)
@@ -314,6 +314,42 @@
	return 0;
}
+static int uvc_v4l2_get_jpegcompression(struct uvc_video_device *video,
+		struct v4l2_jpegcompression *parm)
+{
+	memset(parm, 0, sizeof *parm);
+	parm->quality = video->streaming->ctrl.wCompQuality/100;  /* scale  
from UVC 10000 to familiar 10 */
+	// Are DQT and DRI required in UVC? Maybe we should turn on their  
bits in jpeg_markers?
+
+	return 0;
+}
+
+static int uvc_v4l2_set_jpegcompression(struct uvc_video_device *video,
+		struct v4l2_jpegcompression *parm)
+{
+	struct uvc_streaming_control probe;
+	int ret;
+	int quality;
+
+	memcpy(&probe, &video->streaming->ctrl, sizeof probe);
+	quality = parm->quality * 100; /* scale from famliar 100 to UVC  
10000 */
+
+	uvc_trace(UVC_TRACE_FORMAT, "Setting jpeg quality to %d.\n", quality);
+
+	probe.wCompQuality = quality;
+	/* Probe the device with the new settings. */
+	if ((ret = uvc_probe_video(video, &probe)) < 0)
+		return ret;
+
+	/* Commit the new settings. */
+	if ((ret = uvc_set_video_ctrl(video, &probe, 0)) < 0)
+		return ret;
+
+	memcpy(&video->streaming->ctrl, &probe, sizeof probe);
+
+	return 0;
+}
+
/*  
------------------------------------------------------------------------
   * Privilege management
   */
@@ -710,6 +746,15 @@
	}
		break;
+	case VIDIOC_G_JPEGCOMP:
+		return uvc_v4l2_get_jpegcompression(video, (struct  
v4l2_jpegcompression*)arg);
+	
+	case VIDIOC_S_JPEGCOMP:
+		if ((ret = uvc_acquire_privileges(handle)) < 0)
+			return ret;
+
+		return uvc_v4l2_set_jpegcompression(video, (struct  
v4l2_jpegcompression*)arg);
+	
	/* Get & Set streaming parameters */
	case VIDIOC_G_PARM:
		return uvc_v4l2_get_streamparm(video, (struct v4l2_streamparm*)arg);



From nelg at linuxsolutions.co.nz  Thu Apr 12 06:46:33 2007
From: nelg at linuxsolutions.co.nz (Glen Ogilvie)
Date: Thu, 12 Apr 2007 16:46:33 +1200
Subject: [Linux-uvc-devel] recording video and sound.
Message-ID: <200704121646.36071.nelg@linuxsolutions.co.nz>

Hi,

I've got a Logitech Quickcam Orbit MP, and it works pretty well with luvcview, 
and the uvcvideo module.  

I'd like to know if the is any apps out there that work with uvcvideo that can 
record both video and sound to a file?   

I can get luvcview to record video, but it does not record sound.

Regards
Glen Ogilvie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070412/0848fa94/attachment.pgp>

From pawankumar.gupta at ittiam.com  Thu Apr 12 12:11:21 2007
From: pawankumar.gupta at ittiam.com (Pawan Kumar Gupta)
Date: Thu, 12 Apr 2007 15:41:21 +0530
Subject: [Linux-uvc-devel] Logitech Pro5000: uncompressed format
In-Reply-To: <200704112316.57609.laurent.pinchart@skynet.be>
Message-ID: <904DEC693BE1AB429622C6F5ABA7E0B801CEDA00@is01ex02.ittiam.com>

Hi Laurent,

I get the following error when I try Uncompressed video port.
"uvcvideo: Failed to submit isoc URB 0 (-90)."

I am using USB2.0 port. 

Regards,
Pawan

-----Original Message-----
From: Laurent Pinchart [mailto:laurent.pinchart at skynet.be] 
Sent: Thursday, April 12, 2007 2:47 AM
To: linux-uvc-devel at lists.berlios.de
Cc: Pawan Kumar Gupta
Subject: Re: [Linux-uvc-devel] Logitech Pro5000: uncompressed format

Hi Pawan,

> I am trying to use Logitech Pro5000 for uncompressed data format but I
> am not able to start streaming. When I use MJPEG format, I can get
video
> from the camera but for uncompressed data format "STREAMON" ioctl does
> not succeed.

What error does VIDIOC_STREAMON return ?

> Can somebody tell me about it? Has anybody used Logitech camera for
> uncompressed video output?

Uncompressed video output should work fine. Make sure your webcam is
plugged 
in a USB 2.0 port.

Best regards,

Laurent Pinchart

**********************************************************************
This email and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this email in error please notify
helpdesk at ittiam.com.
**********************************************************************



From paul.warren at anu.edu.au  Fri Apr 13 00:50:49 2007
From: paul.warren at anu.edu.au (Paul Warren)
Date: Fri, 13 Apr 2007 08:50:49 +1000
Subject: [Linux-uvc-devel] Unsupported Camera: Pico iMage
Message-ID: <461EB7C9.6040703@anu.edu.au>

Pico[1], iMage[2], distributed by: ecamm network[3]

model number: PIKCU03W

relevant dmesg  after connection (svn version of uvcvideo, revision 91) :

[17192333.848000] usb 5-7: USB disconnect, address 8
[17201221.900000] usb 5-8: new high speed USB device using ehci_hcd and
address 9
[17201222.044000] usb 5-8: configuration #1 chosen from 1 choice
[17201222.044000] uvcvideo: Found UVC 1.00 device Pico iMage Webcam
(18cd:cafe)
[17201222.044000] uvcvideo: No valid video chain found.

lsusb -v -d 18cd:cafe output attached.

uname -a: Linux Rachel 2.6.17-11-generic #2 SMP Thu Feb 1 19:52:28 UTC
2007 i686 GNU/Linux

ubuntu 6.10


Anything else you need, feel free to email or respond to this post, I'm
subscribed. Willing to help work on this, weekends Australian Time.

Cheers
-- 
Paul Warren
ANUSF Data Intensive Projects
Rm 335, Leonard Huxley Building
56 Mills Rd.

[1] www.picoinstruments.com
[2] http://www.ecamm.com/mac/imagewebcam/
[3] www.ecamm.com
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lsusb.txt
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070413/e985ad40/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070413/e985ad40/attachment.pgp>

From laurent.pinchart at skynet.be  Sat Apr 14 02:06:32 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 14 Apr 2007 02:06:32 +0200
Subject: [Linux-uvc-devel] Unsupported Camera: Pico iMage
In-Reply-To: <461EB7C9.6040703@anu.edu.au>
References: <461EB7C9.6040703@anu.edu.au>
Message-ID: <200704140206.33219.laurent.pinchart@skynet.be>

Hi Paul,

> Pico[1], iMage[2], distributed by: ecamm network[3]
>
> model number: PIKCU03W
>
> relevant dmesg  after connection (svn version of uvcvideo, revision 91) :
>
> [17192333.848000] usb 5-7: USB disconnect, address 8
> [17201221.900000] usb 5-8: new high speed USB device using ehci_hcd and
> address 9
> [17201222.044000] usb 5-8: configuration #1 chosen from 1 choice
> [17201222.044000] uvcvideo: Found UVC 1.00 device Pico iMage Webcam
> (18cd:cafe)
> [17201222.044000] uvcvideo: No valid video chain found.
>
> lsusb -v -d 18cd:cafe output attached.
>
> uname -a: Linux Rachel 2.6.17-11-generic #2 SMP Thu Feb 1 19:52:28 UTC
> 2007 i686 GNU/Linux
>
> ubuntu 6.10
>
>
> Anything else you need, feel free to email or respond to this post, I'm
> subscribed. Willing to help work on this, weekends Australian Time.

Let's try to get this working. Could you set the trace parameter to 65535 when 
loading the driver (modprobe uvcvideo trace=65535) before plugging the 
webcam ? I will then need the dmesg output.

Cheers,

Laurent Pinchart


From sam.revitch at gmail.com  Sat Apr 14 02:26:52 2007
From: sam.revitch at gmail.com (Sam Revitch)
Date: Fri, 13 Apr 2007 17:26:52 -0700
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <200704112253.28859.laurent.pinchart@skynet.be>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
	<200704112253.28859.laurent.pinchart@skynet.be>
Message-ID: <8d4807d50704131726l405d20fbr8b945ca726cbdda0@mail.gmail.com>

On 4/11/07, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
> Is there any known reason for that ? That sounds a bit against the UVC spec.

Laurent,

Thanks for your reply.

Good question.  I'd guess that Ricoh webcams have non-UVC controls
because the manufacturer couldn't fit the required functionality into
the limited code space.  Some of these controls (but no UVC controls)
support auto-adjustment -- Exposure/AEC, Component WB/AWB, Gain/AGC.
There is no reason for these devices to support control change events,
but there would be if the auto controls were UVC.

Realistically, for full support, the driver needs a hard-coded list of
non-UVC controls for each device, and of course needs to be able to
issue private non-UVC set commands for these controls.  It's unclear
how to fit this into uvcvideo's clean, orderly control model, and
seems like a relatively large device-specific concession for an
otherwise generic driver.

> Agreed. I'd rather go for the first solution.
>
> Can we discuss the issues you mentioned, as well as all other issues you can
> foresee ?

If uvcvideo had more complete frame buffer access methods, including
read and VIDIOCGMBUF, apps like camstream, motion, and wengophone
might work.

One way to do this would be to link uvcvideo against video-buf, and
implement a short VIDIOCGMBUF handler.

xawtv working would be another plus.

I also have a module used by r5u870 that takes care of common webcam
problems, called usbcam.  It handles device registration, file
operations, and V4L frame buffer access calls via video-buf.  It's
also the foundation for another driver under development for a more
exotic sq930b device.  I've been through many cycles tuning this
layer, listening to user complaints, tracing apps and figuring out how
to work around bugs, and refining its minidriver interface.  To try to
integrate it with uvcvideo would be interesting, and I'm willing to
adapt it to your liking.  This would be another way to fix the frame
buffer problems, and perhaps in a more reusable way.

> I'm still not sure if the firmware download operation should be handled by the
> driver or by a userspace utility. The fxload software from the usbutils
> package is meant to be called by the hotplug system. This would obviously be
> easier for the driver :-)
>
> Do all Ricoh devices advertise a different class and/or USB pid before and
> after loading the firmware ?

Indeed, so you started a big thread about this a few months ago.

Regarding the descriptor tables, the microcode and other volatile
state does not seem to have an effect on what is reported by Ricoh
webcam devices, so they don't behave like isight or ezusb devices.
This doesn't make it more difficult to do the microcode upload at user
level though -- the kernel driver must fail gracefully anyway when
probing a device without microcode, and a microcode uploader in this
case would have the additional problem of forcing the kernel driver to
re-probe the device, which isn't difficult.

I wrote up a prototype upload utility, including a solution for the
device re-probe problem, and tested it with my non-UVC camera.  This
utility should be enough to allow an unmodified uvcvideo to at least
grab frames from a Ricoh UVC camera.

There is little question that it is easier for the driver to outsource
microcode upload functions to a user level program.  Overall it sounds
much more complicated, because one must also create, maintain,
evangelize, and support a separate package.  If there is some other
reason that this sort of package must exist, fine, and if so, it might
be best to integrate the microcode upload functionality for as many
devices as possible into this package.

As for the other problems, the Ricoh cameras do appear to be evolving.
 Future models will probably follow the standard more completely and
do away with the non-UVC controls, and less device specific code might
be required of uvcvideo.  Where do you feel comfortable drawing the
line?

Thanks.
-Sam Revitch


From laurent.pinchart at skynet.be  Sat Apr 14 02:32:54 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 14 Apr 2007 02:32:54 +0200
Subject: [Linux-uvc-devel] Logitech Pro5000: uncompressed format
In-Reply-To: <904DEC693BE1AB429622C6F5ABA7E0B801CEDA00@is01ex02.ittiam.com>
References: <904DEC693BE1AB429622C6F5ABA7E0B801CEDA00@is01ex02.ittiam.com>
Message-ID: <200704140232.54616.laurent.pinchart@skynet.be>

Hi Pawan,

> I get the following error when I try Uncompressed video port.
> "uvcvideo: Failed to submit isoc URB 0 (-90)."
>
> I am using USB2.0 port.

Something seems to be wrong with the USB packet sizing logic. The function 
usb_submit_urb() in drivers/usb/core/urb.c return -EMSGSIZE. Are you familiar 
with C programming ? If so, can you patch your kernel to add various printk's 
in there ? I'd like to know what makes it return -EMSGSIZE (where does it 
return the value, what URB field makes a check fail, ...). Please check the 
psize value in uvc_init_video_isoc() (uvc_video.c) as well to make sure it is 
coherent.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Apr 14 03:03:13 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 14 Apr 2007 03:03:13 +0200
Subject: [Linux-uvc-devel] [PATCH] VIDIOC_[GS]_JPEGCOMP support
In-Reply-To: <EFE3E62A-C489-45B7-A4B2-B0E53E953AB3@federated.com>
References: <EFE3E62A-C489-45B7-A4B2-B0E53E953AB3@federated.com>
Message-ID: <200704140303.14434.laurent.pinchart@skynet.be>

Hi Jim,

> I had a sneaky suspicion my camera was stuck in top quality. Laurent
> Pinchart's comments from March 25th confirmed and were a nice
> blueprint for this patch.

First of all, thanks for the patch.

> Possible rough edges:
>
> -  I was unable to determine what the range of the
> v4l2_jpegcompression.quality field should be, so I chose 0-100 since
> that is familiar to users of JPEG, it is mapped to the allowed ranges
> of the device, respecting the resolution.

The documentation is pretty unclear on this. I'm fine with a fixed 0-100 range 
for now.

> -  I didn't really understand the privilege issues, so I copied the
> code from the VIDIOC_S_PARM, maybe the priv check should be removed.

The privilege code just makes sure that only a single user (application) can 
control streaming related parameters at a given time. Your patch is fine, 
except that it doesn't handle compression quality changes during streaming. 
As my code doesn't handle frame rates changes during streaming either, I 
can't blame you :-) I added this to my todo list.

> -  The code now defaults to the minimum quality instead of the
> maximum. This is an unfortunate effect of getting a 0 passed in the
> first time. There is a probably a good place to stick in a 10000 for
> the first probe somewhere in the startup code.

I'll have a look at that.

> - At the bottom of uvc_probe_video() where it tries to fall back to a
> lesser bandwidth mode (I think), I switched it to fall back to the
> minimum quality instead of the maximum.

The parameters negotiation code wasn't complete anyway. This is also something 
I need to fix.

> - It only supports the quality field of the ioctl, but I think that
> is appropriate.

Fine with me.

> - If the reported range and resolution would cause a divide by zero
> error in the computation we just take the maximum.
>
> - The "get" function returns the actual quality, not the requested. I
> think that is appropriate, it expose the granularity to the application.

Yes, that's appropriate. The "set" function should change the quality field as 
well to report the actual value.

> Now I can drop my 640x480 frames from 100+kb/frame to 25kb or so.

Great :-) I'll have a look at the code after this weekend, and commit the 
changes to SVN.

Thanks a lot for your patch.

Cheers,

Laurent Pinchart


From kyle.james.gibson at gmail.com  Sat Apr 14 04:57:41 2007
From: kyle.james.gibson at gmail.com (Kyle Gibson)
Date: Fri, 13 Apr 2007 22:57:41 -0400
Subject: [Linux-uvc-devel] Hi, how could I help?
Message-ID: <46204325.5050305@gmail.com>

Hi everyone,

I've got a Microsoft LifeCam NX 6000. I'm also running Windows XP in a 
virtual machine using VMware. I was wondering if anyone knew how I could 
get started in helping out the UVC project in supporting my cam?

Thank you,
Kyle


From rbrown1 at gmail.com  Sun Apr 15 18:44:58 2007
From: rbrown1 at gmail.com (Richard Brown)
Date: Sun, 15 Apr 2007 12:44:58 -0400
Subject: [Linux-uvc-devel] QC Pro 5000 with mythphone
Message-ID: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>

Hello.

I am trying to use a quickcam pro 5000 with mythphone for conferencing.  I
tested the driver with luvcview and it works ok (i.e., I can see local
video).  After using modprobe uvcvideo trace=15, I get the following output
in dmesg:

uvcvideo: Adding mapping Brightness to control 00000000-0000-0000-0000
-000000000101/2.
uvcvideo: Adding mapping Contrast to control
00000000-0000-0000-0000-000000000101/3.
uvcvideo: Adding mapping Hue to control
00000000-0000-0000-0000-000000000101/6.
uvcvideo: Adding mapping Saturation to control
00000000-0000-0000-0000-000000000101/7.
uvcvideo: Adding mapping Sharpness to control
00000000-0000-0000-0000-000000000101/8.
uvcvideo: Adding mapping Gamma to control
00000000-0000-0000-0000-000000000101/9.
uvcvideo: Adding mapping Backlight Compensation to control
00000000-0000-0000-0000-000000000101/1.
uvcvideo: Adding mapping Gain to control
00000000-0000-0000-0000-000000000101/4.
uvcvideo: Adding mapping Power Line Frequency to control
00000000-0000-0000-0000-000000000101/5.
uvcvideo: Adding mapping Hue, Auto to control
00000000-0000-0000-0000-000000000101/16.
uvcvideo: Adding mapping Pan (relative) to control
63610682-5070-49ab-b8cc-b3855e8d2256/1.
uvcvideo: Adding mapping Tilt (relative) to control
63610682-5070-49ab-b8cc-b3855e8d2256/1.
uvcvideo: Adding mapping Pan/Tilt (reset) to control
63610682-5070-49ab-b8cc-b3855e8d2256/2.
uvcvideo: Adding mapping Exposure, Auto to control
00000000-0000-0000-0000-000000000001/2.
uvcvideo: Adding mapping Exposure (Absolute) to control
00000000-0000-0000-0000-000000000001/4.
uvcvideo: Adding mapping White Balance Temperature, Auto to control
00000000-0000-0000-0000-000000000101/11.
uvcvideo: Adding mapping White Balance Temperature to control
00000000-0000-0000-0000-000000000101/10.
uvcvideo: Probing generic UVC device 2
uvcvideo: Found format MJPEG.
uvcvideo: - 160x120 (30.0 fps)
uvcvideo: - 176x144 (30.0 fps)
uvcvideo: - 320x240 (15.0 fps)
uvcvideo: - 352x288 (15.0 fps)
uvcvideo: - 640x480 ( 15.0 fps)
uvcvideo: Found format Uncompressed.
uvcvideo: - 160x120 (15.0 fps)
uvcvideo: - 176x144 (15.0 fps)
uvcvideo: Found a Status endpoint (addr 87).
uvcvideo: Found UVC 1.00 device <unnamed> (046d:08ce)
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/4 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000001/2 to device 2
entity 1
uvcvideo: Added control 00000000-0000-0000-0000-000000000001/4 to device 2
entity 1
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to device 2
entity 2
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to device 2
entity 2
uvcvideo: Scanning UVC chain: OT 5 (-> 12 8 10 11) <- Unit 4 (-> 13) <- Unit
3 <- Unit 2 <- IT 1
uvcvideo: Found a valid video chain (1 -> 5).
uvcvideo: UVC device initialized.
usbcore: registered new driver uvcvideo
USB Video Class driver (v0.1.0)

When I start mythphone, I get the following output in dmesg:

uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.
uvcvideo: Trying format 0x32315559 (YU12): 640x480.
uvcvideo: Unsupported format 0x32315559.
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.
uvcvideo: Trying format 0x50323234 (422P): 640x480.
uvcvideo: Unsupported format 0x50323234.
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.
uvcvideo: Trying format 0x33524742 (BGR3): 640x480.
uvcvideo: Unsupported format 0x33524742.
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
uvcvideo: Control 0x00980903 not found.
uvcvideo: Control 0x00980910 not found.

1. When compiling the driver I got an error with v4l_compat_ioctl32 (line
974), so I commented out this line.  Compiled ok without it.   Running
kernel 2.6.15.
2. My alsa audio appears to be broken.  Alsaconf fixes it, but I don't want
to have to run this after each boot.

Thanks very much for any help.
Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070415/f714e993/attachment.html>

From thoralf_schulze at yahoo.de  Sun Apr 15 20:12:06 2007
From: thoralf_schulze at yahoo.de (Thoralf Schulze)
Date: Sun, 15 Apr 2007 19:12:06 +0100 (BST)
Subject: [Linux-uvc-devel] QC Pro 5000 with mythphone
In-Reply-To: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>
Message-ID: <506232.98487.qm@web27215.mail.ukl.yahoo.com>

hi,

--- Richard Brown <rbrown1 at gmail.com> wrote:

> 2. My alsa audio appears to be broken.  Alsaconf
> fixes it, but I don't want
> to have to run this after each boot.

that's probably because alsa sets the web cam as
default sound device after it gets plugged in, which
is kinda stupid ... adding an index-option
/etc/modules/alsa.d should help, something like:

options snd-emu10k1 index=0

hope this helps,
thoralf.


      ___________________________________________________________ 
Yahoo! Mail is the world's favourite email. Don't settle for less, sign up for
your free account today http://uk.rd.yahoo.com/evt=44106/*http://uk.docs.yahoo.com/mail/winter07.html


From paul.warren at anu.edu.au  Mon Apr 16 03:10:58 2007
From: paul.warren at anu.edu.au (Paul Warren)
Date: Mon, 16 Apr 2007 11:10:58 +1000
Subject: [Linux-uvc-devel] Unsupported Camera: Pico iMage
In-Reply-To: <200704140206.33219.laurent.pinchart@skynet.be>
References: <461EB7C9.6040703@anu.edu.au>
	<200704140206.33219.laurent.pinchart@skynet.be>
Message-ID: <4622CD22.20304@anu.edu.au>

Laurent Pinchart wrote:
> Hi Paul,
> 
>> Pico[1], iMage[2], distributed by: ecamm network[3]
>>
>> model number: PIKCU03W
>>
>> relevant dmesg  after connection (svn version of uvcvideo, revision 91) :
>>
>> [17192333.848000] usb 5-7: USB disconnect, address 8
>> [17201221.900000] usb 5-8: new high speed USB device using ehci_hcd and
>> address 9
>> [17201222.044000] usb 5-8: configuration #1 chosen from 1 choice
>> [17201222.044000] uvcvideo: Found UVC 1.00 device Pico iMage Webcam
>> (18cd:cafe)
>> [17201222.044000] uvcvideo: No valid video chain found.
>>
>> lsusb -v -d 18cd:cafe output attached.
>>
>> uname -a: Linux Rachel 2.6.17-11-generic #2 SMP Thu Feb 1 19:52:28 UTC
>> 2007 i686 GNU/Linux
>>
>> ubuntu 6.10
>>
>>
>> Anything else you need, feel free to email or respond to this post, I'm
>> subscribed. Willing to help work on this, weekends Australian Time.
> 
> Let's try to get this working. Could you set the trace parameter to 65535 when 
> loading the driver (modprobe uvcvideo trace=65535) before plugging the 
> webcam ? I will then need the dmesg output.
> 
> Cheers,
> 
> Laurent Pinchart


I'll get on to this in a few hours, after work.  Had some interesting
times with more misconfiguration of email clients, so have only received
this today (mon apr 16).

Cheers
-- 
Paul Warren
ANUSF Data Intensive Projects
Rm 335, Leonard Huxley Building
56 Mills Rd.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070416/6c42dad2/attachment.pgp>

From laurent.pinchart at skynet.be  Mon Apr 16 23:17:47 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 16 Apr 2007 23:17:47 +0200
Subject: [Linux-uvc-devel] QC Pro 5000 with mythphone
In-Reply-To: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>
References: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>
Message-ID: <200704162317.47867.laurent.pinchart@skynet.be>

Hi Richard,

> I am trying to use a quickcam pro 5000 with mythphone for conferencing.  I
> tested the driver with luvcview and it works ok (i.e., I can see local
> video).  After using modprobe uvcvideo trace=15, I get the following output
> in dmesg:
[snip]
> uvcvideo: Found a valid video chain (1 -> 5).
> uvcvideo: UVC device initialized.
> usbcore: registered new driver uvcvideo
> USB Video Class driver (v0.1.0)

Seems pretty normal so far.

> When I start mythphone, I get the following output in dmesg:
>
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
> uvcvideo: Trying format 0x32315559 (YU12): 640x480.
> uvcvideo: Unsupported format 0x32315559.

No worries there. Mythphone tries a few formats to find out which are 
supported.

> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
> uvcvideo: Trying format 0x50323234 (422P): 640x480.
> uvcvideo: Unsupported format 0x50323234.
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
> uvcvideo: Trying format 0x33524742 (BGR3): 640x480.
> uvcvideo: Unsupported format 0x33524742.
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 66666.6 us (15.0 fps).
> uvcvideo: Control 0x00980903 not found.
> uvcvideo: Control 0x00980910 not found.
>
> 1. When compiling the driver I got an error with v4l_compat_ioctl32 (line
> 974), so I commented out this line.  Compiled ok without it.   Running
> kernel 2.6.15.

Thanks for the report. I committed a fix to SVN for Linux 2.6.15 and earlier.

> 2. My alsa audio appears to be broken.  Alsaconf fixes it, but I don't want
> to have to run this after each boot.

This has nothing to do with the Linux UVC driver. The audio device is handled 
by the USB audio ALSA driver. Thoralf Schulze mentionned a way to fix your 
problem.

> Thanks very much for any help.

If you want help, you'll have to tell us what goes wrong with mythphone :-)

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr 16 23:34:21 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 16 Apr 2007 23:34:21 +0200
Subject: [Linux-uvc-devel] Hi, how could I help?
In-Reply-To: <46204325.5050305@gmail.com>
References: <46204325.5050305@gmail.com>
Message-ID: <200704162334.22242.laurent.pinchart@skynet.be>

Hi Kyle,

> I've got a Microsoft LifeCam NX 6000. I'm also running Windows XP in a
> virtual machine using VMware. I was wondering if anyone knew how I could
> get started in helping out the UVC project in supporting my cam?

First of all, please try the attached patch. If it doesn't work, raise the 
driver trace level to 255 (or even 65535) and have a look at the dmesg 
output.

Best regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lifecam.patch
Type: text/x-diff
Size: 689 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070416/cbda8e4b/attachment.patch>

From kyle.james.gibson at gmail.com  Tue Apr 17 00:09:06 2007
From: kyle.james.gibson at gmail.com (Kyle Gibson)
Date: Mon, 16 Apr 2007 18:09:06 -0400
Subject: [Linux-uvc-devel] Hi, how could I help?
In-Reply-To: <200704162334.22242.laurent.pinchart@skynet.be>
References: <46204325.5050305@gmail.com>
	<200704162334.22242.laurent.pinchart@skynet.be>
Message-ID: <4623F402.4050803@gmail.com>

Hi Laurent,

I did what you suggested. Attached is the resulting dmesg output with 
trace raised to 65535.

Have a good day!

Kyle

Laurent Pinchart wrote:
> Hi Kyle,
> 
>> I've got a Microsoft LifeCam NX 6000. I'm also running Windows XP in a
>> virtual machine using VMware. I was wondering if anyone knew how I could
>> get started in helping out the UVC project in supporting my cam?
> 
> First of all, please try the attached patch. If it doesn't work, raise the 
> driver trace level to 255 (or even 65535) and have a look at the dmesg 
> output.
> 
> Best regards,
> 
> Laurent Pinchart
> 
> 
> ------------------------------------------------------------------------
> 
> Index: uvc_driver.c
> ===================================================================
> --- uvc_driver.c	(revision 89)
> +++ uvc_driver.c	(working copy)
> @@ -1353,6 +1353,15 @@
>   * though they are compliant.
>   */
>  static struct usb_device_id uvc_ids[] = {
> +	/* Microsoft Lifecam NX-6000 */
> +	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
> +				| USB_DEVICE_ID_MATCH_INT_INFO,
> +	  .idVendor		= 0x045e,
> +	  .idProduct		= 0x00f8,
> +	  .bInterfaceClass	= USB_CLASS_VENDOR_SPEC,
> +	  .bInterfaceSubClass	= 1,
> +	  .bInterfaceProtocol	= 0,
> +	  .driver_info		= UVC_QUIRK_PROBE_MINMAX },
>  	/* Logitech Quickcam Fusion */
>  	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
>  				| USB_DEVICE_ID_MATCH_INT_INFO,
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg.log
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070416/8d43d1dd/attachment.ksh>

From rbrown1 at gmail.com  Tue Apr 17 03:13:19 2007
From: rbrown1 at gmail.com (Richard Brown)
Date: Mon, 16 Apr 2007 21:13:19 -0400
Subject: [Linux-uvc-devel] QC Pro 5000 with mythphone
In-Reply-To: <200704162317.47867.laurent.pinchart@skynet.be>
References: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>
	<200704162317.47867.laurent.pinchart@skynet.be>
Message-ID: <9e95825e0704161813t2f956961ic8fa3df182433993@mail.gmail.com>

> Thanks for the report. I committed a fix to SVN for Linux 2.6.15 and earlier.

Thanks Laurent.  Compilation error fixed.

> This has nothing to do with the Linux UVC driver. The audio device is handled
> by the USB audio ALSA driver. Thoralf Schulze mentionned a way to fix your
> problem.

Thanks Thoralf.   I have not tried the index fix yet, but it seems
like a good idea.

> If you want help, you'll have to tell us what goes wrong with mythphone :-)

Well, it does not work :)  I tried it again after recompiling and
loading the latest version of uvcvideo.  Evidently, it tries a few
formats, but it does not display any video.  I am not sure if audio is
working.  It should display a local video window when the application
starts, but I do not see anything.  mythphone has a few settings for
capture resolution (160x120, 128x96, 704x576, 640x480, 352x288,
320x240, 176x144).  It does not seem to matter which one I
select--still no video.  I have the QC Pro 5000 connected to a USB 1.1
port so I have been trying the smaller resolutions.

Thanks,
Richard


From enzymatic.bubble at gmail.com  Tue Apr 17 10:00:55 2007
From: enzymatic.bubble at gmail.com (Aaron Miller)
Date: Tue, 17 Apr 2007 01:00:55 -0700
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
Message-ID: <784c98190704170100i766efbax767b41720f508560@mail.gmail.com>

Hello,

I got the latest version from subversion about an hour ago. It compiled and
installed fine, but it doesn't seem to recognize my quickcam beyond knowing
it's a UVC device. Here are the
relevant lines from dmesg:

[17206689.184000] usb 4-4.2: new high speed USB device using ehci_hcd and
address 11
[17206689.432000] usb 4-4.2: configuration #1 chosen from 1 choice
[17206689.432000] uvcvideo: Found UVC 1.00 device <unnamed> (046d:08cb)

Udev created a /dev/video and /dev/video0, but camorama says "could not
connect to video device (/dev/video0)."  Is there a simple way to fix this,
or is the support simply unwritten?

Thanks in advance,

Aaron Miller
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070417/e0ab159d/attachment.html>

From laurent.pinchart at skynet.be  Tue Apr 17 10:29:59 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 17 Apr 2007 10:29:59 +0200
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
In-Reply-To: <784c98190704170100i766efbax767b41720f508560@mail.gmail.com>
References: <784c98190704170100i766efbax767b41720f508560@mail.gmail.com>
Message-ID: <200704171029.59562.laurent.pinchart@skynet.be>

Hi Aaron,

> I got the latest version from subversion about an hour ago. It compiled and
> installed fine, but it doesn't seem to recognize my quickcam beyond knowing
> it's a UVC device. Here are the
> relevant lines from dmesg:
>
> [17206689.184000] usb 4-4.2: new high speed USB device using ehci_hcd and
> address 11
> [17206689.432000] usb 4-4.2: configuration #1 chosen from 1 choice
> [17206689.432000] uvcvideo: Found UVC 1.00 device <unnamed> (046d:08cb)
>
> Udev created a /dev/video and /dev/video0, but camorama says "could not
> connect to video device (/dev/video0)."  Is there a simple way to fix this,
> or is the support simply unwritten?

Camorama is at fault. It only supports the deprecated V4L1 interface, while 
the driver implements V4L2.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 17 22:35:48 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 17 Apr 2007 22:35:48 +0200
Subject: [Linux-uvc-devel] QC Pro 5000 with mythphone
In-Reply-To: <9e95825e0704161813t2f956961ic8fa3df182433993@mail.gmail.com>
References: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>
	<200704162317.47867.laurent.pinchart@skynet.be>
	<9e95825e0704161813t2f956961ic8fa3df182433993@mail.gmail.com>
Message-ID: <200704172235.49254.laurent.pinchart@skynet.be>

Hi Richard,

> > Thanks for the report. I committed a fix to SVN for Linux 2.6.15 and
> > earlier.
>
> Thanks Laurent.  Compilation error fixed.
>
> > This has nothing to do with the Linux UVC driver. The audio device is
> > handled by the USB audio ALSA driver. Thoralf Schulze mentionned a way to
> > fix your problem.
>
> Thanks Thoralf.   I have not tried the index fix yet, but it seems
> like a good idea.
>
> > If you want help, you'll have to tell us what goes wrong with mythphone
> > :-)
>
> Well, it does not work :)  I tried it again after recompiling and
> loading the latest version of uvcvideo.  Evidently, it tries a few
> formats, but it does not display any video.  I am not sure if audio is
> working.  It should display a local video window when the application
> starts, but I do not see anything.  mythphone has a few settings for
> capture resolution (160x120, 128x96, 704x576, 640x480, 352x288,
> 320x240, 176x144).  It does not seem to matter which one I
> select--still no video.  I have the QC Pro 5000 connected to a USB 1.1
> port so I have been trying the smaller resolutions.

Does mythphone report any error ? Try to start it in a console, it might use 
stdout/stderr for debugging. You can also set the trace level to 65535 to get 
more information from the driver. Have a look at the kernel log then to see 
if something goes wrong.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 17 22:40:03 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 17 Apr 2007 22:40:03 +0200
Subject: [Linux-uvc-devel] Hi, how could I help?
In-Reply-To: <4623F402.4050803@gmail.com>
References: <46204325.5050305@gmail.com>
	<200704162334.22242.laurent.pinchart@skynet.be>
	<4623F402.4050803@gmail.com>
Message-ID: <200704172240.03561.laurent.pinchart@skynet.be>

> I did what you suggested. Attached is the resulting dmesg output with
> trace raised to 65535.

Oops, my bad, the patch I sent you was wrong. Could you please try the 
attached patch ?

Thanks.

Best regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lifecam.patch
Type: text/x-diff
Size: 683 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070417/fb6c9ffa/attachment.patch>

From enzymatic.bubble at gmail.com  Tue Apr 17 23:59:41 2007
From: enzymatic.bubble at gmail.com (Aaron Miller)
Date: Tue, 17 Apr 2007 14:59:41 -0700
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
In-Reply-To: <200704171029.59562.laurent.pinchart@skynet.be>
References: <784c98190704170100i766efbax767b41720f508560@mail.gmail.com>
	<200704171029.59562.laurent.pinchart@skynet.be>
Message-ID: <784c98190704171459g53d4aa09l98a6834c4874c269@mail.gmail.com>

>
> > Udev created a /dev/video and /dev/video0, but camorama says "could not
> > connect to video device (/dev/video0)."  Is there a simple way to fix
> this,
> > or is the support simply unwritten?
>
> Camorama is at fault. It only supports the deprecated V4L1 interface,
> while
> the driver implements V4L2.


I also tried xawtv. It had no problem connecting to /dev/video0, however it
displayed a black screen.

--Aaron Miller
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070417/5e3f29f1/attachment.html>

From christophe.gisquet at free.fr  Wed Apr 18 19:33:43 2007
From: christophe.gisquet at free.fr (christophe.gisquet at free.fr)
Date: Wed, 18 Apr 2007 19:33:43 +0200
Subject: [Linux-uvc-devel] Capturing raw video from 2 USB2.0 webcams
	(was: Divide by 0 in uvcvideo module with 2 webcams plugged)
In-Reply-To: <200703021016.29522.laurent.pinchart@skynet.be>
References: <1172154855.45dda9e781e3c@imp.free.fr>
	<200702231406.08783.laurent.pinchart@skynet.be>
	<1172768921.45e7089937887@imp.free.fr>
	<200703021016.29522.laurent.pinchart@skynet.be>
Message-ID: <1176917623.46265677bb2ee@imp.free.fr>

Sorry for the late reply. Meanwhile, kernel was upgraded to 2.6.20.6.

Selon Laurent Pinchart <laurent.pinchart at skynet.be>:
> > uvcvideo: Failed to submit isoc URB 0 (-28).
>
> -28 is -ENOSPC, which means the driver can't allocate USB bandwidth.

This is stunningly right. Even with the protocol overhead, the exact port and
webcam specifications, I wouldn't have thought that 2 streams each of around
14.7MB/s could saturate it.

> There's not much I can do here. Two webcams at high resolutions in
> uncompressed mode exceed the USB bandwidth. Could you try using the MJPEG
> format ?

I've rather tested by reducing the framerate of any of those from 25 to 15 fps,
and the 2 webcams were able to stream. So indeed, you were right in that USB2.0
bandwidth is the limiting factor here.

During that test (640x480, YUY2), reducing the framerate of a Logitech Pro 5000
to 15 fps yielded packet drops (due to error bit being set). Is this a bug, or
such phenomenon is obvious? I'm not very confident on what is reported by the
driver/webcam, because:
1) For Logitech QC Pro for Notebooks, reports uncompressed 640x480 at 15fps while
happily capturing at 30fps
2) For QC Pro 5000, reports and manages uncompressed 640x480 at 30fps

Thanks and best regards,
Christophe GISQUET


From laurent.pinchart at skynet.be  Wed Apr 18 21:02:01 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 18 Apr 2007 21:02:01 +0200
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
In-Reply-To: <784c98190704171459g53d4aa09l98a6834c4874c269@mail.gmail.com>
References: <784c98190704170100i766efbax767b41720f508560@mail.gmail.com>
	<200704171029.59562.laurent.pinchart@skynet.be>
	<784c98190704171459g53d4aa09l98a6834c4874c269@mail.gmail.com>
Message-ID: <200704182102.02083.laurent.pinchart@skynet.be>

Hi Aaron,

> > > Udev created a /dev/video and /dev/video0, but camorama says "could not
> > > connect to video device (/dev/video0)."  Is there a simple way to fix
> > > this, or is the support simply unwritten?
> >
> > Camorama is at fault. It only supports the deprecated V4L1 interface,
> > while the driver implements V4L2.
>
> I also tried xawtv. It had no problem connecting to /dev/video0, however it
> displayed a black screen.

Well, xawtv isn't known to work with the driver either :-/ Could you try 
luvcview or ekiga ?

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 18 22:19:31 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 18 Apr 2007 22:19:31 +0200
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <8d4807d50704131726l405d20fbr8b945ca726cbdda0@mail.gmail.com>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
	<200704112253.28859.laurent.pinchart@skynet.be>
	<8d4807d50704131726l405d20fbr8b945ca726cbdda0@mail.gmail.com>
Message-ID: <200704182219.32086.laurent.pinchart@skynet.be>

Hi Sam,

> > Is there any known reason for that ? That sounds a bit against the UVC
> > spec.
>
> Thanks for your reply.
>
> Good question.  I'd guess that Ricoh webcams have non-UVC controls
> because the manufacturer couldn't fit the required functionality into
> the limited code space.  Some of these controls (but no UVC controls)
> support auto-adjustment -- Exposure/AEC, Component WB/AWB, Gain/AGC.
> There is no reason for these devices to support control change events,
> but there would be if the auto controls were UVC.

:-/

> Realistically, for full support, the driver needs a hard-coded list of
> non-UVC controls for each device, and of course needs to be able to
> issue private non-UVC set commands for these controls.  It's unclear
> how to fit this into uvcvideo's clean, orderly control model, and
> seems like a relatively large device-specific concession for an
> otherwise generic driver.

I've got to agree with you there...

> > Agreed. I'd rather go for the first solution.
> >
> > Can we discuss the issues you mentioned, as well as all other issues you
> > can foresee ?
>
> If uvcvideo had more complete frame buffer access methods, including
> read and VIDIOCGMBUF, apps like camstream, motion, and wengophone
> might work.

VIDIOCGMBUF is part of the deprecated V4L1 API. Applications should be ported 
to V4L2. Adding V4L1 support is not planned.

> One way to do this would be to link uvcvideo against video-buf, and
> implement a short VIDIOCGMBUF handler.

uvcvideo already implements full buffer management. The streaming I/O V4L2 
method is fully supported. I might consider using video-buf later, although 
there are a few things I don't like in the API (especially the way video-buf 
insists on handling streamon/streamoff itself). VIDIOCGMBUF support isn't 
planned.

> xawtv working would be another plus.

xawtv should support V4L2. I'll have to debug it sometimes to find out if the 
issue lies in the application or in the driver.

> I also have a module used by r5u870 that takes care of common webcam
> problems, called usbcam.  It handles device registration, file
> operations, and V4L frame buffer access calls via video-buf.  It's
> also the foundation for another driver under development for a more
> exotic sq930b device.  I've been through many cycles tuning this
> layer, listening to user complaints, tracing apps and figuring out how
> to work around bugs, and refining its minidriver interface.  To try to
> integrate it with uvcvideo would be interesting, and I'm willing to
> adapt it to your liking.  This would be another way to fix the frame
> buffer problems, and perhaps in a more reusable way.

Once again, there are no frame buffer problems, only application problems :-) 
An approach to using V4L1 applications with the driver would be to write a 
LD_PRELOAD'able shared object that would intercept V4L1 calls and translate 
them into V4L2 calls.

usbcam sounds interesting. Porting uvcvideo to usbcam would be lots of work, 
and I'm not willing to do that for now. Feel free to give it a go though :-) 
Don't forget that the uvcvideo driver is quite complex, and that it will 
eventually support video output as well, which falls out of the scope of 
usbcam. You might have issues with control handling which is being rewritten 
to allow for runtime controls definitions through specific ioctls. The 
extended control API will also have to be implemented by usbcam, and the mini 
drivers API will have to support control transactions. usbcam also seems to 
be missing proper multiple open support. Two applications opening the same 
device shouldn't be able to call VIDIOC_DQBUF for instance, or to mess with 
each other's streaming parameters.

On a side note, you should split usbcam into several files. It will be easier 
to read the code.

Do you plan to submit usbcam to the kernel ? Do you think current USB drivers 
could be ported ? One of the main issues is that developers might not be 
willing to throw away most of the code they wrote.

Are you aware that Mauro (the V4L2 maintainer) is trying to move ioctl 
handling to the V4L2 layer, which is the first step to a mini driver 
approach ? It seems to me that V4L2 is undergoing some major changes, and I'm 
not sure to be happy with them. If we indeed decide that some operations 
(such as buffer management) should be handled by generic code, this should be 
discussed first on the video4linux mailing list.

> > I'm still not sure if the firmware download operation should be handled
> > by the driver or by a userspace utility. The fxload software from the
> > usbutils package is meant to be called by the hotplug system. This would
> > obviously be easier for the driver :-)
> >
> > Do all Ricoh devices advertise a different class and/or USB pid before
> > and after loading the firmware ?
>
> Indeed, so you started a big thread about this a few months ago.
>
> Regarding the descriptor tables, the microcode and other volatile
> state does not seem to have an effect on what is reported by Ricoh
> webcam devices, so they don't behave like isight or ezusb devices.
> This doesn't make it more difficult to do the microcode upload at user
> level though -- the kernel driver must fail gracefully anyway when
> probing a device without microcode, and a microcode uploader in this
> case would have the additional problem of forcing the kernel driver to
> re-probe the device, which isn't difficult.

Is it possible to simulate device unplugging/replugging from userspace to 
force the USB stack to reenumerate the device ?

> I wrote up a prototype upload utility, including a solution for the
> device re-probe problem, and tested it with my non-UVC camera.  This
> utility should be enough to allow an unmodified uvcvideo to at least
> grab frames from a Ricoh UVC camera.

I assume the firmware loading requests are not compatible with ezusb chips, so 
fxload can't do the job. Is that right ?

> There is little question that it is easier for the driver to outsource
> microcode upload functions to a user level program.  Overall it sounds
> much more complicated, because one must also create, maintain,
> evangelize, and support a separate package.  If there is some other
> reason that this sort of package must exist, fine, and if so, it might
> be best to integrate the microcode upload functionality for as many
> devices as possible into this package.

It could be included in the kernel instead, but it would then have to be a 
generic microcode loader usable by several drivers.

> As for the other problems, the Ricoh cameras do appear to be evolving.
>  Future models will probably follow the standard more completely and
> do away with the non-UVC controls, and less device specific code might
> be required of uvcvideo.  Where do you feel comfortable drawing the
> line?

I don't mind adding a few quirks to the uvcvideo driver. Support for non-UVC 
controls is a bit more intrusive though.

Other ways to support those hybrid devices would be to add hooks to uvcvideo 
or implement a minidriver interface like the one you wrote for usbcam.

Best regards,

Laurent Pinchart


From rbrown1 at gmail.com  Thu Apr 19 03:17:55 2007
From: rbrown1 at gmail.com (Richard Brown)
Date: Wed, 18 Apr 2007 21:17:55 -0400
Subject: [Linux-uvc-devel] QC Pro 5000 with mythphone
In-Reply-To: <200704172235.49254.laurent.pinchart@skynet.be>
References: <9e95825e0704150944g40938224y1b713bbf70da2350@mail.gmail.com>
	<200704162317.47867.laurent.pinchart@skynet.be>
	<9e95825e0704161813t2f956961ic8fa3df182433993@mail.gmail.com>
	<200704172235.49254.laurent.pinchart@skynet.be>
Message-ID: <9e95825e0704181817y2e9f9f9as4c6f17a008fd9f41@mail.gmail.com>

Hi Laurent,

> Does mythphone report any error ? Try to start it in a console, it might use
> stdout/stderr for debugging. You can also set the trace level to 65535 to get
> more information from the driver. Have a look at the kernel log then to see
> if something goes wrong.

In the console, mythphone reports the following error:
"Webcam does not support YUV420P, YUV422P, or RGB24 modes; these are
the only ones currently supported.  Closing webcam.
Can't close a camera that isn't open."

Does the QC Pro 5000 support one of these formats?  I attached a
kernel log at trace level 65535 in case that helps.

Thanks,
Richard
-------------- next part --------------
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Brightness to control
00000000-0000-0000-0000-000000000101/2.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Contrast to control 00
000000-0000-0000-0000-000000000101/3.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Hue to control 0000000
0-0000-0000-0000-000000000101/6.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Saturation to control
00000000-0000-0000-0000-000000000101/7.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Sharpness to control 0
0000000-0000-0000-0000-000000000101/8.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Gamma to control 00000
000-0000-0000-0000-000000000101/9.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Backlight Compensation
 to control 00000000-0000-0000-0000-000000000101/1.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Gain to control 000000
00-0000-0000-0000-000000000101/4.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Power Line Frequency t
o control 00000000-0000-0000-0000-000000000101/5.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Hue, Auto to control 0
0000000-0000-0000-0000-000000000101/16.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Pan (relative) to cont
rol 63610682-5070-49ab-b8cc-b3855e8d2256/1.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Tilt (relative) to con
trol 63610682-5070-49ab-b8cc-b3855e8d2256/1.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Pan/Tilt (reset) to co
ntrol 63610682-5070-49ab-b8cc-b3855e8d2256/2.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Exposure, Auto to cont
rol 00000000-0000-0000-0000-000000000001/2.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping Exposure (Absolute) to
 control 00000000-0000-0000-0000-000000000001/4.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping White Balance Temperat
ure, Auto to control 00000000-0000-0000-0000-000000000101/11.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Adding mapping White Balance Temperat
ure to control 00000000-0000-0000-0000-000000000101/10.
Apr 18 21:10:08 gardenia kernel: uvcvideo: Probing generic UVC device 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Found format MJPEG.
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 160x120 (30.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 176x144 (30.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 320x240 (15.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 352x288 (15.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 640x480 (15.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: Found format Uncompressed.
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 160x120 (15.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: - 176x144 (15.0 fps)
Apr 18 21:10:08 gardenia kernel: uvcvideo: Found a Status endpoint (addr 87).
Apr 18 21:10:08 gardenia kernel: uvcvideo: Found UVC 1.00 device <unnamed> (046d
:08ce)
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/2 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/3 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/7 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/8 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/1 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/4 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/5 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000001/2 to device 2 entity 1
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000001/4 to device 2 entity 1
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/11 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Added control 00000000-0000-0000-0000
-000000000101/10 to device 2 entity 2
Apr 18 21:10:08 gardenia kernel: uvcvideo: Scanning UVC chain: OT 5 (-> 12 8 10
11) <- Unit 4 (-> 13) <- Unit 3 <- Unit 2 <- IT 1
Apr 18 21:10:08 gardenia kernel: uvcvideo: Found a valid video chain (1 -> 5).
Apr 18 21:10:08 gardenia kernel: uvcvideo: UVC device initialized.
Apr 18 21:10:08 gardenia kernel: usbcore: registered new driver uvcvideo
Apr 18 21:10:08 gardenia kernel: USB Video Class driver (v0.1.0)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_open
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x803c7601 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0x80685600 (VIDIOC_QUERYCAP)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0405602 (VIDIOC_ENUM_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5640 (VIDIOC_TRY_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x47504a4d (MJPG): 1000
0x10000.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Using default frame interval 66666.6
us (15.0 fps).
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x80207609 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x800e7606 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x400e7607 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5605 (VIDIOC_S_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x32315559 (YU12): 640x
480.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unsupported format 0x32315559.
Apr 18 21:10:45 gardenia kernel: ioctl 0x802c560a (VIDIOC_G_FBUF)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unknown ioctl 0x802c560a
Apr 18 21:10:45 gardenia kernel: ioctl 0x402c560b (VIDIOC_S_FBUF)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unknown ioctl 0x402c560b
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x803c7601 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0x80685600 (VIDIOC_QUERYCAP)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0405602 (VIDIOC_ENUM_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5640 (VIDIOC_TRY_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x47504a4d (MJPG): 1000
0x10000.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Using default frame interval 66666.6
us (15.0 fps).
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x80207609 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x800e7606 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x400e7607 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5605 (VIDIOC_S_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x50323234 (422P): 640x
480.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unsupported format 0x50323234.
Apr 18 21:10:45 gardenia kernel: ioctl 0x802c560a (VIDIOC_G_FBUF)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unknown ioctl 0x802c560a
Apr 18 21:10:45 gardenia kernel: ioctl 0x402c560b (VIDIOC_S_FBUF)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unknown ioctl 0x402c560b
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x803c7601 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0x80685600 (VIDIOC_QUERYCAP)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0405602 (VIDIOC_ENUM_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5640 (VIDIOC_TRY_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x47504a4d (MJPG): 1000
0x10000.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Using default frame interval 66666.6
us (15.0 fps).
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x80207609 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x800e7606 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x400e7607 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561c (VIDIOC_S_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5605 (VIDIOC_S_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x33524742 (BGR3): 640x
480.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unsupported format 0x33524742.
Apr 18 21:10:45 gardenia kernel: ioctl 0x802c560a (VIDIOC_G_FBUF)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unknown ioctl 0x802c560a
Apr 18 21:10:45 gardenia kernel: ioctl 0x402c560b (VIDIOC_S_FBUF)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Unknown ioctl 0x402c560b
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x803c7601 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0x80685600 (VIDIOC_QUERYCAP)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc04c561a (VIDIOC_ENUMINPUT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0405602 (VIDIOC_ENUM_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5640 (VIDIOC_TRY_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Trying format 0x47504a4d (MJPG): 1000
0x10000.
Apr 18 21:10:45 gardenia kernel: uvcvideo: Using default frame interval 66666.6
us (15.0 fps).
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x80207609 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_ioctl
Apr 18 21:10:45 gardenia kernel: ioctl 0x800e7606 (V4L1)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980903 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc008561b (VIDIOC_G_CTRL)
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0445624 (VIDIOC_QUERYCTRL)
Apr 18 21:10:45 gardenia kernel: uvcvideo: Control 0x00980910 not found.
Apr 18 21:10:45 gardenia kernel: ioctl 0xc0cc5604 (VIDIOC_G_FMT)
Apr 18 21:10:45 gardenia kernel: uvcvideo: uvc_v4l2_release

From henrik.frisk at mhm.lu.se  Thu Apr 19 10:22:16 2007
From: henrik.frisk at mhm.lu.se (Henrik Frisk)
Date: Thu, 19 Apr 2007 10:22:16 +0200
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
In-Reply-To: <200704182102.02083.laurent.pinchart@skynet.be> 
References: <200704182102.02083.laurent.pinchart@skynet.be>
Message-ID: <3446.1176970936@henrikfrisk.com>

Hi Aaron,

> Hi Aaron,
> 
> > > > Udev created a /dev/video and /dev/video0, but camorama says "could not
> > > > connect to video device (/dev/video0)."  Is there a simple way to fix
> > > > this, or is the support simply unwritten?
> > >
> > > Camorama is at fault. It only supports the deprecated V4L1 interface,
> > > while the driver implements V4L2.
> >
> > I also tried xawtv. It had no problem connecting to /dev/video0, however it
> > displayed a black screen.
> 
> Well, xawtv isn't known to work with the driver either :-/ Could you try 
> luvcview or ekiga ?
> 
I have this camera with FC5 and the uvc driver and it works like a charm
with luvcview and ekiga.

/Henrik Frisk


From arne at unicap-imaging.org  Thu Apr 19 11:19:06 2007
From: arne at unicap-imaging.org (Arne Caspari)
Date: Thu, 19 Apr 2007 11:19:06 +0200
Subject: [Linux-uvc-devel] Exposure CID
Message-ID: <1176974347.6697.19.camel@localhost>

Hello, 

I see in the driver that the exposure property got a CID in the private
range ( V4L2_CID_PRIVATE_BASE+11 ) instead of V4L2_CID_EXPOSURE. Can
anyone tell me the reasoning behind this? 

This way applications need to know of the private properties just to
change exposure. Unaware applications would hardly be able to work with
a camera offering exposure. 

Thanks, 

 /Arne




From arne at unicap-imaging.org  Thu Apr 19 13:14:00 2007
From: arne at unicap-imaging.org (Arne Caspari)
Date: Thu, 19 Apr 2007 13:14:00 +0200
Subject: [Linux-uvc-devel] Hi, how could I help?
In-Reply-To: <200704172240.03561.laurent.pinchart@skynet.be>
References: <46204325.5050305@gmail.com>
	<200704162334.22242.laurent.pinchart@skynet.be>
	<4623F402.4050803@gmail.com>
	<200704172240.03561.laurent.pinchart@skynet.be>
Message-ID: <1176981240.6697.25.camel@localhost>

Please also try this small patch. 

It fixes an issue where the driver does not read the correct number of
input pins.

 /Arne

On Tue, 2007-04-17 at 22:40 +0200, Laurent Pinchart wrote:
> > I did what you suggested. Attached is the resulting dmesg output with
> > trace raised to 65535.
> 
> Oops, my bad, the patch I sent you was wrong. Could you please try the 
> attached patch ?
> 
> Thanks.
> 
> Best regards,
> 
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
-------------- next part --------------
A non-text attachment was scrubbed...
Name: selector_unit.patch
Type: text/x-patch
Size: 442 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070419/ee945959/attachment.bin>

From laurent.pinchart at skynet.be  Thu Apr 19 13:24:20 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Thu, 19 Apr 2007 13:24:20 +0200
Subject: [Linux-uvc-devel] Hi, how could I help?
In-Reply-To: <1176981240.6697.25.camel@localhost>
References: <46204325.5050305@gmail.com>
	<200704172240.03561.laurent.pinchart@skynet.be>
	<1176981240.6697.25.camel@localhost>
Message-ID: <200704191324.21341.laurent.pinchart@skynet.be>

> Please also try this small patch.
>
> It fixes an issue where the driver does not read the correct number of
> input pins.

Applied. Thanks.

Laurent Pinchart


From ranjan.grover at gmail.com  Thu Apr 19 14:17:12 2007
From: ranjan.grover at gmail.com (Ranjan Grover)
Date: Thu, 19 Apr 2007 08:17:12 -0400
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
In-Reply-To: <3446.1176970936@henrikfrisk.com>
References: <200704182102.02083.laurent.pinchart@skynet.be>
	<3446.1176970936@henrikfrisk.com>
Message-ID: <ed5bd5060704190517r7f67a51ci2d39cb306f2135de@mail.gmail.com>

> I have this camera with FC5 and the uvc driver and it works like a charm
> with luvcview and ekiga.

I also have this camera running fine in Debian/sid using ekiga. It
doesn't work with Kopete yet because of a broken v4l2 interface in
kopete. If you're running Debian or ubuntu you can get the
linux-uvc-source package and install it using module assistant after
untarring the source.

$ tar -xvjf linux-uvc-source
$ module-assistant a-i linux-uvc

Ranjan


From enzymatic.bubble at gmail.com  Thu Apr 19 23:30:19 2007
From: enzymatic.bubble at gmail.com (Aaron Miller)
Date: Thu, 19 Apr 2007 14:30:19 -0700
Subject: [Linux-uvc-devel] Logitech Quickcam Notebook Pro
In-Reply-To: <ed5bd5060704190517r7f67a51ci2d39cb306f2135de@mail.gmail.com>
References: <200704182102.02083.laurent.pinchart@skynet.be>
	<3446.1176970936@henrikfrisk.com>
	<ed5bd5060704190517r7f67a51ci2d39cb306f2135de@mail.gmail.com>
Message-ID: <784c98190704191430m7ab0b2adh2567e0b1127ec31b@mail.gmail.com>

On 19/04/07, Ranjan Grover <ranjan.grover at gmail.com> wrote:
>
> > I have this camera with FC5 and the uvc driver and it works like a charm
> > with luvcview and ekiga.
>
> I also have this camera running fine in Debian/sid using ekiga. It
> doesn't work with Kopete yet because of a broken v4l2 interface in
> kopete. If you're running Debian or ubuntu you can get the
> linux-uvc-source package and install it using module assistant after
> untarring the source.
>
> $ tar -xvjf linux-uvc-source
> $ module-assistant a-i linux-uvc
>
> Ranjan
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>

It works with luvcview! Thanks guys!

I downloaded luvcview from
http://mxhaard.free.fr/spca50x/Investigation/uvc/luvcview-20070107.tar.gz,
since it wasn't in any of the Ubuntu package repositories.

--Aaron Miller
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070419/a7aca5ef/attachment.html>

From marcel at datkan.net  Fri Apr 20 10:12:27 2007
From: marcel at datkan.net (Marcel van Beurden)
Date: Fri, 20 Apr 2007 10:12:27 +0200
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
Message-ID: <462875EB.9020002@datkan.net>

Hi,

This was posted on the motion-users list. Now that it has V4L2 it should work 
with UVC-cams.

Regards,
Marcel
-------------- next part --------------
An embedded message was scrubbed...
From: Kenneth Lavrsen <kenneth at lavrsen.dk>
Subject: [Motion-user] [ANNOUNCE] Release of Motion Beta Release 3.2.8 beta1
Date: Fri, 20 Apr 2007 08:31:45 +0200
Size: 13667
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070420/d3a868fb/attachment.mht>

From arne at unicap-imaging.org  Fri Apr 20 11:30:49 2007
From: arne at unicap-imaging.org (Arne Caspari)
Date: Fri, 20 Apr 2007 11:30:49 +0200
Subject: [Linux-uvc-devel] Announcement: unicap / ucview
Message-ID: <1177061449.11013.12.camel@localhost>

Dear UVC users, 

This is a plump announcement for my imaging library 'unicap'. You can
find it at: 

http://www.unicap-imaging.org

It supports video-4-linux 2 and works with the UVC driver as far as I
was able to test. 

It would be fine if I can get feedback on which devices work with it and
which won't. There might be issues with some colour formats which can
not be translated with the current version. 

There is a program called 'ucview' on the download page which provides
an easy to use graphical interface. Ubuntu users should just be able to
install the provided packages. 

 Thanks, 

 /Arne



From srichter at cosmos.phy.tufts.edu  Fri Apr 20 13:55:25 2007
From: srichter at cosmos.phy.tufts.edu (Stephan Richter)
Date: Fri, 20 Apr 2007 07:55:25 -0400
Subject: [Linux-uvc-devel] Logitech QuickCam for Notebooks Pro (046d:08cb)
	Problems
Message-ID: <200704200755.26404.srichter@cosmos.phy.tufts.edu>

Hello everyone,

after installing -- with some guidance from various forums -- the uvc driver 
for the above cam, I do not get a picture. Below I try to provide you with 
all the infos I have. Please let me know, if I missed something. I compiled 
uvc from trunk, so I can check any fixes at any time:

[srichter at localhost srichter]$ uname -a
Linux localhost 2.6.17-5mdv #1 SMP Wed Sep 13 14:32:31 EDT 2006 i686 Intel(R) 
Pentium(R) M processor 1.70GHz GNU/Linux

[srichter at localhost srichter]$ lsusb
Bus 006 Device 001: ID 0000:0000
Bus 007 Device 001: ID 0000:0000
Bus 005 Device 001: ID 0000:0000
Bus 004 Device 002: ID 046d:08cb Logitech, Inc.
Bus 004 Device 001: ID 0000:0000
Bus 002 Device 001: ID 0000:0000
Bus 003 Device 001: ID 0000:0000
Bus 001 Device 001: ID 0000:0000

[srichter at localhost srichter]$ lsmod|grep uvc
uvcvideo ?? ?? ?? ?? ?? ?? ?? 39524 ??0
compat_ioctl32 ?? ?? ?? ?? ??1952 ??1 uvcvideo
v4l1_compat ?? ?? ?? ?? ?? ??14212 ??1 uvcvideo
videodev ?? ?? ?? ?? ?? ?? ?? ??8064 ??1 uvcvideo
v4l2_common ?? ?? ?? ?? ?? ??15648 ??1 uvcvideo
usbcore ?? ?? ?? ?? ?? ?? ?? 113472 ??7 
snd_usb_audio,snd_usb_lib,ohci_hcd,uvcvideo,ehci_hcd,uhci_hcd

[srichter at localhost srichter]$ xawtv
This is xawtv-3.95, running on Linux/i686 (2.6.17-5mdv)
xinerama 0: 1920x1200+0+0
xinerama 1: 1024x768+1920+0
/dev/video0 [v4l2]: no overlay support
v4l-conf had some trouble, trying to continue anyway
Warning: Missing charsets in String to FontSet conversion
Warning: Missing charsets in String to FontSet conversion
Warning: Missing charsets in String to FontSet conversion
ioctl: VIDIOC_G_STD(std=0xbf9804e4 
[PAL_G,PAL_D,PAL_D1,PAL_K,PAL_Nc,SECAM_H,SECAM_K,?ATSC_8_VSB,ATSC_16_VSB,
(null),(null),(null),(null),(null),(null)]): Invalid argument
ioctl: VIDIOC_REQBUFS(count=2;type=VIDEO_CAPTURE;memory=MMAP): Success
ioctl: VIDIOC_S_STD(std=0x0 []): Invalid argument
ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0 
[];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.seconds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0;memory=unknown): 
Invalid argument
ioctl: VIDIOC_REQBUFS(count=1;type=VIDEO_CAPTURE;memory=MMAP): Invalid 
argument
ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0 
[];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.seconds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0;memory=unknown): 
Invalid argument
ioctl: VIDIOC_REQBUFS(count=2;type=VIDEO_CAPTURE;memory=MMAP): Invalid 
argument
ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0 
[];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.seconds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0;memory=unknown): 
Invalid argument
scroll by 137 ?? length 150 ?? ?? ??shown 0.000000 ??top 0.251900 => 0.434567
ioctl: VIDIOC_REQBUFS(count=1;type=VIDEO_CAPTURE;memory=MMAP): Invalid 
argument
ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0 
[];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.seconds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0;memory=unknown): 
Invalid argument
ioctl: VIDIOC_S_CTRL(id=134217741;value=4345): Input/output error
ioctl: VIDIOC_REQBUFS(count=2;type=VIDEO_CAPTURE;memory=MMAP): Input/output 
error

[srichter at localhost srichter]$ /usr/local/bin/luvcview
uvcview verion 0.1.6
Video driver: x11
A window manager is available
video /dev/video0
Unable to set format: 5.
??Init v4L2 failed !! exit fatal

uvcvideo: Failed to query (130) UVC control 2 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (132) UVC control 7 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (131) UVC control 7 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (131) UVC control 3 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (131) UVC control 3 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (1) UVC control 2 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (135) UVC control 3 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (135) UVC control 7 (unit 2) : -110 (exp. 2).
uvcvideo: Failed to query (132) UVC control 7 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (132) UVC control 2 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (130) UVC control 3 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (1) UVC control 10 (unit 2) : -32 (exp. 2).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
usb 4-1: USB disconnect, address 2
usb 4-1: new high speed USB device using ehci_hcd and address 3
usb 4-1: configuration #1 chosen from 1 choice
uvcvideo: Found UVC 1.00 device <unnamed> (046d:08cb)

Regards,
Stephan
-- 
Stephan Richter
CBU Physics & Chemistry (B.S.) / Tufts Physics (Ph.D. student)
Web2k - Web Software Design, Development and Training


From fvera at ucv.cl  Fri Apr 20 16:39:27 2007
From: fvera at ucv.cl (Francisco Vera)
Date: Fri, 20 Apr 2007 10:39:27 -0400
Subject: [Linux-uvc-devel] unicap ucview tests
Message-ID: <200704201039.27252.fvera@ucv.cl>

Dear Arne an UVC users,

I just downloaded unicap ucview from http://www.unicap-imaging.org

I have made some test on a pixelink (PL-A782) 6.6 Megapixles firewire 
industrial camera (not relevant to this list) and a logitech fusion webcam.

The output from dmesg:
------------------------------------
ieee1394: Node added: ID:BUS[0-00:1023]  GUID[0001687307820168]
ieee1394: Node changed: 0-00:1023 -> 0-01:1023
ieee1394: raw1394: /dev/raw1394 device initialized
video1394: Installed video1394 module
ieee1394: Node changed: 0-01:1023 -> 0-00:1023
ieee1394: Node suspended: ID:BUS[0-00:1023]  GUID[0001687307820168]
usb 4-3: new high speed USB device using ehci_hcd and address 4
usb 4-3: configuration #1 chosen from 1 choice
Linux video capture interface: v2.00
uvcvideo: Found UVC 1.00 device <unnamed> (046d:08c1)
usbcore: registered new driver uvcvideo
USB Video Class driver (v0.1.0)
-----------------------------------

Compiling and installing unicap and ucview:
-----------------------------------
./configure
make
make install

no problems for unicap and ucview, then: 
ldconfig

now ucview is working
-------------------------------------

For the firewire camera:
-------------------------------------
This camera works with coriander but it is not stable, I am not aware of other 
application that can use this camera in linux.

plugged this camera
chmod o+rw /dev/raw1394
chmod o+rw /dev/video1394/0

ucview detected resolutions 320x240 and 640x480
the image shown for 320x240 has a drift
the image for 640x480 was ok but only at 25 fps

I think that other resolutions and speed could be obtained if the video1394 is 
used (instead of raw1394)
---------------------------------------

For the logitech fusion:

I have to run first luvcview to initialize the camera for  ucview to show 
images.
I also have this problem using ffmpeg, so I usually call:

v4lctl  bright "75%"
ffmpeg -an -vd /dev/video0 -s 1280x960 -r 6 -b 5000 -y -vcodec mpeg4 -f 
avi - | /usr/bin/mplayer -vf screenshot - 


uvcview detected modes: uncompressed and MJPEG

for uncompressed it detected: 1024x786 and 1280x960
the first worked at 10 fps and the other 7.5 fps

there are initialization problems so I needed to start first luvcview and 
afterwards run ucview.

For MJPEG it detected: 160x120 320x240 352x288 640x480 704x576 960x720

perfect black screens was showing for all resolutions
(obviously a problem with image formats)
640x480 (black) was at 15 fps, but that must be caused by the default fps for 
the uvc driver, luvcview -i 30 -s 640x480 works ok at 30 fps.

I have installed the last uvc driver in debian using module-assistant (m-a):
m-a prepare
m-a update
m-a  ( select linux-uvc, get, build, install)

unloaded the previous driver, unpluged the webcam, plugged again, ucview:
black screens again for mjpg, and uncompressed format works ok.

dmesg:
---------------------------
usbcore: deregistering driver uvcvideo
usb 4-3: USB disconnect, address 6
usb 4-3: new high speed USB device using ehci_hcd and address 7
usb 4-3: configuration #1 chosen from 1 choice
7:3:1: cannot set freq 0 to ep 0x86
7:3:2: cannot set freq 0 to ep 0x86
7:3:3: cannot set freq 16000 to ep 0x86
uvcvideo: Found UVC 1.00 device <unnamed> (046d:08c1)
usbcore: registered new driver uvcvideo
USB Video Class driver (v0.1.0-c)
--------------------------------

Hope this help to improve this new v4l2 library and viewer.

Francisco Vera






From cass at skynet.be  Sun Apr 22 01:50:42 2007
From: cass at skynet.be (Guillaume Desmottes)
Date: Sun, 22 Apr 2007 01:50:42 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
Message-ID: <1177199442.26838.11.camel@cass-wks>

Hi!

I just bought a Logitech QuickCam Pro 5000 and have some problems with
Ubuntu Feisty (2.6.20-15-generic).

I did some tests with ekiga and the cam seems to be randomly turned
on/off (the green light become off and ekiga complains it can't open the
device).

Same problem using gstreamer-properties. Sometimes it works fine but
sometimes I got this error:

gstreamer-properties-Message: Error running pipeline 'Video for Linux 2
(v4l2)': Could not negotiate format [gstbasesrc.c(1865):
gst_base_src_start (): /pipeline0/v4l2src3:
Check your filtered caps, if any]

dmesg is flooded by these errors:

[20978.252000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
-110 (exp. 26).
[21011.024000] uvcvideo: Failed to query (135) UVC control 2 (unit 2) :
-32 (exp. 2).
[21035.408000] uvcvideo: Failed to query (130) UVC control 7 (unit 2) :
-32 (exp. 2).
[21068.544000] uvcvideo: Failed to query (131) UVC control 4 (unit 2) :
-32 (exp. 2).
[21153.240000] uvcvideo: Failed to query (131) UVC control 7 (unit 2) :
-32 (exp. 2).
[21424.032000] uvcvideo: Failed to query (135) UVC control 2 (unit 2) :
-110 (exp. 2).
[21424.216000] uvcvideo: Failed to query (130) UVC control 7 (unit 2) :
-32 (exp. 2).
[21429.488000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
-32 (exp. 26).


Is it a know bug or something?
Of course, don't hesitate to ask for debug output or additional testing.

Thanks for your help and your amazing job on this driver!


	G.


-- 
Guillaume Desmottes <cass at skynet.be>
Jabber <cassidy at jabber.belnet.be>
GPG 1024D/711E31B1 | 1B5A 1BA8 11AA F0F1 2169  E28A AC55 8671 711E 31B1



From schmid.thomas at gmx.ch  Sun Apr 22 02:04:57 2007
From: schmid.thomas at gmx.ch (Thomas Schmid)
Date: Sun, 22 Apr 2007 02:04:57 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <1177199442.26838.11.camel@cass-wks>
References: <1177199442.26838.11.camel@cass-wks>
Message-ID: <462AA6A9.8060900@gmx.ch>

Guillaume Desmottes schrieb:
> Hi!
> 
> I just bought a Logitech QuickCam Pro 5000 and have some problems with
> Ubuntu Feisty (2.6.20-15-generic).
> 
> I did some tests with ekiga and the cam seems to be randomly turned
> on/off (the green light become off and ekiga complains it can't open the
> device).
> 
> Same problem using gstreamer-properties. Sometimes it works fine but
> sometimes I got this error:
> 
> gstreamer-properties-Message: Error running pipeline 'Video for Linux 2
> (v4l2)': Could not negotiate format [gstbasesrc.c(1865):
> gst_base_src_start (): /pipeline0/v4l2src3:
> Check your filtered caps, if any]
> 
> dmesg is flooded by these errors:
> 
> [20978.252000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
> -110 (exp. 26).
> [21011.024000] uvcvideo: Failed to query (135) UVC control 2 (unit 2) :
> -32 (exp. 2).
> [21035.408000] uvcvideo: Failed to query (130) UVC control 7 (unit 2) :
> -32 (exp. 2).
> [21068.544000] uvcvideo: Failed to query (131) UVC control 4 (unit 2) :
> -32 (exp. 2).
> [21153.240000] uvcvideo: Failed to query (131) UVC control 7 (unit 2) :
> -32 (exp. 2).
> [21424.032000] uvcvideo: Failed to query (135) UVC control 2 (unit 2) :
> -110 (exp. 2).
> [21424.216000] uvcvideo: Failed to query (130) UVC control 7 (unit 2) :
> -32 (exp. 2).
> [21429.488000] uvcvideo: Failed to query (1) UVC control 1 (unit 0) :
> -32 (exp. 26).
> 
> 
> Is it a know bug or something?
> Of course, don't hesitate to ask for debug output or additional testing.
> 
> Thanks for your help and your amazing job on this driver!
> 
> 
> 	G.
> 
> 
Hi,

i've also a Logitech Quickcam Pro 5000 (Model 2006) and Feisty running.
To you use the Feisty uvc-video module or from the uvc repo?

Regards
Tom



From cass at skynet.be  Sun Apr 22 02:21:05 2007
From: cass at skynet.be (Guillaume Desmottes)
Date: Sun, 22 Apr 2007 02:21:05 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <462AA6A9.8060900@gmx.ch>
References: <1177199442.26838.11.camel@cass-wks>  <462AA6A9.8060900@gmx.ch>
Message-ID: <1177201265.26838.14.camel@cass-wks>

Le dimanche 22 avril 2007 ? 02:04 +0200, Thomas Schmid a ?crit :
> i've also a Logitech Quickcam Pro 5000 (Model 2006) and Feisty running.

How can I check which model I have?
I got this when plug in the cam:
[17462.448000] uvcvideo: Found UVC 1.00 device <unnamed> (046d:08ce)

> To you use the Feisty uvc-video module or from the uvc repo?
> 

I'm using the one from Feisty kernel. Should I use the other one?

Thanks!

	G.

-- 
Guillaume Desmottes <cass at skynet.be>
Jabber <cassidy at jabber.belnet.be>
GPG 1024D/711E31B1 | 1B5A 1BA8 11AA F0F1 2169  E28A AC55 8671 711E 31B1



From schmid.thomas at gmx.ch  Sun Apr 22 02:59:28 2007
From: schmid.thomas at gmx.ch (Thomas Schmid)
Date: Sun, 22 Apr 2007 02:59:28 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <1177201265.26838.14.camel@cass-wks>
References: <1177199442.26838.11.camel@cass-wks> <462AA6A9.8060900@gmx.ch>
	<1177201265.26838.14.camel@cass-wks>
Message-ID: <462AB370.4050002@gmx.ch>

Guillaume Desmottes schrieb:
> Le dimanche 22 avril 2007 ? 02:04 +0200, Thomas Schmid a ?crit :
>> i've also a Logitech Quickcam Pro 5000 (Model 2006) and Feisty running.
> 
> How can I check which model I have?
> I got this when plug in the cam:
> [17462.448000] uvcvideo: Found UVC 1.00 device <unnamed> (046d:08ce)
> 
>> To you use the Feisty uvc-video module or from the uvc repo?
>>
> 
> I'm using the one from Feisty kernel. Should I use the other one?
> 
> Thanks!
> 
> 	G.
> 
I think you've a 2006 Model.
Feisty module doesnt work for me.
Try it with the snv version.

change makefile like this:

KERNEL_VERSION	:= `uname -r`
KERNEL_DIR	:= /lib/modules/$(KERNEL_VERSION)/build
#INSTALL_MOD_DIR	:= usb/media
INSTALL_MOD_DIR := kernel/ubuntu/media/usbvideo

PWD		:= $(shell pwd)

obj-m		:= uvcvideo.o
uvcvideo-objs   := uvc_driver.o uvc_queue.o uvc_v4l2.o uvc_video.o
uvc_ctrl.o

all: uvcvideo

uvcvideo:
	@echo "Building USB Video Class driver..."
	@(cd $(KERNEL_DIR) && make -C $(KERNEL_DIR) SUBDIRS=$(PWD) modules)

install:
	@echo "Installing USB Video Class driver..."
	@(cd $(KERNEL_DIR) && make -C $(KERNEL_DIR) SUBDIRS=$(PWD)
INSTALL_MOD_DIR=$(INSTALL_MOD_DIR) modules_install)
	depmod -ae

clean:
	-rm -f *.o *.ko .*.cmd .*.flags *.mod.c Modules.symvers
	-rm -rf .tmp_versions



Regards
Tom


From tchen at on-go.com  Mon Apr 23 02:28:40 2007
From: tchen at on-go.com (thomas chen)
Date: Sun, 22 Apr 2007 20:28:40 -0400
Subject: [Linux-uvc-devel] linux uvc driver source does not seem tob e there
	any more ?
Message-ID: <462BFDB8.2070601@on-go.com>

hello
do you know where the UVC driver for linux now resides ? most web 
reference to the source return with
unknown aaddress
http://developer.berlios.de/projects/linux-uvc
thanks

-- 
Thomas Chen
Email: tchen at on-go.com



From sam.revitch at gmail.com  Mon Apr 23 08:12:11 2007
From: sam.revitch at gmail.com (Sam Revitch)
Date: Sun, 22 Apr 2007 23:12:11 -0700
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <200704182219.32086.laurent.pinchart@skynet.be>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
	<200704112253.28859.laurent.pinchart@skynet.be>
	<8d4807d50704131726l405d20fbr8b945ca726cbdda0@mail.gmail.com>
	<200704182219.32086.laurent.pinchart@skynet.be>
Message-ID: <8d4807d50704222312p6aff37faica386d84f3bb7d5a@mail.gmail.com>

On 4/18/07, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:

> VIDIOCGMBUF is part of the deprecated V4L1 API. Applications should be ported
> to V4L2. Adding V4L1 support is not planned.

Hi Laurent,

On one side, this is perhaps for the best.  It draws a hard line and
encourages app maintainers to update their API usage.  In a
forward-looking driver like uvcvideo, this can be quite powerful.
However, it works against the goal of inspiring confidence in folks
when they download the driver and try it out, and it creates more
support questions.  You've probably heard enough about camorama and
all the other apps in that category by now.  :-)

It's good to hear that the Motion developers spent some time on V4L2 support.

> uvcvideo already implements full buffer management. The streaming I/O V4L2
> method is fully supported. I might consider using video-buf later, although
> there are a few things I don't like in the API (especially the way video-buf
> insists on handling streamon/streamoff itself). VIDIOCGMBUF support isn't
> planned.

The latest SVN version of uvcvideo only appears to implement mmap().
Do you have this on a private branch?  It appears to mention that
read() is explicitly unsupported, and the user pointer I/O method
appears to be rejected in uvc_queue_buffer().  I won't argue that mmap
isn't the most important and that all apps should support mmap, but
not supporting read in uvcvideo will leave it incompatible with a few
apps.

> usbcam sounds interesting. Porting uvcvideo to usbcam would be lots of work,
> and I'm not willing to do that for now. Feel free to give it a go though :-)
> Don't forget that the uvcvideo driver is quite complex, and that it will
> eventually support video output as well, which falls out of the scope of
> usbcam. You might have issues with control handling which is being rewritten
> to allow for runtime controls definitions through specific ioctls. The
> extended control API will also have to be implemented by usbcam, and the mini
> drivers API will have to support control transactions.

I'm definitely pleased you don't pin it in the same category as usbvideo.  :-)

The control handling is on the list of things to rework.  ALSA seems
to have a reasonable interface with the snd_kcontrol.  It might also
be nice if the V4L2 API were expanded to support change notifications
like ALSA.

Regarding transactions, what did you have in mind?

I do like how uvcvideo does this stuff.  It seems a lot like how
jbd/reiserfs handle filesystem transactions, although those aren't
necessarily the best examples because they don't support undo.  It
also seems almost like overkill for uvcvideo, because it doesn't seem
to handle the case of a device rejecting a new control value, and
would be very hard to do this in a complete fashion anyway because of
the asynchronous notification method mandated by the spec.

Anyway, now it's time to reinvent the wheel yet again.  :-)  how about
this sort of interface for usbcam.  We create a new usbcam_txn
structure for the transaction handle, which has a list_head and maybe
some minidriver-specific state.  The minidriver gets new operations:

	int (*ctrl_txn_start)(struct usbcam_dev *udp, struct usbcam_txn *);

	int (*ctrl_txn_end)(struct usbcam_dev *udp, struct usbcam_txn *);

Each control is expected to provide storage for last committed control
values as well as current values.  The control structure gets a new
list_head, and operations:

	int (*set_fn)(struct usbcam_dev *, const struct usbcam_ctrl *,
		      const struct v4l2_ext_control *, struct usbcam_txn *);

	void (*commit_fn)(struct usbcam_dev *, const struct usbcam_ctrl *,
		      struct usbcam_txn *);

	void (*abort_fn)(struct usbcam_dev *, const struct usbcam_ctrl *,
		      struct usbcam_txn *);

The procedures would be:

Set extended controls:
- Invoke the minidriver ctrl_txn_start().  If it fails, return the error.
- Invoke each control's set_fn().  If successful, add the control to
the transaction list.  Otherwise, abort and return the error with the
index of the failing control.
- Commit the transaction, return success.

Commit:
- Invoke the commit_fn() of every control in the transaction list.
- Invoke the minidriver ctrl_txn_stop().

Abort:
- Invoke the abort_fn() of every control in the transaction list.
- Invoke the minidriver ctrl_txn_stop().

The only thing I don't like about this interface is that it might make
long waiting control requests a little bit more complicated in some
models.  For example, there might be some value in having an ioctl to
set a pan/tilt control wait until the device has reoriented itself.
Or, maybe it will simplify them by forcing the correct model the first
time.  Hm.

With your comment below in perspective, maybe the videodev layer
should do this stuff itself instead of usbcam.

> On a side note, you should split usbcam into several files. It will be easier
> to read the code.

Agreed, done.  It makes for marginally more work to embed usbcam in a
3rd party driver though.

> Do you plan to submit usbcam to the kernel ? Do you think current USB drivers
> could be ported ? One of the main issues is that developers might not be
> willing to throw away most of the code they wrote.

The plan is actually to submit it, with r5u870, as a set of patches to
v4l-dvb in the next 2-3 days.  This isn't a lot of time, but there are
other things going on that mandate it.  I'll fix anything else you
deem worth fixing in the mean time.

If a patch is really big, what's the protocol, will they be offended
by an attachment?

The latest sources, including a small overhaul of the control API,
broken out into smaller files, and including the sq930 driver, are
temporarily at:

http://lsb.blogdns.net/files/sq930-dev.tgz

I'll start playing around with a uvcvideo integration next, after we
figure out the control interfaces and the format/resolution handlers
get cleaned up.

> Are you aware that Mauro (the V4L2 maintainer) is trying to move ioctl
> handling to the V4L2 layer, which is the first step to a mini driver
> approach ? It seems to me that V4L2 is undergoing some major changes, and I'm
> not sure to be happy with them. If we indeed decide that some operations
> (such as buffer management) should be handled by generic code, this should be
> discussed first on the video4linux mailing list.

I was hoping that they might spend a little more time refining this
stuff before embarking on their current activity of altering existing
drivers to use it.  This video_ioctl2() might make it marginally
simpler to specify a driver.

It is certainly less pleasant to support this model with usbcam.
usbcam has its own slightly more cooked table of callouts with
different semantics -- minidrivers want callouts invoked with the
device mutex held.  When a callout is added to video_device, it must
also be added to the usbcam callouts in order for usbcam minidrivers
to be able to use it, and that sounds like a lot of work and room for
version skew.

It seems cleaner to provide specific callouts only where value is
added, and to provide an uncooked ioctl callout for everything else.

I agree with your notion that they should make it a stronger sort of
minidriver interface, and have it manage frame buffers and keep track
of lists of controls, formats, resolutions, frame intervals, etc. per
device.

> Is it possible to simulate device unplugging/replugging from userspace to
> force the USB stack to reenumerate the device ?

What, you want me to give away all my secrets?  :-)

Here's the snippet.  It is called after the libusb interface is
released, after the microcode upload finishes.  I wish there were some
way to do this with libusb.

void r5u870_bump_kernel(struct usb_device *dev)
{
	char filename[PATH_MAX];
	int fh;
	struct usbdevfs_ioctl ic;
	sprintf(filename, "/proc/bus/usb/%s/%s",
		dev->bus->dirname, dev->filename);
	fh = open(filename, O_RDWR);
	if (fh >= 0) {
		ic.ifno = 0;
		ic.ioctl_code = USBDEVFS_CONNECT;
		ioctl(fh, USBDEVFS_IOCTL, &ic);
		close(fh);
	}
}

> I assume the firmware loading requests are not compatible with ezusb chips, so
> fxload can't do the job. Is that right ?

That's right, it's a little bit different.

Were you considering trying to convince the fxload folks to integrate
the iSight/r5u870 firmware upload functionality?

If not, somebody should certainly create a uvcfwload project, or
something of the sort.  I'd do this myself but am not competent with
the accepted packaging standards for user level stuff.

> It could be included in the kernel instead, but it would then have to be a
> generic microcode loader usable by several drivers.
>
> I don't mind adding a few quirks to the uvcvideo driver. Support for non-UVC
> controls is a bit more intrusive though.
>
> Other ways to support those hybrid devices would be to add hooks to uvcvideo
> or implement a minidriver interface like the one you wrote for usbcam.

I like the last idea.  What sort of interface did you have in mind?

It sounds like there are two types of help that devices might need in
order to be compatible with uvcvideo:

1. Loading microcode/firmware files
2. Non-standard controls, either UVC-defined private controls or
non-UVC controls

For cameras that need #1 and not #2, the user level firmware loader
seems to make the most sense.  This also seems like a common type of
device, and there will be more of them in the future than just the
iSight, and a user-level firmware uploader is probably a good idea.

For cameras that need #1 and #2, it might make the most sense to have
a uvcvideo plugin of some sort that handles the controls as well as
loading the firmware.  Separating the firmware loader and the control
functions might add confusion, because two separate components may
need to be upgraded / installed to support a device, but maybe that's
the most straightforward way to do it.

Thanks Laurent!
-Sam Revitch


From thoralf_schulze at yahoo.de  Mon Apr 23 10:56:19 2007
From: thoralf_schulze at yahoo.de (Thoralf Schulze)
Date: Mon, 23 Apr 2007 09:56:19 +0100 (BST)
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <8d4807d50704222312p6aff37faica386d84f3bb7d5a@mail.gmail.com>
Message-ID: <193681.65515.qm@web27202.mail.ukl.yahoo.com>

hi,

--- Sam Revitch <sam.revitch at gmail.com> wrote:

> On 4/18/07, Laurent Pinchart
> <laurent.pinchart at skynet.be> wrote:
> 
> > VIDIOCGMBUF is part of the deprecated V4L1 API.
> Applications should be ported
> > to V4L2. Adding V4L1 support is not planned.

> On one side, this is perhaps for the best.  It draws
> a hard line and
> encourages app maintainers to update their API
> usage.  In a

otoh, it forces application developers to implement
routines to handle all kinds of more or less wierd
video formats and colour spaces in their software, if
i'm not totally mistaken (i'm not a developer myself).

i agree that routines for colourspace conversations do
not belong in the linux kernel, but their place isn't
in each and every app that uses a v4l2-device, either:
it's a cause of bloat, and having to re-invent the
wheel is always a dull exercise. imho, v4l2 is
severely flawed in this regard ... 
some sort of middleware (like the - *duck* - vfw-api)
would be great here.

with kind regards,
thoralf.




      ___________________________________________________________ 
Yahoo! Mail is the world's favourite email. Don't settle for less, sign up for
your free account today http://uk.rd.yahoo.com/evt=44106/*http://uk.docs.yahoo.com/mail/winter07.html


From sam.revitch at gmail.com  Mon Apr 23 11:35:56 2007
From: sam.revitch at gmail.com (Sam Revitch)
Date: Mon, 23 Apr 2007 02:35:56 -0700
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <200704182219.32086.laurent.pinchart@skynet.be>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
	<200704112253.28859.laurent.pinchart@skynet.be>
	<8d4807d50704131726l405d20fbr8b945ca726cbdda0@mail.gmail.com>
	<200704182219.32086.laurent.pinchart@skynet.be>
Message-ID: <8d4807d50704230235j19d65c6dm4efb41ef6dcdf1aa@mail.gmail.com>

On 4/18/07, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
> xawtv should support V4L2. I'll have to debug it sometimes to find out if the
> issue lies in the application or in the driver.

Laurent,

It looks like xawtv is passing its argument to VIDIOC_DQBUF without
initializing the memory field to V4L2_MEMORY_MMAP.  According to the
spec, the memory field should be set by the app, so this sounds like
an xawtv bug.  It also sounds like a video-buf bug to tolerate this
behavior.

OTOH, there seems little reason for the app to fill in this field
other than to give the driver something to complain about.  The page
on the REQBUFS call clearly states that subsequent calls free any
existing buffers, therefore every buffer associated with a particular
file handle, if not the whole device (and possibly only for a
particular "type" of capture) should be of the same "memory" type.  It
seems redundant to have the app tell it over and over again what
"memory" of buffer it thinks it is using.

Also, usbcam is now on sourceforge:

http://usbcam.svn.sourceforge.net/viewvc/usbcam/trunk/

Thanks.
-Sam Revitch


From cass at skynet.be  Mon Apr 23 12:08:27 2007
From: cass at skynet.be (Guillaume Desmottes)
Date: Mon, 23 Apr 2007 12:08:27 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <462AB370.4050002@gmx.ch>
References: <1177199442.26838.11.camel@cass-wks> <462AA6A9.8060900@gmx.ch>
	<1177201265.26838.14.camel@cass-wks>  <462AB370.4050002@gmx.ch>
Message-ID: <1177322908.5598.0.camel@cass-wks>

Le dimanche 22 avril 2007 ? 02:59 +0200, Thomas Schmid a ?crit :
> I think you've a 2006 Model.
> Feisty module doesnt work for me.
> Try it with the snv version.
> 

I build HEAD module but have still same issues.

	G.

-- 
Guillaume Desmottes <cass at skynet.be>
Jabber <cassidy at jabber.belnet.be>
GPG 1024D/711E31B1 | 1B5A 1BA8 11AA F0F1 2169  E28A AC55 8671 711E 31B1



From tchen at on-go.com  Mon Apr 23 12:48:49 2007
From: tchen at on-go.com (thomas chen)
Date: Mon, 23 Apr 2007 06:48:49 -0400
Subject: [Linux-uvc-devel] linux uvc driver source does not seem tob e there
	any more ?
Message-ID: <462C8F11.1040202@on-go.com>

hello
do you know where the UVC driver for linux now resides ? most web 
reference to the source return with
unknown aaddress
http://developer.berlios.de/projects/linux-uvc
thanks

Email: tchen at on-go.com



From laurent.pinchart at skynet.be  Mon Apr 23 13:28:26 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 23 Apr 2007 13:28:26 +0200
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <8d4807d50704222312p6aff37faica386d84f3bb7d5a@mail.gmail.com>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
	<200704182219.32086.laurent.pinchart@skynet.be>
	<8d4807d50704222312p6aff37faica386d84f3bb7d5a@mail.gmail.com>
Message-ID: <200704231328.27478.laurent.pinchart@skynet.be>

Hi Sam,

On Monday 23 April 2007 08:12, Sam Revitch wrote:
> On 4/18/07, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
[snip]
> > uvcvideo already implements full buffer management. The streaming I/O
> > V4L2 method is fully supported. I might consider using video-buf later,
> > although there are a few things I don't like in the API (especially the
> > way video-buf insists on handling streamon/streamoff itself). VIDIOCGMBUF
> > support isn't planned.
>
> The latest SVN version of uvcvideo only appears to implement mmap().

That's right.

> Do you have this on a private branch?  It appears to mention that
> read() is explicitly unsupported, and the user pointer I/O method
> appears to be rejected in uvc_queue_buffer().  I won't argue that mmap
> isn't the most important and that all apps should support mmap, but
> not supporting read in uvcvideo will leave it incompatible with a few
> apps.

Agreed. read() will be implemented as soon as I can find some spare time to do 
so. I went for the streaming I/O method first, as it's (at least in my 
opinion) the most important one. read() is definitely important as well.

> > usbcam sounds interesting. Porting uvcvideo to usbcam would be lots of
> > work, and I'm not willing to do that for now. Feel free to give it a go
> > though :-) Don't forget that the uvcvideo driver is quite complex, and
> > that it will eventually support video output as well, which falls out of
> > the scope of usbcam. You might have issues with control handling which is
> > being rewritten to allow for runtime controls definitions through
> > specific ioctls. The extended control API will also have to be
> > implemented by usbcam, and the mini drivers API will have to support
> > control transactions.
>
> I'm definitely pleased you don't pin it in the same category as usbvideo. 
> :-)
>
> The control handling is on the list of things to rework.  ALSA seems
> to have a reasonable interface with the snd_kcontrol.  It might also
> be nice if the V4L2 API were expanded to support change notifications
> like ALSA.

Change notifications are needed for proper UVC support (especially for 
pan/tilt support). I mentioned the topic on the v4l mailing list, but nobody 
seemed really interested. Mauro told me the pan/tilt code was in his opinion 
out of the scope of v4l, and should be handled by a separate device. I of 
course strongly disagree on that.

> Regarding transactions, what did you have in mind?

UVC devices expose controls that can't easily be mapped to a single V4L 
control. A good example is pan/tilt support in Logitech webcams. To make 
diagonal motion possible, pan and tilt are exposed through a single UVC 
control. The driver exposes two V4L controls, one for pan and one for tilt. 
Using the legacy control API, it wouldn't be possible to move the camera 
diagonally.

With the extended control API, control changes can be grouped. Pan and tilt 
values can be passed to the driver in a single call. The driver walks the 
controls array, stores control values in private memory, and commit all 
controls at the end of the array. This requires 'begin' and 'commit' support. 
Rollback is used to reset the internal control data to sensible values if an 
error occurs while processing the array. If an error occurs during commit, I 
decided not to try to rollback controls already committed. This would be 
quite difficult, if not impossible at all.

> I do like how uvcvideo does this stuff.  It seems a lot like how
> jbd/reiserfs handle filesystem transactions, although those aren't
> necessarily the best examples because they don't support undo.  It
> also seems almost like overkill for uvcvideo, because it doesn't seem
> to handle the case of a device rejecting a new control value, and
> would be very hard to do this in a complete fashion anyway because of
> the asynchronous notification method mandated by the spec.

Exactly. Transaction support is needed to group related controls together, but 
handling errors from the device would be too difficult. The driver checks 
control values against boundaries returned by the device, so those errors 
should be rare.

> Anyway, now it's time to reinvent the wheel yet again.  :-)  how about
> this sort of interface for usbcam.  We create a new usbcam_txn
> structure for the transaction handle, which has a list_head and maybe
> some minidriver-specific state.  The minidriver gets new operations:
>
> 	int (*ctrl_txn_start)(struct usbcam_dev *udp, struct usbcam_txn *);
>
> 	int (*ctrl_txn_end)(struct usbcam_dev *udp, struct usbcam_txn *);
>
> Each control is expected to provide storage for last committed control
> values as well as current values.  The control structure gets a new
> list_head, and operations:
>
> 	int (*set_fn)(struct usbcam_dev *, const struct usbcam_ctrl *,
> 		      const struct v4l2_ext_control *, struct usbcam_txn *);
>
> 	void (*commit_fn)(struct usbcam_dev *, const struct usbcam_ctrl *,
> 		      struct usbcam_txn *);
>
> 	void (*abort_fn)(struct usbcam_dev *, const struct usbcam_ctrl *,
> 		      struct usbcam_txn *);

This really sounds way too complex. As only a single transaction can be active 
at a given time, the set_fn doesn't need the struct usbcam_txn* argument. For 
the UVC driver, commit_fn and abort_fn operations would be useless, as what 
must be committed are UVC controls, not V4L controls.

For simple devices with a 1-to-1 mapping between device controls and V4L 
controls, transaction support is not useful. For more complex devices with a 
1-to-n mapping between device controls and V4L controls, the driver will 
store device control values and not V4L control values. This doesn't fit very 
well with the above API.

> The procedures would be:
>
> Set extended controls:
> - Invoke the minidriver ctrl_txn_start().  If it fails, return the error.
> - Invoke each control's set_fn().  If successful, add the control to
> the transaction list.  Otherwise, abort and return the error with the
> index of the failing control.
> - Commit the transaction, return success.
>
> Commit:
> - Invoke the commit_fn() of every control in the transaction list.
> - Invoke the minidriver ctrl_txn_stop().
>
> Abort:
> - Invoke the abort_fn() of every control in the transaction list.
> - Invoke the minidriver ctrl_txn_stop().

Transaction support is *only* needed to let the driver group several V4L 
control values and send them to the device in a single operation. What the 
UVC driver needs is a control set notification (set_fn) to store the control 
value, a rollback notification to restore *all* modified values and a commit 
notification to push controls to the device.

Adding a

int (*ctrl_txn_end)(struct usbcam_dev *udp, int commit);

operation would be enough to handle this.

Actually, I even doubt control handling in usbcam should be used by the UVC 
driver. usbcam frees the driver from having to look up the controls list. As 
the UVC driver needs to lookup up its internal UVC control list anyway, there 
isn't much point in delegating controls handling to usbcam at all. Now, if 
you want to implement native device controls support with V4L controls 
mapping in usbcam, that's another story :-)

> The only thing I don't like about this interface is that it might make
> long waiting control requests a little bit more complicated in some
> models.  For example, there might be some value in having an ioctl to
> set a pan/tilt control wait until the device has reoriented itself.

Shouldn't that be handled by a notification API ?

> Or, maybe it will simplify them by forcing the correct model the first
> time.  Hm.
>
> With your comment below in perspective, maybe the videodev layer
> should do this stuff itself instead of usbcam.

That would indeed be better. Lots of code in usbcam is not USB specific.

> > On a side note, you should split usbcam into several files. It will be
> > easier to read the code.
>
> Agreed, done.  It makes for marginally more work to embed usbcam in a
> 3rd party driver though.

usbcam shouldn't be embedded in a 3rd party driver. It should be a kernel 
module of its own.

> > Do you plan to submit usbcam to the kernel ? Do you think current USB
> > drivers could be ported ? One of the main issues is that developers might
> > not be willing to throw away most of the code they wrote.
>
> The plan is actually to submit it, with r5u870, as a set of patches to
> v4l-dvb in the next 2-3 days.  This isn't a lot of time, but there are
> other things going on that mandate it.  I'll fix anything else you
> deem worth fixing in the mean time.

This is too soon in my opinion. The API isn't stable yet. It can be used with 
the r5u870 driver, but it definitely shouldn't be used by other drivers yet. 
Otherwise you'll be stuck with API changes that you won't be allowed to make 
in the future, and it will just turn into a huge mess.

> If a patch is really big, what's the protocol, will they be offended
> by an attachment?

I have no idea, sorry.

> The latest sources, including a small overhaul of the control API,
> broken out into smaller files, and including the sq930 driver, are
> temporarily at:
>
> http://lsb.blogdns.net/files/sq930-dev.tgz
>
> I'll start playing around with a uvcvideo integration next, after we
> figure out the control interfaces and the format/resolution handlers
> get cleaned up.

As stated above, I doubt the current control API could be useful at all for 
the UVC driver.

> > Are you aware that Mauro (the V4L2 maintainer) is trying to move ioctl
> > handling to the V4L2 layer, which is the first step to a mini driver
> > approach ? It seems to me that V4L2 is undergoing some major changes, and
> > I'm not sure to be happy with them. If we indeed decide that some
> > operations (such as buffer management) should be handled by generic code,
> > this should be discussed first on the video4linux mailing list.
>
> I was hoping that they might spend a little more time refining this
> stuff before embarking on their current activity of altering existing
> drivers to use it.  This video_ioctl2() might make it marginally
> simpler to specify a driver.

It also makes it impossible for drivers to implement private ioctls. For that 
reason alone, video_ioctl2() is dead on arrival for me.

> It is certainly less pleasant to support this model with usbcam.
> usbcam has its own slightly more cooked table of callouts with
> different semantics -- minidrivers want callouts invoked with the
> device mutex held.  When a callout is added to video_device, it must
> also be added to the usbcam callouts in order for usbcam minidrivers
> to be able to use it, and that sounds like a lot of work and room for
> version skew.
>
> It seems cleaner to provide specific callouts only where value is
> added, and to provide an uncooked ioctl callout for everything else.

Try to convince Mauro. I've been unsuccessful so far.

> I agree with your notion that they should make it a stronger sort of
> minidriver interface, and have it manage frame buffers and keep track
> of lists of controls, formats, resolutions, frame intervals, etc. per
> device.

I'm not even sure to like the callout solution. Helper functions might be 
easier for driver developers.

After giving it some thoughts, USB webcams can probably be divided in two 
categories:

- Simple webcams are merely a USB bridge with an I2C interface to the sensor. 
Those webcams provide a fixed list of formats/resolutions/frame rates (or 
even a single format/resolution/frame rate) and a simple list of controls. 
For those webcams, usbcam seems appropriate, and should probably even be 
enhanced to provide support for sensor abstraction. A webcam driver would 
thus be made of a bridge driver, a sensor driver and some very limited 
specific code. usbcam would glue all the pieces together.

- Complex webcams such as UVC devices can be queried at runtime to find out 
the available formats, resolutions, frame rates and controls. Controls can be 
device-specific, user-space support is then needed to interface the controls 
properly. I don't think usbcam, with its mini driver approach, is appropriate 
here. What would be useful would be to abstract common functions and move 
them to a USB video layer (whatever it's called). For instance, buffer 
handling should probably not be done by the driver (I will see if videobuf 
can be used in uvcvideo, even though I don't really like the current API).

I don't think usbcam currently fulfills the needs of complex webcams.

> > Is it possible to simulate device unplugging/replugging from userspace to
> > force the USB stack to reenumerate the device ?
>
> What, you want me to give away all my secrets?  :-)
>
> Here's the snippet.  It is called after the libusb interface is
> released, after the microcode upload finishes.  I wish there were some
> way to do this with libusb.
>
> void r5u870_bump_kernel(struct usb_device *dev)
> {
> 	char filename[PATH_MAX];
> 	int fh;
> 	struct usbdevfs_ioctl ic;
> 	sprintf(filename, "/proc/bus/usb/%s/%s",
> 		dev->bus->dirname, dev->filename);
> 	fh = open(filename, O_RDWR);
> 	if (fh >= 0) {
> 		ic.ifno = 0;
> 		ic.ioctl_code = USBDEVFS_CONNECT;
> 		ioctl(fh, USBDEVFS_IOCTL, &ic);
> 		close(fh);
> 	}
> }
>
> > I assume the firmware loading requests are not compatible with ezusb
> > chips, so fxload can't do the job. Is that right ?
>
> That's right, it's a little bit different.
>
> Were you considering trying to convince the fxload folks to integrate
> the iSight/r5u870 firmware upload functionality?

The iSight uses an EZ-USB chip, so fxload can be used without any change.

> If not, somebody should certainly create a uvcfwload project, or
> something of the sort.  I'd do this myself but am not competent with
> the accepted packaging standards for user level stuff.

A ricohfwload would be better :-)

> > It could be included in the kernel instead, but it would then have to be
> > a generic microcode loader usable by several drivers.
> >
> > I don't mind adding a few quirks to the uvcvideo driver. Support for
> > non-UVC controls is a bit more intrusive though.
> >
> > Other ways to support those hybrid devices would be to add hooks to
> > uvcvideo or implement a minidriver interface like the one you wrote for
> > usbcam.
>
> I like the last idea.  What sort of interface did you have in mind?

I haven't thought about it yet, sorry.

> It sounds like there are two types of help that devices might need in
> order to be compatible with uvcvideo:
>
> 1. Loading microcode/firmware files
> 2. Non-standard controls, either UVC-defined private controls or
> non-UVC controls

UVC-defined private controls are already handled by the UVC driver in the 
dynctrl branch. Non-UVC controls are another story, and I wish engineers did 
their job properly.

> For cameras that need #1 and not #2, the user level firmware loader
> seems to make the most sense.  This also seems like a common type of
> device, and there will be more of them in the future than just the
> iSight, and a user-level firmware uploader is probably a good idea.

We will either need to expand fxload to handle other USB microcontrollers, or 
write a loader for every microcontroller. Expanding fxload might be better, 
as it already handles hex file parsing.

> For cameras that need #1 and #2, it might make the most sense to have
> a uvcvideo plugin of some sort that handles the controls as well as
> loading the firmware.  Separating the firmware loader and the control
> functions might add confusion, because two separate components may
> need to be upgraded / installed to support a device, but maybe that's
> the most straightforward way to do it.

I'm not completely against a kernel space firmware loader, providing it lives 
in a separate module and can be used by other drivers as well. It doesn't 
make sense to bundle an EZ-USB firmware loader with the UVC driver.

Speaking of firmwares, does Ricoh allows firmware redistribution ? If so, 
which license are the firmwares covered by ?

> Thanks Laurent!

You're welcome. Hope you won't find my comments too negative. Otherwise feel 
free to tell me.

Best regards,

Laurent Pinchart


From s0238762 at sms.ed.ac.uk  Mon Apr 23 13:06:27 2007
From: s0238762 at sms.ed.ac.uk (Ioannis Nousias)
Date: Mon, 23 Apr 2007 12:06:27 +0100
Subject: [Linux-uvc-devel] linux uvc driver source does not seem tob e
 there	any more ?
In-Reply-To: <462C8F11.1040202@on-go.com>
References: <462C8F11.1040202@on-go.com>
Message-ID: <462C9333.5020506@sms.ed.ac.uk>

Try checking out the trunk from subversion repository:

svn co svn://svn.berlios.de/linux-uvc/linux-uvc/trunk linux-uvc


-Ioannis


thomas chen wrote:
> hello
> do you know where the UVC driver for linux now resides ? most web 
> reference to the source return with
> unknown aaddress
> http://developer.berlios.de/projects/linux-uvc
> thanks
>
> Email: tchen at on-go.com
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
>   



From schmid.thomas at gmx.ch  Mon Apr 23 22:38:21 2007
From: schmid.thomas at gmx.ch (Thomas Schmid)
Date: Mon, 23 Apr 2007 22:38:21 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <1177322908.5598.0.camel@cass-wks>
References: <1177199442.26838.11.camel@cass-wks>
	<462AA6A9.8060900@gmx.ch>	<1177201265.26838.14.camel@cass-wks>
	<462AB370.4050002@gmx.ch> <1177322908.5598.0.camel@cass-wks>
Message-ID: <462D193D.5010903@gmx.ch>

Guillaume Desmottes schrieb:
> Le dimanche 22 avril 2007 ? 02:59 +0200, Thomas Schmid a ?crit :
>> I think you've a 2006 Model.
>> Feisty module doesnt work for me.
>> Try it with the snv version.
>>
> 
> I build HEAD module but have still same issues.
> 
> 	G.
> 


From cass at skynet.be  Tue Apr 24 10:15:24 2007
From: cass at skynet.be (Guillaume Desmottes)
Date: Tue, 24 Apr 2007 10:15:24 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <462D193D.5010903@gmx.ch>
References: <1177199442.26838.11.camel@cass-wks> <462AA6A9.8060900@gmx.ch>
	<1177201265.26838.14.camel@cass-wks> <462AB370.4050002@gmx.ch>
	<1177322908.5598.0.camel@cass-wks>  <462D193D.5010903@gmx.ch>
Message-ID: <1177402525.6006.2.camel@cass-wks>

Le lundi 23 avril 2007 ? 22:38 +0200, Thomas Schmid a ?crit :
> Guillaume Desmottes schrieb:
> > Le dimanche 22 avril 2007 ? 02:59 +0200, Thomas Schmid a ?crit :
> >> I think you've a 2006 Model.
> >> Feisty module doesnt work for me.
> >> Try it with the snv version.
> >>
> > 
> > I build HEAD module but have still same issues.
> > 
> > 	G.
> > 
> 
> >From this:
> svn co svn://svn.berlios.de/linux-uvc/linux-uvc/trunk
> 
> and in the Makefile:
> 
> INSTALL_MOD_DIR := usb/media (Wrong path!!!!!)
> INSTALL_MOD_DIR := kernel/ubuntu/media/usbvideo (Right :-)
> 
> make
> sudo make install
> 
Yep, that how I build the driver.

> Strange, please do
> 
> sudo rmmod uvcvideo
> sudo dmesg -c
> sudo modprobe uvcvideo trace=0xffff
> 
> dmesg
> 

Just after driver loading:

# dmesg 
[ 1300.632000] uvcvideo: Adding mapping Brightness to control
00000000-0000-0000-0000-000000000101/2.
[ 1300.632000] uvcvideo: Adding mapping Contrast to control
00000000-0000-0000-0000-000000000101/3.
[ 1300.632000] uvcvideo: Adding mapping Hue to control
00000000-0000-0000-0000-000000000101/6.
[ 1300.632000] uvcvideo: Adding mapping Saturation to control
00000000-0000-0000-0000-000000000101/7.
[ 1300.632000] uvcvideo: Adding mapping Sharpness to control
00000000-0000-0000-0000-000000000101/8.
[ 1300.632000] uvcvideo: Adding mapping Gamma to control
00000000-0000-0000-0000-000000000101/9.
[ 1300.632000] uvcvideo: Adding mapping Backlight Compensation to
control 00000000-0000-0000-0000-000000000101/1.
[ 1300.632000] uvcvideo: Adding mapping Gain to control
00000000-0000-0000-0000-000000000101/4.
[ 1300.632000] uvcvideo: Adding mapping Power Line Frequency to control
00000000-0000-0000-0000-000000000101/5.
[ 1300.632000] uvcvideo: Adding mapping Hue, Auto to control
00000000-0000-0000-0000-000000000101/16.
[ 1300.632000] uvcvideo: Adding mapping Pan (relative) to control
63610682-5070-49ab-b8cc-b3855e8d2256/1.
[ 1300.632000] uvcvideo: Adding mapping Tilt (relative) to control
63610682-5070-49ab-b8cc-b3855e8d2256/1.
[ 1300.632000] uvcvideo: Adding mapping Pan/Tilt (reset) to control
63610682-5070-49ab-b8cc-b3855e8d2256/2.
[ 1300.632000] uvcvideo: Adding mapping Exposure, Auto to control
00000000-0000-0000-0000-000000000001/2.
[ 1300.632000] uvcvideo: Adding mapping Exposure (Absolute) to control
00000000-0000-0000-0000-000000000001/4.
[ 1300.632000] uvcvideo: Adding mapping White Balance Temperature, Auto
to control 00000000-0000-0000-0000-000000000101/11.
[ 1300.636000] uvcvideo: Adding mapping White Balance Temperature to
control 00000000-0000-0000-0000-000000000101/10.
[ 1300.636000] uvcvideo: Probing generic UVC device 2
[ 1300.636000] uvcvideo: Found format MJPEG.
[ 1300.636000] uvcvideo: - 160x120 (30.0 fps)
[ 1300.636000] uvcvideo: - 176x144 (30.0 fps)
[ 1300.636000] uvcvideo: - 320x240 (15.0 fps)
[ 1300.636000] uvcvideo: - 352x288 (15.0 fps)
[ 1300.636000] uvcvideo: - 640x480 (15.0 fps)
[ 1300.636000] uvcvideo: Found format Uncompressed.
[ 1300.636000] uvcvideo: - 160x120 (30.0 fps)
[ 1300.636000] uvcvideo: - 176x144 (30.0 fps)
[ 1300.636000] uvcvideo: - 320x240 (15.0 fps)
[ 1300.636000] uvcvideo: - 352x288 (15.0 fps)
[ 1300.636000] uvcvideo: - 640x480 (15.0 fps)
[ 1300.636000] uvcvideo: Found a Status endpoint (addr 87).
[ 1300.636000] uvcvideo: Found UVC 1.00 device <unnamed> (046d:08ce)
[ 1300.636000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/2 to device 2 entity 2
[ 1300.636000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/3 to device 2 entity 2
[ 1300.636000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/7 to device 2 entity 2
[ 1300.636000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/8 to device 2 entity 2
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/1 to device 2 entity 2
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/4 to device 2 entity 2
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/5 to device 2 entity 2
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000001/2 to device 2 entity 1
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000001/4 to device 2 entity 1
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/11 to device 2 entity 2
[ 1300.640000] uvcvideo: Added control
00000000-0000-0000-0000-000000000101/10 to device 2 entity 2
[ 1300.640000] uvcvideo: Scanning UVC chain: OT 5 (-> 12 8 10 11) <-
Unit 4 (-> 13) <- Unit 3 <- Unit 2 <- IT 1
[ 1300.640000] uvcvideo: Found a valid video chain (1 -> 5).
[ 1300.680000] uvcvideo: UVC device initialized.
[ 1300.680000] usbcore: registered new interface driver uvcvideo
[ 1300.684000] USB Video Class driver (v0.1.0)



I launch gstreamer-properties and test : no problem.
I relaunch it : 
 Error running pipeline 'Video for Linux 2 (v4l2)': Failed getting
controls attributes on device "/dev/video0". [v4l2_calls.c(217):
gst_v4l2_fill_lists (): /pipeline0/v4l2src3:
Failed querying control 9963778 on device '/dev/video0'. (5 - Erreur
d'entr?e/sortie)]

dmesg output:

[ 1485.576000] uvcvideo: uvc_v4l2_open
[ 1485.576000] uvcvideo: uvc_v4l2_release
[ 1485.576000] uvcvideo: uvc_v4l2_open
[ 1485.576000] uvcvideo: uvc_v4l2_ioctl
[ 1485.576000] v4l2 ioctl VIDIOC_QUERYCAP, dir=r- (0x80685600)
[ 1485.576000] uvcvideo: uvc_v4l2_ioctl
[ 1485.576000] v4l2 ioctl VIDIOC_ENUMINPUT, dir=rw (0xc04c561a)
[ 1485.576000] uvcvideo: uvc_v4l2_ioctl
[ 1485.576000] v4l2 ioctl VIDIOC_ENUMINPUT, dir=rw (0xc04c561a)
[ 1485.576000] uvcvideo: uvc_v4l2_ioctl
[ 1485.576000] v4l2 ioctl VIDIOC_ENUMSTD, dir=rw (0xc0405619)
[ 1485.576000] uvcvideo: Unsupported ioctl 0xc0405619
[ 1485.576000] uvcvideo: uvc_v4l2_ioctl
[ 1485.576000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.584000] uvcvideo: uvc_v4l2_ioctl
[ 1485.584000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.596000] uvcvideo: uvc_v4l2_ioctl
[ 1485.596000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980903 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980904 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980905 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980906 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980907 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980908 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980909 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x0098090a not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x0098090b not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x0098090c not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x0098090d not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x0098090e not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x0098090f not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980910 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980911 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.608000] uvcvideo: Control 0x00980912 not found.
[ 1485.608000] uvcvideo: uvc_v4l2_ioctl
[ 1485.608000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.616000] uvcvideo: uvc_v4l2_ioctl
[ 1485.616000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.616000] uvcvideo: Control 0x00980914 not found.
[ 1485.616000] uvcvideo: uvc_v4l2_ioctl
[ 1485.616000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.616000] uvcvideo: Control 0x00980915 not found.
[ 1485.616000] uvcvideo: uvc_v4l2_ioctl
[ 1485.616000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.616000] uvcvideo: Control 0x00980916 not found.
[ 1485.616000] uvcvideo: uvc_v4l2_ioctl
[ 1485.616000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.616000] uvcvideo: Control 0x00980917 not found.
[ 1485.616000] uvcvideo: uvc_v4l2_release
[ 1485.620000] uvcvideo: uvc_v4l2_open
[ 1485.620000] uvcvideo: uvc_v4l2_ioctl
[ 1485.620000] v4l2 ioctl VIDIOC_QUERYCAP, dir=r- (0x80685600)
[ 1485.620000] uvcvideo: uvc_v4l2_ioctl
[ 1485.620000] v4l2 ioctl VIDIOC_ENUMINPUT, dir=rw (0xc04c561a)
[ 1485.620000] uvcvideo: uvc_v4l2_ioctl
[ 1485.620000] v4l2 ioctl VIDIOC_ENUMINPUT, dir=rw (0xc04c561a)
[ 1485.620000] uvcvideo: uvc_v4l2_ioctl
[ 1485.620000] v4l2 ioctl VIDIOC_ENUMSTD, dir=rw (0xc0405619)
[ 1485.620000] uvcvideo: Unsupported ioctl 0xc0405619
[ 1485.620000] uvcvideo: uvc_v4l2_ioctl
[ 1485.620000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.628000] uvcvideo: uvc_v4l2_ioctl
[ 1485.628000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.636000] uvcvideo: uvc_v4l2_ioctl
[ 1485.636000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980903 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980904 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980905 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980906 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980907 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980908 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980909 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x0098090a not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x0098090b not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x0098090c not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x0098090d not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x0098090e not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x0098090f not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980910 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980911 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.648000] uvcvideo: Control 0x00980912 not found.
[ 1485.648000] uvcvideo: uvc_v4l2_ioctl
[ 1485.648000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.656000] uvcvideo: uvc_v4l2_ioctl
[ 1485.656000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.656000] uvcvideo: Control 0x00980914 not found.
[ 1485.656000] uvcvideo: uvc_v4l2_ioctl
[ 1485.656000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.656000] uvcvideo: Control 0x00980915 not found.
[ 1485.656000] uvcvideo: uvc_v4l2_ioctl
[ 1485.656000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.656000] uvcvideo: Control 0x00980916 not found.
[ 1485.656000] uvcvideo: uvc_v4l2_ioctl
[ 1485.656000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1485.656000] uvcvideo: Control 0x00980917 not found.
[ 1485.656000] uvcvideo: uvc_v4l2_release
[ 1487.780000] uvcvideo: uvc_v4l2_open
[ 1487.780000] uvcvideo: uvc_v4l2_ioctl
[ 1487.780000] v4l2 ioctl VIDIOC_QUERYCAP, dir=r- (0x80685600)
[ 1487.780000] uvcvideo: uvc_v4l2_ioctl
[ 1487.780000] v4l2 ioctl VIDIOC_ENUMINPUT, dir=rw (0xc04c561a)
[ 1487.780000] uvcvideo: uvc_v4l2_ioctl
[ 1487.780000] v4l2 ioctl VIDIOC_ENUMINPUT, dir=rw (0xc04c561a)
[ 1487.780000] uvcvideo: uvc_v4l2_ioctl
[ 1487.780000] v4l2 ioctl VIDIOC_ENUMSTD, dir=rw (0xc0405619)
[ 1487.780000] uvcvideo: Unsupported ioctl 0xc0405619
[ 1487.780000] uvcvideo: uvc_v4l2_ioctl
[ 1487.780000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1487.792000] uvcvideo: uvc_v4l2_ioctl
[ 1487.792000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1487.800000] uvcvideo: uvc_v4l2_ioctl
[ 1487.800000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
[ 1487.804000] uvcvideo: Failed to query (130) UVC control 7 (unit 2) :
-32 (exp. 2).
[ 1487.804000] uvcvideo: uvc_v4l2_release


Hope this help.

	G.


-- 
Guillaume Desmottes <cass at skynet.be>
Jabber <cassidy at jabber.belnet.be>
GPG 1024D/711E31B1 | 1B5A 1BA8 11AA F0F1 2169  E28A AC55 8671 711E 31B1



From Glenn.West at aarcorp.com  Tue Apr 24 11:27:50 2007
From: Glenn.West at aarcorp.com (Glenn West)
Date: Tue, 24 Apr 2007 17:27:50 +0800
Subject: [Linux-uvc-devel] Color and Resolution - uvcvideo - motion.
Message-ID: <0D7DB474101986479884361BBE91929F01D5352B@sinsiw2k1.aarcorp.com>

I'm running with uvcvideo and motion (svn as of today for uvc, and
motion as of yesterday).

With 320x240 I'm getting bad color artifacts. The camera is a Logitech
sphere MP

 

Greenest tints etc.

 

If I use the same camera under windows, all is well.

 

So looks like the "default" settings are a bit off.

 

 

I'm wearing a light green tie, and  the wall paper is bamboo color.

 

Is there a "way" to set the "defaults" to override what the camera is
returning?

 

Looking at what motion is telling me, the GAMMA is set at 220, the gain
is set at 159

 

 

 

 



DISCLAIMER:
IMPORTANT - This E-Mail is intended for the use of the individual or entity to which it is addressed, and may contain information that is privileged, confidential and exempt from disclosure under applicable law. If the reader of this E-mail is not the intended recipient, or the employee or agent responsible to deliver it to the  intended recipient, you are hereby notified that reading, disseminating, distributing or copying this communication is strictly  PROHIBITED. If you have received this communication in error, please immediately notify AAR CORP by e-mail and return  the original message to us by e-mail. THANK YOU.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070424/1b0bc1ea/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpg
Size: 13483 bytes
Desc: image001.jpg
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070424/1b0bc1ea/attachment.jpg>

From laurent.pinchart at skynet.be  Tue Apr 24 20:37:11 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 20:37:11 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <1177402525.6006.2.camel@cass-wks>
References: <1177199442.26838.11.camel@cass-wks> <462D193D.5010903@gmx.ch>
	<1177402525.6006.2.camel@cass-wks>
Message-ID: <200704242037.12225.laurent.pinchart@skynet.be>

On Tuesday 24 April 2007, Guillaume Desmottes wrote:
> Le lundi 23 avril 2007 ? 22:38 +0200, Thomas Schmid a ?crit :
> > Guillaume Desmottes schrieb:
> > > Le dimanche 22 avril 2007 ? 02:59 +0200, Thomas Schmid a ?crit :
> > >> I think you've a 2006 Model.
> > >> Feisty module doesnt work for me.
> > >> Try it with the snv version.
> > >
> > > I build HEAD module but have still same issues.
> > >
> > > 	G.
> > >
> > >
> > >From this:
> >
> > svn co svn://svn.berlios.de/linux-uvc/linux-uvc/trunk
> >
> > and in the Makefile:
> >
> > INSTALL_MOD_DIR := usb/media (Wrong path!!!!!)
> > INSTALL_MOD_DIR := kernel/ubuntu/media/usbvideo (Right :-)
> >
> > make
> > sudo make install
>
> Yep, that how I build the driver.
>
> > Strange, please do
> >
> > sudo rmmod uvcvideo
> > sudo dmesg -c
> > sudo modprobe uvcvideo trace=0xffff
> >
> > dmesg
>
> Just after driver loading:
>
> # dmesg
[snip]
>
> I launch gstreamer-properties and test : no problem.
> I relaunch it :
>  Error running pipeline 'Video for Linux 2 (v4l2)': Failed getting
> controls attributes on device "/dev/video0". [v4l2_calls.c(217):
> gst_v4l2_fill_lists (): /pipeline0/v4l2src3:
> Failed querying control 9963778 on device '/dev/video0'. (5 - Erreur
> d'entr?e/sortie)]
>
> dmesg output:
>
> [ 1485.576000] uvcvideo: uvc_v4l2_open
[snip]
> [ 1487.800000] v4l2 ioctl VIDIOC_QUERYCTRL, dir=rw (0xc0445624)
> [ 1487.804000] uvcvideo: Failed to query (130) UVC control 7 (unit 2) :
> -32 (exp. 2).
> [ 1487.804000] uvcvideo: uvc_v4l2_release

You might be suffering from a Logitech hardware bug. Search the list archive 
for a so-called "reset patch". It is known to help some people in the past.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 24 21:03:42 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 21:03:42 +0200
Subject: [Linux-uvc-devel] Logitech QuickCam for Notebooks Pro
	(046d:08cb) Problems
In-Reply-To: <200704200755.26404.srichter@cosmos.phy.tufts.edu>
References: <200704200755.26404.srichter@cosmos.phy.tufts.edu>
Message-ID: <200704242103.44339.laurent.pinchart@skynet.be>

Hi Stephan,

> Hello everyone,
>
> after installing -- with some guidance from various forums -- the uvc
> driver for the above cam, I do not get a picture. Below I try to provide
> you with all the infos I have. Please let me know, if I missed something. I
> compiled uvc from trunk, so I can check any fixes at any time:
>
> [srichter at localhost srichter]$ uname -a
> Linux localhost 2.6.17-5mdv #1 SMP Wed Sep 13 14:32:31 EDT 2006 i686
> Intel(R) Pentium(R) M processor 1.70GHz GNU/Linux
>
> [srichter at localhost srichter]$ lsusb
> Bus 006 Device 001: ID 0000:0000
> Bus 007 Device 001: ID 0000:0000
> Bus 005 Device 001: ID 0000:0000
> Bus 004 Device 002: ID 046d:08cb Logitech, Inc.
> Bus 004 Device 001: ID 0000:0000
> Bus 002 Device 001: ID 0000:0000
> Bus 003 Device 001: ID 0000:0000
> Bus 001 Device 001: ID 0000:0000
>
> [srichter at localhost srichter]$ lsmod|grep uvc
> uvcvideo ?? ?? ?? ?? ?? ?? ?? 39524 ??0
> compat_ioctl32 ?? ?? ?? ?? ??1952 ??1 uvcvideo
> v4l1_compat ?? ?? ?? ?? ?? ??14212 ??1 uvcvideo
> videodev ?? ?? ?? ?? ?? ?? ?? ??8064 ??1 uvcvideo
> v4l2_common ?? ?? ?? ?? ?? ??15648 ??1 uvcvideo
> usbcore ?? ?? ?? ?? ?? ?? ?? 113472 ??7
> snd_usb_audio,snd_usb_lib,ohci_hcd,uvcvideo,ehci_hcd,uhci_hcd
>
> [srichter at localhost srichter]$ xawtv
> This is xawtv-3.95, running on Linux/i686 (2.6.17-5mdv)
> xinerama 0: 1920x1200+0+0
> xinerama 1: 1024x768+1920+0
> /dev/video0 [v4l2]: no overlay support
> v4l-conf had some trouble, trying to continue anyway
> Warning: Missing charsets in String to FontSet conversion
> Warning: Missing charsets in String to FontSet conversion
> Warning: Missing charsets in String to FontSet conversion
> ioctl: VIDIOC_G_STD(std=0xbf9804e4
> [PAL_G,PAL_D,PAL_D1,PAL_K,PAL_Nc,SECAM_H,SECAM_K,?ATSC_8_VSB,ATSC_16_VSB,
> (null),(null),(null),(null),(null),(null)]): Invalid argument
> ioctl: VIDIOC_REQBUFS(count=2;type=VIDEO_CAPTURE;memory=MMAP): Success
> ioctl: VIDIOC_S_STD(std=0x0 []): Invalid argument
> ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0
> [];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.s
>econds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0
>;memory=unknown): Invalid argument
> ioctl: VIDIOC_REQBUFS(count=1;type=VIDEO_CAPTURE;memory=MMAP): Invalid
> argument
> ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0
> [];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.s
>econds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0
>;memory=unknown): Invalid argument
> ioctl: VIDIOC_REQBUFS(count=2;type=VIDEO_CAPTURE;memory=MMAP): Invalid
> argument
> ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0
> [];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.s
>econds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0
>;memory=unknown): Invalid argument
> scroll by 137 ?? length 150 ?? ?? ??shown 0.000000 ??top 0.251900 =>
> 0.434567 ioctl: VIDIOC_REQBUFS(count=1;type=VIDEO_CAPTURE;memory=MMAP):
> Invalid argument
> ioctl: VIDIOC_DQBUF(index=0;type=VIDEO_CAPTURE;bytesused=0;flags=0x0
> [];field=ANY;;timecode.type=0;timecode.flags=0;timecode.frames=0;timecode.s
>econds=0;timecode.minutes=0;timecode.hours=0;timecode.userbits="";sequence=0
>;memory=unknown): Invalid argument
> ioctl: VIDIOC_S_CTRL(id=134217741;value=4345): Input/output error
> ioctl: VIDIOC_REQBUFS(count=2;type=VIDEO_CAPTURE;memory=MMAP): Input/output
> error

This is a bug in xawtv.

> [srichter at localhost srichter]$ /usr/local/bin/luvcview
> uvcview verion 0.1.6
> Video driver: x11
> A window manager is available
> video /dev/video0
> Unable to set format: 5.
> ??Init v4L2 failed !! exit fatal
>
> uvcvideo: Failed to query (130) UVC control 2 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (132) UVC control 7 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (131) UVC control 7 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (131) UVC control 3 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (131) UVC control 3 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (1) UVC control 2 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (135) UVC control 3 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (135) UVC control 7 (unit 2) : -110 (exp. 2).
> uvcvideo: Failed to query (132) UVC control 7 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (132) UVC control 2 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (130) UVC control 3 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (1) UVC control 10 (unit 2) : -32 (exp. 2).
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32 (exp. 26).
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -32 (exp. 26).
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
> uvcvideo: Failed to query (1) UVC control 1 (unit 0) : -110 (exp. 26).
> usb 4-1: USB disconnect, address 2
> usb 4-1: new high speed USB device using ehci_hcd and address 3
> usb 4-1: configuration #1 chosen from 1 choice
> uvcvideo: Found UVC 1.00 device <unnamed> (046d:08cb)

You might be suffering from a Logitech hardware bug. Search the list archive 
for a so-called "reset patch". It is known to help some people in the past.

Best regards,

Laurent Pinchart


From pmarques at grupopie.com  Tue Apr 24 20:42:26 2007
From: pmarques at grupopie.com (Paulo Marques)
Date: Tue, 24 Apr 2007 19:42:26 +0100
Subject: [Linux-uvc-devel] Recommended, best supported/least buggy camera
In-Reply-To: <461D5379.8090202@google.com>
References: <461547BC.1060200@google.com>	<200704112311.51581.laurent.pinchart@skynet.be>
	<461D5379.8090202@google.com>
Message-ID: <462E4F92.9030604@grupopie.com>

Joel Ebel wrote:
> Ah. ok.  I was under the impression the bug was only in the Fusion.  I 
> like the design of the Fusion, so I guess we'll run with it, and if we 
> have problems, we'll try the reset patch.

FWIW, I would like to give a quick summary of the worst problems I found
when using a Logitech Ultra Vision camera (I suspect others have similar
problems):

  - when using a resolution of 640x480 (I used only uncompressed YUYV
format) the camera will basically cut the "effective" resolution in half
with frame rates >= 25 fps.

  - except for 30fps, the frame period is always a multiple of 40
milliseconds. If you request 10fps, for instance, you will get
inter-frame periods of 120 -> 80 -> 120 -> 80, etc.

  - at really high resolutions (1280x960) you get at most 8 fps, and if
you request the bayer raw data at 8 bits this will drop to 4 fps or
less, i.e., it is slower for the camera to provide raw data than it is
to provide "processed" data :P

  - if you connect to a USB1.1 port the highest uncompressed resolution
you will get is ~176x132.

  - I don't know if this is driver or camera related, but lots of times
when the camera is streaming video it fails to set standard controls
(brightness, contrast, etc.).

  - sometimes the camera just stops responding completely and needs to
be unplugged and replugged. I guess this is the "firmware hang problem"
that is alleviated by the reset patch (which I haven't tried yet).

Most of these shouldn't be too bad for "regular" webcam usage, though.

BTW, if anyone has different experiences and thinks that I'm doing
something wrong in any of the items above, please let me know.

-- 
Paulo Marques
Software Development Department - Grupo PIE, S.A.
Phone: +351 252 290600, Fax: +351 252 290601
Web: www.grupopie.com


From laurent.pinchart at skynet.be  Tue Apr 24 21:15:15 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 21:15:15 +0200
Subject: [Linux-uvc-devel] Ricoh UVC webcams
In-Reply-To: <8d4807d50704230235j19d65c6dm4efb41ef6dcdf1aa@mail.gmail.com>
References: <8d4807d50704081310j5d4ee8dch58036b9ef692ab33@mail.gmail.com>
	<200704182219.32086.laurent.pinchart@skynet.be>
	<8d4807d50704230235j19d65c6dm4efb41ef6dcdf1aa@mail.gmail.com>
Message-ID: <200704242115.15332.laurent.pinchart@skynet.be>

On Monday 23 April 2007, Sam Revitch wrote:
> On 4/18/07, Laurent Pinchart <laurent.pinchart at skynet.be> wrote:
> > xawtv should support V4L2. I'll have to debug it sometimes to find out if
> > the issue lies in the application or in the driver.
>
> Laurent,
>
> It looks like xawtv is passing its argument to VIDIOC_DQBUF without
> initializing the memory field to V4L2_MEMORY_MMAP.  According to the
> spec, the memory field should be set by the app, so this sounds like
> an xawtv bug.  It also sounds like a video-buf bug to tolerate this
> behavior.

Thanks for the report. Have you/will you file a bug report (with a patch) to 
Gerd Knorr or would you like me to do it ?

> OTOH, there seems little reason for the app to fill in this field
> other than to give the driver something to complain about.  The page
> on the REQBUFS call clearly states that subsequent calls free any
> existing buffers, therefore every buffer associated with a particular
> file handle, if not the whole device (and possibly only for a
> particular "type" of capture) should be of the same "memory" type.  It
> seems redundant to have the app tell it over and over again what
> "memory" of buffer it thinks it is using.

You're probably right there. There might have been a reason to specify the 
memory type when calling VIDIOC_DQBUF, but I don't know what it was. Do you 
want to ask on the video4linux mailing list ?

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 24 21:36:08 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 21:36:08 +0200
Subject: [Linux-uvc-devel] Announcement: unicap / ucview
In-Reply-To: <1177061449.11013.12.camel@localhost>
References: <1177061449.11013.12.camel@localhost>
Message-ID: <200704242136.08899.laurent.pinchart@skynet.be>

Hi Arne,

> Dear UVC users,
>
> This is a plump announcement for my imaging library 'unicap'. You can
> find it at:
>
> http://www.unicap-imaging.org
>
> It supports video-4-linux 2 and works with the UVC driver as far as I
> was able to test.
>
> It would be fine if I can get feedback on which devices work with it and
> which won't. There might be issues with some colour formats which can
> not be translated with the current version.
>
> There is a program called 'ucview' on the download page which provides
> an easy to use graphical interface. Ubuntu users should just be able to
> install the provided packages.

Congratulations for the release. Linux misses a good userspace video library, 
and unicap is certainly a step in the right direction. Only time will say if 
it will become a standard, or if it will serve as a base for a new standard 
library. In any case, your work will be useful.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 24 21:36:48 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 21:36:48 +0200
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <462875EB.9020002@datkan.net>
References: <462875EB.9020002@datkan.net>
Message-ID: <200704242136.48402.laurent.pinchart@skynet.be>

Hi Marcel,

> This was posted on the motion-users list. Now that it has V4L2 it should
> work with UVC-cams.

Thanks for the report. Has anyone tried motion with the uvcvideo driver yet ?

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 24 21:38:57 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 21:38:57 +0200
Subject: [Linux-uvc-devel] Exposure CID
In-Reply-To: <1176974347.6697.19.camel@localhost>
References: <1176974347.6697.19.camel@localhost>
Message-ID: <200704242138.57850.laurent.pinchart@skynet.be>

Hi Arne,

> I see in the driver that the exposure property got a CID in the private
> range ( V4L2_CID_PRIVATE_BASE+11 ) instead of V4L2_CID_EXPOSURE. Can
> anyone tell me the reasoning behind this?

UVC defines relative and absolute exposure controls. As I was not sure how to 
map them to V4L2_CID_EXPOSURE, I used private controls.

I posted a mail a few months ago on the video4linux mailing list to get 
standard UVC controls added to the V4L2 API. Unfortunately, people haven't 
been very enthusiastic. I'll have to try again, hoping to be luckier this 
time.

> This way applications need to know of the private properties just to
> change exposure. Unaware applications would hardly be able to work with
> a camera offering exposure.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Tue Apr 24 21:41:53 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 21:41:53 +0200
Subject: [Linux-uvc-devel] Color and Resolution - uvcvideo - motion.
In-Reply-To: <0D7DB474101986479884361BBE91929F01D5352B@sinsiw2k1.aarcorp.com>
References: <0D7DB474101986479884361BBE91929F01D5352B@sinsiw2k1.aarcorp.com>
Message-ID: <200704242141.54101.laurent.pinchart@skynet.be>

Hi Glenn,

> I'm running with uvcvideo and motion (svn as of today for uvc, and
> motion as of yesterday).
>
> With 320x240 I'm getting bad color artifacts. The camera is a Logitech
> sphere MP
>
> Greenest tints etc.
>
> If I use the same camera under windows, all is well.
>
> So looks like the "default" settings are a bit off.

The default settings are set by the webcam and unchanged by the driver. They 
are reported to userspace applications without being modified.

> I'm wearing a light green tie, and  the wall paper is bamboo color.
>
> Is there a "way" to set the "defaults" to override what the camera is
> returning?
>
> Looking at what motion is telling me, the GAMMA is set at 220, the gain
> is set at 159

Have you tried to webcam with luvcview right after plugging it in ? Do you 
experience the same problems, or are they specific to motion ?

Best regards,

Laurent Pinchart


From Privat_one at gmx.de  Tue Apr 24 19:51:59 2007
From: Privat_one at gmx.de (Dirk Wesenberg)
Date: Tue, 24 Apr 2007 21:51:59 +0400
Subject: [Linux-uvc-devel] Color and Resolution - uvcvideo - motion.
In-Reply-To: <0D7DB474101986479884361BBE91929F01D5352B@sinsiw2k1.aarcorp.com>
References: <0D7DB474101986479884361BBE91929F01D5352B@sinsiw2k1.aarcorp.com>
Message-ID: <200704242152.00094.Privat_one@gmx.de>

Its interessting, but I have spend following: Connect the Cam under windows 
and change the brightness, gamme and contratrast so that the picture is nice. 
Disconnect the Cam and connect back to linux: The values from Windows are 
stored in the Cam ;). I'll hope its help you 

Am Dienstag, 24. April 2007 13:27 schrieb Glenn West:
> I'm running with uvcvideo and motion (svn as of today for uvc, and
> motion as of yesterday).
>
> With 320x240 I'm getting bad color artifacts. The camera is a Logitech
> sphere MP
>
>
>
> Greenest tints etc.
>
>
>
> If I use the same camera under windows, all is well.
>
>
>
> So looks like the "default" settings are a bit off.
>
>
>
>
>
> I'm wearing a light green tie, and  the wall paper is bamboo color.
>
>
>
> Is there a "way" to set the "defaults" to override what the camera is
> returning?
>
>
>
> Looking at what motion is telling me, the GAMMA is set at 220, the gain
> is set at 159
>
>
>
>
>
>
>
>
>
>
>
> DISCLAIMER:
> IMPORTANT - This E-Mail is intended for the use of the individual or entity
> to which it is addressed, and may contain information that is privileged,
> confidential and exempt from disclosure under applicable law. If the reader
> of this E-mail is not the intended recipient, or the employee or agent
> responsible to deliver it to the  intended recipient, you are hereby
> notified that reading, disseminating, distributing or copying this
> communication is strictly  PROHIBITED. If you have received this
> communication in error, please immediately notify AAR CORP by e-mail and
> return  the original message to us by e-mail. THANK YOU.


From srichter at cosmos.phy.tufts.edu  Tue Apr 24 22:12:32 2007
From: srichter at cosmos.phy.tufts.edu (Stephan Richter)
Date: Tue, 24 Apr 2007 16:12:32 -0400
Subject: [Linux-uvc-devel] Logitech QuickCam for Notebooks Pro
	(046d:08cb) Problems
In-Reply-To: <200704242103.44339.laurent.pinchart@skynet.be>
References: <200704200755.26404.srichter@cosmos.phy.tufts.edu>
	<200704242103.44339.laurent.pinchart@skynet.be>
Message-ID: <200704241612.32784.srichter@cosmos.phy.tufts.edu>

On Tuesday 24 April 2007 15:03, Laurent Pinchart wrote:
> You might be suffering from a Logitech hardware bug. Search the list
> archive for a so-called "reset patch". It is known to help some people in
> the past.

Hi Laurent,

thanks for your response. You were right, it was the reset problem. I applied 
the patch from the mailinglist onto the the trunk and after fixing the 
rejection, recompiling and installing it, the camera immediately worked 
without any more work.

I attached the SVN diff output to this mail as reference for others. Is there 
any chance you would put this patch into the trunk?

I used luvcview to test the camera. Then I tried xawtv, but as you mentioned 
due to the bug, it did not work. I also tried Kopete (I have no idea which 
library it uses as a backend) and it would do something, but not a nice 
picture. This leads me to my final question: Which applications are known to 
work well with v4l2/uvc?

Thanks a lot for your help!

Regards,
Stephan
-- 
Stephan Richter
CBU Physics & Chemistry (B.S.) / Tufts Physics (Ph.D. student)
Web2k - Web Software Design, Development and Training
-------------- next part --------------
A non-text attachment was scrubbed...
Name: uvc.patch
Type: text/x-diff
Size: 5833 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070424/3a2ad835/attachment.patch>

From laurent.pinchart at skynet.be  Tue Apr 24 23:03:08 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 24 Apr 2007 23:03:08 +0200
Subject: [Linux-uvc-devel] Logitech QuickCam for Notebooks Pro
	(046d:08cb) Problems
In-Reply-To: <200704241612.32784.srichter@cosmos.phy.tufts.edu>
References: <200704200755.26404.srichter@cosmos.phy.tufts.edu>
	<200704242103.44339.laurent.pinchart@skynet.be>
	<200704241612.32784.srichter@cosmos.phy.tufts.edu>
Message-ID: <200704242303.08832.laurent.pinchart@skynet.be>

Hi Stephan,

On Tuesday 24 April 2007, Stephan Richter wrote:
> On Tuesday 24 April 2007 15:03, Laurent Pinchart wrote:
> > You might be suffering from a Logitech hardware bug. Search the list
> > archive for a so-called "reset patch". It is known to help some people in
> > the past.
>
> thanks for your response. You were right, it was the reset problem. I
> applied the patch from the mailinglist onto the the trunk and after fixing
> the rejection, recompiling and installing it, the camera immediately worked
> without any more work.
>
> I attached the SVN diff output to this mail as reference for others. Is
> there any chance you would put this patch into the trunk?

Thanks for the diff. I'm still having issues with the reset patch, as it's a 
heavy workaround for a still not well understood problem. It also doesn't 
solve all issues with the Logitech hardware bug, some people still can't use 
their webcams despite the patch. I'd like to have a proper fix before 
committing this to the trunk.

> I used luvcview to test the camera. Then I tried xawtv, but as you
> mentioned due to the bug, it did not work. I also tried Kopete (I have no
> idea which library it uses as a backend) and it would do something, but not
> a nice picture. This leads me to my final question: Which applications are
> known to work well with v4l2/uvc?

Marcel van Beurden reported a new motion beta release that might work with the 
Linux UVC driver. Ekiga is known to work, and xawtv should work with the 
attached patch which has been committed to 
svn://svn.berlios.de/linux-uvc/patches/xawtv.

Cheers,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xawtv-3.95.diff
Type: text/x-diff
Size: 427 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070424/64b2c09d/attachment.diff>

From cass at skynet.be  Wed Apr 25 00:05:49 2007
From: cass at skynet.be (Guillaume Desmottes)
Date: Wed, 25 Apr 2007 00:05:49 +0200
Subject: [Linux-uvc-devel] Problems with QuickCam Pro 5000
In-Reply-To: <200704242037.12225.laurent.pinchart@skynet.be>
References: <1177199442.26838.11.camel@cass-wks> <462D193D.5010903@gmx.ch>
	<1177402525.6006.2.camel@cass-wks>
	<200704242037.12225.laurent.pinchart@skynet.be>
Message-ID: <1177452349.6006.11.camel@cass-wks>

Le mardi 24 avril 2007 ? 20:37 +0200, Laurent Pinchart a ?crit :
> You might be suffering from a Logitech hardware bug. Search the list archive 
> for a so-called "reset patch". It is known to help some people in the past.
> 

Laurent you are my hero. I patched using the diff posted by Stephan and
it seems to work perfectly now. :)

Thanks to both of you!

	G.

-- 
Guillaume Desmottes <cass at skynet.be>
Jabber <cassidy at jabber.belnet.be>
GPG 1024D/711E31B1 | 1B5A 1BA8 11AA F0F1 2169  E28A AC55 8671 711E 31B1



From josh.bassett at gmail.com  Wed Apr 25 05:37:02 2007
From: josh.bassett at gmail.com (Joshua Bassett)
Date: Wed, 25 Apr 2007 13:37:02 +1000
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <200704242136.48402.laurent.pinchart@skynet.be>
References: <462875EB.9020002@datkan.net>
	<200704242136.48402.laurent.pinchart@skynet.be>
Message-ID: <462ECCDE.6020403@gmail.com>

Hi Laurent,

I just compiled the latest version of Motion from subversion and it 
works perfectly with uvcvideo (patched as I've got a Logitech QuickCam 
Pro 5000). Rock on!

Josh.


Laurent Pinchart wrote:
> Hi Marcel,
> 
>> This was posted on the motion-users list. Now that it has V4L2 it should
>> work with UVC-cams.
> 
> Thanks for the report. Has anyone tried motion with the uvcvideo driver yet ?
> 
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 


From josh.bassett at gmail.com  Wed Apr 25 08:15:47 2007
From: josh.bassett at gmail.com (Joshua Bassett)
Date: Wed, 25 Apr 2007 16:15:47 +1000
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <462EDDF7.8060604@astronomicalresearchaustralia.org>
References: <462875EB.9020002@datkan.net>	<200704242136.48402.laurent.pinchart@skynet.be>
	<462ECCDE.6020403@gmail.com>
	<462EDDF7.8060604@astronomicalresearchaustralia.org>
Message-ID: <462EF213.8000708@gmail.com>

Hi Brian,

Don't worry about bugging me, that's why I joined the list to bug/be 
bugged. The only thing is that you should CC your emails back to the 
list so that other people can follow what we're doing :)

I'm not 100% sure if you need to patch your uvcvideo...I came across the 
Logitech hardware bug where my QuickCam Pro 5000 would stop working 
randomly. Patching and recompiling uvcvideo seemed to fix the problem. I 
applied the patch from Stefan Monnier's email:

http://lists.berlios.de/pipermail/linux-uvc-devel/2007-March/001476.html

I've attached the patch as a diff file to make it easier for you.

Firstly, checkout the latest version of uvcvideo from subversion:

svn co svn://svn.berlios.de/linux-uvc/linux-uvc/trunk linux-uvc
cd linux-uvc

Then save the diff file (attached) to the linux-uvc directory and patch 
the source tree:

patch < logitech.patch

Compile and install it (as root):

rmmod uvcvideo # Unload the unpatched driver.
make && make install
modprobe uvcvideo # Load the patched driver.

Now is probably a good time to check your camera is still working with 
whatever software you know it should work with (you mentioned Ekiga).

As for Motion, if you want to be able to output MPEGs then you must 
first install FFmpeg (if not then skip this step):

svn co svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
cd ffmpeg
./configure --disable-static --enable-shared
make && make install

Now checkout the latest version of Motion, compile and install it:

svn co http://www.lavrsen.dk/svn/motion/trunk motion
cd motion
./configure
make && make install

The configuration file is installed to /usr/local/etc/motion-dist.conf 
by default. Rename it as /usr/local/etc/motion.conf and then edit it to 
your liking...descriptions of all the options are available on the wiki 
(http://www.lavrsen.dk/twiki/bin/view/Motion/ConfigFileOptions).

Good luck,

Josh.


Brian wrote:
> Josh,
> Sorry to bug you but I have a quickcam Fusion which I would like to test
> with Motion.
> 
> I have used subversion a bit, but not very experienced.
> Would you have some steps I could follow to get the job done.
> eg. I am pretty sure I do not have the patched version of uvcvideo as I
> do not know how to apply patches.
> What was the svn command you used to get Motion down.
> 
> I have compiled the head version of Ekiga and that works no problem.
> 
> Appreciate any suggestions,
> 
> Thanks,
> Brian
> 
> Joshua Bassett wrote:
>> Hi Laurent,
>>
>> I just compiled the latest version of Motion from subversion and it 
>> works perfectly with uvcvideo (patched as I've got a Logitech QuickCam 
>> Pro 5000). Rock on!
>>
>> Josh.
>>
>>
>> Laurent Pinchart wrote:
>>> Hi Marcel,
>>>
>>>> This was posted on the motion-users list. Now that it has V4L2 it should
>>>> work with UVC-cams.
>>> Thanks for the report. Has anyone tried motion with the uvcvideo driver yet ?
>>>
>>> Laurent Pinchart
>>> _______________________________________________
>>> Linux-uvc-devel mailing list
>>> Linux-uvc-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>>
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: logitech.patch
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070425/6d999acd/attachment.ksh>

From dfgweb at dfg.homedns.org  Wed Apr 25 12:08:53 2007
From: dfgweb at dfg.homedns.org (David)
Date: Wed, 25 Apr 2007 12:08:53 +0200
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <200704242136.48402.laurent.pinchart@skynet.be>
References: <462875EB.9020002@datkan.net>
	<200704242136.48402.laurent.pinchart@skynet.be>
Message-ID: <462F28B5.4000001@dfg.homedns.org>

Hi Laurent,

Tried it and it work with my Logitech Fusion.

But I can't change resolution, always in 1024x576 in YUV format !
I tried to set 352x288 (MJPG) but it always select 1024x576 YUV format !

If you know how to change this behaviour, I'm ready to test more. ;-)

Regards,
David

Laurent Pinchart a ?crit :
> Hi Marcel,
>
>   
>> This was posted on the motion-users list. Now that it has V4L2 it should
>> work with UVC-cams.
>>     
>
> Thanks for the report. Has anyone tried motion with the uvcvideo driver yet ?
>
> Laurent Pinchart
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>   




From bnc at astronomicalresearchaustralia.org  Wed Apr 25 14:04:28 2007
From: bnc at astronomicalresearchaustralia.org (Brian)
Date: Wed, 25 Apr 2007 22:04:28 +1000
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <462F28B5.4000001@dfg.homedns.org>
References: <462875EB.9020002@datkan.net>	<200704242136.48402.laurent.pinchart@skynet.be>
	<462F28B5.4000001@dfg.homedns.org>
Message-ID: <462F43CC.1000407@astronomicalresearchaustralia.org>

David,
> But I can't change resolution, always in 1024x576 in YUV format !
> I tried to set 352x288 (MJPG) but it always select 1024x576 YUV format !
> 
I can confirm that. I have set my motion.conf file to 920x760, but still
get 1024x576. On going back into the conf file I find that has been
changed back too.

Brian
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bnc.vcf
Type: text/x-vcard
Size: 110 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070425/ce04e7cd/attachment.vcf>

From bnc at astronomicalresearchaustralia.org  Wed Apr 25 13:55:50 2007
From: bnc at astronomicalresearchaustralia.org (Brian)
Date: Wed, 25 Apr 2007 21:55:50 +1000
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <462EF213.8000708@gmail.com>
References: <462875EB.9020002@datkan.net>	<200704242136.48402.laurent.pinchart@skynet.be>
	<462ECCDE.6020403@gmail.com>
	<462EDDF7.8060604@astronomicalresearchaustralia.org>
	<462EF213.8000708@gmail.com>
Message-ID: <462F41C6.7040902@astronomicalresearchaustralia.org>

Josh,
Thanks heaps, apart from the . missing in front of the /configure the
instructions below were PERFECT.

Obviously I have only tested the basics but it all seems to work for my
Quickcam Fusion.

1) Control via the web browser was no problem after I found that you
needed localhost or 127.0.0.1

2) Making a movie, taking a snapshot or getting an image via movement no
problem.

3) did notice an interrupt to my sound when an image was taken, so it
needs a bit of processing grunt.

4) I clicked on makemovie and got a 15sec one(I guess that is a default
somewhere) but no sound.

Is there a way to record sound with the image?

I want to use the webcam to monitor a remote controlled Telescope.
Part of the warning feedback is from the sound the scope makes so
getting the sound working would be good.

5) I have compiled the uvcvideo with the patch in and so far I have
stopped and started the camera more than 10 times without it freezing.


6) by default it wants to write the pid to /var/run/motion.pid
on my system this is a root file so I could only run the daemon from
root. Change the pid directory to a local one and it ran from my userid
no problem.

7) tested connection to the web browser port with Firefox, Opera,
Seamonkey and Konqueror. They all displayed images but firefox only
displayed the first image.



Thanks again,
Brian




Joshua Bassett wrote:
> Hi Brian,
> 
> Don't worry about bugging me, that's why I joined the list to bug/be
> bugged. The only thing is that you should CC your emails back to the
> list so that other people can follow what we're doing :)
> 
> I'm not 100% sure if you need to patch your uvcvideo...I came across the
> Logitech hardware bug where my QuickCam Pro 5000 would stop working
> randomly. Patching and recompiling uvcvideo seemed to fix the problem. I
> applied the patch from Stefan Monnier's email:
> 
> http://lists.berlios.de/pipermail/linux-uvc-devel/2007-March/001476.html
> 
> I've attached the patch as a diff file to make it easier for you.
> 
> Firstly, checkout the latest version of uvcvideo from subversion:
> 
> svn co svn://svn.berlios.de/linux-uvc/linux-uvc/trunk linux-uvc
> cd linux-uvc
> 
> Then save the diff file (attached) to the linux-uvc directory and patch
> the source tree:
> 
> patch < logitech.patch
> 
> Compile and install it (as root):
> 
> rmmod uvcvideo # Unload the unpatched driver.
> make && make install
> modprobe uvcvideo # Load the patched driver.
> 
> Now is probably a good time to check your camera is still working with
> whatever software you know it should work with (you mentioned Ekiga).
> 
> As for Motion, if you want to be able to output MPEGs then you must
> first install FFmpeg (if not then skip this step):
> 
> svn co svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
> cd ffmpeg
> /configure --disable-static --enable-shared
> make && make install
> 
> Now checkout the latest version of Motion, compile and install it:
> 
> svn co http://www.lavrsen.dk/svn/motion/trunk motion
> cd motion
> /configure
> make && make install
> 
> The configuration file is installed to /usr/local/etc/motion-dist.conf
> by default. Rename it as /usr/local/etc/motion.conf and then edit it to
> your liking...descriptions of all the options are available on the wiki
> (http://www.lavrsen.dk/twiki/bin/view/Motion/ConfigFileOptions).
> 
> Good luck,
> 
> Josh.
> 
> 
> Brian wrote:
>> Josh,
>> Sorry to bug you but I have a quickcam Fusion which I would like to test
>> with Motion.
>>
>> I have used subversion a bit, but not very experienced.
>> Would you have some steps I could follow to get the job done.
>> eg. I am pretty sure I do not have the patched version of uvcvideo as I
>> do not know how to apply patches.
>> What was the svn command you used to get Motion down.
>>
>> I have compiled the head version of Ekiga and that works no problem.
>>
>> Appreciate any suggestions,
>>
>> Thanks,
>> Brian
>>
>> Joshua Bassett wrote:
>>> Hi Laurent,
>>>
>>> I just compiled the latest version of Motion from subversion and it
>>> works perfectly with uvcvideo (patched as I've got a Logitech
>>> QuickCam Pro 5000). Rock on!
>>>
>>> Josh.
>>>
>>>
>>> Laurent Pinchart wrote:
>>>> Hi Marcel,
>>>>
>>>>> This was posted on the motion-users list. Now that it has V4L2 it
>>>>> should
>>>>> work with UVC-cams.
>>>> Thanks for the report. Has anyone tried motion with the uvcvideo
>>>> driver yet ?
>>>>
>>>> Laurent Pinchart
>>>> _______________________________________________
>>>> Linux-uvc-devel mailing list
>>>> Linux-uvc-devel at lists.berlios.de
>>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>>>
>>> _______________________________________________
>>> Linux-uvc-devel mailing list
>>> Linux-uvc-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: bnc.vcf
Type: text/x-vcard
Size: 110 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070425/ad665a10/attachment.vcf>

From s.cantos at neopost.com  Wed Apr 25 14:59:03 2007
From: s.cantos at neopost.com (Sebastien Cantos)
Date: Wed, 25 Apr 2007 14:59:03 +0200
Subject: [Linux-uvc-devel] motion color problem
Message-ID: <012601c78739$808390a0$9100a8c0@rese0001>

Hello,

 

I?m using motion (last beta version with v4l2 support) together with uvc
driver and a Logitech qc pro 5000 webcam. All is working well but I?ve
strange color outputs (lots of green and pink colors) . 

I?m using a 1.1 usb port so the first problem I encountered was that motion
has priorities for palettes and it tries to use YUV palettes before MJPEG
ones. It seems that it cannot be possible to usr resolution like 320*240 in
yuv format with 1.1 usb port, I?ve then modified motion (video2.c) to make
sure MJPEG is used. Now I can have motion run in MJPEG 640*480. 

 

The problem is that colors are bad with this palette. I guess I?ve two
options:

1/ I?ve seen a recent post saying that it can be possible to config gama and
other parameters using windows and the putting back the cam on linux. I?ve
tried the cam on windows and colors are ok (should I changed the parameters?
If yes, what parameters should I use? )

 

2/ Is there a way to make uvcvideo output higher resolution with a 1.1 usb
port (I only need one image per second) ? 

 

 

Thanks in advance for your answers. 

 

Regards,

 

Sebastien. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070425/8eb11eee/attachment.html>

From einstein14 at free.Fr  Wed Apr 25 21:29:11 2007
From: einstein14 at free.Fr (albert einstein)
Date: Wed, 25 Apr 2007 21:29:11 +0200
Subject: [Linux-uvc-devel] [Microsoft NX-6000] /dev/video0 not create
Message-ID: <462FAC07.9080905@free.Fr>

Hello,
	I tried to install a lifecam NX-6000 on my gentoo.
I have tried with the ebuild and with the svn. In both case my problem 
is the same.
When I modprobe uvcvideo I get this messages in dmesg:


uvcvideo: Found UVC 1.00 device Microsoft? LifeCam NX-6000 (045e:00f8)
uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to initialize the device (-5).
usbcore: registered new interface driver uvcvideo
USB Video Class driver (v0.1.0)

And /dev/video0 isn't create so luvcview complain about not finding it.
after a mknod /dev/video0 c 81 0 luvcview say:

luvcview version 0.2.0
Video driver: x11
A window manager is available
video /dev/video0
ERROR opening V4L interface
: No such device

Reading other messages post here i tried modprobe uvcvideo trace=255 and 
I get those line:
uvcvideo: Adding mapping Brightness to control 
00000000-0000-0000-0000-000000000101/2.
uvcvideo: Adding mapping Contrast to control 
00000000-0000-0000-0000-000000000101/3.
uvcvideo: Adding mapping Hue to control 
00000000-0000-0000-0000-000000000101/6.
uvcvideo: Adding mapping Saturation to control 
00000000-0000-0000-0000-000000000101/7.
uvcvideo: Adding mapping Sharpness to control 
00000000-0000-0000-0000-000000000101/8.
uvcvideo: Adding mapping Gamma to control 
00000000-0000-0000-0000-000000000101/9.
uvcvideo: Adding mapping Backlight Compensation to control 
00000000-0000-0000-0000-000000000101/1.
uvcvideo: Adding mapping Gain to control 
00000000-0000-0000-0000-000000000101/4.
uvcvideo: Adding mapping Power Line Frequency to control 
00000000-0000-0000-0000-000000000101/5.
uvcvideo: Adding mapping Hue, Auto to control 
00000000-0000-0000-0000-000000000101/16.
uvcvideo: Adding mapping Pan (relative) to control 
63610682-5070-49ab-b8cc-b3855e8d2256/1.
uvcvideo: Adding mapping Tilt (relative) to control 
63610682-5070-49ab-b8cc-b3855e8d2256/1.
uvcvideo: Adding mapping Pan/Tilt (reset) to control 
63610682-5070-49ab-b8cc-b3855e8d2256/2.
uvcvideo: Adding mapping Exposure, Auto to control 
00000000-0000-0000-0000-000000000001/2.
uvcvideo: Adding mapping Exposure (Absolute) to control 
00000000-0000-0000-0000-000000000001/4.
uvcvideo: Adding mapping White Balance Temperature, Auto to control 
00000000-0000-0000-0000-000000000101/11.
uvcvideo: Adding mapping White Balance Temperature to control 
00000000-0000-0000-0000-000000000101/10.
uvcvideo: Probing generic UVC device 2
uvcvideo: Found format MJPEG.
uvcvideo: - 352x288 (30.0 fps)
uvcvideo: - 1600x1200 (7.5 fps)
uvcvideo: - 1280x1024 (7.5 fps)
uvcvideo: - 1024x768 (7.5 fps)
uvcvideo: - 800x600 (30.0 fps)
uvcvideo: - 640x480 (30.0 fps)
uvcvideo: - 320x240 (30.0 fps)
uvcvideo: - 176x144 (30.0 fps)
uvcvideo: - 160x120 (30.0 fps)
uvcvideo: Found a Status endpoint (addr 83).
uvcvideo: Found UVC 1.00 device Microsoft? LifeCam NX-6000 (045e:00f8)
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device 
2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to 
device 2 entity 5
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to 
device 2 entity 5
uvcvideo: Scanning UVC chain: OT 3 <- Unit 5 <- Unit 4 <- IT 1
uvcvideo: Found a valid video chain (1 -> 3).
uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
uvcvideo: Failed to initialize the device (-5).
usbcore: registered new interface driver uvcvideo
USB Video Class driver (v0.1.0)


syslog says some words about udev and uvcvideo that i join at this message.

Do you have any idea of what I can try to make this tiny webcam working?

Thanks a lot for your help and for uvccideo

Bye
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: messageudev
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070425/c96163ef/attachment.ksh>

From laurent.pinchart at skynet.be  Wed Apr 25 22:21:07 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 25 Apr 2007 22:21:07 +0200
Subject: [Linux-uvc-devel] [Microsoft NX-6000] /dev/video0 not create
In-Reply-To: <462FAC07.9080905@free.Fr>
References: <462FAC07.9080905@free.Fr>
Message-ID: <200704252221.07731.laurent.pinchart@skynet.be>

Hi,

> Hello,
> 	I tried to install a lifecam NX-6000 on my gentoo.
> I have tried with the ebuild and with the svn. In both case my problem
> is the same.
> When I modprobe uvcvideo I get this messages in dmesg:
>
>
> uvcvideo: Found UVC 1.00 device Microsoft? LifeCam NX-6000 (045e:00f8)
> uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
> uvcvideo: Failed to initialize the device (-5).
> usbcore: registered new interface driver uvcvideo
> USB Video Class driver (v0.1.0)
>
[snip]
>
> Do you have any idea of what I can try to make this tiny webcam working?

Yep, try to update your sources from SVN to get the patch that has been 
committed a few minutes ago :-)

> Thanks a lot for your help and for uvccideo

You're welcome. Please tell me if the latest driver version works with the 
NX-6000.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 25 22:23:32 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 25 Apr 2007 22:23:32 +0200
Subject: [Linux-uvc-devel] Motion Beta release supports V4L2
In-Reply-To: <462F41C6.7040902@astronomicalresearchaustralia.org>
References: <462875EB.9020002@datkan.net> <462EF213.8000708@gmail.com>
	<462F41C6.7040902@astronomicalresearchaustralia.org>
Message-ID: <200704252223.33286.laurent.pinchart@skynet.be>

Hi Josh and Brian,

Thanks for the reports. I'm glad we now have a new application working with 
the driver. Little by little I'm sure we can get most applications ported to 
V4L2 :-)

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Apr 25 22:42:26 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 25 Apr 2007 22:42:26 +0200
Subject: [Linux-uvc-devel] motion color problem
In-Reply-To: <012601c78739$808390a0$9100a8c0@rese0001>
References: <012601c78739$808390a0$9100a8c0@rese0001>
Message-ID: <200704252242.26788.laurent.pinchart@skynet.be>

Hi Sebastien,

> I'm using motion (last beta version with v4l2 support) together with uvc
> driver and a Logitech qc pro 5000 webcam. All is working well but I've
> strange color outputs (lots of green and pink colors) .

You're not the first user to report that, so it seems I'll have to 
investigate :-)

> I'm using a 1.1 usb port so the first problem I encountered was that motion
> has priorities for palettes and it tries to use YUV palettes before MJPEG
> ones. It seems that it cannot be possible to usr resolution like 320*240 in
> yuv format with 1.1 usb port, I've then modified motion (video2.c) to make
> sure MJPEG is used. Now I can have motion run in MJPEG 640*480.
>
> The problem is that colors are bad with this palette. I guess I've two
> options:
>
> 1/ I've seen a recent post saying that it can be possible to config gama
> and other parameters using windows and the putting back the cam on linux.
> I've tried the cam on windows and colors are ok (should I changed the
> parameters? If yes, what parameters should I use?)

Motion support setting brightness, contrast and hue. If other parameters are 
needed, it should be quite straightforward to add them. The colour artifacts 
you reported are probably due to invalid hue and/or saturation parameters.

To get the "proper" parameters, you could either use luvcview and change them 
manually until you are satisfied, or boot Windows to set the parameters and 
reboot under Linux without unplugging the webcam (don't turn off the 
computer, just reboot it). You will then have to find a way to query the 
parameters (luvcview might be able to do that).

> 2/ Is there a way to make uvcvideo output higher resolution with a 1.1 usb
> port (I only need one image per second) ?

Maybe, but not with a Quickcam Pro 5000, as the webcam has a VGA sensor.

Best regards,

Laurent Pinchart


From einstein14 at free.Fr  Thu Apr 26 10:33:14 2007
From: einstein14 at free.Fr (albert einstein)
Date: Thu, 26 Apr 2007 10:33:14 +0200
Subject: [Linux-uvc-devel] [Microsoft NX-6000] /dev/video0 not create
In-Reply-To: <200704252221.07731.laurent.pinchart@skynet.be>
References: <462FAC07.9080905@free.Fr>
	<200704252221.07731.laurent.pinchart@skynet.be>
Message-ID: <463063CA.3060804@free.Fr>

Hi,
Laurent Pinchart a ?crit :
> Hi,
> 
>> Hello,
>> 	I tried to install a lifecam NX-6000 on my gentoo.
>> I have tried with the ebuild and with the svn. In both case my problem
>> is the same.
>> When I modprobe uvcvideo I get this messages in dmesg:
>>
>>
>> uvcvideo: Found UVC 1.00 device Microsoft? LifeCam NX-6000 (045e:00f8)
>> uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
>> uvcvideo: Failed to initialize the device (-5).
>> usbcore: registered new interface driver uvcvideo
>> USB Video Class driver (v0.1.0)
>>
> [snip]
>> Do you have any idea of what I can try to make this tiny webcam working?
> 
> Yep, try to update your sources from SVN to get the patch that has been 
> committed a few minutes ago :-)
> 
>> Thanks a lot for your help and for uvccideo
> 
> You're welcome. Please tell me if the latest driver version works with the 
> NX-6000.
> 
> Cheers,
> 
> Laurent Pinchart
Thanks for your help.
With the last version if I connect my webcam after a modprobe 
/dev/video0 is created and luvcview grab the video. So it's a very good 
point :p

But (yes there is a but) I tried to use ekiga. My webcam is well found 
by this software but when I tried to activate it the "microsoft" on the 
webcam blink a little and then shutdown. Ekiga display a message saying 
that there is an error when opening the device.
dmesg display this messages:

uvcvideo: uvc_v4l2_open
uvcvideo: uvc_v4l2_ioctl
v4l2 ioctl VIDIOC_QUERYCAP, dir=r- (0x80685600)
uvcvideo: uvc_v4l2_release
uvcvideo: uvc_v4l2_open
uvcvideo: uvc_v4l2_ioctl
v4l2 ioctl VIDIOC_QUERYCAP, dir=r- (0x80685600)
uvcvideo: uvc_v4l2_release

So I think that now this is a ekiga but if you have a new bright idea 
i'm ready to test it ;)


From s.cantos at neopost.com  Thu Apr 26 15:18:09 2007
From: s.cantos at neopost.com (Sebastien Cantos)
Date: Thu, 26 Apr 2007 15:18:09 +0200
Subject: [Linux-uvc-devel] motion color problem
In-Reply-To: <200704252242.26788.laurent.pinchart@skynet.be>
References: <012601c78739$808390a0$9100a8c0@rese0001> 
	<200704252242.26788.laurent.pinchart@skynet.be>
Message-ID: <017401c78805$56fbb920$9100a8c0@rese0001>

Hi Laurent, 

Thx for your quick answer. I've tried the webcam both on windows (without
changing any param) and with lucview and the image seems to be correct (no
artifacts). The bug seems related to motion ... (maybe motion is readjusting
params for itself). I don't know if you can reproduce my config to see what
I'm talking. I've taken a snapshot and put it on my public webspace:
http://people.projet7.org/~truff/motion_test.jpg

What's strange is that the artifacts are related to some parts of the
picture but not all (see on the motion_test.jpg the black chair on the
right, it seems that there's a mask just upon it whith good colors but not
on top of this). 

Now I really don't know where to investigate but I'll be glad to help in
debugging this if you can provide me with some hints. 

Best regards,

Sebastien. 

-----Message d'origine-----
De?: Laurent Pinchart [mailto:laurent.pinchart at skynet.be] 
Envoy??: mercredi 25 avril 2007 22:42
??: linux-uvc-devel at lists.berlios.de
Cc?: Sebastien Cantos
Objet?: Re: [Linux-uvc-devel] motion color problem

Hi Sebastien,

> I'm using motion (last beta version with v4l2 support) together with uvc
> driver and a Logitech qc pro 5000 webcam. All is working well but I've
> strange color outputs (lots of green and pink colors) .

You're not the first user to report that, so it seems I'll have to 
investigate :-)

> I'm using a 1.1 usb port so the first problem I encountered was that
motion
> has priorities for palettes and it tries to use YUV palettes before MJPEG
> ones. It seems that it cannot be possible to usr resolution like 320*240
in
> yuv format with 1.1 usb port, I've then modified motion (video2.c) to make
> sure MJPEG is used. Now I can have motion run in MJPEG 640*480.
>
> The problem is that colors are bad with this palette. I guess I've two
> options:
>
> 1/ I've seen a recent post saying that it can be possible to config gama
> and other parameters using windows and the putting back the cam on linux.
> I've tried the cam on windows and colors are ok (should I changed the
> parameters? If yes, what parameters should I use?)

Motion support setting brightness, contrast and hue. If other parameters are

needed, it should be quite straightforward to add them. The colour artifacts

you reported are probably due to invalid hue and/or saturation parameters.

To get the "proper" parameters, you could either use luvcview and change
them 
manually until you are satisfied, or boot Windows to set the parameters and 
reboot under Linux without unplugging the webcam (don't turn off the 
computer, just reboot it). You will then have to find a way to query the 
parameters (luvcview might be able to do that).

> 2/ Is there a way to make uvcvideo output higher resolution with a 1.1 usb
> port (I only need one image per second) ?

Maybe, but not with a Quickcam Pro 5000, as the webcam has a VGA sensor.

Best regards,

Laurent Pinchart



From marco.buschini at gmail.com  Sat Apr 28 19:21:39 2007
From: marco.buschini at gmail.com (Marco L. Buschini)
Date: Sat, 28 Apr 2007 19:21:39 +0200
Subject: [Linux-uvc-devel] Logitech Quickcam Ultra Vision
Message-ID: <74fee0340704281021q723f5eb1n424dac9c9e2ca4ee@mail.gmail.com>

Hello,
I recently bought a Logitech Quickcam Ultra Vision. I was quite sure
it was supported by the uvcvideo driver, since it is listed in the
supported devices section of https://linux-uvc.berlios.de/. It does
not work, however. Reading the mailing list archives I discovered that
that webcam has timing issues and will never work with the uvcvideo
driver. My question is: why that webcam is still listed as supported?
Or, perhaps, did I miss something and somebody fixed the driver so
that now it works?

Please, remove the Logitech Quickcam Ultra Vision from the list of
supported devices (so nobody else wastes EUR 130 as I think I did), or
point me to a page, or a post, or something, that explains me how to
make it work. (I tried only with xawtv, a black window appeared and
the blue light of the camera didn't light up).

Thank you
Marco


From pmarques at grupopie.com  Sat Apr 28 19:34:51 2007
From: pmarques at grupopie.com (Paulo Marques)
Date: Sat, 28 Apr 2007 18:34:51 +0100
Subject: [Linux-uvc-devel] Logitech Quickcam Ultra Vision
In-Reply-To: <74fee0340704281021q723f5eb1n424dac9c9e2ca4ee@mail.gmail.com>
References: <74fee0340704281021q723f5eb1n424dac9c9e2ca4ee@mail.gmail.com>
Message-ID: <463385BB.5050408@grupopie.com>

Marco L. Buschini wrote:
> Hello,

Hi,

> I recently bought a Logitech Quickcam Ultra Vision. I was quite sure
> it was supported by the uvcvideo driver, since it is listed in the
> supported devices section of https://linux-uvc.berlios.de/. It does
> not work, however. 

What exactly doesn't work for you?

The camera might have some issues (as they all do), but it mostly works
for me.

> Reading the mailing list archives I discovered that
> that webcam has timing issues and will never work with the uvcvideo
> driver. My question is: why that webcam is still listed as supported?
> Or, perhaps, did I miss something and somebody fixed the driver so
> that now it works?
> 
> Please, remove the Logitech Quickcam Ultra Vision from the list of
> supported devices (so nobody else wastes EUR 130 as I think I did), or
> point me to a page, or a post, or something, that explains me how to
> make it work. (I tried only with xawtv, a black window appeared and
> the blue light of the camera didn't light up).

Maybe xawtv only uses video4linux version 1. The UVC driver only
supports video4linux version 2.

Try the camera with luvcview. You can get it here:

http://mxhaard.free.fr/spca50x/Investigation/uvc/luvcview-20070107.tar.gz

It needs SDL development headers installed on your system to compile,
though.

I hope this helps,

-- 
Paulo Marques



From marco.buschini at gmail.com  Sat Apr 28 19:53:36 2007
From: marco.buschini at gmail.com (Marco L. Buschini)
Date: Sat, 28 Apr 2007 19:53:36 +0200
Subject: [Linux-uvc-devel] Logitech Quickcam Ultra Vision
In-Reply-To: <463385BB.5050408@grupopie.com>
References: <74fee0340704281021q723f5eb1n424dac9c9e2ca4ee@mail.gmail.com>
	<463385BB.5050408@grupopie.com>
Message-ID: <74fee0340704281053t686d0fc5x390c07bd016ba7d5@mail.gmail.com>

Hello,
of course it was my fault and you where right about xawtv. I just
tried luvcview as you suggested and the webcam started to work.

Thank you very much for your help.
Marco


From pundiramit at gmail.com  Sun Apr 29 15:22:06 2007
From: pundiramit at gmail.com (amit pundir)
Date: Sun, 29 Apr 2007 18:52:06 +0530
Subject: [Linux-uvc-devel] compile time error
Message-ID: <52c7556c0704290622s446d48c6x5e76b29a533e4441@mail.gmail.com>

while compiling linux-uvc module.. i got the following error..
any help in this regard will be appreciated..


Building USB Video Class driver...
make[1]: Entering directory `/usr/src/linux-headers-2.6.20-15-386'
  CC [M]  /usr/src/modules/linux-uvc/uvcvideo.o
In file included from /usr/src/modules/linux-uvc/uvcvideo.c:49:
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:8: error: nested redefinition
of ?enum v4l2_frmsizetypes?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:8: error: redeclaration of
?enum v4l2_frmsizetypes?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:9: error: redeclaration of
enumerator ?V4L2_FRMSIZE_TYPE_DISCRETE?
include/linux/videodev2.h:287: error: previous definition of
?V4L2_FRMSIZE_TYPE_DISCRETE? was here
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:10: error: redeclaration of
enumerator ?V4L2_FRMSIZE_TYPE_CONTINUOUS?
include/linux/videodev2.h:288: error: previous definition of
?V4L2_FRMSIZE_TYPE_CONTINUOUS? was here
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:11: error: redeclaration of
enumerator ?V4L2_FRMSIZE_TYPE_STEPWISE?
include/linux/videodev2.h:289: error: previous definition of
?V4L2_FRMSIZE_TYPE_STEPWISE? was here
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:14: error: nested redefinition
of ?enum v4l2_frmivaltypes?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:14: error: redeclaration of
?enum v4l2_frmivaltypes?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:15: error: redeclaration of
enumerator ?V4L2_FRMIVAL_TYPE_DISCRETE?
include/linux/videodev2.h:327: error: previous definition of
?V4L2_FRMIVAL_TYPE_DISCRETE? was here
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:16: error: redeclaration of
enumerator ?V4L2_FRMIVAL_TYPE_CONTINUOUS?
include/linux/videodev2.h:328: error: previous definition of
?V4L2_FRMIVAL_TYPE_CONTINUOUS? was here
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:17: error: redeclaration of
enumerator ?V4L2_FRMIVAL_TYPE_STEPWISE?
include/linux/videodev2.h:329: error: previous definition of
?V4L2_FRMIVAL_TYPE_STEPWISE? was here
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:24: error: redefinition of
?struct v4l2_frmsize_discrete?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:32: error: redefinition of
?struct v4l2_frmsize_stepwise?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:52: error: redefinition of
?struct v4l2_frmsizeenum?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:73: error: redefinition of
?struct v4l2_frmival_stepwise?
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:84: error: redefinition of
?struct v4l2_frmivalenum?
In file included from /usr/src/modules/linux-uvc/uvcvideo.c:49:
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:116:1: warning:
"VIDIOC_ENUM_FRAMESIZES" redefined
In file included from include/linux/videodev.h:15,
                 from /usr/src/modules/linux-uvc/uvcvideo.c:38:
include/linux/videodev2.h:1339:1: warning: this is the location of the
previous definition
In file included from /usr/src/modules/linux-uvc/uvcvideo.c:49:
/usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:117:1: warning:
"VIDIOC_ENUM_FRAMEINTERVALS" redefined
In file included from include/linux/videodev.h:15,
                 from /usr/src/modules/linux-uvc/uvcvideo.c:38:
include/linux/videodev2.h:1340:1: warning: this is the location of the
previous definition
/usr/src/modules/linux-uvc/uvcvideo.c: In function ?uvc_init_isoc?:
/usr/src/modules/linux-uvc/uvcvideo.c:1612: warning: assignment from
incompatible pointer type
/usr/src/modules/linux-uvc/uvcvideo.c: In function ?uvc_init_status?:
/usr/src/modules/linux-uvc/uvcvideo.c:3814: warning: passing argument 6 of
?usb_fill_int_urb? from incompatible pointer type
make[2]: *** [/usr/src/modules/linux-uvc/uvcvideo.o] Error 1
make[1]: *** [_module_/usr/src/modules/linux-uvc] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.20-15-386'
make: *** [uvcvideo] Error 2

output of lsusb:
Bus 005 Device 002: ID 046d:08c6 Logitech, Inc.

-- 
Thanks and Regards
Amit Pundir

"Disclaimer: The opinions expressed herein are not necessarily those of my
employer, not necessarily mine, and probably not necessary."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20070429/7465b698/attachment.html>

From Glenn.West at aarcorp.com  Mon Apr 30 03:47:11 2007
From: Glenn.West at aarcorp.com (Glenn West)
Date: Mon, 30 Apr 2007 09:47:11 +0800
Subject: [Linux-uvc-devel] Color Problem - uvc + sphere mp
In-Reply-To: <mailman.111.1177668088.21969.linux-uvc-devel@lists.berlios.de>
References: <mailman.111.1177668088.21969.linux-uvc-devel@lists.berlios.de>
Message-ID: <0D7DB474101986479884361BBE91929F01E5FC6E@sinsiw2k1.aarcorp.com>

The problem I was having with UVC Logitech sphere was do to 
A missing patch in motion.

http://www.lavrsen.dk/twiki/bin/view/Motion/MjpegToYUV420pPatch

Now I get lovely color using the UVC camera and motion.

I use the latest svn as of today, and the above patch, and everything is
fine.




DISCLAIMER:
IMPORTANT - This E-Mail is intended for the use of the individual or entity to which it is addressed, and may contain information that is privileged, confidential and exempt from disclosure under applicable law. If the reader of this E-mail is not the intended recipient, or the employee or agent responsible to deliver it to the  intended recipient, you are hereby notified that reading, disseminating, distributing or copying this communication is strictly  PROHIBITED. If you have received this communication in error, please immediately notify AAR CORP by e-mail and return  the original message to us by e-mail. THANK YOU.


From laurent.pinchart at skynet.be  Mon Apr 30 22:22:18 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 30 Apr 2007 22:22:18 +0200
Subject: [Linux-uvc-devel] compile time error
In-Reply-To: <52c7556c0704290622s446d48c6x5e76b29a533e4441@mail.gmail.com>
References: <52c7556c0704290622s446d48c6x5e76b29a533e4441@mail.gmail.com>
Message-ID: <200704302222.18449.laurent.pinchart@skynet.be>

Hi Amit,

> while compiling linux-uvc module.. i got the following error..
> any help in this regard will be appreciated..
>
>
> Building USB Video Class driver...
> make[1]: Entering directory `/usr/src/linux-headers-2.6.20-15-386'
>   CC [M]  /usr/src/modules/linux-uvc/uvcvideo.o
> In file included from /usr/src/modules/linux-uvc/uvcvideo.c:49:
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:8: error: nested redefinition
> of ?enum v4l2_frmsizetypes?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:8: error: redeclaration of
> ?enum v4l2_frmsizetypes?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:9: error: redeclaration of
> enumerator ?V4L2_FRMSIZE_TYPE_DISCRETE?
> include/linux/videodev2.h:287: error: previous definition of
> ?V4L2_FRMSIZE_TYPE_DISCRETE? was here
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:10: error: redeclaration of
> enumerator ?V4L2_FRMSIZE_TYPE_CONTINUOUS?
> include/linux/videodev2.h:288: error: previous definition of
> ?V4L2_FRMSIZE_TYPE_CONTINUOUS? was here
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:11: error: redeclaration of
> enumerator ?V4L2_FRMSIZE_TYPE_STEPWISE?
> include/linux/videodev2.h:289: error: previous definition of
> ?V4L2_FRMSIZE_TYPE_STEPWISE? was here
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:14: error: nested redefinition
> of ?enum v4l2_frmivaltypes?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:14: error: redeclaration of
> ?enum v4l2_frmivaltypes?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:15: error: redeclaration of
> enumerator ?V4L2_FRMIVAL_TYPE_DISCRETE?
> include/linux/videodev2.h:327: error: previous definition of
> ?V4L2_FRMIVAL_TYPE_DISCRETE? was here
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:16: error: redeclaration of
> enumerator ?V4L2_FRMIVAL_TYPE_CONTINUOUS?
> include/linux/videodev2.h:328: error: previous definition of
> ?V4L2_FRMIVAL_TYPE_CONTINUOUS? was here
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:17: error: redeclaration of
> enumerator ?V4L2_FRMIVAL_TYPE_STEPWISE?
> include/linux/videodev2.h:329: error: previous definition of
> ?V4L2_FRMIVAL_TYPE_STEPWISE? was here
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:24: error: redefinition of
> ?struct v4l2_frmsize_discrete?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:32: error: redefinition of
> ?struct v4l2_frmsize_stepwise?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:52: error: redefinition of
> ?struct v4l2_frmsizeenum?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:73: error: redefinition of
> ?struct v4l2_frmival_stepwise?
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:84: error: redefinition of
> ?struct v4l2_frmivalenum?
> In file included from /usr/src/modules/linux-uvc/uvcvideo.c:49:
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:116:1: warning:
> "VIDIOC_ENUM_FRAMESIZES" redefined
> In file included from include/linux/videodev.h:15,
>                  from /usr/src/modules/linux-uvc/uvcvideo.c:38:
> include/linux/videodev2.h:1339:1: warning: this is the location of the
> previous definition
> In file included from /usr/src/modules/linux-uvc/uvcvideo.c:49:
> /usr/src/modules/linux-uvc/v4l2_enumfrmfmt.h:117:1: warning:
> "VIDIOC_ENUM_FRAMEINTERVALS" redefined
> In file included from include/linux/videodev.h:15,
>                  from /usr/src/modules/linux-uvc/uvcvideo.c:38:
> include/linux/videodev2.h:1340:1: warning: this is the location of the
> previous definition
> /usr/src/modules/linux-uvc/uvcvideo.c: In function ?uvc_init_isoc?:
> /usr/src/modules/linux-uvc/uvcvideo.c:1612: warning: assignment from
> incompatible pointer type
> /usr/src/modules/linux-uvc/uvcvideo.c: In function ?uvc_init_status?:
> /usr/src/modules/linux-uvc/uvcvideo.c:3814: warning: passing argument 6 of
> ?usb_fill_int_urb? from incompatible pointer type
> make[2]: *** [/usr/src/modules/linux-uvc/uvcvideo.o] Error 1
> make[1]: *** [_module_/usr/src/modules/linux-uvc] Error 2
> make[1]: Leaving directory `/usr/src/linux-headers-2.6.20-15-386'
> make: *** [uvcvideo] Error 2

You're using a waaaaaaaaaaaaay old driver version. Please checkout the latest 
driver from SVN as explained on http://linux-uvc.berlios.de.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Mon Apr 30 22:23:35 2007
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Mon, 30 Apr 2007 22:23:35 +0200
Subject: [Linux-uvc-devel] Color Problem - uvc + sphere mp
In-Reply-To: <0D7DB474101986479884361BBE91929F01E5FC6E@sinsiw2k1.aarcorp.com>
References: <mailman.111.1177668088.21969.linux-uvc-devel@lists.berlios.de>
	<0D7DB474101986479884361BBE91929F01E5FC6E@sinsiw2k1.aarcorp.com>
Message-ID: <200704302223.35355.laurent.pinchart@skynet.be>

Hi Glenn,

> The problem I was having with UVC Logitech sphere was do to
> A missing patch in motion.
>
> http://www.lavrsen.dk/twiki/bin/view/Motion/MjpegToYUV420pPatch
>
> Now I get lovely color using the UVC camera and motion.
>
> I use the latest svn as of today, and the above patch, and everything is
> fine.

Thanks for the report.

Cheers,

Laurent Pinchart


