<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Quickam E 3500 plus and auto exposure
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2008-November/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Quickam%20E%203500%20plus%20and%20auto%20exposure&In-Reply-To=%3C200811161657.58495.laurent.pinchart%40skynet.be%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004243.html">
   <LINK REL="Next"  HREF="004247.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Quickam E 3500 plus and auto exposure</H1>
    <B>Laurent Pinchart</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Quickam%20E%203500%20plus%20and%20auto%20exposure&In-Reply-To=%3C200811161657.58495.laurent.pinchart%40skynet.be%3E"
       TITLE="[Linux-uvc-devel] Quickam E 3500 plus and auto exposure">laurent.pinchart at skynet.be
       </A><BR>
    <I>Sun Nov 16 16:57:58 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="004243.html">[Linux-uvc-devel] Quickam E 3500 plus and auto exposure
</A></li>
        <LI>Next message: <A HREF="004247.html">[Linux-uvc-devel] Quickam E 3500 plus and auto exposure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4244">[ date ]</a>
              <a href="thread.html#4244">[ thread ]</a>
              <a href="subject.html#4244">[ subject ]</a>
              <a href="author.html#4244">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mauro,

On Sunday 16 November 2008, Mauro Grauso wrote:
&gt;<i> Hi Laurent,
</I>&gt;<i>
</I>&gt;<i> First of all thanks for the reply and the support.
</I>
You're welcome.

&gt;<i> &gt;&gt; Basically when there's not enough
</I>&gt;<i> &gt;&gt; light the camera is compensating (very well actually) and the
</I>&gt;<i> &gt;&gt; framerate drops to 3fps, when there's daylight it still compensate and
</I>&gt;<i> &gt;&gt; the framerate is about 15/20fps (@640x480).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's quite usual with webcams. Cheap mass market CMOS sensors are not
</I>&gt;<i> &gt; very light sensitive and perform quite bad under low light conditions.
</I>&gt;<i> &gt; Increasing the exposure time automatically helps but at the cost of image
</I>&gt;<i> &gt; quality (more noise, blurry images, ...).
</I>&gt;<i>
</I>&gt;<i> I can confirm that to you. With low light I still get a very good
</I>&gt;<i> picture, but the framerate is terribly low (the light compensation
</I>&gt;<i> doesn't seem to affect image quality that is always quite good).
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; The odd thing is that sometimes (but I haven't been able to reproduce
</I>&gt;<i> &gt;&gt; it) the camera just doesn't use the auto exposure feature when I plug
</I>&gt;<i> &gt;&gt; it in and, even if the image is darker, I get constant 30fps.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's indeed weird. Auto-exposure should be enabled. How many times have
</I>&gt;<i> &gt; you encountered the issue ?
</I>&gt;<i>
</I>&gt;<i> I've had this camera for only a few days, but this inconsistent
</I>&gt;<i> behaviour showed up only once or twice. Do you know if this camera has
</I>&gt;<i> any eprom to save settings? Is it possible that softwares (I tried
</I>&gt;<i> skype, mplayer and luvcview) overwrite camera's defaults to put their
</I>&gt;<i> settings? This would explain the unconsistent behaviour.
</I>
Not that I know of. That would be too expensive.

&gt;<i> &gt;&gt; Now I would really like to know how to turn off and on the auto
</I>&gt;<i> &gt;&gt; exposure and white balance feature of the camera from the driver. If I
</I>&gt;<i> &gt;&gt; try to turn off the auto exposure from the luvcview interface, I get
</I>&gt;<i> &gt;&gt; &quot;Set Auto Exposure off error&quot; in the standard error.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Your luvcview version might be outdated. Could you try the latest one
</I>&gt;<i> &gt; (available from quickcamteam.net) or the uvcdynctrl command line tool
</I>&gt;<i> &gt; (from the libwebcam package available on the same website) ?
</I>&gt;<i>
</I>&gt;<i> I'm using luvcview 0.2.4 (latest luvcview ubuntu package).
</I>&gt;<i>
</I>&gt;<i> I compiled the latest uvcdynctrl (0.2) and here is some output:
</I>
I'm afraid that's outdated :-/ Could you please check the last version out 
from the SVN repository ?

&gt;<i> ./uvcdynctrl-0.2 -l
</I>&gt;<i> [libwebcam] Unknown V4L2 control ID encountered: 10094849
</I>&gt;<i> [libwebcam] Unknown V4L2 control ID encountered: 10094850
</I>&gt;<i> [libwebcam] Unknown V4L2 control ID encountered: 10094851
</I>
Those warnings should disappear with the last version.

&gt;<i> Listing available devices:
</I>&gt;<i>   video0   UVC Camera (046d:09a4)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ./uvcdynctrl-0.2 -c
</I>&gt;<i> [libwebcam] Unknown V4L2 control ID encountered: 10094849
</I>&gt;<i> [libwebcam] Unknown V4L2 control ID encountered: 10094850
</I>&gt;<i> [libwebcam] Unknown V4L2 control ID encountered: 10094851
</I>&gt;<i> Listing available controls for device video0:
</I>&gt;<i>   Exposure, Auto Priority
</I>&gt;<i>   Exposure (Absolute)
</I>&gt;<i>   Exposure, Auto
</I>
The controls are properly detected.

&gt;<i>   Backlight Compensation
</I>&gt;<i>   Sharpness
</I>&gt;<i>   White Balance Temperature
</I>&gt;<i>   Power Line Frequency
</I>&gt;<i>   Gain
</I>&gt;<i>   White Balance Temperature, Auto
</I>&gt;<i>   Saturation
</I>&gt;<i>   Contrast
</I>&gt;<i>   Brightness
</I>
[snip]

Please try to modify the exposure controls using the -s option to uvcdynctrl.

&gt;<i> &gt;&gt; And sometimes (often, but not always!) I also get the following in
</I>&gt;<i> &gt;&gt; syslog when I plug the cam, but the error doesn't stop the cam from
</I>&gt;<i> &gt;&gt; working:
</I>&gt;<i> &gt;&gt; Nov 15 14:39:34 greywolf kernel: [11981.960176] uvcvideo: Failed to
</I>&gt;<i> &gt;&gt; query (1) UVC control 1 (unit 0) : -110 (exp. 26).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I don't like that one, it reminds me of the Logitech firmware bug that is
</I>&gt;<i> &gt; not supposed to happen with that camera :-/
</I>&gt;<i>
</I>&gt;<i> The strange thing is that I usually get this line in syslog only if I
</I>&gt;<i> unplug and then replug the camera. the first time I plug it on a clean
</I>&gt;<i> boot it doesn't show up.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; Anyways the camera works even if I get these &quot;soft&quot; errors in syslog.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I would have thought the last error (&quot;Failed to query...&quot;) would prevent
</I>&gt;<i> &gt; the driver from initialising the camera properly. Could you please show
</I>&gt;<i> &gt; me all messages printed by the driver to the kernel log when the problem
</I>&gt;<i> &gt; occurs ?
</I>&gt;<i>
</I>&gt;<i> Ok let's assume that the problem is always present, as the auto
</I>&gt;<i> exposure is usually default to on. I made a clean boot of my pc and on
</I>&gt;<i> first connection of the camera I get the following syslog:
</I>
By problem I meant the &quot;Failed to query...&quot; message.

[snip ]

&gt;<i> now if I launch luvcview I get a good picture but low framerate (auto
</I>&gt;<i> exposure on). Important: I can also confirm that the settings are
</I>&gt;<i> saved somewhere because last time I plugged the webcam I tried it with
</I>&gt;<i> kopete, and it did screw all the settings giving an awful picture.
</I>&gt;<i> Plugging the cam now I got the same crappy output (till I clicked on
</I>&gt;<i> &quot;reset to defaults&quot; switch in luvcview).
</I>
Set the driver trace parameter to 64 before plugging the camera (echo 64 
&gt;<i> /sys/modules/uvcvideo/parameters/trace). The driver will then log a message 
</I>when an ioctl is called. Plug the camera and check if a userspace application 
invokes VIDIOC_S_CTRL to restore controls.

&gt;<i> If I click on &quot;auto exposure off&quot; I still get &quot;Set Auto Exposure off
</I>&gt;<i> error&quot; in stderr.
</I>
Please try to set the auto exposure control with uvcdynctrl.

&gt;<i> If I unplug and replug the camera I get the following syslog:
</I>&gt;<i>
</I>&gt;<i> Nov 16 16:00:26 greywolf kernel: [20030.102631] usb 2-1: USB
</I>&gt;<i> disconnect, address 6
</I>&gt;<i>
</I>&gt;<i> Nov 16 16:00:40 greywolf kernel: [20043.553039] usb 2-1: new high
</I>&gt;<i> speed USB device using ehci_hcd and address 7
</I>&gt;<i> Nov 16 16:00:40 greywolf kernel: [20043.794369] usb 2-1: configuration
</I>&gt;<i> #1 chosen from 1 choice
</I>&gt;<i> Nov 16 16:00:40 greywolf kernel: [20043.794860] uvcvideo: Found UVC
</I>&gt;<i> 1.00 device &lt;unnamed&gt; (046d:09a4)
</I>&gt;<i> Nov 16 16:00:40 greywolf kernel: [20043.828903] input: UVC Camera
</I>&gt;<i> (046d:09a4) as
</I>&gt;<i> /devices/pci0000:00/0000:00:02.1/usb2/2-1/2-1:1.0/input/input8 Nov 16
</I>&gt;<i> 16:00:41 greywolf kernel: [20044.857100] 7:3:1: cannot set freq 16000 to ep
</I>&gt;<i> 0x86
</I>&gt;<i> Nov 16 16:00:41 greywolf kernel: [20045.072108] uvcvideo: Failed to
</I>&gt;<i> query (1) UVC control 1 (unit 0) : -110 (exp. 26).
</I>&gt;<i> Nov 16 16:00:42 greywolf kernel: [20045.521117] uvcvideo: Failed to
</I>&gt;<i> query (1) UVC control 1 (unit 0) : -32 (exp. 26).
</I>&gt;<i> Nov 16 16:00:43 greywolf kernel: [20046.521233] uvcvideo: Failed to
</I>&gt;<i> query (1) UVC control 1 (unit 0) : -110 (exp. 26).
</I>&gt;<i> Nov 16 16:00:44 greywolf kernel: [20047.520218] uvcvideo: Failed to
</I>&gt;<i> query (1) UVC control 1 (unit 0) : -110 (exp. 26).
</I>
If those messages were generated from actions taken by the driver during 
device initialisation the errors would be fatal. This seems to indicate that 
a userspace application tries to access the device. Setting trace to 64 will 
confirm that.

[snip]

&gt;<i> I'm almost sure turning off auto exposure is a matter of finding out
</I>&gt;<i> how the cam saves its settings. It's possible that I got the smooth
</I>&gt;<i> output just the first time I plugged the cam in (with factory
</I>&gt;<i> defaults). the driver can't correctly set back the exposure value, so
</I>&gt;<i> the factory setting can't be restored. Also other settings that some
</I>&gt;<i> software changes become the default when the cam is plugged back in.
</I>
I really doubt the camera includes an EEPROM to store control values (but I 
might of course be wrong). Please try to set auto-exposure off with 
uvcdynctrl. If it works the problem is probably in luvcview. If it doesn't 
we'll have a look somewhere else.

Best regards,

Laurent Pinchart

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004243.html">[Linux-uvc-devel] Quickam E 3500 plus and auto exposure
</A></li>
	<LI>Next message: <A HREF="004247.html">[Linux-uvc-devel] Quickam E 3500 plus and auto exposure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4244">[ date ]</a>
              <a href="thread.html#4244">[ thread ]</a>
              <a href="subject.html#4244">[ subject ]</a>
              <a href="author.html#4244">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
