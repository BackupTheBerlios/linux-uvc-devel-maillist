<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Issues%20with%20the%20Linux%20UVC%20driver%20%28Was%20%22Where%0A%09is%20V4L%20headed%20%3F%22%29&In-Reply-To=%3Cd9def9db0705061026y3b560bf9t3828043758d38acf%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001686.html">
   <LINK REL="Next"  HREF="001688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)</H1>
    <B>Markus Rechberger</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20Issues%20with%20the%20Linux%20UVC%20driver%20%28Was%20%22Where%0A%09is%20V4L%20headed%20%3F%22%29&In-Reply-To=%3Cd9def9db0705061026y3b560bf9t3828043758d38acf%40mail.gmail.com%3E"
       TITLE="[Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)">mrechberger at gmail.com
       </A><BR>
    <I>Sun May  6 19:26:13 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001686.html">[Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)
</A></li>
        <LI>Next message: <A HREF="001688.html">[Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1687">[ date ]</a>
              <a href="thread.html#1687">[ thread ]</a>
              <a href="subject.html#1687">[ subject ]</a>
              <a href="author.html#1687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/6/07, Laurent Pinchart &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">laurent.pinchart at skynet.be</A>&gt; wrote:
&gt;<i> On Sunday 06 May 2007, Markus Rechberger wrote:
</I>&gt;<i> &gt; On 5/6/07, Laurent Pinchart &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">laurent.pinchart at skynet.be</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; On Sunday 06 May 2007, Markus Rechberger wrote:
</I>&gt;<i> &gt; &gt; &gt; On 5/6/07, Laurent Pinchart &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">laurent.pinchart at skynet.be</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Let's move this discussion to the linux-uvc-devel list. I CCed
</I>&gt;<i> &gt; &gt; &gt; &gt; video4linux-list for reference, please reply to linux-uvc-devel only
</I>&gt;<i> &gt; &gt; &gt; &gt; to avoid
</I>&gt;<i> &gt; &gt; &gt; &gt; flooding the video4linux list.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; On Saturday 05 May 2007, Markus Rechberger wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; [snip non-uvc issues]
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; I'll just write all my considerations here, you can put the ML
</I>&gt;<i> into
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; CC and/or split up the topics:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 1.)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: ekiga: page allocation failure.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; order:10, mode:0x0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [__alloc_pages+629/646]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; __alloc_pages+0x275/0x286
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [__get_free_pages+26/51]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; __get_free_pages+0x1a/0x33
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [dma_alloc_coherent+170/222]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; dma_alloc_coherent+0xaa/0xde
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [pg0+513461816/1069679616]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; uvc_init_video_bulk+0xb7/0x143 [uvcvideo]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [pg0+513462425/1069679616]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; uvc_video_enable+0xfe/0x121 [uvcvideo]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [pg0+513458219/1069679616]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; uvc_v4l2_do_ioctl+0x830/0x8bf [uvcvideo]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [dput+24/373] dput+0x18/0x175
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [__link_path_walk+2824/3148]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; __link_path_walk+0xb08/0xc4c
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [n_tty_receive_buf+3303/3378]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; n_tty_receive_buf+0xce7/0xd32
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [get_page_from_freelist+635/798]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; get_page_from_freelist+0x27b/0x31e
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [wakeup_kswapd+45/104]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; wakeup_kswapd+0x2d/0x68 May  5 20:14:19 debian kernel:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [pg0+511673193/1069679616]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; video_usercopy+0x112/0x1a3 [videodev]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [vma_prio_tree_insert+23/42]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; vma_prio_tree_insert+0x17/0x2a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [vma_link+218/247]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; vma_link+0xda/0xf7 May  5 20:14:19 debian kernel:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [pg0+513458420/1069679616] uvc_v4l2_ioctl+0x3a/0x40 [uvcvideo]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [pg0+513456123/1069679616]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; uvc_v4l2_do_ioctl+0x0/0x8bf [uvcvideo]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [do_ioctl+76/98]
</I>&gt;<i> do_ioctl+0x4c/0x62
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel:  [vfs_ioctl+583/602]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; vfs_ioctl+0x247/0x25a May  5 20:14:19 debian kernel:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; [sys_ioctl+51/76]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; sys_ioctl+0x33/0x4c May  5 20:14:19 debian kernel:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; [syscall_call+7/11]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; syscall_call+0x7/0xb May  5 20:14:19 debian kernel:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; =======================
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Mem-info:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: DMA per-cpu:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: CPU    0: Hot: hi:    0, btch:   1
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; usd: 0   Cold: hi:    0, btch:   1 usd:   0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Normal per-cpu:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: CPU    0: Hot: hi:  186, btch:  31
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; usd: 13   Cold: hi:   62, btch:  15 usd:  51
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Active:93485 inactive:7268 dirty:0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; writeback:0 unstable:0 free:1171 slab:5255 mapped:15182
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; pagetables:980 May  5 20:14:19 debian kernel: DMA free:1928kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; min:92kB low:112kB high:136kB active:10716kB inactive:0kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; present:16256kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; pages_scanned:429 all_unreclaimable? no
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: lowmem_reserve[]: 0 459
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Normal free:2756kB min:2692kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; low:3364kB high:4036kB active:363224kB inactive:29072kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; present:470284kB pages_scanned:291 all_unreclaimable? no
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: lowmem_reserve[]: 0 0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: DMA: 4*4kB 1*8kB 1*16kB 1*32kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 1*64kB 0*128kB 1*256kB 1*512kB 1*1024kB 0*2048kB 0*4096kB = 1928kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Normal: 47*4kB 5*8kB 12*16kB 3*32kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 1*64kB 1*128kB 0*256kB 0*512kB 0*1024kB 1*2048kB 0*4096kB = 2756kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Swap cache: add 440134, delete
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 421407, find 136779/175577, race 0+0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Free swap  = 455676kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Total swap = 976888kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: Free swap:       455676kB
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 122592 pages of RAM
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 0 pages of HIGHMEM
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 1844 reserved pages
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 70305 pages shared
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 18727 pages swap cached
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 0 pages dirty
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 0 pages writeback
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 15182 pages mapped
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 5253 pages slab
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; May  5 20:14:19 debian kernel: 980 pages pagetables
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; This happens either if a box has 256 mb ram, or is almost out of
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; physical memory.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; The other driver I have works properly with it. After a fresh
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; reboot the uvcvideo driver seems to work for a while.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Oh, an OOM issue.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; The driver allocates memory for bulk/isochronous transfers based on
</I>&gt;<i> &gt; &gt; &gt; &gt; two parameters. The first one is the maximum payload transfer size,
</I>&gt;<i> &gt; &gt; &gt; &gt; as reported by the device. I can't do much about that one. The
</I>&gt;<i> second
</I>&gt;<i> &gt; &gt; &gt; &gt; one is the number of URBs allocated by the driver. This is currently
</I>&gt;<i> &gt; &gt; &gt; &gt; hardcoded to 5, but could be made configurable or could be computed
</I>&gt;<i> &gt; &gt; &gt; &gt; based on the maximum payload transfer size. I'll look into this
</I>&gt;<i> &gt; &gt; &gt; &gt; issue.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; this really seems to be an issue with usb_buffer_alloc() after that
</I>&gt;<i> &gt; &gt; &gt; call fails the whole memory management goes dizzy.
</I>&gt;<i> &gt; &gt; &gt; It tries to swap out almost all the physical memory hangs for a while
</I>&gt;<i> &gt; &gt; &gt; and copies the swapped memory back to physical memory till it becomes
</I>&gt;<i> &gt; &gt; &gt; normal again.
</I>&gt;<i> &gt; &gt; &gt; I also see that more than half of the system memory is used as cache,
</I>&gt;<i> &gt; &gt; &gt; since usb_buffer_alloc is called with GFP_KERNEL it might wait until
</I>&gt;<i> &gt; &gt; &gt; some cache memory gets released for it. I added Greg to that mail
</I>&gt;<i> &gt; &gt; &gt; since I think that he knows alot about the usb framework itself.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If the system goes unstable when I try to request more than the
</I>&gt;<i> available
</I>&gt;<i> &gt; &gt; memory, there's not much I can do about it. The driver fails gracefully
</I>&gt;<i> &gt; &gt; when memory allocation fails. I seriously doubt that the kernel memory
</I>&gt;<i> &gt; &gt; manager makes the system unstable when a driver tries to allocate a usb
</I>&gt;<i> &gt; &gt; buffer bigger than the available memory. Maybe you have an issue
</I>&gt;<i> specific
</I>&gt;<i> &gt; &gt; to your system ? I'm not familiar with the memory allocator internals,
</I>&gt;<i> &gt; &gt; maybe Greg will be able to help.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It is like I explained it above. The system becomes very slow because
</I>&gt;<i> &gt; of moving almost everything to swap and copying it back to memory
</I>&gt;<i> &gt; again.
</I>&gt;<i>
</I>&gt;<i> Ok.
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; &gt;  dwMaxVideoFrameBufferSize     2752512 (which is used for
</I>&gt;<i> &gt; &gt; &gt; usb_buffer_alloc, seems to be too much already)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The bulk buffers are allocated using dwMaxPayloadTransferSize.
</I>&gt;<i> &gt; &gt; Isochronous buffers are allocated using dwMaxVideoFrameSize, which is
</I>&gt;<i> &gt; &gt; clearly a bug. I'm working on a fix.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The stack trace you posted shows your device uses bulk transfers. Could
</I>&gt;<i> &gt; &gt; you tell me how big dwMaxPayloadTransferSize is ? If the devices insists
</I>&gt;<i> &gt; &gt; on using
</I>&gt;<i> &gt; &gt; huge buffers, there's not much I can do about it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I simply wouldn't allocate that much memory for the urbs, this way
</I>&gt;<i> &gt; seems to work reliable with the driver I have.
</I>&gt;<i> &gt; I added some debug at the allocation it is 2.7 MB/URB
</I>&gt;<i>
</I>&gt;<i> I suspect that the dwMaxPayloadTransferSize value is thus equal to 2752512
</I>&gt;<i> as
</I>&gt;<i> well.
</I>&gt;<i>
</I>&gt;<i> For bulk transfers, you are right, I could allocate smaller URBs. As bulk
</I>&gt;<i> transfers are guaranteed, I can split payloads across multiple URBs. For
</I>&gt;<i> isochronous transfers that won't be possible.
</I>&gt;<i>
</I>
it is also possible for isochronous transfers, if the framebuffer
doesn't get fully filled just drop the frame.
By experience this works very well with em28xx based devices.

&gt;<i> Thanks for reporting the problem, I can now work on a fix.
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; &gt; I don't have a problem with that in my uvc driver since I only
</I>&gt;<i> &gt; &gt; &gt; allocate memory for max. 640x480 and do not support a higher mode.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The comparison is thus not fair, is it ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I explained it the wrong way, my driver allocates much less than your
</I>&gt;<i> &gt; one for the URBs and it also works reliable when all the system memory
</I>&gt;<i> &gt; is in use (system + cache)
</I>&gt;<i>
</I>&gt;<i> OK.
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; &gt; &gt; Could you please post the output of lsusb -v (with usbutils 0.72 or
</I>&gt;<i> &gt; &gt; &gt; &gt; later) ? Thanks.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; (think that value was what you were looking for)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'm interested in the lsusb output as well (the dwMaxPayloadTransferSize
</I>&gt;<i> &gt; &gt; value
</I>&gt;<i> &gt; &gt; is also interesting and not reported by the usb descriptors).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; attached the uvc log.
</I>&gt;<i>
</I>&gt;<i> Thanks.
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 2.) No v4l1 support using the compat layer
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; I read some discussions about not supporting v4l1, as a point from
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; the userside it simply has to work and there are still
</I>&gt;<i> applications
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; out there which only support v4l1, I read that a compat version of
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; that driver is available but you don't want it in the main driver.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; The Linux UVC driver calls v4l_compat_translate_ioctl() for all
</I>&gt;<i> &gt; &gt; &gt; &gt; non-handled ioctls. The compat layer is thus used. It seems the
</I>&gt;<i> &gt; &gt; &gt; &gt; problem comes from a required v4l1 ioctl not handled properly by the
</I>&gt;<i> &gt; &gt; &gt; &gt; compat layer. I haven't looked into that issue, as I don't plan to
</I>&gt;<i> &gt; &gt; &gt; &gt; support v4l1 explicitly in the driver.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; as for my drivers I always saw this as an open issue too, there is no
</I>&gt;<i> &gt; &gt; &gt; reason to not add support for it at least, it just requires a few more
</I>&gt;<i> &gt; &gt; &gt; ioctl controls.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Applications should be ported to v4l2. It's difficult to push
</I>&gt;<i> application
</I>&gt;<i> &gt; &gt; developers to port their software if everything is still completely v4l1
</I>&gt;<i> &gt; &gt; compatible.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; should yes but it's not so much work to add v4l1 compatibilty support
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 3.) Some controls are missing, for example mplayer isn't supported
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; by just running
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; mplayer -tv driver=v4l2 <A HREF="tv://">tv://</A>
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; mplayer is buggy. It doesn't set the v4l2_buffer.memory field prior
</I>&gt;<i> &gt; &gt; &gt; &gt; to dequeuing buffers, as required by the v4l2 specification. I think
</I>&gt;<i> &gt; &gt; &gt; &gt; a patch has been applied to the mplayer repository to fix this
</I>&gt;<i> issue.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I see xawtv doesn't work either here, the em28xx driver works with
</I>&gt;<i> &gt; &gt; &gt; both without the need of any patches. xawtv is used as a reference for
</I>&gt;<i> &gt; &gt; &gt; some other userspace applications since it has been available for a
</I>&gt;<i> &gt; &gt; &gt; very long time already.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; xawtv is buggy too, unfortunately. Many drivers don't check the
</I>&gt;<i> &gt; &gt; v4l2_buffer.memory field when handling VIDIOC_DQBUF, which leads to
</I>&gt;<i> buggy
</I>&gt;<i> &gt; &gt; applications being undetected. We should either fix all drivers to check
</I>&gt;<i> &gt; &gt; the memory field, or change the v4l2 spec to remove the requirement.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The v4l2 specs are drafted, in that case it's better to fix the
</I>&gt;<i> &gt; uvcvideo driver and correct the specs if you want to get it work.
</I>&gt;<i> &gt; If you see a serious problem in that i'd be curious to know about it,
</I>&gt;<i> &gt; I haven't experienced any problems with the em28xx nor other drivers.
</I>&gt;<i>
</I>&gt;<i> Sam Revitch e-mailed the video4linux-list on May the 1st (&quot;VIDIOC_DQBUF and
</I>&gt;<i> v4l2_buffer.memory&quot;). He explained the issue quite clearly, but nobody
</I>&gt;<i> answered him.
</I>&gt;<i>
</I>
ah fine I'll read it when I'm back

Markus

&gt;<i> &gt; &gt; &gt; &gt; &gt; 4.) read() isn't supported
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; That's right, and this is definitely a shortcomming. I plan to
</I>&gt;<i> &gt; &gt; &gt; &gt; support read(),
</I>&gt;<i> &gt; &gt; &gt; &gt; but this hasn't been done yet. If you need read() support for a
</I>&gt;<i> &gt; &gt; &gt; &gt; specific application, we could work together to add it to the driver
</I>&gt;<i> &gt; &gt; &gt; &gt; as quickly as possible.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 5.) I'd like to share common code between usb video devices, the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; em28xx driver supports slicing the video and piping a part of the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; video to /dev/vbi for example (raw vbi).
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 6.) Mauro also wrote some ideas about having a general usb
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; framework since all devices share common parts.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; these points would be part of the agenda which I'd like to discuss
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; with you and Mauro actually.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; I plan to see if I can use video-buf in the Linux UVC driver.
</I>&gt;<i> &gt; &gt; &gt; &gt; However, this might not be beneficial to all users. The buffer queue
</I>&gt;<i> &gt; &gt; &gt; &gt; code in the UVC driver
</I>&gt;<i> &gt; &gt; &gt; &gt; is USB-specific, and is thus smaller than video-buf. Users who
</I>&gt;<i> &gt; &gt; &gt; &gt; currently don't use video-buf would see their memory usage grow.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Laurent Pinchart
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; (I'll answer the other issues later)
</I>&gt;<i>
</I>&gt;<i> Laurent Pinchart
</I>&gt;<i>
</I>

-- 
Markus Rechberger

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001686.html">[Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)
</A></li>
	<LI>Next message: <A HREF="001688.html">[Linux-uvc-devel] Issues with the Linux UVC driver (Was &quot;Where	is V4L headed ?&quot;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1687">[ date ]</a>
              <a href="thread.html#1687">[ thread ]</a>
              <a href="subject.html#1687">[ subject ]</a>
              <a href="author.html#1687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
