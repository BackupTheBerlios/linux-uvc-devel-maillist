From bakalito at gmail.com  Thu Oct  2 02:09:14 2008
From: bakalito at gmail.com (Jose Ant.)
Date: Thu, 02 Oct 2008 02:09:14 +0200
Subject: [Linux-uvc-devel] device 0e8d:0004 only works with luvcview
Message-ID: <48E4112A.8050101@gmail.com>

I'll post the logs. First, loading module (modprobe uvcvideo trace=15):

---
uvcvideo: Adding mapping Brightness to control 
00000000-0000-0000-0000-000000000101/2.
uvcvideo: Adding mapping Contrast to control 
00000000-0000-0000-0000-000000000101/3.
uvcvideo: Adding mapping Hue to control 
00000000-0000-0000-0000-000000000101/6.
uvcvideo: Adding mapping Saturation to control 
00000000-0000-0000-0000-000000000101/7.
uvcvideo: Adding mapping Sharpness to control 
00000000-0000-0000-0000-000000000101/8.
uvcvideo: Adding mapping Gamma to control 
00000000-0000-0000-0000-000000000101/9.
uvcvideo: Adding mapping Backlight Compensation to control 
00000000-0000-0000-0000-000000000101/1.
uvcvideo: Adding mapping Gain to control 
00000000-0000-0000-0000-000000000101/4.
uvcvideo: Adding mapping Power Line Frequency to control 
00000000-0000-0000-0000-000000000101/5.
uvcvideo: Adding mapping Hue, Auto to control 
00000000-0000-0000-0000-000000000101/16.
uvcvideo: Adding mapping Exposure, Auto to control 
00000000-0000-0000-0000-000000000001/2.
uvcvideo: Adding mapping Exposure, Auto Priority to control 
00000000-0000-0000-0000-000000000001/3.
uvcvideo: Adding mapping Exposure (Absolute) to control 
00000000-0000-0000-0000-000000000001/4.
uvcvideo: Adding mapping White Balance Temperature, Auto to control 
00000000-0000-0000-0000-000000000101/11.
uvcvideo: Adding mapping White Balance Temperature to control 
00000000-0000-0000-0000-000000000101/10.
uvcvideo: Adding mapping White Balance Component, Auto to control 
00000000-0000-0000-0000-000000000101/13.
uvcvideo: Adding mapping White Balance Blue Component to control 
00000000-0000-0000-0000-000000000101/12.
uvcvideo: Adding mapping White Balance Red Component to control 
00000000-0000-0000-0000-000000000101/12.
uvcvideo: Adding mapping Focus (absolute) to control 
00000000-0000-0000-0000-000000000001/6.
uvcvideo: Adding mapping Focus, Auto to control 
00000000-0000-0000-0000-000000000001/8.
usbcore: registered new interface driver uvcvideo
USB Video Class driver (SVN r255)
---

-> Now i connect the webcam (really is a phone):

---
usb 2-2: new full speed USB device using ohci_hcd and address 2
usb 2-2: configuration #1 chosen from 1 choice
uvcvideo: Probing known UVC device 2 (0e8d:0004)
uvcvideo: Found format MJPEG.
uvcvideo: - 160x120 (20.0 fps)
uvcvideo: - 320x240 (20.0 fps)
uvcvideo: - 640x480 (20.0 fps)
uvcvideo: Found a Status endpoint (addr 83).
uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/16 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to 
device 2 entity 3
uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
uvcvideo: Found a valid video chain (1 -> 2).
uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -62 (exp. 26).
uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -62 (exp. 26).
uvcvideo: Failed to initialize the device (-5).
usb 2-2: USB disconnect, address 2
usb 2-2: new full speed USB device using ohci_hcd and address 3
usb 2-2: configuration #1 chosen from 1 choice
uvcvideo: Probing known UVC device 2 (0e8d:0004)
uvcvideo: Found format MJPEG.
uvcvideo: - 160x120 (20.0 fps)
uvcvideo: - 320x240 (20.0 fps)
uvcvideo: - 640x480 (20.0 fps)
uvcvideo: Found a Status endpoint (addr 83).
uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/16 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to 
device 2 entity 3
uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
uvcvideo: Found a valid video chain (1 -> 2).
uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
input: OT-C701/ as /class/input/input5
---

-> Now I launch luvcview (luvcview -w, because i'm using compiz)

---
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Setting frame interval to 1/15 (666666).
---

-> All's ok. Let's try ekiga (ekiga-2.0.12)

--
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x32315559 (YU12): 320x240.
uvcvideo: Unsupported format 0x32315559.
uvcvideo: Trying format 0x34424752 (RGB4): 320x240.
uvcvideo: Unsupported format 0x34424752.
uvcvideo: Trying format 0x34524742 (BGR4): 320x240.
uvcvideo: Unsupported format 0x34524742.
uvcvideo: Trying format 0x33424752 (RGB3): 320x240.
uvcvideo: Unsupported format 0x33424752.
uvcvideo: Trying format 0x33524742 (BGR3): 320x240.
uvcvideo: Unsupported format 0x33524742.
uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Setting frame interval to 1/20 (500000).
uvcvideo: Setting frame interval to 1/30 (333333).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 176x144.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 352x288.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 352x240.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: Setting frame interval to 1/20 (500000).
uvcvideo: Failed to query (132) UVC control 2 (unit 3) : -110 (exp. 2).
uvcvideo: Failed to query (135) UVC control 7 (unit 3) : -110 (exp. 2).
uvcvideo: Failed to query (135) UVC control 3 (unit 3) : -110 (exp. 2).
uvcvideo: Non-zero status (-62) in video completion handler.
uvcvideo: Failed to query (135) UVC control 6 (unit 3) : -62 (exp. 2).
uvcvideo: Non-zero status (-62) in video completion handler.
uvcvideo: Non-zero status (-62) in video completion handler.
uvcvideo: Non-zero status (-62) in video completion handler.
uvcvideo: Non-zero status (-62) in status completion handler.
uvcvideo: Non-zero status (-62) in video completion handler.
usb 2-2: USB disconnect, address 3
usb 2-2: new full speed USB device using ohci_hcd and address 4
usb 2-2: device descriptor read/64, error -62
usb 2-2: device descriptor read/64, error -62
usb 2-2: new full speed USB device using ohci_hcd and address 5
usb 2-2: device descriptor read/64, error -62
usb 2-2: device descriptor read/64, error -62
usb 2-2: new full speed USB device using ohci_hcd and address 6
usb 2-2: device not accepting address 6, error -62
usb 2-2: new full speed USB device using ohci_hcd and address 7
usb 2-2: device not accepting address 7, error -62
usb 2-2: new full speed USB device using ohci_hcd and address 8
usb 2-2: configuration #1 chosen from 1 choice
uvcvideo: Probing known UVC device 2 (0e8d:0004)
uvcvideo: Found format MJPEG.
uvcvideo: - 160x120 (20.0 fps)
uvcvideo: - 320x240 (20.0 fps)
uvcvideo: - 640x480 (20.0 fps)
uvcvideo: Found a Status endpoint (addr 83).
uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/16 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to 
device 2 entity 3
uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
uvcvideo: Found a valid video chain (1 -> 2).
uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -62 (exp. 26).
uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -62 (exp. 26).
uvcvideo: Failed to initialize the device (-5).
usb 2-2: USB disconnect, address 8
usb 2-2: new full speed USB device using ohci_hcd and address 9
usb 2-2: configuration #1 chosen from 1 choice
uvcvideo: Probing known UVC device 2 (0e8d:0004)
uvcvideo: Found format MJPEG.
uvcvideo: - 160x120 (20.0 fps)
uvcvideo: - 320x240 (20.0 fps)
uvcvideo: - 640x480 (20.0 fps)
uvcvideo: Found a Status endpoint (addr 83).
uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device 
2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/16 to 
device 2 entity 3
uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to 
device 2 entity 3
uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
uvcvideo: Found a valid video chain (1 -> 2).
uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
input: OT-C701/ as /class/input/input6
uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
uvcvideo: UVC device initialized.
---

-> As you see, webcam gets reset. Any help, please? Thanks!



From rob.owens at biochemfluidics.com  Fri Oct  3 12:54:08 2008
From: rob.owens at biochemfluidics.com (Rob Owens)
Date: Fri, 03 Oct 2008 06:54:08 -0400
Subject: [Linux-uvc-devel] uvc camera with Cheese and Camorama
Message-ID: <48E5F9D0.5050800@biochemfluidics.com>

I'm new to the list, and to webcams in general.  My company wants to
purchase a few ProScope HR cameras (supported by the uvc driver) to use
for inspection of parts.  The camera works fine with luvcview, but does
not work properly with either Cheese or Camorama.  Personally, I like
luvcview, but I'd like to give the users a choice.

Is there something special that needs to be installed in order to use
Cheese and Camorama with the uvc driver, or are they just incompatible?
 Camorama claims that it cannot find /dev/video0 (which does exist).
Cheese runs but does not produce any video and the program takes a few
minutes to close.

I'm running Debian Lenny and using packaged software.  Nothing is
compiled from source.

Thanks for your help.

-Rob
********************************************************

The information transmitted is intended only for the person or entity to
which it is addressed and may contain confidential and/or privileged
material. If you are not the addressee, any disclosure, reproduction,
copying, distribution, or other dissemination or use of this transmission in
error please notify the sender immediately and then delete this e-mail.
E-mail transmission cannot be guaranteed to be secure or error free as
information could be intercepted, corrupted lost, destroyed, arrive late or
incomplete, or contain viruses.
The sender therefore does not accept liability for any errors or omissions
in the contents of this message which arise as a result of e-mail
transmission. If verification is required please request a hard copy
version.

********************************************************



From laurent.pinchart at skynet.be  Sat Oct  4 19:14:21 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 4 Oct 2008 19:14:21 +0200
Subject: [Linux-uvc-devel] How to run a LED status check?
In-Reply-To: <C7EA9BA2FF739043AB84C42449D887A121FDC7@daebe102.NOE.Nokia.com>
References: <C7EA9BA2FF739043AB84C42449D887A121FDC7@daebe102.NOE.Nokia.com>
Message-ID: <200810041914.21408.laurent.pinchart@skynet.be>

Hi Unnati,

On Monday 29 September 2008, unnati.sapre at nokia.com wrote:
> Hi
>
> I have a logitech quickcam communicate dulux camera which works
> perfectly. I have taken some pictures using it and now I want to run a
> LED status check for those pictures just to know how many led's were on
> and how many were off. How exactly do I perform those tests?? Does
> anyone know the code for debugging a photograph?? A step by step
> explanation would be appreciated

I suppose you took pictures of LEDs with the webcam and want to process the 
images to count the number of lit LEDs.

There is no magic software that I know of to solve your problem. You will have 
to implement an image processing algorithm in the programming language you 
like the best. If you go for C/C++ the Intel image processing library OpenCV 
implements basic operations that you can reuse to ease your task.

Best regards,

Laurent Pinchart



From laurent.pinchart at skynet.be  Sat Oct  4 19:31:18 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 4 Oct 2008 19:31:18 +0200
Subject: [Linux-uvc-devel] device 0e8d:0004 only works with luvcview
In-Reply-To: <48E4112A.8050101@gmail.com>
References: <48E4112A.8050101@gmail.com>
Message-ID: <200810041931.18626.laurent.pinchart@skynet.be>

Hi Jose,

On Thursday 02 October 2008, Jose Ant. wrote:
> I'll post the logs. First, loading module (modprobe uvcvideo trace=15):
>
> ---
[snip]
> ---
>
> -> Now i connect the webcam (really is a phone):
>
> ---
> usb 2-2: new full speed USB device using ohci_hcd and address 2
> usb 2-2: configuration #1 chosen from 1 choice
> uvcvideo: Probing known UVC device 2 (0e8d:0004)
> uvcvideo: Found format MJPEG.
> uvcvideo: - 160x120 (20.0 fps)
> uvcvideo: - 320x240 (20.0 fps)
> uvcvideo: - 640x480 (20.0 fps)
> uvcvideo: Found a Status endpoint (addr 83).
> uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
[snip]
> uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
> uvcvideo: Found a valid video chain (1 -> 2).
> uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -62 (exp. 26).
> uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -62 (exp. 26).
> uvcvideo: Failed to initialize the device (-5).
> usb 2-2: USB disconnect, address 2
> usb 2-2: new full speed USB device using ohci_hcd and address 3

Did you disconnect and reconnect the camera ? Error -62 is -ETIME and can mean 
that the device has been disconnected but the USB hub (which can be the root 
hub inside your computer) hasn't notified the operating system yet. The 
disconnect message hints that this is probably the case.

If you didn't disconnect the device this doesn't seem too serious as the 
device reconnects and is then properly detected. It can caused by some kind 
of transient electrical/cable issue.

> usb 2-2: configuration #1 chosen from 1 choice
> uvcvideo: Probing known UVC device 2 (0e8d:0004)
> uvcvideo: Found format MJPEG.
> uvcvideo: - 160x120 (20.0 fps)
> uvcvideo: - 320x240 (20.0 fps)
> uvcvideo: - 640x480 (20.0 fps)
> uvcvideo: Found a Status endpoint (addr 83).
> uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
[snip]
> uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
> uvcvideo: Found a valid video chain (1 -> 2).
> uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).

Don't worry about this error. This is not fatal.

> input: OT-C701/ as /class/input/input5
> ---
>
> -> Now I launch luvcview (luvcview -w, because i'm using compiz)
>
> ---
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Setting frame interval to 1/15 (666666).
> ---
>
> -> All's ok. Let's try ekiga (ekiga-2.0.12)
>
> --
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x32315559 (YU12): 320x240.
> uvcvideo: Unsupported format 0x32315559.
> uvcvideo: Trying format 0x34424752 (RGB4): 320x240.
> uvcvideo: Unsupported format 0x34424752.
> uvcvideo: Trying format 0x34524742 (BGR4): 320x240.
> uvcvideo: Unsupported format 0x34524742.
> uvcvideo: Trying format 0x33424752 (RGB3): 320x240.
> uvcvideo: Unsupported format 0x33424752.
> uvcvideo: Trying format 0x33524742 (BGR3): 320x240.
> uvcvideo: Unsupported format 0x33524742.
> uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Setting frame interval to 1/20 (500000).
> uvcvideo: Setting frame interval to 1/30 (333333).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 176x144.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 352x288.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 352x240.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Trying format 0x47504a4d (MJPG): 320x240.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: Setting frame interval to 1/20 (500000).
> uvcvideo: Failed to query (132) UVC control 2 (unit 3) : -110 (exp. 2).
> uvcvideo: Failed to query (135) UVC control 7 (unit 3) : -110 (exp. 2).
> uvcvideo: Failed to query (135) UVC control 3 (unit 3) : -110 (exp. 2).

Here the camera starts timing out every request.

> uvcvideo: Non-zero status (-62) in video completion handler.
> uvcvideo: Failed to query (135) UVC control 6 (unit 3) : -62 (exp. 2).
> uvcvideo: Non-zero status (-62) in video completion handler.
> uvcvideo: Non-zero status (-62) in video completion handler.
> uvcvideo: Non-zero status (-62) in video completion handler.
> uvcvideo: Non-zero status (-62) in status completion handler.
> uvcvideo: Non-zero status (-62) in video completion handler.
> usb 2-2: USB disconnect, address 3

And it then gets disconnected.

> usb 2-2: new full speed USB device using ohci_hcd and address 4

And reconnected.

> usb 2-2: device descriptor read/64, error -62
> usb 2-2: device descriptor read/64, error -62
> usb 2-2: new full speed USB device using ohci_hcd and address 5
> usb 2-2: device descriptor read/64, error -62
> usb 2-2: device descriptor read/64, error -62
> usb 2-2: new full speed USB device using ohci_hcd and address 6
> usb 2-2: device not accepting address 6, error -62
> usb 2-2: new full speed USB device using ohci_hcd and address 7
> usb 2-2: device not accepting address 7, error -62
> usb 2-2: new full speed USB device using ohci_hcd and address 8

A few times.

> usb 2-2: configuration #1 chosen from 1 choice
> uvcvideo: Probing known UVC device 2 (0e8d:0004)
> uvcvideo: Found format MJPEG.
> uvcvideo: - 160x120 (20.0 fps)
> uvcvideo: - 320x240 (20.0 fps)
> uvcvideo: - 640x480 (20.0 fps)
> uvcvideo: Found a Status endpoint (addr 83).
> uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to
> device 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/16 to
> device 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to
> device 2 entity 3
> uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
> uvcvideo: Found a valid video chain (1 -> 2).
> uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -62 (exp. 26).
> uvcvideo: Failed to query (129) UVC control 1 (unit 0) : -62 (exp. 26).
> uvcvideo: Failed to initialize the device (-5).
> usb 2-2: USB disconnect, address 8
> usb 2-2: new full speed USB device using ohci_hcd and address 9
> usb 2-2: configuration #1 chosen from 1 choice
> uvcvideo: Probing known UVC device 2 (0e8d:0004)
> uvcvideo: Found format MJPEG.
> uvcvideo: - 160x120 (20.0 fps)
> uvcvideo: - 320x240 (20.0 fps)
> uvcvideo: - 640x480 (20.0 fps)
> uvcvideo: Found a Status endpoint (addr 83).
> uvcvideo: Found UVC 1.00 device OT-C701/ (0e8d:0004)
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/2 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/3 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/6 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/7 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/8 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/9 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/10 to
> device 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/1 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/5 to device
> 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/16 to
> device 2 entity 3
> uvcvideo: Added control 00000000-0000-0000-0000-000000000101/11 to
> device 2 entity 3
> uvcvideo: Scanning UVC chain: OT 2 <- PU 3 <- IT 1
> uvcvideo: Found a valid video chain (1 -> 2).
> uvcvideo: Failed to query (135) UVC control 1 (unit 0) : -32 (exp. 26).
> input: OT-C701/ as /class/input/input6
> uvcvideo: Trying format 0x47504a4d (MJPG): 10000x10000.
> uvcvideo: Using default frame interval 50000.0 us (20.0 fps).
> uvcvideo: UVC device initialized.
> ---
>
> -> As you see, webcam gets reset. Any help, please? Thanks!

There's an issue either with the hardware or with the USB host controller / 
root hub driver. Device connection/disconnection issues are well beneath the 
UVC driver.

Your device can be buggy (many webcam firmwares seem to have been badly 
engineered), your USB controller can be buggy, or the Linux USB core/host 
controller driver can be buggy. You should contact the linux-usb mailing 
list, they should be able to give you some more information about the 
disconnection issue and its possible causes. Please CC me if you do, as I'm 
interested in the answer.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sun Oct  5 14:43:57 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sun, 5 Oct 2008 14:43:57 +0200
Subject: [Linux-uvc-devel] Call for testers with Microsoft Lifecam NX-6000
	and VX-7000 webcams
Message-ID: <200810051443.57765.laurent.pinchart@skynet.be>

Hi everybody,

I'm looking for owners of Microsoft Lifecam NX-6000 and VX-7000 webcams to 
test the attached patch (against SVN r255, but it should be easy to apply 
it - even by hand - to most version of the driver).

I would like to know if the camera still works with the patch applied. If it 
doesn't, please post the messages printed by uvcvideo to the kernel log.

Thanks in advance for your help.

Best regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: uvc-microsoft.diff
Type: text/x-diff
Size: 1022 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081005/b4ce51cf/attachment.diff>

From barsnick at gmx.net  Sun Oct  5 23:54:55 2008
From: barsnick at gmx.net (Moritz Barsnick)
Date: Sun, 5 Oct 2008 23:54:55 +0200
Subject: [Linux-uvc-devel] uvc camera with Cheese and Camorama
In-Reply-To: <48E5F9D0.5050800@biochemfluidics.com>
References: <48E5F9D0.5050800@biochemfluidics.com>
Message-ID: <20081005215455.GA20252@sunshine.barsnick.net>

Hi Rob,

On Fri, Oct 03, 2008 at 06:54:08 -0400, Rob Owens wrote:

> Camorama claims that it cannot find /dev/video0 (which does exist).

Camorama is right. It uses the V4L1 API (which is basically
deprecated), and linux-uvc only provides the V4L2 API. I guess you
should use a different app, such as wxCam. (I like camorama too,
though.) BUT: There is a nice new library by Hans de Goede called
libv4l. It provides a layer between V4L1 and V4L2. I have a patch for
camorama to use this library, and have managed to make camorama work
with linux-uvc. Screenshots and patch are available from me! :-)

> Cheese runs but does not produce any video and the program takes a few
> minutes to close.

Can't help you with that, sorry. You may need to ask the Cheese
programmers. If luvcview (or guvcview) works, the camera and the driver
are fine.

Moritz.


From p.mironchyk at gmail.com  Wed Oct  8 22:54:37 2008
From: p.mironchyk at gmail.com (Pavel Mironchyk)
Date: Wed, 8 Oct 2008 23:54:37 +0300
Subject: [Linux-uvc-devel] Patch for Trust WebCamera
In-Reply-To: <mailman.227.1223498789.5343.linux-uvc-devel@lists.berlios.de>
References: <mailman.227.1223498789.5343.linux-uvc-devel@lists.berlios.de>
Message-ID: <7f512edf0810081354oef0f8c4v9751b79441786db9@mail.gmail.com>

Hello,

I found that my new camera Trust Megapixel USB2 (WB-5600R) does not work
well in
streaming v4l applications - xawtv, mplayer etc.. In lower resolution It
looked like driver
was not able to grab full frame and there was some garbage at the bottom of
frame (incomplete frame).
In higher resolution (1280x1024) driver did not work at all and xawtv just
hangs.

I spent some time debugging and figured that the cause of that behaviour was
incorrect frame
size calcultion. I figured out that happens due to some ordering in
initiations of format frames
at usb probe stage. So I made small path which sorts correctly format frames
in initialization.
For it solved all the problems, maybe it will be usefull for others ....

So please have a look or test it... or apply to mainstream :)

Best regards,
Pavel Mironchyk

PS. Does anyone know how to make 5.2 Mpix image using that Trust camera
under linux?
Are there any specification on that (to make driver)?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081008/30f4c1e6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: svn-r255.patch
Type: text/x-diff
Size: 1157 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081008/30f4c1e6/attachment.patch>

From vix at vazka.sk  Fri Oct 10 09:23:41 2008
From: vix at vazka.sk (Ivan Noris)
Date: Fri, 10 Oct 2008 09:23:41 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera support?
Message-ID: <48EF02FD.2050408@vazka.sk>

Hi,

I would like to ask if the Lenovo Thinkpad SL500 Integrated Camera is
likely to be supported in near future.

This is in dmesg after booting:

[   21.133102] Linux video capture interface: v2.00
[   21.212453] uvcvideo: Found UVC 1.00 device Integrated Camera (17ef:480b)
[   21.269903] uvcvideo: Failed to query (135) UVC control 1 (unit 0) :
-32 (exp. 26).
[   21.950791] usbcore: registered new interface driver uvcvideo
[   21.950797] USB Video Class driver (v0.1.0)

The camera does not work; the green light is "on" when trying to get
some picture from it (cheese, camorama, Skype etc.), but there is no
picture. I can get some partial picture using cat /dev/video0 >
/tmp/aaa.jpg though.

Trying on Ubunbu 8.10 Intrepid Ibex (testing/devel branch)

Kernel:
Linux bruce 2.6.27-6-generic #1 SMP Tue Oct 7 04:15:04 UTC 2008 i686
GNU/Linux

lsusb reports:

Bus 008 Device 002: ID 17ef:480b Lenovo
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass          239 Miscellaneous Device
  bDeviceSubClass         2 ?
  bDeviceProtocol         1 Interface Association
  bMaxPacketSize0        64
  idVendor           0x17ef Lenovo
  idProduct          0x480b
  bcdDevice           12.14
  iManufacturer           0
  iProduct                1
  iSerial                 0
  bNumConfigurations      1

If you need some more info, please tell me.

Many thanks and regards,
Ivan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..



From d.paganelli at expertsystemsolutions.it  Fri Oct 10 10:13:39 2008
From: d.paganelli at expertsystemsolutions.it (Daniele Paganelli)
Date: Fri, 10 Oct 2008 10:13:39 +0200
Subject: [Linux-uvc-devel] inconsistency with video4linux2 MENU control type
Message-ID: <200810101013.39959.d.paganelli@expertsystemsolutions.it>

Dear UVC developers,
	I'm trying to program UVC devices using the video4linux2 API. 
I have problems understanding the output UVC driver give for a 
VIDIOC_QUERYCTRL ioctl.

Response struct (v4l2_queryctrl):
id: V4L2_CID_EXPOSURE
type: V4L2_CTRL_TYPE_MENU
name: 'Exposure, Auto' 
minimum: 0
maximum: 0
step: 9
default_value: 8
flags: 0 

The video4linux2 api specification states that, for a Menu type, the meaning 
of the queryctrl response given by the driver should be:

min: 0
step: 1
max: N-1

where N is the number of menu choices.

So how should I interpret the UVC response min=0/max=0/step=9???

I got this response for Logitech QuickCam Pro for Notebooks
and 
Logitech QuickCam Deluxe for Notebooks

Best regards
and thanks for the great driver ;)

--
Daniele Paganelli
 Researcher
 Expert System Solutions S.r.l.
 Via Virgilio 58/L - 41100 Modena (ITALY)
 Tel: +39 0598860020 - Fax: +39 0598860024
 Email: d.paganelli at expertsystemsolutions.it
 Web: www.expertsystemsolutions.it




From ivan.babkin at miclab.chem.msu.ru  Fri Oct 10 21:51:15 2008
From: ivan.babkin at miclab.chem.msu.ru (Ivan Babkin)
Date: Fri, 10 Oct 2008 23:51:15 +0400
Subject: [Linux-uvc-devel] 174f:5931 is not working
Message-ID: <48EFB233.2080906@miclab.chem.msu.ru>

Hi!

I have a problem with a built-in camera in my Samsung Q310 laptop.

After "modprobe uvcvideo trace=15" I get the following in dmesg:

[ 4149.432261] uvcvideo: Adding mapping Brightness to control 
00000000-0000-0000-0000-000000000101/2.
[ 4149.434693] uvcvideo: Adding mapping Contrast to control 
00000000-0000-0000-0000-000000000101/3.
[ 4149.436971] uvcvideo: Adding mapping Hue to control 
00000000-0000-0000-0000-000000000101/6.
[ 4149.439150] uvcvideo: Adding mapping Saturation to control 
00000000-0000-0000-0000-000000000101/7.
[ 4149.440291] uvcvideo: Adding mapping Sharpness to control 
00000000-0000-0000-0000-000000000101/8.
[ 4149.441371] uvcvideo: Adding mapping Gamma to control 
00000000-0000-0000-0000-000000000101/9.
[ 4149.442396] uvcvideo: Adding mapping Backlight Compensation to 
control 00000000-0000-0000-0000-000000000101/1.
[ 4149.443594] uvcvideo: Adding mapping Gain to control 
00000000-0000-0000-0000-000000000101/4.
[ 4149.444610] uvcvideo: Adding mapping Power Line Frequency to control 
00000000-0000-0000-0000-000000000101/5.
[ 4149.445796] uvcvideo: Adding mapping Hue, Auto to control 
00000000-0000-0000-0000-000000000101/16.
[ 4149.446867] uvcvideo: Adding mapping Exposure, Auto to control 
00000000-0000-0000-0000-000000000001/2.
[ 4149.447994] uvcvideo: Adding mapping Exposure, Auto Priority to 
control 00000000-0000-0000-0000-000000000001/3.
[ 4149.449215] uvcvideo: Adding mapping Exposure (Absolute) to control 
00000000-0000-0000-0000-000000000001/4.
[ 4149.450386] uvcvideo: Adding mapping White Balance Temperature, Auto 
to control 00000000-0000-0000-0000-000000000101/11.
[ 4149.451682] uvcvideo: Adding mapping White Balance Temperature to 
control 00000000-0000-0000-0000-000000000101/10.
[ 4149.452923] uvcvideo: Adding mapping White Balance Component, Auto to 
control 00000000-0000-0000-0000-000000000101/13.
[ 4149.454236] uvcvideo: Adding mapping White Balance Blue Component to 
control 00000000-0000-0000-0000-000000000101/12.
[ 4149.455529] uvcvideo: Adding mapping White Balance Red Component to 
control 00000000-0000-0000-0000-000000000101/12.
[ 4149.456818] uvcvideo: Adding mapping Focus (absolute) to control 
00000000-0000-0000-0000-000000000001/6.
[ 4149.457984] uvcvideo: Adding mapping Focus, Auto to control 
00000000-0000-0000-0000-000000000001/8.
[ 4149.459119] uvcvideo: Probing generic UVC device 3
[ 4149.459731] uvcvideo: Found format YUV 4:2:2 (YUYV).
[ 4149.459735] uvcvideo: - 640x480 (20.0 fps)
[ 4149.459737] uvcvideo: - 160x120 (24.0 fps)
[ 4149.459739] uvcvideo: - 176x144 (24.0 fps)
[ 4149.459741] uvcvideo: - 320x240 (24.0 fps)
[ 4149.459742] uvcvideo: - 352x288 (24.0 fps)
[ 4149.459744] uvcvideo: - 800x600 (7.0 fps)
[ 4149.459746] uvcvideo: - 1024x768 (7.0 fps)
[ 4149.459748] uvcvideo: - 1280x800 (7.0 fps)
[ 4149.459749] uvcvideo: - 1280x960 (7.0 fps)
[ 4149.459751] uvcvideo: - 1280x1024 (7.0 fps)
[ 4149.459755] uvcvideo: Found UVC 1.00 device USB2.0 UVC PC Camera 
(174f:5931)
[ 4149.466351] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/2 to device 3 entity 3
[ 4149.466357] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/3 to device 3 entity 3
[ 4149.466360] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/6 to device 3 entity 3
[ 4149.466364] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/7 to device 3 entity 3
[ 4149.466367] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/8 to device 3 entity 3
[ 4149.466370] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/9 to device 3 entity 3
[ 4149.466374] uvcvideo: Added control 
00000000-0000-0000-0000-000000000101/1 to device 3 entity 3
[ 4149.466381] uvcvideo: Scanning UVC chain: OT 4 <- PU 3 <- IT 1
[ 4149.466385] uvcvideo: Found a valid video chain (1 -> 4).
[ 4149.521015] uvcvideo: Failed to query (135) UVC control 1 (unit 0) : 
-32 (exp. 26).
[ 4150.339102] uvcvideo: UVC device initialized.
[ 4150.339164] usbcore: registered new interface driver uvcvideo
[ 4150.339171] USB Video Class driver (SVN r257)
[ 4150.346123] uvcvideo: Trying format 0x56595559 (YUYV): 10000x10000.
[ 4150.346131] uvcvideo: Using default frame interval 142857.1 us (7.0 fps).

The driver creates /dev/video0, and a few program list "USB2.0 UVC PC 
Camera" as an installed webcam.
But the problem is that the camera is not really usable: all programs 
I've tried so far do not capture any image from it.

I had only very limited success with running "luvcview -f yuv" (I use 
version 0.2.1 from ubuntu hardy).
In this case, luvcview captures and outputs only the first frame and 
hangs completely: only "kill -KILL pid" helps.
Here is what I get in dmesg:

[ 4164.797148] uvcvideo: Trying format 0x56595559 (YUYV): 320x240.
[ 4164.797155] uvcvideo: Using default frame interval 41666.6 us (24.0 fps).
[ 4165.657184] uvcvideo: Setting frame interval to 1/15 (666666).

Does this mean the camera is not supported by uvcvideo driver?
Any help will be appreciated.

-- 
Wbr, Ivan



From aschnepf at centurytel.net  Tue Oct 14 08:58:02 2008
From: aschnepf at centurytel.net (Al Schnepf)
Date: Tue, 14 Oct 2008 01:58:02 -0500 (CDT)
Subject: [Linux-uvc-devel] Webcam Driver
Message-ID: <39369.172.16.10.157.1223967482.squirrel@172.16.10.250>

I'm looking for a Linux driver that supports the Creative Live! Cam
Notebook Ultra Model Number VF0310.        Vendor ID 0x041e, product ID
0x405b.

Is there a driver that will work with this webcam?

Thanks,
Al




From palmax at gmail.com  Tue Oct 14 13:24:29 2008
From: palmax at gmail.com (palmax at gmail.com)
Date: Tue, 14 Oct 2008 13:24:29 +0200
Subject: [Linux-uvc-devel] Webcam driver
In-Reply-To: <209499a0810140422m32298daambe7abcec095c2f98@mail.gmail.com>
References: <209499a0810140422m32298daambe7abcec095c2f98@mail.gmail.com>
Message-ID: <209499a0810140424p4f8a7fbfief767b6b1dd33b1@mail.gmail.com>

Hello

I want to do a webcam driver from scratch. Your driver may be
interesting in my "academy" intention because I know that a lot of
cameras are compatible UVC (usb video class). Can you tell me what is
the most interesting "papers" for me?

If I would enter in "UVC driver team", what will I do? What will I
need know knowledges?

Thank you!
Palmax


From laurent.pinchart at skynet.be  Wed Oct 15 00:47:08 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 00:47:08 +0200
Subject: [Linux-uvc-devel] Webcam driver
In-Reply-To: <209499a0810140424p4f8a7fbfief767b6b1dd33b1@mail.gmail.com>
References: <209499a0810140422m32298daambe7abcec095c2f98@mail.gmail.com>
	<209499a0810140424p4f8a7fbfief767b6b1dd33b1@mail.gmail.com>
Message-ID: <200810150047.09126.laurent.pinchart@skynet.be>

Hi,

On Tuesday 14 October 2008, palmax at gmail.com wrote:
> Hello
>
> I want to do a webcam driver from scratch.

Can I ask you why ? Do you have a webcam that is currently unsupported in 
Linux, or is your project for learning purpose only ?

> Your driver may be interesting in my "academy" intention because I know that
> a lot of cameras are compatible UVC (usb video class).

Most new webcams are UVC compatible as Microsoft made it a requirement for the 
Vista compatibility logo.

> Can you tell me what is the most interesting "papers" for me?

You can find a few documents about the Linux side of things at 
http://www.linuxtv.org/docs.php. You will need to understand the V4L2 API.

A good understanding of the Linux driver model will be required too. "Linux 
Device Drivers", 3rd edition, is a good book and can be downloaded at 
http://lwn.net/Kernel/LDD3/ (or better for the authors, bought from 
O'Reilly).

Regarding UVC itself, the specification can be downloaded from the USB 
Implementers Forum at 
http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1.zip. There's 
not much other source of information (although the USB-IF forums could be 
useful).

> If I would enter in "UVC driver team", what will I do?

That's up to you :-) If you write a UVC driver from scratch it will be a 
separate project, unrelated to the current Linux UVC driver. If you want to 
join the "team", pick up something you'd like to improve in the driver and 
send a patch. I can provide a sample list of unimplemented features.

> What will I need know knowledges?

C programming (obviously) and Linux kernel development, although the later can 
be learnt as you go.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 00:51:22 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 00:51:22 +0200
Subject: [Linux-uvc-devel] Webcam Driver
In-Reply-To: <39369.172.16.10.157.1223967482.squirrel@172.16.10.250>
References: <39369.172.16.10.157.1223967482.squirrel@172.16.10.250>
Message-ID: <200810150051.22978.laurent.pinchart@skynet.be>

Hi Al,

On Tuesday 14 October 2008, Al Schnepf wrote:
> I'm looking for a Linux driver that supports the Creative Live! Cam
> Notebook Ultra Model Number VF0310.        Vendor ID 0x041e, product ID
> 0x405b.
>
> Is there a driver that will work with this webcam?

Hint: search Google with the VID and PID of your webcam. Here's what you get 
from the top links :

http://lists.berlios.de/pipermail/linux-uvc-devel/2007-December/002665.html

The camera is not (and won't be) supported by the Linux UVC driver. You might 
have more luck with the gspca driver.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 01:04:14 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 01:04:14 +0200
Subject: [Linux-uvc-devel] 174f:5931 is not working
In-Reply-To: <48EFB233.2080906@miclab.chem.msu.ru>
References: <48EFB233.2080906@miclab.chem.msu.ru>
Message-ID: <200810150104.14783.laurent.pinchart@skynet.be>

Hi Ivan,

On Friday 10 October 2008, Ivan Babkin wrote:
> Hi!
>
> I have a problem with a built-in camera in my Samsung Q310 laptop.
>
> After "modprobe uvcvideo trace=15" I get the following in dmesg:
>
> [ 4149.432261] uvcvideo: Adding mapping Brightness to control
> 00000000-0000-0000-0000-000000000101/2.
> [ 4149.434693] uvcvideo: Adding mapping Contrast to control
> 00000000-0000-0000-0000-000000000101/3.
> [ 4149.436971] uvcvideo: Adding mapping Hue to control
> 00000000-0000-0000-0000-000000000101/6.
> [ 4149.439150] uvcvideo: Adding mapping Saturation to control
> 00000000-0000-0000-0000-000000000101/7.
> [ 4149.440291] uvcvideo: Adding mapping Sharpness to control
> 00000000-0000-0000-0000-000000000101/8.
> [ 4149.441371] uvcvideo: Adding mapping Gamma to control
> 00000000-0000-0000-0000-000000000101/9.
> [ 4149.442396] uvcvideo: Adding mapping Backlight Compensation to
> control 00000000-0000-0000-0000-000000000101/1.
> [ 4149.443594] uvcvideo: Adding mapping Gain to control
> 00000000-0000-0000-0000-000000000101/4.
> [ 4149.444610] uvcvideo: Adding mapping Power Line Frequency to control
> 00000000-0000-0000-0000-000000000101/5.
> [ 4149.445796] uvcvideo: Adding mapping Hue, Auto to control
> 00000000-0000-0000-0000-000000000101/16.
> [ 4149.446867] uvcvideo: Adding mapping Exposure, Auto to control
> 00000000-0000-0000-0000-000000000001/2.
> [ 4149.447994] uvcvideo: Adding mapping Exposure, Auto Priority to
> control 00000000-0000-0000-0000-000000000001/3.
> [ 4149.449215] uvcvideo: Adding mapping Exposure (Absolute) to control
> 00000000-0000-0000-0000-000000000001/4.
> [ 4149.450386] uvcvideo: Adding mapping White Balance Temperature, Auto
> to control 00000000-0000-0000-0000-000000000101/11.
> [ 4149.451682] uvcvideo: Adding mapping White Balance Temperature to
> control 00000000-0000-0000-0000-000000000101/10.
> [ 4149.452923] uvcvideo: Adding mapping White Balance Component, Auto to
> control 00000000-0000-0000-0000-000000000101/13.
> [ 4149.454236] uvcvideo: Adding mapping White Balance Blue Component to
> control 00000000-0000-0000-0000-000000000101/12.
> [ 4149.455529] uvcvideo: Adding mapping White Balance Red Component to
> control 00000000-0000-0000-0000-000000000101/12.
> [ 4149.456818] uvcvideo: Adding mapping Focus (absolute) to control
> 00000000-0000-0000-0000-000000000001/6.
> [ 4149.457984] uvcvideo: Adding mapping Focus, Auto to control
> 00000000-0000-0000-0000-000000000001/8.
> [ 4149.459119] uvcvideo: Probing generic UVC device 3
> [ 4149.459731] uvcvideo: Found format YUV 4:2:2 (YUYV).
> [ 4149.459735] uvcvideo: - 640x480 (20.0 fps)
> [ 4149.459737] uvcvideo: - 160x120 (24.0 fps)
> [ 4149.459739] uvcvideo: - 176x144 (24.0 fps)
> [ 4149.459741] uvcvideo: - 320x240 (24.0 fps)
> [ 4149.459742] uvcvideo: - 352x288 (24.0 fps)
> [ 4149.459744] uvcvideo: - 800x600 (7.0 fps)
> [ 4149.459746] uvcvideo: - 1024x768 (7.0 fps)
> [ 4149.459748] uvcvideo: - 1280x800 (7.0 fps)
> [ 4149.459749] uvcvideo: - 1280x960 (7.0 fps)
> [ 4149.459751] uvcvideo: - 1280x1024 (7.0 fps)
> [ 4149.459755] uvcvideo: Found UVC 1.00 device USB2.0 UVC PC Camera
> (174f:5931)
> [ 4149.466351] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/2 to device 3 entity 3
> [ 4149.466357] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/3 to device 3 entity 3
> [ 4149.466360] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/6 to device 3 entity 3
> [ 4149.466364] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/7 to device 3 entity 3
> [ 4149.466367] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/8 to device 3 entity 3
> [ 4149.466370] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/9 to device 3 entity 3
> [ 4149.466374] uvcvideo: Added control
> 00000000-0000-0000-0000-000000000101/1 to device 3 entity 3
> [ 4149.466381] uvcvideo: Scanning UVC chain: OT 4 <- PU 3 <- IT 1
> [ 4149.466385] uvcvideo: Found a valid video chain (1 -> 4).
> [ 4149.521015] uvcvideo: Failed to query (135) UVC control 1 (unit 0) :
> -32 (exp. 26).

This is a non-fatal message. No worries there. As a side note, I will soon 
remove it as it confuses many users.

> [ 4150.339102] uvcvideo: UVC device initialized.
> [ 4150.339164] usbcore: registered new interface driver uvcvideo
> [ 4150.339171] USB Video Class driver (SVN r257)
> [ 4150.346123] uvcvideo: Trying format 0x56595559 (YUYV): 10000x10000.
> [ 4150.346131] uvcvideo: Using default frame interval 142857.1 us (7.0
> fps).
>
> The driver creates /dev/video0, and a few program list "USB2.0 UVC PC
> Camera" as an installed webcam.

Good so far.

> But the problem is that the camera is not really usable: all programs
> I've tried so far do not capture any image from it.
>
> I had only very limited success with running "luvcview -f yuv" (I use
> version 0.2.1 from ubuntu hardy).
> In this case, luvcview captures and outputs only the first frame and
> hangs completely: only "kill -KILL pid" helps.
> Here is what I get in dmesg:
>
> [ 4164.797148] uvcvideo: Trying format 0x56595559 (YUYV): 320x240.
> [ 4164.797155] uvcvideo: Using default frame interval 41666.6 us (24.0
> fps). [ 4165.657184] uvcvideo: Setting frame interval to 1/15 (666666).
>
> Does this mean the camera is not supported by uvcvideo driver?

It means the camera is detected by the driver, and should work unless it is 
buggy (the driver can also be buggy, but experience showed that there are now 
more issues in the cameras themselves than in the driver :-)).

> Any help will be appreciated.

Could you please set the quirks parameter to 16 when loading the driver ? You 
can run the following two commands as root to unload the driver and reload it 
with quirks set to the right value.

rmmod uvcvideo
modprobe uvcvideo quirks=16

If it helps, please let me know and I'll issue a proper fix.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 01:12:37 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 01:12:37 +0200
Subject: [Linux-uvc-devel] inconsistency with video4linux2 MENU control
	type
In-Reply-To: <200810101013.39959.d.paganelli@expertsystemsolutions.it>
References: <200810101013.39959.d.paganelli@expertsystemsolutions.it>
Message-ID: <200810150112.37989.laurent.pinchart@skynet.be>

Hi Daniele,

On Friday 10 October 2008, Daniele Paganelli wrote:
> Dear UVC developers,
> 	I'm trying to program UVC devices using the video4linux2 API.
> I have problems understanding the output UVC driver give for a
> VIDIOC_QUERYCTRL ioctl.
>
> Response struct (v4l2_queryctrl):
> id: V4L2_CID_EXPOSURE
> type: V4L2_CTRL_TYPE_MENU
> name: 'Exposure, Auto'
> minimum: 0
> maximum: 0
> step: 9
> default_value: 8
> flags: 0
>
> The video4linux2 api specification states that, for a Menu type, the
> meaning of the queryctrl response given by the driver should be:
>
> min: 0
> step: 1
> max: N-1
>
> where N is the number of menu choices.
>
> So how should I interpret the UVC response min=0/max=0/step=9???

As a bug somewhere between the device and the console :-) It can be a driver 
issue or a userspace issue.

First of all, please make sure you're using a recent driver version. SVN head 
or the driver included in the Linux kernel should do.

If it still fails please post a code sample I can test.

> I got this response for Logitech QuickCam Pro for Notebooks
> and Logitech QuickCam Deluxe for Notebooks
>
> Best regards
> and thanks for the great driver ;)

You're welcome.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 01:17:13 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 01:17:13 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <48EF02FD.2050408@vazka.sk>
References: <48EF02FD.2050408@vazka.sk>
Message-ID: <200810150117.13189.laurent.pinchart@skynet.be>

Hi Ivan,

On Friday 10 October 2008, Ivan Noris wrote:
> Hi,
>
> I would like to ask if the Lenovo Thinkpad SL500 Integrated Camera is
> likely to be supported in near future.
>
> This is in dmesg after booting:
>
> [   21.133102] Linux video capture interface: v2.00
> [   21.212453] uvcvideo: Found UVC 1.00 device Integrated Camera
> (17ef:480b) [   21.269903] uvcvideo: Failed to query (135) UVC control 1
> (unit 0) : -32 (exp. 26).

This is a non-fatal warning and can be safely ignored.

> [   21.950791] usbcore: registered new interface driver uvcvideo
> [   21.950797] USB Video Class driver (v0.1.0)
>
> The camera does not work; the green light is "on" when trying to get
> some picture from it (cheese, camorama, Skype etc.), but there is no
> picture.

Could you try with luvcview as well ? Camorama is known not to work as it 
supports V4L1 only while the Linux UVC driver is pure V4L2. Skype is 
proprietary software and has its share of bugs so it's not a really good 
test. You could also try Ekiga.

> I can get some partial picture using cat /dev/video0 > /tmp/aaa.jpg though.

No you can't :-) That's currently not supported by the driver. If you get 
anything from that command make sur /dev/video0 is really your integrated 
webcam.

> Trying on Ubunbu 8.10 Intrepid Ibex (testing/devel branch)
>
> Kernel:
> Linux bruce 2.6.27-6-generic #1 SMP Tue Oct 7 04:15:04 UTC 2008 i686
> GNU/Linux
>
> lsusb reports:
>
> Bus 008 Device 002: ID 17ef:480b Lenovo
> Device Descriptor:
>   bLength                18
>   bDescriptorType         1
>   bcdUSB               2.00
>   bDeviceClass          239 Miscellaneous Device
>   bDeviceSubClass         2 ?
>   bDeviceProtocol         1 Interface Association
>   bMaxPacketSize0        64
>   idVendor           0x17ef Lenovo
>   idProduct          0x480b
>   bcdDevice           12.14
>   iManufacturer           0
>   iProduct                1
>   iSerial                 0
>   bNumConfigurations      1
>
> If you need some more info, please tell me.

Could you please post the whole lsusb report ?

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 01:20:06 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 01:20:06 +0200
Subject: [Linux-uvc-devel] Patch for Trust WebCamera
In-Reply-To: <7f512edf0810081354oef0f8c4v9751b79441786db9@mail.gmail.com>
References: <mailman.227.1223498789.5343.linux-uvc-devel@lists.berlios.de>
	<7f512edf0810081354oef0f8c4v9751b79441786db9@mail.gmail.com>
Message-ID: <200810150120.06363.laurent.pinchart@skynet.be>

Hi Pavel,

On Wednesday 08 October 2008, Pavel Mironchyk wrote:
> Hello,
>
> I found that my new camera Trust Megapixel USB2 (WB-5600R) does not work
> well in streaming v4l applications - xawtv, mplayer etc.. In lower
> resolution It looked like driver was not able to grab full frame and there 
> was some garbage at the bottom of frame (incomplete frame).
> In higher resolution (1280x1024) driver did not work at all and xawtv just
> hangs.
>
> I spent some time debugging and figured that the cause of that behaviour
> was incorrect frame size calcultion. I figured out that happens due to some
> ordering in initiations of format frames at usb probe stage. So I made small
> path which sorts correctly format frames in initialization.
> For it solved all the problems, maybe it will be usefull for others ....
>
> So please have a look or test it... or apply to mainstream :)

Thanks a lot for the patch. Before I test it, could you please send me the 
complete USB descriptors of your camera ? You can get them with lsusb -v 
(make sure you use usbutils 0.72 or newer - 0.73+ is preferred).

> PS. Does anyone know how to make 5.2 Mpix image using that Trust camera
> under linux?
> Are there any specification on that (to make driver)?

I'd be very surprised if it was at all possible. The 5.2M resolution is 
probably the result of software interpolation. Marketing BS, as usual.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 01:31:33 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 01:31:33 +0200
Subject: [Linux-uvc-devel] [PATCH] VIDIOC_[GS]_JPEGCOMP support
In-Reply-To: <20080922140904.GA7809@bwwlx086.ibw.intel.com>
References: <EFE3E62A-C489-45B7-A4B2-B0E53E953AB3@federated.com>
	<200704140303.14434.laurent.pinchart@skynet.be>
	<20080922140904.GA7809@bwwlx086.ibw.intel.com>
Message-ID: <200810150131.33731.laurent.pinchart@skynet.be>

Hi Moritz,
On Monday 22 September 2008, Moritz Barsnick wrote:
> Hi Laurent,
>
> On Sat, Apr 14, 2007 at 03:03:13 +0200, Laurent Pinchart wrote:
> > > I had a sneaky suspicion my camera was stuck in top quality. Laurent
> > > Pinchart's comments from March 25th confirmed and were a nice
> > > blueprint for this patch.
> >
> > First of all, thanks for the patch.
>
> [...]
>
> > Great :-) I'll have a look at the code after this weekend, and commit the
> > changes to SVN.
> >
> > Thanks a lot for your patch.
>
> Has this patch[*] been obsoleted, or forgotten, or perhaps even rejected?

Mostly forgotten actually. I'm working on reviving it, but I first have to 
implement proper workarounds for webcams that don't implement the 
GET_MIN/GET_MAX requests on the video probe control properly (and there are 
many of them). I'll soon post a patch for review/testing on the list, and 
I'll then work on the JPEG quality patch.

> The recent release of motion mentions this in its CHANGELOG (though I
> think the patch is unrelated to the named issue):
> http://www.lavrsen.dk/twiki/bin/view/Motion/UvcvideoMjpegPatch

That's related. Thanks for the information. I'll contact the authors of motion 
after committing JPEG quality support to update their wiki.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 01:38:18 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 01:38:18 +0200
Subject: [Linux-uvc-devel] Random exposure issues while using uvccapture.
In-Reply-To: <75ff97e0809290852s7b3c760eoc91910ba3de2a627@mail.gmail.com>
References: <75ff97e0809290852s7b3c760eoc91910ba3de2a627@mail.gmail.com>
Message-ID: <200810150138.19020.laurent.pinchart@skynet.be>

Hi Forrest,

first of all, sorry for the late reply.

On Monday 29 September 2008, Forrest Vodden wrote:
> Hey all,
>
> I realize this is the development list for uvc, but couldn't find a
> mailing list for uvccapture and felt that maybe you would have some
> insight into my problem.

No worries. You did well.

> I'm using a Logitech Quickcam Communicate Deluxe in USB 1.0 mode to
> avoid the Logitech bug that I've had trouble with in the past. I'm
> scripting uvccapture to capture a 640x480 image every 5 seconds.
>
> This works great for 90% of the pictures taken, but every once in
> awhile the photo's exposure is off the charts. I've tried locking the
> exposure in using the uvccapture option, which helped, but it still
> happens. The camera is outside, so it has to deal with natural light
> variances, but this still happens on generally dark, overcast days.
>
> Is this probably a camera issue and should I looks into other
> brands/models or is there anything on the software side that I could
> try?

Here's an answer I got from Logitech after forwarding your issue (kudos to 
them for providing great technical support) :

"It sounds like the user is scripting multiple launches of uvccapture, i.e.
a "start stream, take snapshot, stop stream" sequence every 5 seconds. In
that case the camera probably does not always have time to adapt the
exposure time properly when the stream starts. In general it's not a good
idea to restart the stream so often because of the time it takes for the
algorithm to settle. I would suggest using uvccapture -t, in that case it
shouldn't happen."

Best regards,

Laurent Pinchart


From palmax at gmail.com  Wed Oct 15 09:41:05 2008
From: palmax at gmail.com (palmax at gmail.com)
Date: Wed, 15 Oct 2008 09:41:05 +0200
Subject: [Linux-uvc-devel] Webcam driver
In-Reply-To: <200810150047.09126.laurent.pinchart@skynet.be>
References: <209499a0810140422m32298daambe7abcec095c2f98@mail.gmail.com>
	<209499a0810140424p4f8a7fbfief767b6b1dd33b1@mail.gmail.com>
	<200810150047.09126.laurent.pinchart@skynet.be>
Message-ID: <209499a0810150041v145ab12m2b667fdd3d42fdde@mail.gmail.com>

My project is for learning only of course. I don't know nothing about
writting a linux driver, but I'm reading LDD 3rd edition.

I want to have a list of unimplemented features in linux uvc driver,
because it may be interesting for know the possibilities of "get" this
knowledges.

Bye
Palmax

2008/10/15 Laurent Pinchart <laurent.pinchart at skynet.be>:
> Hi,
>
> On Tuesday 14 October 2008, palmax at gmail.com wrote:
>> Hello
>>
>> I want to do a webcam driver from scratch.
>
> Can I ask you why ? Do you have a webcam that is currently unsupported in
> Linux, or is your project for learning purpose only ?
>
>> Your driver may be interesting in my "academy" intention because I know that
>> a lot of cameras are compatible UVC (usb video class).
>
> Most new webcams are UVC compatible as Microsoft made it a requirement for the
> Vista compatibility logo.
>
>> Can you tell me what is the most interesting "papers" for me?
>
> You can find a few documents about the Linux side of things at
> http://www.linuxtv.org/docs.php. You will need to understand the V4L2 API.
>
> A good understanding of the Linux driver model will be required too. "Linux
> Device Drivers", 3rd edition, is a good book and can be downloaded at
> http://lwn.net/Kernel/LDD3/ (or better for the authors, bought from
> O'Reilly).
>
> Regarding UVC itself, the specification can be downloaded from the USB
> Implementers Forum at
> http://www.usb.org/developers/devclass_docs/USB_Video_Class_1_1.zip. There's
> not much other source of information (although the USB-IF forums could be
> useful).
>
>> If I would enter in "UVC driver team", what will I do?
>
> That's up to you :-) If you write a UVC driver from scratch it will be a
> separate project, unrelated to the current Linux UVC driver. If you want to
> join the "team", pick up something you'd like to improve in the driver and
> send a patch. I can provide a sample list of unimplemented features.
>
>> What will I need know knowledges?
>
> C programming (obviously) and Linux kernel development, although the later can
> be learnt as you go.
>
> Best regards,
>
> Laurent Pinchart
>


From vix at vazka.sk  Wed Oct 15 10:19:46 2008
From: vix at vazka.sk (Ivan Noris)
Date: Wed, 15 Oct 2008 10:19:46 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <200810150117.13189.laurent.pinchart@skynet.be>
References: <48EF02FD.2050408@vazka.sk>
	<200810150117.13189.laurent.pinchart@skynet.be>
Message-ID: <48F5A7A2.4060801@vazka.sk>

Hi,

> This is a non-fatal warning and can be safely ignored.

OK.

> Could you try with luvcview as well ? Camorama is known not to work as it 
> supports V4L1 only while the Linux UVC driver is pure V4L2. Skype is 
> proprietary software and has its share of bugs so it's not a really good 
> test. You could also try Ekiga.

I have tried luvcview meanwhile; I was able to see picture, but I have
tried it now and have seen only black window. On the terminal output,
the following can be seen:

vix at bruce:~$ luvcview
luvcview 0.2.4

SDL information:
  Video driver: x11
  A window manager is available
Device information:
  Device path:  /dev/video0
Stream settings:
  Frame format: YUYV (MJPG is not supported by device)
  Frame size:   640x480
  Frame rate:   30 fps

(I'm using Ubuntu Testing / Intrepid Ibex, updating packages daily, so
something may have changed in past days.)

>> I can get some partial picture using cat /dev/video0 > /tmp/aaa.jpg though.
> 
> No you can't :-) That's currently not supported by the driver. If you get 
> anything from that command make sur /dev/video0 is really your integrated 
> webcam.
> 

Well, there is only one device in /dev/video* :) and that's /dev/video0.
No other webcam is connected.

> Could you please post the whole lsusb report ?
> 

Attached (ZIP), hope it comes through. If you don't receive it, I will
send it to you privately.

Best regards,
Ivan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lsusb.zip
Type: application/zip
Size: 3378 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081015/73f8a840/attachment.zip>

From bnc at astronomicalresearchaustralia.org  Wed Oct 15 11:27:21 2008
From: bnc at astronomicalresearchaustralia.org (Brian)
Date: Wed, 15 Oct 2008 19:27:21 +1000
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated
	Camera	support?
In-Reply-To: <48F5A7A2.4060801@vazka.sk>
References: <48EF02FD.2050408@vazka.sk>	<200810150117.13189.laurent.pinchart@skynet.be>
	<48F5A7A2.4060801@vazka.sk>
Message-ID: <48F5B779.7070807@astronomicalresearchaustralia.org>

Ivan,
The new version of VLC(0.9.3) now supports V4L2, WITH sound.
So you could test with that.
I am currently running SUSE 10.3 and have noticed two other problems,
which may/not apply to Ubuntu.

1) My /dev/video0 simply disappears. I have not reported it yet because
I cannot find the circumstances to recreate it. I have bypassed it by
adding it to the boot.local script.

2) After I have rebooted and run xawtv -hwscan to see if this

/dev/video0: OK                         [ -device /dev/video0 ]
    type : v4l2
    name : UVC Camera (046d:08c1)
    flags:  capture

is there, it is not.
If I do a lsmod I get the normal things like
v4l2_common            20608  2 uvcvideo,videodev
However, the camera will not connect.
I then do a rmmod uvcview and a modprobe uvcview and all is well until
the next reboot.

Also guvcview works very well and will capture picture and sound.

HTH
FYI,
Brian


Ivan Noris wrote:
> Hi,
> 
>> This is a non-fatal warning and can be safely ignored.
> 
> OK.
> 
>> Could you try with luvcview as well ? Camorama is known not to work as it 
>> supports V4L1 only while the Linux UVC driver is pure V4L2. Skype is 
>> proprietary software and has its share of bugs so it's not a really good 
>> test. You could also try Ekiga.
> 
> I have tried luvcview meanwhile; I was able to see picture, but I have
> tried it now and have seen only black window. On the terminal output,
> the following can be seen:
> 
> vix at bruce:~$ luvcview
> luvcview 0.2.4
> 
> SDL information:
>   Video driver: x11
>   A window manager is available
> Device information:
>   Device path:  /dev/video0
> Stream settings:
>   Frame format: YUYV (MJPG is not supported by device)
>   Frame size:   640x480
>   Frame rate:   30 fps
> 
> (I'm using Ubuntu Testing / Intrepid Ibex, updating packages daily, so
> something may have changed in past days.)
> 
>>> I can get some partial picture using cat /dev/video0 > /tmp/aaa.jpg though.
>> No you can't :-) That's currently not supported by the driver. If you get 
>> anything from that command make sur /dev/video0 is really your integrated 
>> webcam.
>>
> 
> Well, there is only one device in /dev/video* :) and that's /dev/video0.
> No other webcam is connected.
> 
>> Could you please post the whole lsusb report ?
>>
> 
> Attached (ZIP), hope it comes through. If you don't receive it, I will
> send it to you privately.
> 
> Best regards,
> Ivan
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


From laurent.pinchart at skynet.be  Wed Oct 15 11:40:08 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 11:40:08 +0200
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to Mercurial
	on linux-tv.org
Message-ID: <200810151140.08178.laurent.pinchart@skynet.be>

Hi everybody,

now that the driver has been integrated into the mainline kernel for 3 months, 
and shipped by most distributions, I'm considering dropping the uvcvideo SVN 
repository on Berlios and create a Mercurial tree on linux-tv.org where most 
other video-related kernel projects are developed.

linux-tv.org Mercurial trees contain a copy of the whole v4l/dvb subsystem. 
The main implication would be that, to use the latest uvcvideo driver instead 
of the one shipped with your kernel, you will have to install the v4l core 
module from the Mercurial tree along with the uvcvideo module, instead of the 
uvcvideo module only as you do now.

I would expect the number of SVN checkouts to have dropped over the last 3 
monts, but Berlios doesn't provide such statistics. I'm thus asking your 
opinion : should I switch the Linux UVC driver to a Mercurial tree ?

Pros:
 - The driver will be hosted along most other video-related kernel projects
 - An important part of the compatibility code (uvc_compat.h and various 
#ifdef's around the source) can be dropped, as the source tree contains the 
latest v4l core source.
 - A tarball of the tree sources can be downloaded from the linux-tv.org web 
interface, freeing people from installing and using a version control 
software they might not be used to (Mercurial/SVN).
 - One less repository means more consistency.

Cons:
 - Installing the uvcvideo driver from the source tree will require 
installation of the v4l core module as well (and possibly other v4l/dvb 
modules you require for the hardware you own and use).

What's your opinion ? Is someone strongly opposed to the switch ? If so please 
state your reasons. All constructive opinions are welcome.

Best regards,

Laurent Pinchart


From vix at vazka.sk  Wed Oct 15 11:52:02 2008
From: vix at vazka.sk (Ivan Noris)
Date: Wed, 15 Oct 2008 11:52:02 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500
	Integrated	Camera	support?
In-Reply-To: <48F5B779.7070807@astronomicalresearchaustralia.org>
References: <48EF02FD.2050408@vazka.sk>	<200810150117.13189.laurent.pinchart@skynet.be>	<48F5A7A2.4060801@vazka.sk>
	<48F5B779.7070807@astronomicalresearchaustralia.org>
Message-ID: <48F5BD42.8060804@vazka.sk>

Hi Brian,

> The new version of VLC(0.9.3) now supports V4L2, WITH sound.
> So you could test with that.

I have VLC 0.9.4, but I was not able to see anything from the camera.
(I've tried to set Capture video device to /dev/video0). I'm not very
familiar with VLC+camera, so maybe I'm just doing some trivial mistake.

> If I do a lsmod I get the normal things like
> v4l2_common            20608  2 uvcvideo,videodev
> However, the camera will not connect.
> I then do a rmmod uvcview and a modprobe uvcview and all is well until
> the next reboot.

Btw. I can see only this:

lsmod|grep uvc
uvcvideo               62728  0
compat_ioctl32          9344  1 uvcvideo
videodev               41344  1 uvcvideo
v4l1_compat            22404  2 uvcvideo,videodev
usbcore               148848  5 uvcvideo,usbhid,ehci_hcd,uhci_hcd

Best regards,
Ivan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..


From darren.longhorn at redembedded.com  Wed Oct 15 12:13:42 2008
From: darren.longhorn at redembedded.com (Darren Longhorn)
Date: Wed, 15 Oct 2008 11:13:42 +0100
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
 Mercurial on linux-tv.org
In-Reply-To: <200810151140.08178.laurent.pinchart@skynet.be>
References: <200810151140.08178.laurent.pinchart@skynet.be>
Message-ID: <48F5C256.7040906@redembedded.com>

Laurent Pinchart wrote:

<snip>

> linux-tv.org Mercurial trees contain a copy of the whole v4l/dvb subsystem. 
> The main implication would be that, to use the latest uvcvideo driver instead 
> of the one shipped with your kernel, you will have to install the v4l core 
> module from the Mercurial tree along with the uvcvideo module, instead of the 
> uvcvideo module only as you do now.

Could you expand on why the v4l core module would also be required?

> I would expect the number of SVN checkouts to have dropped over the last 3 
> monts, but Berlios doesn't provide such statistics. I'm thus asking your 
> opinion : should I switch the Linux UVC driver to a Mercurial tree ?
> 
> Pros:
>  - The driver will be hosted along most other video-related kernel projects
>  - An important part of the compatibility code (uvc_compat.h and various 
> #ifdef's around the source) can be dropped, as the source tree contains the 
> latest v4l core source.

That answers my questions above, I think? I think that would be a con
for those of use who backport to older kernels.

<snip>

> What's your opinion ? Is someone strongly opposed to the switch ? If so please 
> state your reasons. All constructive opinions are welcome.

I guess I would be opposed for teh reson above, but I'm probably a very
small minority!

Cheers

Darren



From laurent.pinchart at skynet.be  Wed Oct 15 13:12:40 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 13:12:40 +0200
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
	Mercurial on linux-tv.org
In-Reply-To: <48F5C256.7040906@redembedded.com>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<48F5C256.7040906@redembedded.com>
Message-ID: <200810151312.40148.laurent.pinchart@skynet.be>

Hi Darren,

thanks for taking the time to provide feedback.

On Wednesday 15 October 2008, Darren Longhorn wrote:
> Laurent Pinchart wrote:
>
> <snip>
>
> > linux-tv.org Mercurial trees contain a copy of the whole v4l/dvb
> > subsystem. The main implication would be that, to use the latest uvcvideo
> > driver instead of the one shipped with your kernel, you will have to
> > install the v4l core module from the Mercurial tree along with the
> > uvcvideo module, instead of the uvcvideo module only as you do now.
>
> Could you expand on why the v4l core module would also be required?

Mercurial trees host a copy of the whole v4l/dvb subsystem. The v4l/dvb core 
is source compatible with all Linux kernels from 2.6.16 up. The device 
drivers maintain backward source compatibility as well, but the first Linux 
kernel version they are compatible with depends on the individual drivers' 
developers.

As a v4l/dvb tree host a backward compatible copy of the v4l core source, 
drivers don't have to care about backward compatibility with older versions 
of the v4l/dvb APIs. For the uvcvideo driver this would mean I can drop an 
important part of the compatibility code as the driver will only have to 
support the latest v4l/dvb API. To use the driver with older kernels you 
would then have to use the v4l/dvb core moduels as well, as the driver itself 
doesn't maintain backward compability with previous versions of the v4l/dvb 
core.

> > I would expect the number of SVN checkouts to have dropped over the last
> > 3 monts, but Berlios doesn't provide such statistics. I'm thus asking
> > your opinion : should I switch the Linux UVC driver to a Mercurial tree ?
> >
> > Pros:
> >  - The driver will be hosted along most other video-related kernel
> > projects - An important part of the compatibility code (uvc_compat.h and
> > various #ifdef's around the source) can be dropped, as the source tree
> > contains the latest v4l core source.
>
> That answers my questions above, I think? I think that would be a con
> for those of use who backport to older kernels.

Backporting will still work, but you will have to backport the v4l/dvb core as 
well.

Do you really mean backporting (thus on kernels older than 2.6.15, as the 
uvcvideo driver supports 2.6.15+ kernels already), or were you referring to 
using the driver with a 2.6.15+ kernel ? In the later case the switch to 
Mercurial would drop compatibility with 2.6.15 but 2.6.16 and above should 
work.

> <snip>
>
> > What's your opinion ? Is someone strongly opposed to the switch ? If so
> > please state your reasons. All constructive opinions are welcome.
>
> I guess I would be opposed for teh reson above, but I'm probably a very
> small minority!

Your opinion in nonetheless important.

Maintaining backward compatibility in the uvcvideo driver itself wasn't that 
much of a burden until now, but changes in the v4l core queued for 2.6.28 
would introduced a whole new set of #ifdef's all around the driver. The code 
would become messy and I'd like to avoid that if possible. Hence the idea of 
switching to Mercurial.

Best regards,

Laurent Pinchart


From bnc at astronomicalresearchaustralia.org  Wed Oct 15 13:15:10 2008
From: bnc at astronomicalresearchaustralia.org (Brian)
Date: Wed, 15 Oct 2008 21:15:10 +1000
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500
	Integrated	Camera	support?
In-Reply-To: <48F5BD42.8060804@vazka.sk>
References: <48EF02FD.2050408@vazka.sk>	<200810150117.13189.laurent.pinchart@skynet.be>	<48F5A7A2.4060801@vazka.sk>
	<48F5B779.7070807@astronomicalresearchaustralia.org>
	<48F5BD42.8060804@vazka.sk>
Message-ID: <48F5D0BE.5090508@astronomicalresearchaustralia.org>



Ivan,
>> The new version of VLC(0.9.3) now supports V4L2, WITH sound.
>> So you could test with that.
> 
> I have VLC 0.9.4, but I was not able to see anything from the camera.
> (I've tried to set Capture video device to /dev/video0). I'm not very
> familiar with VLC+camera, so maybe I'm just doing some trivial mistake.
> 
Yes I had forgotten that 0.9.4 was available.

Fire up VLC
File
Open Capture device.
A panel pops up and in the top right corner there is a capture mode
option. This should say Video for Linux 2.
Note if it does not and you cannot pick it then the uvc install is suspect.

Fill in your two devices  /dev/video0 /dev/dsp1
Note if you want the audio too please verify the device with cat
/proc/asound/cards

Press play( have a headset plugged in or the volume turned down)

>> If I do a lsmod I get the normal things like
>> v4l2_common            20608  2 uvcvideo,videodev
>> However, the camera will not connect.
>> I then do a rmmod uvcview and a modprobe uvcview and all is well until
>> the next reboot.
> 
> Btw. I can see only this:
> 
> lsmod|grep uvc
> uvcvideo               62728  0
> compat_ioctl32          9344  1 uvcvideo
> videodev               41344  1 uvcvideo
> v4l1_compat            22404  2 uvcvideo,videodev
> usbcore               148848  5 uvcvideo,usbhid,ehci_hcd,uhci_hcd

Yes, I have all those to. However, I use the application xawtv to check
for the device. I cannot get xawtv to work as a tv but the -hwscan
option is great to check the V4l2 device is there. It also confirms the
actual video device the camera is on.

Brian


From laurent.pinchart at skynet.be  Wed Oct 15 13:27:28 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 13:27:28 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <48F5A7A2.4060801@vazka.sk>
References: <48EF02FD.2050408@vazka.sk>
	<200810150117.13189.laurent.pinchart@skynet.be>
	<48F5A7A2.4060801@vazka.sk>
Message-ID: <200810151327.28773.laurent.pinchart@skynet.be>

Hi Ivan,

On Wednesday 15 October 2008, Ivan Noris wrote:
> Hi,
>
> > Could you try with luvcview as well ? Camorama is known not to work as it
> > supports V4L1 only while the Linux UVC driver is pure V4L2. Skype is
> > proprietary software and has its share of bugs so it's not a really good
> > test. You could also try Ekiga.
>
> I have tried luvcview meanwhile; I was able to see picture, but I have
> tried it now and have seen only black window. On the terminal output,
> the following can be seen:
>
> vix at bruce:~$ luvcview
> luvcview 0.2.4
>
> SDL information:
>   Video driver: x11
>   A window manager is available
> Device information:
>   Device path:  /dev/video0
> Stream settings:
>   Frame format: YUYV (MJPG is not supported by device)
>   Frame size:   640x480
>   Frame rate:   30 fps
>
> (I'm using Ubuntu Testing / Intrepid Ibex, updating packages daily, so
> something may have changed in past days.)

Does the driver print anything to the kernel log when you start luvcview ?

> >> I can get some partial picture using cat /dev/video0 > /tmp/aaa.jpg
> >> though.
> >
> > No you can't :-) That's currently not supported by the driver. If you get
> > anything from that command make sur /dev/video0 is really your integrated
> > webcam.
>
> Well, there is only one device in /dev/video* :) and that's /dev/video0.
> No other webcam is connected.

Does 'cat /dev/video0 > /tmp/aaa.jpg' produce a non-empty file ?

> > Could you please post the whole lsusb report ?
>
> Attached (ZIP), hope it comes through. If you don't receive it, I will
> send it to you privately.

Got it, thanks.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 13:33:09 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 13:33:09 +0200
Subject: [Linux-uvc-devel] Webcam driver
In-Reply-To: <209499a0810150041v145ab12m2b667fdd3d42fdde@mail.gmail.com>
References: <209499a0810140422m32298daambe7abcec095c2f98@mail.gmail.com>
	<200810150047.09126.laurent.pinchart@skynet.be>
	<209499a0810150041v145ab12m2b667fdd3d42fdde@mail.gmail.com>
Message-ID: <200810151333.09292.laurent.pinchart@skynet.be>

Hi,

On Wednesday 15 October 2008, palmax at gmail.com wrote:
> My project is for learning only of course. I don't know nothing about
> writting a linux driver, but I'm reading LDD 3rd edition.
>
> I want to have a list of unimplemented features in linux uvc driver,
> because it may be interesting for know the possibilities of "get" this
> knowledges.

The driver now supports most of the UVC specification, except

- stream-based payloads
- still image capture
- timestamps in video streaming

The first two features, especially stream-based payloads, would not be too 
difficult to implement, but I lack hardware for testing. I don't know of any 
UVC-compatible device supporting stream-based payloads or still image 
capture.

Timestamps in video streaming is an important feature supported by all devices 
that is currently unimplemented. It doesn't require an in-depth knowledge of 
the Linux kernel of the UVC specification, but the algorithm behind the 
function is not trivial.

Basically, 3 clocks are involved with UVC devices. The device clock (a crystal 
local to the device), the USB clock (shared between the device and the host) 
and the host clock (local to the host). With each video payload devices send 
two timestamps, one relative to the local device clock and one related to the 
USB clock. The goal is to used that information to synchronise the device 
clock with the host clock and produce a timestamp relative to the host that 
can be reported to userspace. Definitely not trivial to implement.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 14:17:14 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 14:17:14 +0200
Subject: [Linux-uvc-devel] [BUG] NULL pointer dereference caused by
	uvcvideo stress test
In-Reply-To: <gbiduj$9p3$1@ger.gmane.org>
References: <gbiduj$9p3$1@ger.gmane.org>
Message-ID: <200810151417.14661.laurent.pinchart@skynet.be>

Hi Alan,

On Friday 26 September 2008, Alan Jenkins wrote:
> This is is on v2.6.27-rc6.  I originally saw it on todays -tip tree.
>
> # while true; do modprobe uvcvideo; modprobe -r uvcvideo; done
>
> After a few tens of cycles, modprobe gets stuck in "D" state, and the
> following backtrace appears:

[snip]

I can't reproduce the issue here on 2.6.27. Could you please test that 
version ?

Best regards,

Laurent Pinchart


From juhovh at iki.fi  Wed Oct 15 13:52:35 2008
From: juhovh at iki.fi (=?ISO-8859-1?Q?Juho_V=E4h=E4-Herttua?=)
Date: Wed, 15 Oct 2008 19:52:35 +0800
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
 Mercurial on linux-tv.org
In-Reply-To: <200810151140.08178.laurent.pinchart@skynet.be>
References: <200810151140.08178.laurent.pinchart@skynet.be>
Message-ID: <48F5D983.9050301@iki.fi>

Laurent Pinchart wrote:
> Cons:
>  - Installing the uvcvideo driver from the source tree will require 
> installation of the v4l core module as well (and possibly other v4l/dvb 
> modules you require for the hardware you own and use).
>
> What's your opinion ? Is someone strongly opposed to the switch ? If so please 
> state your reasons. All constructive opinions are welcome.
>   
I'll add to the cons installing and learning yet another version control
system. Also I remember that with some projects they require some new
version of mercurial which is not found from any distribution (in that
case there was no snapshots available), so even looking at the latest
code was a serious pain in the ass (excuse me my expression) and
required compiling the whole version control system from source. I hope
nothing even resembling that experience will come out of the switch.

Also since I'm in China there's all kinds of blocks and connectivity
problems, can the mercurial repository be checked out over http like the
SVN can? If your only connectivity to the outside world is a proxy, HTTP
is very handy. If not, that is a con as well, the tarballs help with it
a bit but you don't REALLY want to do real work by always downloading a
new tarball. linux-tv.org that you mentioned seems to be owned by some
domain hijackers, so I guess you mean linuxtv.org? If I click the
"CVS/Mercurial" link on their page I get an empty page. :) Not so
convincing, but at "Repositories" link I can get links to tarballs.
There's no easy way to get all required tarballs and nothing else, I
really wouldn't list the tarballs as a pro since you have to get many of
them...

So generally I'm opposed to the change, but if that's the only way to
avoid ugly ifdefs around the code then I guess have to say go for it.
Personally judging by that email, I feel that the barrier to download
and compile uvcvideo will be much higher than before, maybe even over
the limit of doing it on your own. That's just my 5 euro cents (around
0.47 CNY with current rate).


Juho

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081015/b94bac89/attachment.pgp>

From darren.longhorn at redembedded.com  Wed Oct 15 14:26:23 2008
From: darren.longhorn at redembedded.com (Darren Longhorn)
Date: Wed, 15 Oct 2008 13:26:23 +0100
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
 Mercurial on linux-tv.org
In-Reply-To: <200810151312.40148.laurent.pinchart@skynet.be>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<48F5C256.7040906@redembedded.com>
	<200810151312.40148.laurent.pinchart@skynet.be>
Message-ID: <48F5E16F.2070101@redembedded.com>

Laurent Pinchart wrote:
> Hi Darren,
> 
> thanks for taking the time to provide feedback.

No problem.

> On Wednesday 15 October 2008, Darren Longhorn wrote:
>> Laurent Pinchart wrote:
>>
>> <snip>
>>
>>> linux-tv.org Mercurial trees contain a copy of the whole v4l/dvb
>>> subsystem. The main implication would be that, to use the latest uvcvideo
>>> driver instead of the one shipped with your kernel, you will have to
>>> install the v4l core module from the Mercurial tree along with the
>>> uvcvideo module, instead of the uvcvideo module only as you do now.
>> Could you expand on why the v4l core module would also be required?
> 
> Mercurial trees host a copy of the whole v4l/dvb subsystem. The v4l/dvb core 
> is source compatible with all Linux kernels from 2.6.16 up. The device 
> drivers maintain backward source compatibility as well, but the first Linux 
> kernel version they are compatible with depends on the individual drivers' 
> developers.
> 
> As a v4l/dvb tree host a backward compatible copy of the v4l core source, 
> drivers don't have to care about backward compatibility with older versions 
> of the v4l/dvb APIs. For the uvcvideo driver this would mean I can drop an 
> important part of the compatibility code as the driver will only have to 
> support the latest v4l/dvb API. To use the driver with older kernels you 
> would then have to use the v4l/dvb core moduels as well, as the driver itself 
> doesn't maintain backward compability with previous versions of the v4l/dvb 
> core.

Thanks, that's very clear.

>>> I would expect the number of SVN checkouts to have dropped over the last
>>> 3 monts, but Berlios doesn't provide such statistics. I'm thus asking
>>> your opinion : should I switch the Linux UVC driver to a Mercurial tree ?
>>>
>>> Pros:
>>>  - The driver will be hosted along most other video-related kernel
>>> projects - An important part of the compatibility code (uvc_compat.h and
>>> various #ifdef's around the source) can be dropped, as the source tree
>>> contains the latest v4l core source.
>> That answers my questions above, I think? I think that would be a con
>> for those of use who backport to older kernels.
> 
> Backporting will still work, but you will have to backport the v4l/dvb core as 
> well.

Sure.

> Do you really mean backporting (thus on kernels older than 2.6.15, as the 
> uvcvideo driver supports 2.6.15+ kernels already), or were you referring to 
> using the driver with a 2.6.15+ kernel ? In the later case the switch to 
> Mercurial would drop compatibility with 2.6.15 but 2.6.16 and above should 
> work.

Unfortunately, yes. One of the embedded platforms I develop for is based
around 2.6.10.

>> <snip>
>>
>>> What's your opinion ? Is someone strongly opposed to the switch ? If so
>>> please state your reasons. All constructive opinions are welcome.
>> I guess I would be opposed for teh reson above, but I'm probably a very
>> small minority!
> 
> Your opinion in nonetheless important.
> 
> Maintaining backward compatibility in the uvcvideo driver itself wasn't that 
> much of a burden until now, but changes in the v4l core queued for 2.6.28 
> would introduced a whole new set of #ifdef's all around the driver. The code 
> would become messy and I'd like to avoid that if possible. Hence the idea of 
> switching to Mercurial.

I can see that you would wish to avoid that.

Cheers

Darren


From vix at vazka.sk  Wed Oct 15 14:35:59 2008
From: vix at vazka.sk (Ivan Noris)
Date: Wed, 15 Oct 2008 14:35:59 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500
	Integrated	Camera	support?
In-Reply-To: <48F5D0BE.5090508@astronomicalresearchaustralia.org>
References: <48EF02FD.2050408@vazka.sk>	<200810150117.13189.laurent.pinchart@skynet.be>	<48F5A7A2.4060801@vazka.sk>
	<48F5B779.7070807@astronomicalresearchaustralia.org>
	<48F5BD42.8060804@vazka.sk>
	<48F5D0BE.5090508@astronomicalresearchaustralia.org>
Message-ID: <48F5E3AF.7040209@vazka.sk>

Hi Brian,

> Fire up VLC
> File
> Open Capture device.
> A panel pops up and in the top right corner there is a capture mode
> option. This should say Video for Linux 2.
> Note if it does not and you cannot pick it then the uvc install is suspect.

I can see "Video for Linux 2" option, it's the default.

> Fill in your two devices  /dev/video0 /dev/dsp1

Tried everyting, but no picture.
What is interesting, that I can exit VLC, it must be killed with SIGTERM
(the same I need when I test luvcview).

> for the device. I cannot get xawtv to work as a tv but the -hwscan
> option is great to check the V4l2 device is there. It also confirms the
> actual video device the camera is on.
> 
> Brian

This is the xawtv -hwscan output:

This is xawtv-3.95.dfsg.1, running on Linux/i686 (2.6.27-7-generic)
looking for available devices
port 280-311
    type : Xvideo, image scaler
    name : NV17 Video Texture

/dev/video0: OK                         [ -device /dev/video0 ]
    type : v4l2
    name : Integrated Camera
    flags:  capture

So, the device sits there ;-)

Regards,
IVan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..


From vix at vazka.sk  Wed Oct 15 14:49:26 2008
From: vix at vazka.sk (Ivan Noris)
Date: Wed, 15 Oct 2008 14:49:26 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <200810151327.28773.laurent.pinchart@skynet.be>
References: <48EF02FD.2050408@vazka.sk>
	<200810150117.13189.laurent.pinchart@skynet.be>
	<48F5A7A2.4060801@vazka.sk>
	<200810151327.28773.laurent.pinchart@skynet.be>
Message-ID: <48F5E6D6.6090303@vazka.sk>

Hi Laurent,

> Does the driver print anything to the kernel log when you start luvcview ?

Nope, nothing in kern.log nor dmesg.

> Does 'cat /dev/video0 > /tmp/aaa.jpg' produce a non-empty file ?

Well, not anymore:

ls -la /dev/video0
crw-rw----+ 1 root video 81, 0 2008-10-15 12:23 /dev/video0

cat /dev/video0  > /tmp/aaa.jpg
cat: /dev/video0: No such device

Best regards,
Ivan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..


From laurent.pinchart at skynet.be  Wed Oct 15 14:51:35 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 14:51:35 +0200
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
	Mercurial on linux-tv.org
In-Reply-To: <48F5D983.9050301@iki.fi>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<48F5D983.9050301@iki.fi>
Message-ID: <200810151451.35818.laurent.pinchart@skynet.be>

Hi Juho,

On Wednesday 15 October 2008, Juho V?h?-Herttua wrote:
> Laurent Pinchart wrote:
> > Cons:
> >  - Installing the uvcvideo driver from the source tree will require
> > installation of the v4l core module as well (and possibly other v4l/dvb
> > modules you require for the hardware you own and use).
> >
> > What's your opinion ? Is someone strongly opposed to the switch ? If so
> > please state your reasons. All constructive opinions are welcome.
>
> I'll add to the cons installing and learning yet another version control
> system. Also I remember that with some projects they require some new
> version of mercurial which is not found from any distribution (in that
> case there was no snapshots available), so even looking at the latest
> code was a serious pain in the ass (excuse me my expression) and
> required compiling the whole version control system from source. I hope
> nothing even resembling that experience will come out of the switch.

To be honest, learning yet another version control system is one of the 
reasons why I'm reluctant to switch over to Mercurial. I would have preferred 
using a git repository instead.

However, I expect most people to be interested in the latest version only. In 
that case they can easily download a tarball. I might be wrong, but I imagine 
that most people who will download the uvcvideo sources directly from the 
repository will, now that the driver has been included in the kernel, just 
want to try the latest version to get a patch specific to their issue.

How many developers checkout a non-head SVN revision or use SVN log or diff 
commands on the Linux UVC SVN repository ? I'd really like to have statistics 
on such usage.

> Also since I'm in China there's all kinds of blocks and connectivity
> problems, can the mercurial repository be checked out over http like the
> SVN can? If your only connectivity to the outside world is a proxy, HTTP
> is very handy.

Very good point. http://www.selenic.com/mercurial/wiki/index.cgi/MajorFeatures 
states that Mercurial uses "Bandwidth and CPU efficient HTTP and SSH sync 
protocols" so I guess this won't be an issue.

> If not, that is a con as well, the tarballs help with it a bit but you don't
> REALLY want to do real work by always downloading a new tarball.

Hence my question above about usage of SVN log and diff commands (commit is 
not an issue as I'm currently the only committer). Do you feel that tarballs 
are unpractical for the majority of users who just want to try the latest 
version ?

> linux-tv.org that you mentioned seems to be owned by some domain hijackers,
> so I guess you mean linuxtv.org? 

Yes sorry.

> If I click the "CVS/Mercurial" link on their page I get an empty page. :)
> Not so convincing, but at "Repositories" link I can get links to tarballs.
> There's no easy way to get all required tarballs and nothing else, I
> really wouldn't list the tarballs as a pro since you have to get many of
> them...

You only need a single tarball, the one containing the tree you want to 
checkout (in our case this would be the linux-uvc tree). People complained in 
the past about the lack of tarball and the required use of SVN so I thought 
everybody would be happy with tarballs, but it seems this is not the case :-)

> So generally I'm opposed to the change, but if that's the only way to
> avoid ugly ifdefs around the code then I guess have to say go for it.

I'd stick to SVN too if it wasn't for the #ifdef's :-/

> Personally judging by that email, I feel that the barrier to download
> and compile uvcvideo will be much higher than before, maybe even over
> the limit of doing it on your own. That's just my 5 euro cents (around
> 0.47 CNY with current rate).

I see two use cases.

Developers who require "advanced" VCS features will need to learn Mercurial, 
but I don't think that will be a huge burden. I also don't think there are 
many such developers.

Users who need to get the latest version at some point will just have to 
download a tarball. This in itself lowers the barrier. They will also have to 
compile and install the v4l core modules in addition to the uvcvideo module. 
That could raise the barrier, but don't forget that there should be more 
community support as compiling and installing a linuxtv.org tree is an 
operation performed by more users than compiling and installing the uvcvideo 
driver. In a quick chat on the #v4l IRC channel I got told v4l developers do 
not receive much support requests from users who have trouble compiling a 
linuxtv.org tree. I can't tell from personal experience though.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 14:53:18 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 14:53:18 +0200
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
	Mercurial on linux-tv.org
In-Reply-To: <48F5E16F.2070101@redembedded.com>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<200810151312.40148.laurent.pinchart@skynet.be>
	<48F5E16F.2070101@redembedded.com>
Message-ID: <200810151453.18956.laurent.pinchart@skynet.be>

Hi Darren,

On Wednesday 15 October 2008, Darren Longhorn wrote:
> Laurent Pinchart wrote:
> > On Wednesday 15 October 2008, Darren Longhorn wrote:
> >> Laurent Pinchart wrote:
> >>
> >>> I would expect the number of SVN checkouts to have dropped over the
> >>> last 3 monts, but Berlios doesn't provide such statistics. I'm thus
> >>> asking your opinion : should I switch the Linux UVC driver to a
> >>> Mercurial tree ?
> >>>
> >>> Pros:
> >>>  - The driver will be hosted along most other video-related kernel
> >>> projects - An important part of the compatibility code (uvc_compat.h
> >>> and various #ifdef's around the source) can be dropped, as the source
> >>> tree contains the latest v4l core source.
> >>
> >> That answers my questions above, I think? I think that would be a con
> >> for those of use who backport to older kernels.
> >
> > Backporting will still work, but you will have to backport the v4l/dvb
> > core as well.
>
> Sure.
>
> > Do you really mean backporting (thus on kernels older than 2.6.15, as the
> > uvcvideo driver supports 2.6.15+ kernels already), or were you referring
> > to using the driver with a 2.6.15+ kernel ? In the later case the switch
> > to Mercurial would drop compatibility with 2.6.15 but 2.6.16 and above
> > should work.
>
> Unfortunately, yes. One of the embedded platforms I develop for is based
> around 2.6.10.

Ok. Do you have a public repository somewhere ? Do you have to apply lots of 
changes to the uvcvideo driver ? Have you tried backporting v4l core the 
2.6.10 ?

> >> <snip>
> >>
> >>> What's your opinion ? Is someone strongly opposed to the switch ? If so
> >>> please state your reasons. All constructive opinions are welcome.
> >>
> >> I guess I would be opposed for teh reson above, but I'm probably a very
> >> small minority!
> >
> > Your opinion in nonetheless important.
> >
> > Maintaining backward compatibility in the uvcvideo driver itself wasn't
> > that much of a burden until now, but changes in the v4l core queued for
> > 2.6.28 would introduced a whole new set of #ifdef's all around the
> > driver. The code would become messy and I'd like to avoid that if
> > possible. Hence the idea of switching to Mercurial.
>
> I can see that you would wish to avoid that.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 14:56:23 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 14:56:23 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <48F5E6D6.6090303@vazka.sk>
References: <48EF02FD.2050408@vazka.sk>
	<200810151327.28773.laurent.pinchart@skynet.be>
	<48F5E6D6.6090303@vazka.sk>
Message-ID: <200810151456.23505.laurent.pinchart@skynet.be>

On Wednesday 15 October 2008, Ivan Noris wrote:
> Hi Laurent,
>
> > Does the driver print anything to the kernel log when you start luvcview
> > ?
>
> Nope, nothing in kern.log nor dmesg.

Quick test, could you please set the quirks parameter to 16 when loading the 
module ?

modprobe uvcvideo quirks=16

Make sure you unload uvcvideo before doing so, otherwise modprobe will 
silently return without loading anything.

rmmod uvcvideo

Try luvcview again and tell me if you get any interesting result.

Best regards,

Laurent Pinchart


From vix at vazka.sk  Wed Oct 15 15:24:38 2008
From: vix at vazka.sk (Ivan Noris)
Date: Wed, 15 Oct 2008 15:24:38 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <200810151456.23505.laurent.pinchart@skynet.be>
References: <48EF02FD.2050408@vazka.sk>
	<200810151327.28773.laurent.pinchart@skynet.be>
	<48F5E6D6.6090303@vazka.sk>
	<200810151456.23505.laurent.pinchart@skynet.be>
Message-ID: <48F5EF16.7090507@vazka.sk>

Laurent,

> Quick test, could you please set the quirks parameter to 16 when loading the 
> module ?
> 
> modprobe uvcvideo quirks=16

Very interesting. After I use quirks=16, module WORKS, I can see picture
from webcam with luvcview AND I can exit it normally (i.e. no kill -9).

Regards,
Ivan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..


From laurent.pinchart at skynet.be  Wed Oct 15 15:31:09 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 15:31:09 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <48F5EF16.7090507@vazka.sk>
References: <48EF02FD.2050408@vazka.sk>
	<200810151456.23505.laurent.pinchart@skynet.be>
	<48F5EF16.7090507@vazka.sk>
Message-ID: <200810151531.09122.laurent.pinchart@skynet.be>

Hi Ivan,

On Wednesday 15 October 2008, Ivan Noris wrote:
> Laurent,
>
> > Quick test, could you please set the quirks parameter to 16 when loading
> > the module ?
> >
> > modprobe uvcvideo quirks=16
>
> Very interesting. After I use quirks=16, module WORKS, I can see picture
> from webcam with luvcview AND I can exit it normally (i.e. no kill -9).

Problem solved then :-)

I'll commit a fix to SVN.

Best regards,

Laurent Pinchart


From vix at vazka.sk  Wed Oct 15 15:32:34 2008
From: vix at vazka.sk (Ivan Noris)
Date: Wed, 15 Oct 2008 15:32:34 +0200
Subject: [Linux-uvc-devel] Lenovo Thinkpad SL500 Integrated Camera
	support?
In-Reply-To: <200810151531.09122.laurent.pinchart@skynet.be>
References: <48EF02FD.2050408@vazka.sk>
	<200810151456.23505.laurent.pinchart@skynet.be>
	<48F5EF16.7090507@vazka.sk>
	<200810151531.09122.laurent.pinchart@skynet.be>
Message-ID: <48F5F0F2.2070402@vazka.sk>

Hi Laurent,

> Problem solved then :-)
> 
> I'll commit a fix to SVN.

:-) Wow, this is interesting. Many thanks!

Regards,
Ivan
-- 

Ing. Ivan Noris, Security Administrator
vix at vazka.sk, admin at vazka.sk

PubKey: 4B10F989 (7612 5298 7DB7 2C95 BD4B A954 A097 B71A 4B10 F989)
..the (t)root(h) shell make(s) you free..


From darren.longhorn at redembedded.com  Wed Oct 15 15:40:08 2008
From: darren.longhorn at redembedded.com (Darren Longhorn)
Date: Wed, 15 Oct 2008 14:40:08 +0100
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
 Mercurial on linux-tv.org
In-Reply-To: <200810151453.18956.laurent.pinchart@skynet.be>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<200810151312.40148.laurent.pinchart@skynet.be>
	<48F5E16F.2070101@redembedded.com>
	<200810151453.18956.laurent.pinchart@skynet.be>
Message-ID: <48F5F2B8.3090403@redembedded.com>

Laurent Pinchart wrote:
> Hi Darren,
> 
> On Wednesday 15 October 2008, Darren Longhorn wrote:
>> Unfortunately, yes. One of the embedded platforms I develop for is based
>> around 2.6.10.
> 
> Ok. Do you have a public repository somewhere ? Do you have to apply lots of 
> changes to the uvcvideo driver ? Have you tried backporting v4l core the 
> 2.6.10 ?

Unfortunately not, as yet. I keep my modified code in a local CVS
repository. I import uvcvideo onto a vendor branch. That usually takes
care of applying changes to the driver. Most of the backport changes I
made you later incorporated into SVN. There are quite a few other
changes related to allocating contiguous physical memory for the
captured frames.

So far I have not had any reason to try and backport v4l core. It's
something I should investigate.

Cheers

Darren




From rob.owens at biochemfluidics.com  Wed Oct 15 15:44:43 2008
From: rob.owens at biochemfluidics.com (Rob Owens)
Date: Wed, 15 Oct 2008 09:44:43 -0400
Subject: [Linux-uvc-devel] webcams on LTSP thin clients
Message-ID: <48F5F3CB.1030702@biochemfluidics.com>

Has anybody gotten a webcam to work on an LTSP-powered thin client?  I
asked on the LTSP list but apparently nobody there has done it before.

-Rob
********************************************************

The information transmitted is intended only for the person or entity to
which it is addressed and may contain confidential and/or privileged
material. If you are not the addressee, any disclosure, reproduction,
copying, distribution, or other dissemination or use of this transmission in
error please notify the sender immediately and then delete this e-mail.
E-mail transmission cannot be guaranteed to be secure or error free as
information could be intercepted, corrupted lost, destroyed, arrive late or
incomplete, or contain viruses.
The sender therefore does not accept liability for any errors or omissions
in the contents of this message which arise as a result of e-mail
transmission. If verification is required please request a hard copy
version.

********************************************************



From laurent.pinchart at skynet.be  Wed Oct 15 15:46:15 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 15:46:15 +0200
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
	Mercurial on linux-tv.org
In-Reply-To: <48F5F2B8.3090403@redembedded.com>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<200810151453.18956.laurent.pinchart@skynet.be>
	<48F5F2B8.3090403@redembedded.com>
Message-ID: <200810151546.15276.laurent.pinchart@skynet.be>

Hi Darren,

On Wednesday 15 October 2008, Darren Longhorn wrote:
> Laurent Pinchart wrote:
> > Hi Darren,
> >
> > On Wednesday 15 October 2008, Darren Longhorn wrote:
> >> Unfortunately, yes. One of the embedded platforms I develop for is based
> >> around 2.6.10.
> >
> > Ok. Do you have a public repository somewhere ? Do you have to apply lots
> > of changes to the uvcvideo driver ? Have you tried backporting v4l core
> > the 2.6.10 ?
>
> Unfortunately not, as yet. I keep my modified code in a local CVS
> repository. I import uvcvideo onto a vendor branch. That usually takes
> care of applying changes to the driver. Most of the backport changes I
> made you later incorporated into SVN.

Ok.

> There are quite a few other changes related to allocating contiguous
> physical memory for the captured frames.

As that's specific to your platform I can't really integrate that in the 
mainline driver. If there are any change required to compile and run the 
driver on 2.6.10 that I can integrate please let me know.

> So far I have not had any reason to try and backport v4l core. It's
> something I should investigate.

I'll try to minimise the amount of work for both of us during the transition 
to mercurial (if it happens) so I'm very interesting in all input and 
feedback you can give. There's no urgency though (at least on my side).

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 16:07:44 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 16:07:44 +0200
Subject: [Linux-uvc-devel] webcams on LTSP thin clients
In-Reply-To: <48F5F3CB.1030702@biochemfluidics.com>
References: <48F5F3CB.1030702@biochemfluidics.com>
Message-ID: <200810151607.44605.laurent.pinchart@skynet.be>

Hi Rob,

On Wednesday 15 October 2008, Rob Owens wrote:
> Has anybody gotten a webcam to work on an LTSP-powered thin client?  I
> asked on the LTSP list but apparently nobody there has done it before.

Could you describe the problem with more details ? A quick summary of the 
hardware/software setup would probably be interesting too.

Best regards,

Laurent Pinchart


From rob.owens at biochemfluidics.com  Wed Oct 15 16:36:04 2008
From: rob.owens at biochemfluidics.com (Rob Owens)
Date: Wed, 15 Oct 2008 10:36:04 -0400
Subject: [Linux-uvc-devel] webcams on LTSP thin clients
In-Reply-To: <200810151607.44605.laurent.pinchart@skynet.be>
References: <48F5F3CB.1030702@biochemfluidics.com>
	<200810151607.44605.laurent.pinchart@skynet.be>
Message-ID: <48F5FFD4.1000404@biochemfluidics.com>

Laurent Pinchart wrote:
> Hi Rob,
> 
> On Wednesday 15 October 2008, Rob Owens wrote:
>> Has anybody gotten a webcam to work on an LTSP-powered thin client?  I
>> asked on the LTSP list but apparently nobody there has done it before.
> 
> Could you describe the problem with more details ? A quick summary of the 
> hardware/software setup would probably be interesting too.
> 
LTSP is Linux Terminal Server Project.  Basically it allows you to run
low-power, diskless workstations (also called thin clients) completely
over the network.  The thin clients retrieve a basic operating system
from the LTSP server, then establish a remote session (graphical or
otherwise) to the LTSP server or to any other server you specify.

The key here is that there is no embedded operating system on these thin
clients.  They use PXE or Etherboot to get their operating system from
the LTSP server.

The thin clients run a local X server (downloaded from the LTSP server),
and then all applications run on the LTSP server.  A 200 MHz thin client
with 64 MB of RAM is capable of running modern software very quickly.
Well, really it's only displaying the software -- it's actually running
on the server.

Anyway, this causes some complications when plugging local devices into
the thin client, because the server needs access to these devices.
Local usb storage works.  Local sound works.  But I haven't come across
anyone using local webcams.  When I tried it, it didn't work, but I
didn't try for very long.  I have to borrow the webcam to do my testing,
and I have limited time to do my testing.

So the problem can be attacked in a few ways.  All of these depend on
getting the proper modules to load when the camera device is plugged in,
which I think I can handle.

1) Run the video application (luvcview, for instance) locally on the
thin client.  LTSP calls this "local applications" and I'd consult the
LTSP list for instructions on doing that.

2) Run the video application on the server (the normal way LTSP works),
but convince the video application to access a video device over the
network.

3) Have LTSP treat the local webcam the same way a local USB drive or a
local sound card is treated.  Unfortunately I don't know the specifics
of that, so I was hoping to hear from somebody "sure I've done that
before, it's easy!"

Thanks for any advice you guys might have.

By the way, I'm trying to use the ProScope HR camera at the 9 thin
clients that are installed in my company's machine shop.  The cameras
are to be used for inspection of some very small parts.  This camera
does work on Linux using the uvc driver.

-Rob
********************************************************

The information transmitted is intended only for the person or entity to
which it is addressed and may contain confidential and/or privileged
material. If you are not the addressee, any disclosure, reproduction,
copying, distribution, or other dissemination or use of this transmission in
error please notify the sender immediately and then delete this e-mail.
E-mail transmission cannot be guaranteed to be secure or error free as
information could be intercepted, corrupted lost, destroyed, arrive late or
incomplete, or contain viruses.
The sender therefore does not accept liability for any errors or omissions
in the contents of this message which arise as a result of e-mail
transmission. If verification is required please request a hard copy
version.

********************************************************



From r.cortes at ntgs.es  Wed Oct 15 16:31:01 2008
From: r.cortes at ntgs.es (=?iso-8859-1?Q?Raquel_Cort=E9s_Carreras?=)
Date: Wed, 15 Oct 2008 16:31:01 +0200
Subject: [Linux-uvc-devel] Framegrabber USB for Linux
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAMC1shiTElhIowYPzRF4TZLCgAAAEAAAAHH2SQUuFuxJidn1q9l9MpEBAAAAAA==@ntgs.es>

Hello,

I need to work with an analog camera in Linux, so I need a framegrabber. Do
you know any framegrabber usb compatible with UVC?

Thank you,

Raquel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081015/d7f795e3/attachment.html>

From laurent.pinchart at skynet.be  Wed Oct 15 16:59:12 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 16:59:12 +0200
Subject: [Linux-uvc-devel] [RFC] Video probe control refactoring
Message-ID: <200810151659.13006.laurent.pinchart@skynet.be>

Hi everybody,

I've been working on code refactoring to make the UVC driver more robust when 
used with non-compliant UVC devices (we all know there are many of them). 
Before you rejoice, this has nothing to do with the Logitech firmware bug. 
Sorry.

Anyway, the attached patch (against SVN head) modifies video control handling 
to handle failed GET_MIN/GET_MAX/GET_DEF requests more gracefully. Failed 
requests will now generate a one-time warning message instead of the 
usual "Failed to query..." error, which should be more user-friendly. The 
driver will also recover automatically from failed GET_MIN/GET_MAX requests 
when the device is half-broken without requiring the MINMAX quirk (fully 
broken devices still need the quirk).

The patch is required to implement JPEG quality control which I will soon work 
on. As it's quite intrusive, I'd like to make sure it doesn't break anything. 
I'd appreciate if you could test it, especially if you got one of the 
following cameras:

ALi M5606 (Clevo M540SR)	(0402:5606)
Creative Live! Optia		(041e:4057)
Microsoft Lifecam NX-6000	(045e:00f8)
Microsoft Lifecam VX-7000	(045e:0723)
Apple Built-In iSight		(05ac:8501)
Silicon Motion SM371		(090c:b371)
Acer OEM Webcam			(5986:0100)
Packard Bell OEM Webcam		(5986:0101)
Acer Crystal Eye webcam		(5986:0102)
Compaq Presario B1200		(5986:0104)
Acer Travelmate 7720		(5986:0105)
Medion Akoya Mini E1210		(5986:0141)
Acer OrbiCam			(5986:0200)
Fujitsu Amilo SI2636		(5986:0202)
Advent 4211			(5986:0203)
???				(5986:0300)
Clevo M570TU			(5986:0303)

Testing the patch means making sure the webcam is still detected properly by 
the driver (it should be as I haven't changed anything there) and is still 
able to stream video (use any software you like, pick one that you know is 
working).

Of course nothing should break, but bugs happen. That's not completely true, 
as I don't have enough information about the two Microsoft cameras to make 
sure they will still work. I'm thus especially interesting in hearing from 
you if you got a supported Microsoft webcam.

Cameras in the above list should print a few extra messages in the kernel log 
when starting a video stream. Please include them in your report.

Enough said, I wish you all happy testing :-)

Best regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minmax.diff
Type: text/x-diff
Size: 12418 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081015/e2bb705c/attachment.diff>

From laurent.pinchart at skynet.be  Wed Oct 15 17:00:22 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 17:00:22 +0200
Subject: [Linux-uvc-devel] Framegrabber USB for Linux
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAMC1shiTElhIowYPzRF4TZLCgAAAEAAAAHH2SQUuFuxJidn1q9l9MpEBAAAAAA==@ntgs.es>
References: <!&!AAAAAAAAAAAYAAAAAAAAAMC1shiTElhIowYPzRF4TZLCgAAAEAAAAHH2SQUuFuxJidn1q9l9MpEBAAAAAA==@ntgs.es>
Message-ID: <200810151700.22261.laurent.pinchart@skynet.be>

Hi Raquel,

On Wednesday 15 October 2008, Raquel Cort?s Carreras wrote:
> Hello,
>
> I need to work with an analog camera in Linux, so I need a framegrabber. Do
> you know any framegrabber usb compatible with UVC?

I personally don't, but I'd be interesting in hearing from such hardware.

Best regards,

Laurent Pinchart


From darren.longhorn at redembedded.com  Wed Oct 15 17:03:18 2008
From: darren.longhorn at redembedded.com (Darren Longhorn)
Date: Wed, 15 Oct 2008 16:03:18 +0100
Subject: [Linux-uvc-devel] Framegrabber USB for Linux
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAMC1shiTElhIowYPzRF4TZLCgAAAEAAAAHH2SQUuFuxJidn1q9l9MpEBAAAAAA==@ntgs.es>
References: <!&!AAAAAAAAAAAYAAAAAAAAAMC1shiTElhIowYPzRF4TZLCgAAAEAAAAHH2SQUuFuxJidn1q9l9MpEBAAAAAA==@ntgs.es>
Message-ID: <48F60636.5010801@redembedded.com>

Raquel Cort?s Carreras wrote:
> Hello,
> 
> I need to work with an analog camera in Linux, so I need a framegrabber.
> Do you know any framegrabber usb compatible with UVC?

I've looked myself, for the same reason, but without success.


From laurent.pinchart at skynet.be  Wed Oct 15 20:17:47 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 20:17:47 +0200
Subject: [Linux-uvc-devel] [BUG] NULL pointer dereference caused by
	uvcvideo stress test
In-Reply-To: <48F61DA1.6060504@tuffmail.co.uk>
References: <gbiduj$9p3$1@ger.gmane.org>
	<200810151417.14661.laurent.pinchart@skynet.be>
	<48F61DA1.6060504@tuffmail.co.uk>
Message-ID: <200810152017.47347.laurent.pinchart@skynet.be>

Hi Alan,

On Wednesday 15 October 2008, Alan Jenkins wrote:
> Laurent Pinchart wrote:
> > Hi Alan,
> >
> > On Friday 26 September 2008, Alan Jenkins wrote:
> >> This is is on v2.6.27-rc6.  I originally saw it on todays -tip tree.
> >>
> >> # while true; do modprobe uvcvideo; modprobe -r uvcvideo; done
> >>
> >> After a few tens of cycles, modprobe gets stuck in "D" state, and the
> >> following backtrace appears:
> >
> > [snip]
> >
> > I can't reproduce the issue here on 2.6.27. Could you please test that
> > version ?
>
> Sure... still happens.

I had secretly hoped it would have disapearred :-)

> If you look at the trace, it happens as "hald-probe-video" opens the
> video device.  This is from Ubuntu 8.04.  Possibly it's significant that
> I use the camera first, to make sure it works (I use Kopete, the
> settings dialogue includes a video test).

The NULL pointer (or rather 0x00000030 pointer) dereference happens in 
video_open:

        file->f_op = fops_get(vfl->fops);
        if (file->f_op->open)
                err = file->f_op->open(inode, file);

file->f_op ends up being NULL. Either vfl->fops is NULL to begin with, or 
fops_get failed to get a reference to the file_operations structure.

I'd be surprised if vfl->fops was NULL. To rule out that case, can you add a 
BUG_ON(vfl->fops == NULL) before the call to fops_get ?

I'm not too familiar with the module loader, but a quick look at the code 
shows that the module could be marked as being unloaded (MODULE_STATE_GOING) 
before its exit function is called. If this is the case video_open would 
still be called, as the video device would still be registered, but fops_get 
would fail in try_module_get and return a NULL pointer. It seems the pointer 
returned by fops_get should be tested in video_open.

I've CC'ed the v4l maintainer to get his opinion on this.

> [  267.056655] input: UVC Camera (eb1a:2761) as /class/input/input59
> [  267.069990] usbcore: registered new interface driver uvcvideo
> [  267.069990] USB Video Class driver (v0.1.0)
> [  267.299989] usbcore: deregistering interface driver uvcvideo
> [  267.336656] Linux video capture interface: v2.00
> [  267.349981] uvcvideo: Found UVC 1.00 device <unnamed> (eb1a:2761)
> [  267.353317] input: UVC Camera (eb1a:2761) as /class/input/input60
> [  267.363324] usbcore: registered new interface driver uvcvideo
> [  267.363324] USB Video Class driver (v0.1.0)
> [  267.373325] BUG: unable to handle kernel NULL pointer dereference at
> 00000030
> [  267.373325] IP: [<e03e13ec>] :videodev:video_open+0x8b/0xe4
> [  267.373325] *pdpt = 0000000011ebc001 *pde = 0000000000000000
> [  267.373325] Oops: 0000 [#1]
> [  267.373325] Modules linked in: uvcvideo(-) compat_ioctl32 videodev
> v4l1_compat aes_i586 aes_generic af_packet i915 drm cpufreq_userspace
> cpufreq_powersave cpufreq_ondemand cpufreq_stats freq_table
> cpufreq_conservative wmi sbs sbshc ip6t_LOG nf_conntrack_ipv6 ipt_LOG
> xt_limit ipt_addrtype xt_state xt_tcpudp xt_conntrack ip6table_filter
> ip6_tables ipv6 nf_nat_irc nf_conntrack_irc nf_nat_ftp nf_nat
> nf_conntrack_ipv4 nf_conntrack_ftp nf_conntrack iptable_filter ip_tables
> x_tables dm_crypt dm_mod fuse joydev arc4 ecb crypto_blkcipher ath5k
> mac80211 led_class sg cfg80211 psmouse serio_raw snd_hda_intel
> snd_pcm_oss snd_mixer_oss ata_generic snd_pcm snd_timer snd_page_alloc
> snd_hwdep shpchp pci_hotplug intel_agp agpgart video output battery ac
> eeepc_laptop backlight button evdev uhci_hcd ehci_hcd usb_storage
> libusual pcspkr usbcore thermal processor fan [last unloaded: v4l1_compat]
> [  267.373325]
> [  267.373325] Pid: 7709, comm: hald-probe-vide Not tainted (2.6.27eeepc
> #61)
> [  267.373325] EIP: 0060:[<e03e13ec>] EFLAGS: 00010246 CPU: 0
> [  267.373325] EIP is at video_open+0x8b/0xe4 [videodev]
> [  267.373325] EAX: 00000000 EBX: e03e49d0 ECX: e03e1361 EDX: d1e6c000
> [  267.373325] ESI: d1ea5c80 EDI: 00000000 EBP: debf41ec ESP: d1efde98
> [  267.373325]  DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 0068
> [  267.373325] Process hald-probe-vide (pid: 7709, ti=d1efc000
> task=d1c586e0 task.ti=d1efc000)
> [  267.373325] Stack: 00000000 df1e17c0 00000000 debf41ec c01604e6
> d1ea5c80 00000000 d1ea5c80
> [  267.373325]        debf41ec d1efdf14 c0160406 c015d36d deae0580
> def61700 d1efdf14 d1ea5c80
> [  267.373325]        d1efdf14 00008001 c015d471 d1ea5c80 00000000
> 00000000 d1efdf14 c016692e
> [  267.373325] Call Trace:
> [  267.373325]  [<c01604e6>] chrdev_open+0xe0/0xf6
> [  267.373325]  [<c0160406>] chrdev_open+0x0/0xf6
> [  267.373325]  [<c015d36d>] __dentry_open+0xf2/0x1da
> [  267.373325]  [<c015d471>] nameidata_to_filp+0x1c/0x2c
> [  267.373325]  [<c016692e>] do_filp_open+0x343/0x61e
> [  267.373325]  [<c014e1ad>] handle_mm_fault+0x27d/0x528
> [  267.373325]  [<c016df2d>] alloc_fd+0x46/0xad
> [  267.373325]  [<c015d1a8>] do_sys_open+0x3f/0xb3
> [  267.373325]  [<c015d260>] sys_open+0x1e/0x23
> [  267.373325]  [<c01035c1>] sysenter_do_call+0x12/0x21
> [  267.373325]  [<c0280000>] xfrm_state_find+0x3bb/0x4b1
> [  267.373325]  =======================
> [  267.373325] Code: c4 0c 85 d2 74 6d 8b 02 8b 5e 10 85 c0 74 15 8b 00
> 85 c0 74 0b 83 38 02 74 0a ff 80 40 01 00 00 8b 02 eb 02 31 c0 89 46 10
> 31 ff <8b> 48 30 85 c9 74 36 89 f2 89 e8 ff d1 85 c0 89 c7 74 2a 8b 46
> [  267.373325] EIP: [<e03e13ec>] video_open+0x8b/0xe4 [videodev] SS:ESP
> 0068:d1efde98
> [  267.373325] ---[ end trace 1a1a7d2a0a55bf75 ]---
> [  267.379201] usbcore: deregistering interface driver uvcvideo

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Wed Oct 15 23:19:17 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 15 Oct 2008 23:19:17 +0200
Subject: [Linux-uvc-devel] [BUG] NULL pointer dereference caused by
	uvcvideo stress test
In-Reply-To: <48F63C4E.3070103@tuffmail.co.uk>
References: <gbiduj$9p3$1@ger.gmane.org>
	<200810152017.47347.laurent.pinchart@skynet.be>
	<48F63C4E.3070103@tuffmail.co.uk>
Message-ID: <200810152319.17925.laurent.pinchart@skynet.be>

Hi Alan,

On Wednesday 15 October 2008, Alan Jenkins wrote:
> Laurent Pinchart wrote:
> > On Wednesday 15 October 2008, Alan Jenkins wrote:
> > > If you look at the trace, it happens as "hald-probe-video" opens the
> > > video device.  This is from Ubuntu 8.04.  Possibly it's significant that
> > > I use the camera first, to make sure it works (I use Kopete, the
> > > settings dialogue includes a video test).
> >
> > The NULL pointer (or rather 0x00000030 pointer) dereference happens in
> > video_open:
> >
> >         file->f_op = fops_get(vfl->fops);
> >         if (file->f_op->open)
> >                 err = file->f_op->open(inode, file);
> >
> > file->f_op ends up being NULL. Either vfl->fops is NULL to begin with, or
> > fops_get failed to get a reference to the file_operations structure.
> >
> > I'd be surprised if vfl->fops was NULL. To rule out that case, can you
> > add a BUG_ON(vfl->fops == NULL) before the call to fops_get ?
> >
> > I'm not too familiar with the module loader, but a quick look at the code
> > shows that the module could be marked as being unloaded
> > (MODULE_STATE_GOING) before its exit function is called. If this is the
> > case video_open would still be called, as the video device would still be
> > registered, but fops_get would fail in try_module_get and return a NULL
> > pointer. It seems the pointer returned by fops_get should be tested in
> > video_open.
> >
> > I've CC'ed the v4l maintainer to get his opinion on this.
>
> I put one before and one after
>
> 134    BUG_ON(vfl->fops == NULL);
> 135    file->f_op = fops_get(vfl->fops);
> 136    BUG_ON(file->f_op == NULL);
>
> and the second one triggered

This confirms my suspicion. Could you please try the attached patch ?

Best regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fops_get_check.patch
Type: text/x-diff
Size: 710 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081015/b53a4b88/attachment.patch>

From darren.longhorn at redembedded.com  Thu Oct 16 10:46:17 2008
From: darren.longhorn at redembedded.com (Darren Longhorn)
Date: Thu, 16 Oct 2008 09:46:17 +0100
Subject: [Linux-uvc-devel] Framegrabber USB for Linux
In-Reply-To: <8AC08AE352EE467F87DD57678B102557@core2>
References: <!&!AAAAAAAAAAAYAAAAAAAAAMC1shiTElhIowYPzRF4TZLCgAAAEAAAAHH2SQUuFuxJidn1q9l9MpEBAAAAAA==@ntgs.es>
	<48F60636.5010801@redembedded.com>
	<8AC08AE352EE467F87DD57678B102557@core2>
Message-ID: <48F6FF59.80605@redembedded.com>

Adrian Sergiu DARABANT wrote:
> Why not use other grabers for analog cameras ?
> There are a few  supported on Linux.
> Is it absolutely necessary to use a UVC like grabber. What would be the
> benefit ?

Just that we already have uvc ported to our target platform, that's all.


From juhovh at iki.fi  Thu Oct 16 10:59:02 2008
From: juhovh at iki.fi (=?UTF-8?B?SnVobyBWw6Row6QtSGVydHR1YQ==?=)
Date: Thu, 16 Oct 2008 16:59:02 +0800
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
 Mercurial on linux-tv.org
In-Reply-To: <200810151451.35818.laurent.pinchart@skynet.be>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<48F5D983.9050301@iki.fi>
	<200810151451.35818.laurent.pinchart@skynet.be>
Message-ID: <48F70256.9050902@iki.fi>

Hi Lauren,

Laurent Pinchart wrote:
> To be honest, learning yet another version control system is one of the
> reasons why I'm reluctant to switch over to Mercurial. I would have
preferred
> using a git repository instead.

In fact I would prefer git as well, but if hosting is mercurial only
then... :)

> However, I expect most people to be interested in the latest version
only. In
> that case they can easily download a tarball. I might be wrong, but I
imagine
> that most people who will download the uvcvideo sources directly from the
> repository will, now that the driver has been included in the kernel, just
> want to try the latest version to get a patch specific to their issue.

Hmm, that's probably the case.

> How many developers checkout a non-head SVN revision or use SVN log or
diff
> commands on the Linux UVC SVN repository ? I'd really like to have
statistics
> on such usage.

I wasn't really referring to the log or even diff commands per se.
Rather keeping oneself up to date with the latest repository without
redownloading it.

> Very good point.
http://www.selenic.com/mercurial/wiki/index.cgi/MajorFeatures
> states that Mercurial uses "Bandwidth and CPU efficient HTTP and SSH sync
> protocols" so I guess this won't be an issue.

Yeah, according to that it seems to be a non-issue.

> Hence my question above about usage of SVN log and diff commands
(commit is
> not an issue as I'm currently the only committer). Do you feel that
tarballs
> are unpractical for the majority of users who just want to try the latest
> version ?

I'm not committing, but sometimes syncing and diffing to check if
there's a workaround for the old camera issue my camera had. :p

> You only need a single tarball, the one containing the tree you want to
> checkout (in our case this would be the linux-uvc tree). People
complained in
> the past about the lack of tarball and the required use of SVN so I
thought
> everybody would be happy with tarballs, but it seems this is not the
case :-)

But I understood you also need to get the v4l/dvb core sources and
maybe some other modules to compile it, would they be in the same
tarball or how are they got? Don't take my opinion as the general
opinion though, I'm just personally happier with svn compared to
tarballs but most people probably aren't. :)

> I'd stick to SVN too if it wasn't for the #ifdef's :-/

I guess that's good enough reason, as I said if that's the thing to
avoid ugly code then should just go for it.

> download a tarball. This in itself lowers the barrier. They will also
have to
> compile and install the v4l core modules in addition to the uvcvideo
module.
> That could raise the barrier, but don't forget that there should be more
> community support as compiling and installing a linuxtv.org tree is an
> operation performed by more users than compiling and installing the
uvcvideo
> driver. In a quick chat on the #v4l IRC channel I got told v4l
developers do

It's just that the first time I checked out and compiled uvcvideo I
was slightly amazed at how easy and painless everything went. That
sounds like it will go from amazing to a slight pain in the ass in the
future, but that should be acceptable. I'm mainly replying because you
asked for comments, in the end it's your call since you do the commits. :)


Regards,

Juho


From laurent.pinchart at skynet.be  Thu Oct 16 11:16:28 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Thu, 16 Oct 2008 11:16:28 +0200
Subject: [Linux-uvc-devel] [RFC] Switching from SVN on Berlios to
	Mercurial on linux-tv.org
In-Reply-To: <48F70256.9050902@iki.fi>
References: <200810151140.08178.laurent.pinchart@skynet.be>
	<200810151451.35818.laurent.pinchart@skynet.be>
	<48F70256.9050902@iki.fi>
Message-ID: <200810161116.28792.laurent.pinchart@skynet.be>

Hi Juho,

On Thursday 16 October 2008, Juho V?h?-Herttua wrote:
> Laurent Pinchart wrote:
> > To be honest, learning yet another version control system is one of the
> > reasons why I'm reluctant to switch over to Mercurial. I would have
> > preferred using a git repository instead.
>
> In fact I would prefer git as well, but if hosting is mercurial only
> then... :)

It would be much easier for me to maintain the driver in a kernel git tree, 
but then we would loose all backward compatibility. Let's not go that far 
yet :-)

> > However, I expect most people to be interested in the latest version
> > only. In that case they can easily download a tarball. I might be wrong,
> > but I imagine that most people who will download the uvcvideo sources
> > directly from the repository will, now that the driver has been included
> > in the kernel, just want to try the latest version to get a patch specific
> > to their issue.
>
> Hmm, that's probably the case.
>
> > How many developers checkout a non-head SVN revision or use SVN log or
> > diff commands on the Linux UVC SVN repository ? I'd really like to have
> > statistics on such usage.
>
> I wasn't really referring to the log or even diff commands per se.
> Rather keeping oneself up to date with the latest repository without
> redownloading it.

Good point. It's definitely easier to svn up than to download a new tarball 
and look at the diff output.

> > Very good point.
> > http://www.selenic.com/mercurial/wiki/index.cgi/MajorFeatures 
> > states that Mercurial uses "Bandwidth and CPU efficient HTTP and SSH sync
> > protocols" so I guess this won't be an issue.
>
> Yeah, according to that it seems to be a non-issue.
>
> > Hence my question above about usage of SVN log and diff commands
> > (commit is not an issue as I'm currently the only committer). Do you feel
> > that tarballs are unpractical for the majority of users who just want to
> > try the latest version ?
>
> I'm not committing, but sometimes syncing and diffing to check if
> there's a workaround for the old camera issue my camera had. :p

Feel free to report the issue if it's still present in the latest version :-)

> > You only need a single tarball, the one containing the tree you want to
> > checkout (in our case this would be the linux-uvc tree). People
> > complained in the past about the lack of tarball and the required use of
> > SVN so I thought everybody would be happy with tarballs, but it seems this
> > is not the case :-)
>
> But I understood you also need to get the v4l/dvb core sources and
> maybe some other modules to compile it, would they be in the same
> tarball or how are they got?

They would be in the same tree, thus in the same tarball. make && make install 
(or a small variation thereof) should install everything 
in /lib/modules/`uname -r`.

> Don't take my opinion as the general opinion though, I'm just personally
> happier with svn compared to tarballs but most people probably aren't. :)
>
> > I'd stick to SVN too if it wasn't for the #ifdef's :-/
>
> I guess that's good enough reason, as I said if that's the thing to
> avoid ugly code then should just go for it.
>
> > download a tarball. This in itself lowers the barrier. They will also
> > have to compile and install the v4l core modules in addition to the
> > uvcvideo module.
>
> > That could raise the barrier, but don't forget that there should be more
> > community support as compiling and installing a linuxtv.org tree is an
> > operation performed by more users than compiling and installing the
> > uvcvideo driver. In a quick chat on the #v4l IRC channel I got told v4l
> > developers do
>
> It's just that the first time I checked out and compiled uvcvideo I
> was slightly amazed at how easy and painless everything went. That
> sounds like it will go from amazing to a slight pain in the ass in the
> future, but that should be acceptable.

The v4l tree compilation and installation procedure seems quite 
straightforward. You can either build and install all modules (make && make 
install) or configure the ones you need (make menuconfig). It shouldn't get 
more difficult than that.

> I'm mainly replying because you asked for comments, in the end it's your
> call since you do the commits. :) 

And I'm glad you replied, otherwise the amount of comments would have been 
divided by two.

Cheers,

Laurent Pinchart


From laurent.pinchart at skynet.be  Thu Oct 16 14:03:49 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Thu, 16 Oct 2008 14:03:49 +0200
Subject: [Linux-uvc-devel] [BUG] NULL pointer dereference caused by
	uvcvideo stress test
In-Reply-To: <48F710F7.9030608@tuffmail.co.uk>
References: <gbiduj$9p3$1@ger.gmane.org>
	<200810152319.17925.laurent.pinchart@skynet.be>
	<48F710F7.9030608@tuffmail.co.uk>
Message-ID: <200810161403.49267.laurent.pinchart@skynet.be>

Hi Alan,

On Thursday 16 October 2008, Alan Jenkins wrote:
> Laurent Pinchart wrote:
> > On Wednesday 15 October 2008, Alan Jenkins wrote:
> >> Laurent Pinchart wrote:
> >>> On Wednesday 15 October 2008, Alan Jenkins wrote:
> >>>> If you look at the trace, it happens as "hald-probe-video" opens the
> >>>> video device.  This is from Ubuntu 8.04.  Possibly it's significant
> >>>> that I use the camera first, to make sure it works (I use Kopete, the
> >>>> settings dialogue includes a video test).
> >>>
> >>> The NULL pointer (or rather 0x00000030 pointer) dereference happens in
> >>> video_open:
> >>>
> >>>         file->f_op = fops_get(vfl->fops);
> >>>         if (file->f_op->open)
> >>>                 err = file->f_op->open(inode, file);
> >>>
> >>> file->f_op ends up being NULL. Either vfl->fops is NULL to begin with,
> >>> or fops_get failed to get a reference to the file_operations structure.
> >>>
> >>> I'd be surprised if vfl->fops was NULL. To rule out that case, can you
> >>> add a BUG_ON(vfl->fops == NULL) before the call to fops_get ?
> >>>
> >>> I'm not too familiar with the module loader, but a quick look at the
> >>> code shows that the module could be marked as being unloaded
> >>> (MODULE_STATE_GOING) before its exit function is called. If this is the
> >>> case video_open would still be called, as the video device would still
> >>> be registered, but fops_get would fail in try_module_get and return a
> >>> NULL pointer. It seems the pointer returned by fops_get should be
> >>> tested in video_open.
> >>>
> >>> I've CC'ed the v4l maintainer to get his opinion on this.
> >>
> >> I put one before and one after
> >>
> >> 134    BUG_ON(vfl->fops == NULL);
> >> 135    file->f_op = fops_get(vfl->fops);
> >> 136    BUG_ON(file->f_op == NULL);
> >>
> >> and the second one triggered
> >
> > This confirms my suspicion. Could you please try the attached patch ?
>
> Yup, that seems to fix it.

Great.

> I wonder if there are more instances of this error in other subsystems.

From a quick grep it seems the following subsystems are affected:

drivers/media/video
drivers/media/video/dvb/dvb-core
drivers/gpu/drm
sound/core

Unless the issue is critical and should be fixed before 2.6.28, 
drivers/media/video won't matter as the v4l core has already been moved to 
the cdev API in the kernel tree, removing the offending code.

Will you submit patches for the other three subsystems or would you like me to 
take care of that ?

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Fri Oct 17 15:39:20 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Fri, 17 Oct 2008 15:39:20 +0200
Subject: [Linux-uvc-devel] webcams on LTSP thin clients
In-Reply-To: <48F5FFD4.1000404@biochemfluidics.com>
References: <48F5F3CB.1030702@biochemfluidics.com>
	<200810151607.44605.laurent.pinchart@skynet.be>
	<48F5FFD4.1000404@biochemfluidics.com>
Message-ID: <200810171539.21068.laurent.pinchart@skynet.be>

Hi Rob,

On Wednesday 15 October 2008, Rob Owens wrote:
> Laurent Pinchart wrote:
> > Hi Rob,
> >
> > On Wednesday 15 October 2008, Rob Owens wrote:
> >> Has anybody gotten a webcam to work on an LTSP-powered thin client?  I
> >> asked on the LTSP list but apparently nobody there has done it before.
> >
> > Could you describe the problem with more details ? A quick summary of the
> > hardware/software setup would probably be interesting too.
>
> LTSP is Linux Terminal Server Project.  Basically it allows you to run
> low-power, diskless workstations (also called thin clients) completely
> over the network.  The thin clients retrieve a basic operating system
> from the LTSP server, then establish a remote session (graphical or
> otherwise) to the LTSP server or to any other server you specify.
>
> The key here is that there is no embedded operating system on these thin
> clients.  They use PXE or Etherboot to get their operating system from
> the LTSP server.
>
> The thin clients run a local X server (downloaded from the LTSP server),
> and then all applications run on the LTSP server.  A 200 MHz thin client
> with 64 MB of RAM is capable of running modern software very quickly.
> Well, really it's only displaying the software -- it's actually running
> on the server.
>
> Anyway, this causes some complications when plugging local devices into
> the thin client, because the server needs access to these devices.
> Local usb storage works.  Local sound works.  But I haven't come across
> anyone using local webcams.  When I tried it, it didn't work, but I
> didn't try for very long.  I have to borrow the webcam to do my testing,
> and I have limited time to do my testing.

Do you know how local USB storage is handled ? Obviously, as the USB storage 
device is plugged into the thin client, the thin client operating system 
(both kernel space and userspace) must support the device and 
somehow "export" it through the network.

I see two ways this can work for USB storage devices. Either the thin client 
acts as a USB-Ethernet bridge (USB/IP), with the server handling the actual 
USB mass storage protocol, or the thin client mounts the device locally and 
exports it through the network (NFS, CIFS, ...).

In the first case the same system might be used for webcams, although the 
latency and bandwidth requirements are quite different.

> So the problem can be attacked in a few ways.  All of these depend on
> getting the proper modules to load when the camera device is plugged in,
> which I think I can handle.
>
> 1) Run the video application (luvcview, for instance) locally on the
> thin client.  LTSP calls this "local applications" and I'd consult the
> LTSP list for instructions on doing that.

That's probably the easiest path for you, although it might be a bit heavy on 
the thin client resources.

> 2) Run the video application on the server (the normal way LTSP works),
> but convince the video application to access a video device over the
> network.

You will need a server process on the thin client to forward the video stream 
to the server-side application, which will then re-forward them to the thin 
client's display. The CPU and memory constraints incurred by the Linux UVC 
driver would still have to be handled by the thin client as in option 1, but 
you will save the application's memory and CPU footprint. In case of simple 
applications such as luvcview I think this will actually be slower than 
option 1.

> 3) Have LTSP treat the local webcam the same way a local USB drive or a
> local sound card is treated.  Unfortunately I don't know the specifics
> of that, so I was hoping to hear from somebody "sure I've done that
> before, it's easy!"

Can you ssh into the LTSP box ? If so you can easily check if USB mass storage 
devices are locally mounted or exported through the network using USB/IP.

> Thanks for any advice you guys might have.
>
> By the way, I'm trying to use the ProScope HR camera at the 9 thin
> clients that are installed in my company's machine shop.  The cameras
> are to be used for inspection of some very small parts.  This camera
> does work on Linux using the uvc driver.

Best regards,

Laurent Pinchart


From rob.owens at biochemfluidics.com  Tue Oct 21 19:54:59 2008
From: rob.owens at biochemfluidics.com (Rob Owens)
Date: Tue, 21 Oct 2008 13:54:59 -0400
Subject: [Linux-uvc-devel] webcams on LTSP thin clients
In-Reply-To: <200810171539.21068.laurent.pinchart@skynet.be>
References: <48F5F3CB.1030702@biochemfluidics.com>
	<200810151607.44605.laurent.pinchart@skynet.be>
	<48F5FFD4.1000404@biochemfluidics.com>
	<200810171539.21068.laurent.pinchart@skynet.be>
Message-ID: <48FE1773.4080307@biochemfluidics.com>

Thanks for your response.  See below...

Laurent Pinchart wrote:
> Hi Rob,
> 
> On Wednesday 15 October 2008, Rob Owens wrote:
>> Laurent Pinchart wrote:
>>> Hi Rob,
>>>
>>> On Wednesday 15 October 2008, Rob Owens wrote:
>>>> Has anybody gotten a webcam to work on an LTSP-powered thin client?  I
>>>> asked on the LTSP list but apparently nobody there has done it before.
>>> Could you describe the problem with more details ? A quick summary of the
>>> hardware/software setup would probably be interesting too.
>> LTSP is Linux Terminal Server Project.  Basically it allows you to run
>> low-power, diskless workstations (also called thin clients) completely
>> over the network.  The thin clients retrieve a basic operating system
>> from the LTSP server, then establish a remote session (graphical or
>> otherwise) to the LTSP server or to any other server you specify.
>>
>> The key here is that there is no embedded operating system on these thin
>> clients.  They use PXE or Etherboot to get their operating system from
>> the LTSP server.
>>
>> The thin clients run a local X server (downloaded from the LTSP server),
>> and then all applications run on the LTSP server.  A 200 MHz thin client
>> with 64 MB of RAM is capable of running modern software very quickly.
>> Well, really it's only displaying the software -- it's actually running
>> on the server.
>>
>> Anyway, this causes some complications when plugging local devices into
>> the thin client, because the server needs access to these devices.
>> Local usb storage works.  Local sound works.  But I haven't come across
>> anyone using local webcams.  When I tried it, it didn't work, but I
>> didn't try for very long.  I have to borrow the webcam to do my testing,
>> and I have limited time to do my testing.
> 
> Do you know how local USB storage is handled ? Obviously, as the USB storage 
> device is plugged into the thin client, the thin client operating system 
> (both kernel space and userspace) must support the device and 
> somehow "export" it through the network.
> 
> I see two ways this can work for USB storage devices. Either the thin client 
> acts as a USB-Ethernet bridge (USB/IP), with the server handling the actual 
> USB mass storage protocol, or the thin client mounts the device locally and 
> exports it through the network (NFS, CIFS, ...).
> 
I researched this a bit.  USB local storage is handled by what they call
ltspfs.  It seems to be a good solution for files, but probably not for
devices.

In case you're interested, here is a description:
http://www.ltsp.org/twiki/bin/view/Ltsp/LtspFS#Introduction

> In the first case the same system might be used for webcams, although the 
> latency and bandwidth requirements are quite different.
> 
>> So the problem can be attacked in a few ways.  All of these depend on
>> getting the proper modules to load when the camera device is plugged in,
>> which I think I can handle.
>>
>> 1) Run the video application (luvcview, for instance) locally on the
>> thin client.  LTSP calls this "local applications" and I'd consult the
>> LTSP list for instructions on doing that.
> 
> That's probably the easiest path for you, although it might be a bit heavy on 
> the thin client resources.
> 
This is what I'm researching now, because I agree, it does seem like the
easiest path right now.

>> 2) Run the video application on the server (the normal way LTSP works),
>> but convince the video application to access a video device over the
>> network.
> 
> You will need a server process on the thin client to forward the video stream 
> to the server-side application, which will then re-forward them to the thin 
> client's display. The CPU and memory constraints incurred by the Linux UVC 
> driver would still have to be handled by the thin client as in option 1, but 
> you will save the application's memory and CPU footprint. In case of simple 
> applications such as luvcview I think this will actually be slower than 
> option 1.
> 
>> 3) Have LTSP treat the local webcam the same way a local USB drive or a
>> local sound card is treated.  Unfortunately I don't know the specifics
>> of that, so I was hoping to hear from somebody "sure I've done that
>> before, it's easy!"
> 
> Can you ssh into the LTSP box ? If so you can easily check if USB mass storage 
> devices are locally mounted or exported through the network using USB/IP.
> 
That's possible to do, but I'm not set up for it yet.  Still learning...

I'll report back when I've made some progress.

-Rob
********************************************************

The information transmitted is intended only for the person or entity to
which it is addressed and may contain confidential and/or privileged
material. If you are not the addressee, any disclosure, reproduction,
copying, distribution, or other dissemination or use of this transmission in
error please notify the sender immediately and then delete this e-mail.
E-mail transmission cannot be guaranteed to be secure or error free as
information could be intercepted, corrupted lost, destroyed, arrive late or
incomplete, or contain viruses.
The sender therefore does not accept liability for any errors or omissions
in the contents of this message which arise as a result of e-mail
transmission. If verification is required please request a hard copy
version.

********************************************************



From msilveira at linuxbr.com  Tue Oct 21 21:35:12 2008
From: msilveira at linuxbr.com (Mauricio Silveira)
Date: Tue, 21 Oct 2008 17:35:12 -0200
Subject: [Linux-uvc-devel] support request for Philips SPC530NC (0471:2034)
Message-ID: <48FE2EF0.4040600@linuxbr.com>

Hello,

I've just bought a Philips USB Cam Model SPC530NC, and it doesn't work
with UVC . USB Device ID: 0471:2034

Product url:
http://www.p4c.philips.com/cgi-bin/dcbint/cpindex.pl?scy=US&slg=AEN&cat=PC_CAMERAS_CA&sct=WEBCAMS_SU&session=20081021124713_201.92.191.182&grp=PC_PRODUCTS_GR&ctn=SPC530NC/00&mid=Link_UserManuals&hlt=Link_UserManuals


I've tried many quirks, but I only manage to get errors from tvtime:

videoinput: Driver won't tell us its norm: Invalid argument
videoinput: Can't get tuner info: Invalid argument
videoinput: Can't read frame. Error was: Invalid argument (0).


or


videoinput: Driver refuses to start streaming: Device or resource busy.
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Driver refuses to stop streaming: Invalid argument.
videoinput: Can't free frame 0: Device or resource busy
videoinput: Can't free frame 1: Device or resource busy
videoinput: Can't free frame 2: Device or resource busy
videoinput: Can't free frame 3: Device or resource busy


depending on quirks used.


How may I help adding support to this product to UVC (NOTE: I'm not a
driver developer!)


If any information from v4l-info or lsusb may help, please let me know


Thanks,

Mauricio Silveira


-------------- next part --------------
A non-text attachment was scrubbed...
Name: msilveira.vcf
Type: text/x-vcard
Size: 318 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081021/9bc9e894/attachment.vcf>

From laurent.pinchart at skynet.be  Tue Oct 21 22:00:29 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 21 Oct 2008 22:00:29 +0200
Subject: [Linux-uvc-devel] support request for Philips SPC530NC
	(0471:2034)
In-Reply-To: <48FE2EF0.4040600@linuxbr.com>
References: <48FE2EF0.4040600@linuxbr.com>
Message-ID: <200810212200.30096.laurent.pinchart@skynet.be>

Hi Mauricio,

On Tuesday 21 October 2008, Mauricio Silveira wrote:
> Hello,
>
> I've just bought a Philips USB Cam Model SPC530NC, and it doesn't work
> with UVC . USB Device ID: 0471:2034
>
> Product url:
> http://www.p4c.philips.com/cgi-bin/dcbint/cpindex.pl?scy=US&slg=AEN&cat=PC_
>CAMERAS_CA&sct=WEBCAMS_SU&session=20081021124713_201.92.191.182&grp=PC_PRODU
>CTS_GR&ctn=SPC530NC/00&mid=Link_UserManuals&hlt=Link_UserManuals
>
> I've tried many quirks, but I only manage to get errors from tvtime:
>
> videoinput: Driver won't tell us its norm: Invalid argument
> videoinput: Can't get tuner info: Invalid argument
> videoinput: Can't read frame. Error was: Invalid argument (0).
>
> or
>
> videoinput: Driver refuses to start streaming: Device or resource busy.
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Driver refuses to stop streaming: Invalid argument.
> videoinput: Can't free frame 0: Device or resource busy
> videoinput: Can't free frame 1: Device or resource busy
> videoinput: Can't free frame 2: Device or resource busy
> videoinput: Can't free frame 3: Device or resource busy
>
> depending on quirks used.

What quirks did you use to get the above messages ?

> How may I help adding support to this product to UVC (NOTE: I'm not a
> driver developer!)
>
> If any information from v4l-info or lsusb may help, please let me know

Could you please send me the output of

lsusb -v -d 0471:2034

with usbutils 0.72 or newer (0.73+ preferred) ? I would also like to get a 
copy of the messages printed by the uvcvideo driver to the kernel log (you 
can retrieve the content of the kernel log with the dmesg command).

Best regards,

Laurent Pinchart


From yeg at inbox.ru  Wed Oct 22 14:58:58 2008
From: yeg at inbox.ru (Yegor A Yelizarov)
Date: Wed, 22 Oct 2008 16:58:58 +0400
Subject: [Linux-uvc-devel] Uvc devices
Message-ID: <48FF2392.5020700@inbox.ru>

Hello,

Excuse me, does the uvc driver support devices with this id:
1)174f:5271
2)174f:5215
Thank you.

With best regards, Yegor.


From laurent.pinchart at skynet.be  Wed Oct 22 15:07:17 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 22 Oct 2008 15:07:17 +0200
Subject: [Linux-uvc-devel] Uvc devices
In-Reply-To: <48FF2392.5020700@inbox.ru>
References: <48FF2392.5020700@inbox.ru>
Message-ID: <200810221507.18237.laurent.pinchart@skynet.be>

On Wednesday 22 October 2008, Yegor A Yelizarov wrote:
> Hello,
> 
> Excuse me, does the uvc driver support devices with this id:
> 1)174f:5271
> 2)174f:5215

I don't know. Do you have access to those devices ? If so have a look at http://linux-uvc.berlios.de/faq/ to check if they are UVC compliant. If they are, please send their USB descriptors to this mailing list and I'll update the devices list on the website.

Best regards,

Laurent Pinchart


From yeg at inbox.ru  Wed Oct 22 15:59:58 2008
From: yeg at inbox.ru (Yegor A Yelizarov)
Date: Wed, 22 Oct 2008 17:59:58 +0400
Subject: [Linux-uvc-devel] Uvc devices
Message-ID: <48FF31DE.9010802@inbox.ru>


-------------- next part --------------
An embedded message was scrubbed...
From: Yegor A Yelizarov <yeg at inbox.ru>
Subject: Re: [Linux-uvc-devel] Uvc devices
Date: Wed, 22 Oct 2008 17:58:56 +0400
Size: 1357
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081022/f0ee1a14/attachment.eml>

From laurent.pinchart at skynet.be  Wed Oct 22 17:10:25 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Wed, 22 Oct 2008 17:10:25 +0200
Subject: [Linux-uvc-devel] Uvc devices
In-Reply-To: <48FF31A0.5060006@inbox.ru>
References: <48FF2392.5020700@inbox.ru>
	<200810221507.18237.laurent.pinchart@skynet.be>
	<48FF31A0.5060006@inbox.ru>
Message-ID: <200810221710.25871.laurent.pinchart@skynet.be>

Hi Yegor,

On Wednesday 22 October 2008, Yegor A Yelizarov wrote:
> Thank you for your answer!
> 
> Yes, when I've followed the instructions, written there, I saw the 
> number of lines.
> So both of them are UVC compliant.
> 1)UVC 1.00 device USB 2.0 PC Cam (174f:5215)
> 2)UVC 1.00 device USB 2.0 PC Cam (174f:5271)

Could you please send me the USB descriptors of both those devices ? You can retrieve them with

lsusb -v

with usbutils 0.72 or newer (0.73+ preferred).

Best regards,

Laurent Pinchart


From philipp at kolmann.at  Thu Oct 23 07:37:42 2008
From: philipp at kolmann.at (Philipp Kolmann)
Date: Thu, 23 Oct 2008 07:37:42 +0200
Subject: [Linux-uvc-devel] Report: Working HP Webcam ID 04f2:b082
Message-ID: <49000DA6.3000900@kolmann.at>

Hi,

I got a brand new HP Laptop (EliteBook 2530p) with builtin Webcam.

2.6.27 supports that notebook out of the box. I installed skype, and the 
webcam worked without any issue. I even changed starting values of skype 
to get me 640x480 at 30fps and the cam even give me that resolution.

Oct 19 10:09:01 notebook kernel: [   10.315127] uvcvideo: Found UVC 1.00 
device CKA7227 (04f2:b082)
Oct 19 10:09:01 notebook kernel: [   10.332860] input: CKA7227 as 
/class/input/input2
Oct 19 10:09:01 notebook kernel: [   10.347327] usbcore: registered new 
interface driver uvcvideo
Oct 19 10:09:01 notebook kernel: [   10.352038] USB Video Class driver 
(v0.1.0)

Thanks for the great driver!
Philipp
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: hpwebcam.txt
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081023/67dd4c29/attachment.txt>

From msilveira at linuxbr.com  Tue Oct 21 23:37:46 2008
From: msilveira at linuxbr.com (Mauricio Silveira)
Date: Tue, 21 Oct 2008 19:37:46 -0200
Subject: [Linux-uvc-devel] support request for Philips SPC530NC
	(0471:2034)
In-Reply-To: <200810212200.30096.laurent.pinchart@skynet.be>
References: <48FE2EF0.4040600@linuxbr.com>
	<200810212200.30096.laurent.pinchart@skynet.be>
Message-ID: <48FE4BAA.8010900@linuxbr.com>

Hi Laurent,

Fast answer huh!?


** VERSIONS
TVTIME version: 1.0.2
USBUTILS version: 0.73
kernel:  2.6.27.1
uvcvideo: SVN r261

** INSMOD messages, general:

uvcvideo 2-5:1.0: usb_probe_interface
uvcvideo 2-5:1.0: usb_probe_interface - got id
uvcvideo: Found UVC 1.00 device USB Video Camera (0471:2034)
input: USB Video Camera as /class/input/input52
usb 2-5: link qh1024-0001/f6d93180 start 1023 [1/0 us]
usbcore: registered new interface driver uvcvideo
USB Video Class driver (SVN r261)


**QUIRKS

* Quirks 0 to 7

ANY QUIRK GENERAL MESSAGES
TVTIME Output:
videoinput: Driver won't tell us its norm: Invalid argument
videoinput: Can't get tuner info: Invalid argument
videoinput: Driver won't tell us its norm: Invalid argument
videoinput: Can't get tuner info: Invalid argument
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't mute card.  Post a bug report with your
videoinput: driver info to http://tvtime.net/
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't read frame. Error was: Invalid argument (0).
videoinput: Can't mute card.  Post a bug report with your
videoinput: driver info to http://tvtime.net/
videoinput: Include this error: 'Invalid argument'
Thank you for using tvtime.

KERNEL MESSAGES(dmesg):
uvcvideo: device USB Video Camera requested null bandwidth, defaulting 
to lowest.
(repeats 14 times)


* Quirks 8 to 16(0xf)
I get a slower initialization from tvtime (really, it takes a few 
seconds to show up the with blue screen (10+s)), and its responsiveness 
is affected (takes long to quit after q or ESC is pressed (~5s))


RATIONALE: The first two "videoinput: Driver won't tell us its norm: 
Invalid argument" / "videoinput: Can't get tuner info: Invalid argument" 
+ all the "videoinput: Can't read frame. Error was: Invalid argument 
(0)." from tvtime sum up to the same number of kernel messages:

videoinput: Driver won't tell us its norm: Invalid argument  \
videoinput: Can't get tuner info: Invalid argument               /   x2
videoinput: Can't read frame. Error was: Invalid argument (0). > x12


TVTIME config:
<?xml version="1.0"?>
<!DOCTYPE tvtime PUBLIC "-//tvtime//DTD tvtime 1.0//EN" 
"http://tvtime.sourceforge.net/DTD/tvtime1.dtd">
<tvtime xmlns="http://tvtime.sourceforge.net/DTD/">
  <option name="Channel" value="5"/>
  <option name="DefaultBrightness" value="-1"/>
  <option name="DefaultContrast" value="-1"/>
  <option name="DefaultSaturation" value="-1"/>
  <option name="DefaultHue" value="-1"/>
  <option name="Norm" value="NTSC"/>
  <option name="PrevChannel" value="6"/>
  <option name="FramerateMode" value="0"/>
  <option name="OverScan" value="0.5"/>
  <option name="CheckForSignal" value="1"/>
  <option name="AudioBoost" value="-1"/>
  <option name="AlwaysOnTop" value="0"/>
  <option name="QuietScreenshots" value="0"/>
  <option name="UnmuteVolume" value="12850"/>
  <option name="Muted" value="0"/>
  <option name="V4LInput" value="0"/>
  <option name="AudioMode" value="stereo"/>
  <option name="PalDKMode" value="0"/>
  <option name="FullScreen" value="1"/>
  <option name="WideScreen" value="0"/>
  <option name="NTSCCableMode" value="Nominal"/>
  <option name="Frequencies" value="us-broadcast"/>
  <option name="MirrorInput" value="0"/>
  <option name="ColourInvert" value="0"/>
  <option name="DeinterlaceMethod" value="AdaptiveSearch"/>
<option name="InputWidth" value="720"/></tvtime>


*** Now let's see the messages with some changes in tvtime's config:

->> Changed norm to SECAM:

no kernel messages
TVTIME screen with the message:
"Frames too short from uvcvideo
Cannot open capture device /dev/v4l/video1"

**TVTIME console output:

videoinput: Driver won't tell us its norm: Invalid argument
videoinput: Can't get tuner info: Invalid argument

    Your capture card driver: uvcvideo [USB Video Camera/0000:00:0a.1/256]
    does not support full size studio-quality images required by tvtime.
    This is true for many low-quality webcams.  Please select a
    different video device for tvtime to use with the command line
    option --device.


***** I Just can't get to reproduce the messages below again! Might have 
something to do with the pwc module
> videoinput: Driver refuses to start streaming: Device or resource busy.
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Driver refuses to stop streaming: Invalid argument.
> videoinput: Can't free frame 0: Device or resource busy
> videoinput: Can't free frame 1: Device or resource busy
> videoinput: Can't free frame 2: Device or resource busy
> videoinput: Can't free frame 3: Device or resource busy
>   

***** Output from 'lsusb -v -d 0471:2034':
----------------------------------------------------------------------------------
Bus 002 Device 003: ID 0471:2034 Philips
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass          239 Miscellaneous Device
  bDeviceSubClass         2 ?
  bDeviceProtocol         1 Interface Association
  bMaxPacketSize0        64
  idVendor           0x0471 Philips
  idProduct          0x2034
  bcdDevice            0.00
  iManufacturer           0
  iProduct                1 USB Video Camera
  iSerial                 0
  bNumConfigurations      1
  Configuration Descriptor:
    bLength                 9
    bDescriptorType         2
    wTotalLength          422
    bNumInterfaces          4
    bConfigurationValue     1
    iConfiguration          0
    bmAttributes         0x80
      (Bus Powered)
    MaxPower               98mA
    Interface Association:
      bLength                 8
      bDescriptorType        11
      bFirstInterface         0
      bInterfaceCount         2
      bFunctionClass         14 Video
      bFunctionSubClass       3 Video Interface Collection
      bFunctionProtocol       0
      iFunction               1 USB Video Camera
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        0
      bAlternateSetting       0
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      1 Video Control
      bInterfaceProtocol      0
      iInterface              1 USB Video Camera
      VideoControl Interface Descriptor:
        bLength                13
        bDescriptorType        36
        bDescriptorSubtype      1 (HEADER)
        bcdUVC               1.00
        wTotalLength           77
        dwClockFrequency       48.000000MHz
        bInCollection           1
        baInterfaceNr( 0)       1
      VideoControl Interface Descriptor:
        bLength                18
        bDescriptorType        36
        bDescriptorSubtype      2 (INPUT_TERMINAL)
        bTerminalID             1
        wTerminalType      0x0201 Camera Sensor
        bAssocTerminal          0
        iTerminal               0
        wObjectiveFocalLengthMin      0
        wObjectiveFocalLengthMax      0
        wOcularFocalLength            0
        bControlSize                  3
        bmControls           0x00000000
      VideoControl Interface Descriptor:
        bLength                11
        bDescriptorType        36
        bDescriptorSubtype      5 (PROCESSING_UNIT)
      Warning: Descriptor too short
        bUnitID                 3
        bSourceID               1
        wMaxMultiplier          0
        bControlSize            2
        bmControls     0x0000157b
          Brightness
          Contrast
          Saturation
          Sharpness
          Gamma
          White Balance Temperature
          Backlight Compensation
          Power Line Frequency
          White Balance Temperature, Auto
        iProcessing            34
        bmVideoStandards     0x1a
          NTSC - 525/60
          SECAM - 625/50
          NTSC - 625/50
      VideoControl Interface Descriptor:
        bLength                26
        bDescriptorType        36
        bDescriptorSubtype      6 (EXTENSION_UNIT)
        bUnitID                 6
        guidExtensionCode         {d2090058-6fe7-2446-8512-76cdd8dda14e}
        bNumControl             2
        bNrPins                 1
        baSourceID( 0)          3
        bControlSize            1
        bmControls( 0)       0x03
        iExtension              0
      VideoControl Interface Descriptor:
        bLength                 9
        bDescriptorType        36
        bDescriptorSubtype      3 (OUTPUT_TERMINAL)
        bTerminalID             2
        wTerminalType      0x0101 USB Streaming
        bAssocTerminal          0
        bSourceID               6
        iTerminal               0
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x82  EP 2 IN
        bmAttributes            3
          Transfer Type            Interrupt
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0008  1x 8 bytes
        bInterval              16
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       0
      bNumEndpoints           0
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0
      iInterface              0
      VideoStreaming Interface Descriptor:
        bLength                            14
        bDescriptorType                    36
        bDescriptorSubtype                  1 (INPUT_HEADER)
        bNumFormats                        1
        wTotalLength                      157
        bEndPointAddress                  131
        bmInfo                              0
        bTerminalLink                       2
        bStillCaptureMethod                 1
        bTriggerSupport                     1
        bTriggerUsage                       0
        bControlSize                        1
        bmaControls( 0)                    27
      VideoStreaming Interface Descriptor:
        bLength                            27
        bDescriptorType                    36
        bDescriptorSubtype                  4 (FORMAT_UNCOMPRESSED)
        bFormatIndex                        1
        bNumFrameDescriptors                2
        guidFormat                            
{59555932-0000-1000-8000-00aa00389b71}
        bBitsPerPixel                      16
        bDefaultFrameIndex                  1
        bAspectRatioX                       0
        bAspectRatioY                       0
        bmInterlaceFlags                 0x00
          Interlaced stream or variable: No
          Fields per frame: 1 fields
          Field 1 first: No
          Field pattern: Field 1 only
          bCopyProtect                      0
      VideoStreaming Interface Descriptor:
        bLength                            54
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         1
        bmCapabilities                   0x01
          Still image supported
        wWidth                            640
        wHeight                           480
        dwMinBitRate                1179648000
        dwMaxBitRate                147456000
        dwMaxVideoFrameBufferSize      614400
        dwDefaultFrameInterval         333333
        bFrameIntervalType                  7
        dwFrameInterval( 0)            333333
        dwFrameInterval( 1)            400000
        dwFrameInterval( 2)            499998
        dwFrameInterval( 3)            666666
        dwFrameInterval( 4)            999996
        dwFrameInterval( 5)           1333332
        dwFrameInterval( 6)           1999992
      VideoStreaming Interface Descriptor:
        bLength                            62
        bDescriptorType                    36
        bDescriptorSubtype                  5 (FRAME_UNCOMPRESSED)
        bFrameIndex                         2
        bmCapabilities                   0x01
          Still image supported
        wWidth                            320
        wHeight                           240
        dwMinBitRate                1179648000
        dwMaxBitRate                147456000
        dwMaxVideoFrameBufferSize      153600
        dwDefaultFrameInterval         166666
        bFrameIntervalType                  9
        dwFrameInterval( 0)            166666
        dwFrameInterval( 1)            200000
        dwFrameInterval( 2)            333333
        dwFrameInterval( 3)            400000
        dwFrameInterval( 4)            499998
        dwFrameInterval( 5)            666666
        dwFrameInterval( 6)            999996
        dwFrameInterval( 7)           1333332
        dwFrameInterval( 8)           1999992
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        1
      bAlternateSetting       1
      bNumEndpoints           1
      bInterfaceClass        14 Video
      bInterfaceSubClass      2 Video Streaming
      bInterfaceProtocol      0
      iInterface              0
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            5
          Transfer Type            Isochronous
          Synch Type               Asynchronous
          Usage Type               Data
        wMaxPacketSize     0x1400  3x 1024 bytes
        bInterval               1
    Interface Association:
      bLength                 8
      bDescriptorType        11
      bFirstInterface         2
      bInterfaceCount         2
      bFunctionClass          1 Audio
      bFunctionSubClass       2 Streaming
      bFunctionProtocol       0
      iFunction               1 USB Video Camera
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        2
      bAlternateSetting       0
      bNumEndpoints           0
      bInterfaceClass         1 Audio
      bInterfaceSubClass      1 Control Device
      bInterfaceProtocol      0
      iInterface              1 USB Video Camera
      AudioControl Interface Descriptor:
        bLength                 9
        bDescriptorType        36
        bDescriptorSubtype      1 (HEADER)
        bcdADC               1.00
        wTotalLength           38
        bInCollection           1
        baInterfaceNr( 0)       3
      AudioControl Interface Descriptor:
        bLength                12
        bDescriptorType        36
        bDescriptorSubtype      2 (INPUT_TERMINAL)
        bTerminalID             3
        wTerminalType      0x0201 Microphone
        bAssocTerminal          0
        bNrChannels             1
        wChannelConfig     0x0000
        iChannelNames           0
        iTerminal               0
      AudioControl Interface Descriptor:
        bLength                 8
        bDescriptorType        36
        bDescriptorSubtype      6 (FEATURE_UNIT)
        bUnitID                 5
        bSourceID               3
        bControlSize            1
        bmaControls( 0)      0x43
          Mute
          Volume
          Automatic Gain
        iFeature                0
      AudioControl Interface Descriptor:
        bLength                 9
        bDescriptorType        36
        bDescriptorSubtype      3 (OUTPUT_TERMINAL)
        bTerminalID             4
        wTerminalType      0x0101 USB Streaming
        bAssocTerminal          0
        bSourceID               5
        iTerminal               0
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        3
      bAlternateSetting       0
      bNumEndpoints           0
      bInterfaceClass         1 Audio
      bInterfaceSubClass      2 Streaming
      bInterfaceProtocol      0
      iInterface              0
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        3
      bAlternateSetting       1
      bNumEndpoints           1
      bInterfaceClass         1 Audio
      bInterfaceSubClass      2 Streaming
      bInterfaceProtocol      0
      iInterface              0
      AudioStreaming Interface Descriptor:
        bLength                 7
        bDescriptorType        36
        bDescriptorSubtype      1 (AS_GENERAL)
        bTerminalLink           4
        bDelay                  1 frames
        wFormatTag              1 PCM
      AudioStreaming Interface Descriptor:
        bLength                29
        bDescriptorType        36
        bDescriptorSubtype      2 (FORMAT_TYPE)
        bFormatType             1 (FORMAT_TYPE_I)
        bNrChannels             1
        bSubframeSize           2
        bBitResolution         16
        bSamFreqType            7 Discrete
        tSamFreq[ 0]         8000
        tSamFreq[ 1]        11025
        tSamFreq[ 2]        16000
        tSamFreq[ 3]        22050
        tSamFreq[ 4]        32000
        tSamFreq[ 5]        44100
        tSamFreq[ 6]        48000
      Endpoint Descriptor:
        bLength                 9
        bDescriptorType         5
        bEndpointAddress     0x81  EP 1 IN
        bmAttributes            1
          Transfer Type            Isochronous
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0100  1x 256 bytes
        bInterval               4
        bRefresh                0
        bSynchAddress           0
        AudioControl Endpoint Descriptor:
          bLength                 7
          bDescriptorType        37
          bDescriptorSubtype      1 (EP_GENERAL)
          bmAttributes         0x00
          bLockDelayUnits         0 Undefined
          wLockDelay              0 Undefined
Device Qualifier (for other device speed):
  bLength                10
  bDescriptorType         6
  bcdUSB               2.00
  bDeviceClass          239 Miscellaneous Device
  bDeviceSubClass         2 ?
  bDeviceProtocol         1 Interface Association
  bMaxPacketSize0        64
  bNumConfigurations      1
Device Status:     0x0000
  (Bus Powered)
----------------------------------------------------------------------------------




***** Complementary info *****


***** Output from v4l-info /dev/video1 2>&1>& /tmp/v4l-info
----------------------------------------------------------------------------------
ioctl VIDIOCGCHAN: Invalid argument
ioctl VIDIOCGTUNER: Invalid argument
ioctl VIDIOCGAUDIO: Invalid argument
ioctl VIDIOCGFBUF: Invalid argument

### v4l2 device info [/dev/video1] ###
general info
    VIDIOC_QUERYCAP
    driver                  : "uvcvideo"
    card                    : "USB Video Camera"
    bus_info                : "0000:00:0a.1"
    version                 : 0.1.0
    capabilities            : 0x4000001 [VIDEO_CAPTURE,STREAMING]

standards

inputs
    VIDIOC_ENUMINPUT(0)
    index                   : 0
    name                    : "Camera 1"
    type                    : CAMERA
    audioset                : 0
    tuner                   : 0
    std                     : 0x0 []
    status                  : 0x0 []

video capture
    VIDIOC_ENUM_FMT(0,VIDEO_CAPTURE)
    index                   : 0
    type                    : VIDEO_CAPTURE
    flags                   : 0
    description             : "YUV 4:2:2 (YUYV)"
    pixelformat             : 0x56595559 [YUYV]
    VIDIOC_G_FMT(VIDEO_CAPTURE)
    type                    : VIDEO_CAPTURE
    fmt.pix.width           : 640
    fmt.pix.height          : 480
    fmt.pix.pixelformat     : 0x56595559 [YUYV]
    fmt.pix.field           : NONE
    fmt.pix.bytesperline    : 1280
    fmt.pix.sizeimage       : 614400
    fmt.pix.colorspace      : unknown
    fmt.pix.priv            : 0

controls
    VIDIOC_QUERYCTRL(BASE+0)
    id                      : 9963776
    type                    : INTEGER
    name                    : "Brightness"
    minimum                 : 0
    maximum                 : 37
    step                    : 1
    default_value           : 24
    flags                   : 0
    VIDIOC_QUERYCTRL(BASE+1)
    id                      : 9963777
    type                    : INTEGER
    name                    : "Contrast"
    minimum                 : 0
    maximum                 : 200
    step                    : 1
    default_value           : 124
    flags                   : 0
    VIDIOC_QUERYCTRL(BASE+2)
    id                      : 9963778
    type                    : INTEGER
    name                    : "Saturation"
    minimum                 : 0
    maximum                 : 200
    step                    : 1
    default_value           : 121
    flags                   : 0

### video4linux device info [/dev/video1] ###
general info
    VIDIOCGCAP
    name                    : "USB Video Camera"
    type                    : 0x1 [CAPTURE]
    channels                : 1
    audios                  : 0
    maxwidth                : 640
    maxheight               : 480
    minwidth                : 48
    minheight               : 32

channels

tuner

audio

picture
    VIDIOCGPICT
    brightness              : 42509
    hue                     : 0
    colour                  : 39649
    contrast                : 40632
    whiteness               : 26214
    depth                   : 16
    palette                 : YUYV

buffer

window
    VIDIOCGWIN
    x                       : 0
    y                       : 0
    width                   : 640
    height                  : 480
    chromakey               : 0
    flags                   : 0
----------------------------------------------------------------------------------

**** Output from: 'luvcview -d /dev/video1 -L'
----------------------------------------------------------------------------------
luvcview version 0.2.1
Video driver: x11
A window manager is available
video /dev/video1
/dev/video1 does not support read i/o
{ pixelformat = 'YUYV', description = 'YUV 4:2:2 (YUYV)' }
{ discrete: width = 640, height = 480 }
    Time interval between frame: 1/30, 1/25, 1/20, 1/15, 1/10, 2/15, 1/5,
{ discrete: width = 320, height = 240 }
    Time interval between frame: 1/60, 1/50, 1/30, 1/25, 1/20, 1/15, 
1/10, 2/15, 1/5,
----------------------------------------------------------------------------------


Well, that's it.

Thanks for all,

Mauricio Silveira



Laurent Pinchart wrote:
> Hi Mauricio,
>
> On Tuesday 21 October 2008, Mauricio Silveira wrote:
>   
>> Hello,
>>
>> I've just bought a Philips USB Cam Model SPC530NC, and it doesn't work
>> with UVC . USB Device ID: 0471:2034
>>
>> Product url:
>> http://www.p4c.philips.com/cgi-bin/dcbint/cpindex.pl?scy=US&slg=AEN&cat=PC_
>> CAMERAS_CA&sct=WEBCAMS_SU&session=20081021124713_201.92.191.182&grp=PC_PRODU
>> CTS_GR&ctn=SPC530NC/00&mid=Link_UserManuals&hlt=Link_UserManuals
>>
>> I've tried many quirks, but I only manage to get errors from tvtime:
>>
>> videoinput: Driver won't tell us its norm: Invalid argument
>> videoinput: Can't get tuner info: Invalid argument
>> videoinput: Can't read frame. Error was: Invalid argument (0).
>>
>> or
>>
>> videoinput: Driver refuses to start streaming: Device or resource busy.
>> videoinput: Can't read frame. Error was: Invalid argument (0).
>> videoinput: Driver refuses to stop streaming: Invalid argument.
>> videoinput: Can't free frame 0: Device or resource busy
>> videoinput: Can't free frame 1: Device or resource busy
>> videoinput: Can't free frame 2: Device or resource busy
>> videoinput: Can't free frame 3: Device or resource busy
>>
>> depending on quirks used.
>>     
>
> What quirks did you use to get the above messages ?
>
>   
>> How may I help adding support to this product to UVC (NOTE: I'm not a
>> driver developer!)
>>
>> If any information from v4l-info or lsusb may help, please let me know
>>     
>
> Could you please send me the output of
>
> lsusb -v -d 0471:2034
>
> with usbutils 0.72 or newer (0.73+ preferred) ? I would also like to get a 
> copy of the messages printed by the uvcvideo driver to the kernel log (you 
> can retrieve the content of the kernel log with the dmesg command).
>
> Best regards,
>
> Laurent Pinchart
>
>
>   


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081021/b3e5def1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: msilveira.vcf
Type: text/x-vcard
Size: 318 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081021/b3e5def1/attachment.vcf>

From mchehab at infradead.org  Fri Oct 24 16:31:29 2008
From: mchehab at infradead.org (Mauro Carvalho Chehab)
Date: Fri, 24 Oct 2008 12:31:29 -0200
Subject: [Linux-uvc-devel] [BUG] NULL pointer dereference caused by
 uvcvideo stress test
In-Reply-To: <48F710F7.9030608@tuffmail.co.uk>
References: <gbiduj$9p3$1@ger.gmane.org>
	<200810152017.47347.laurent.pinchart@skynet.be>
	<48F63C4E.3070103@tuffmail.co.uk>
	<200810152319.17925.laurent.pinchart@skynet.be>
	<48F710F7.9030608@tuffmail.co.uk>
Message-ID: <20081024123129.3c373b90@pedra.chehab.org>

On Thu, 16 Oct 2008 11:01:27 +0100
Alan Jenkins <alan-jenkins at tuffmail.co.uk> wrote:

> Laurent Pinchart wrote:
> > Hi Alan,
> >
> > On Wednesday 15 October 2008, Alan Jenkins wrote:
> >   
> >> Laurent Pinchart wrote:
> >>     
> >>> On Wednesday 15 October 2008, Alan Jenkins wrote:
> >>>       
> >>>> If you look at the trace, it happens as "hald-probe-video" opens the
> >>>> video device.  This is from Ubuntu 8.04.  Possibly it's significant that
> >>>> I use the camera first, to make sure it works (I use Kopete, the
> >>>> settings dialogue includes a video test).
> >>>>         
> >>> The NULL pointer (or rather 0x00000030 pointer) dereference happens in
> >>> video_open:
> >>>
> >>>         file->f_op = fops_get(vfl->fops);
> >>>         if (file->f_op->open)
> >>>                 err = file->f_op->open(inode, file);
> >>>
> >>> file->f_op ends up being NULL. Either vfl->fops is NULL to begin with, or
> >>> fops_get failed to get a reference to the file_operations structure.
> >>>
> >>> I'd be surprised if vfl->fops was NULL. To rule out that case, can you
> >>> add a BUG_ON(vfl->fops == NULL) before the call to fops_get ?
> >>>
> >>> I'm not too familiar with the module loader, but a quick look at the code
> >>> shows that the module could be marked as being unloaded
> >>> (MODULE_STATE_GOING) before its exit function is called. If this is the
> >>> case video_open would still be called, as the video device would still be
> >>> registered, but fops_get would fail in try_module_get and return a NULL
> >>> pointer. It seems the pointer returned by fops_get should be tested in
> >>> video_open.
> >>>
> >>> I've CC'ed the v4l maintainer to get his opinion on this.

Sorry for being late with this. Too much work here...

I suspect that you only hit this bug due to BKL removal from open/close fops.
maybe you're calling open() before having the device fully initialized?

Anyway, I think that the proposed check is interesting on other places where
there are similar code.

Cheers,
Mauro


From laurent.pinchart at skynet.be  Sat Oct 25 13:15:39 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 25 Oct 2008 13:15:39 +0200
Subject: [Linux-uvc-devel] Report: Working HP Webcam ID 04f2:b082
In-Reply-To: <49000DA6.3000900@kolmann.at>
References: <49000DA6.3000900@kolmann.at>
Message-ID: <200810251315.40020.laurent.pinchart@skynet.be>

Hi Philipp,

On Thursday 23 October 2008, Philipp Kolmann wrote:
> Hi,
>
> I got a brand new HP Laptop (EliteBook 2530p) with builtin Webcam.
>
> 2.6.27 supports that notebook out of the box. I installed skype, and the
> webcam worked without any issue. I even changed starting values of skype
> to get me 640x480 at 30fps and the cam even give me that resolution.
>
> Oct 19 10:09:01 notebook kernel: [   10.315127] uvcvideo: Found UVC 1.00
> device CKA7227 (04f2:b082)
> Oct 19 10:09:01 notebook kernel: [   10.332860] input: CKA7227 as
> /class/input/input2
> Oct 19 10:09:01 notebook kernel: [   10.347327] usbcore: registered new
> interface driver uvcvideo
> Oct 19 10:09:01 notebook kernel: [   10.352038] USB Video Class driver
> (v0.1.0)

Thanks for the report. I've updated the supported devices list on the website.

> Thanks for the great driver!

You're welcome.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Oct 25 13:19:07 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 25 Oct 2008 13:19:07 +0200
Subject: [Linux-uvc-devel] [BUG] NULL pointer dereference caused by
	uvcvideo stress test
In-Reply-To: <20081024123129.3c373b90@pedra.chehab.org>
References: <gbiduj$9p3$1@ger.gmane.org> <48F710F7.9030608@tuffmail.co.uk>
	<20081024123129.3c373b90@pedra.chehab.org>
Message-ID: <200810251319.07232.laurent.pinchart@skynet.be>

Hi Mauro,

On Friday 24 October 2008, Mauro Carvalho Chehab wrote:
> On Thu, 16 Oct 2008 11:01:27 +0100
>
> Alan Jenkins <alan-jenkins at tuffmail.co.uk> wrote:
> > Laurent Pinchart wrote:
> > > Hi Alan,
> > >
> > > On Wednesday 15 October 2008, Alan Jenkins wrote:
> > >> Laurent Pinchart wrote:
> > >>> On Wednesday 15 October 2008, Alan Jenkins wrote:
> > >>>> If you look at the trace, it happens as "hald-probe-video" opens the
> > >>>> video device.  This is from Ubuntu 8.04.  Possibly it's significant
> > >>>> that I use the camera first, to make sure it works (I use Kopete,
> > >>>> the settings dialogue includes a video test).
> > >>>
> > >>> The NULL pointer (or rather 0x00000030 pointer) dereference happens
> > >>> in video_open:
> > >>>
> > >>>         file->f_op = fops_get(vfl->fops);
> > >>>         if (file->f_op->open)
> > >>>                 err = file->f_op->open(inode, file);
> > >>>
> > >>> file->f_op ends up being NULL. Either vfl->fops is NULL to begin
> > >>> with, or fops_get failed to get a reference to the file_operations
> > >>> structure.
> > >>>
> > >>> I'd be surprised if vfl->fops was NULL. To rule out that case, can
> > >>> you add a BUG_ON(vfl->fops == NULL) before the call to fops_get ?
> > >>>
> > >>> I'm not too familiar with the module loader, but a quick look at the
> > >>> code shows that the module could be marked as being unloaded
> > >>> (MODULE_STATE_GOING) before its exit function is called. If this is
> > >>> the case video_open would still be called, as the video device would
> > >>> still be registered, but fops_get would fail in try_module_get and
> > >>> return a NULL pointer. It seems the pointer returned by fops_get
> > >>> should be tested in video_open.
> > >>>
> > >>> I've CC'ed the v4l maintainer to get his opinion on this.
>
> Sorry for being late with this. Too much work here...
>
> I suspect that you only hit this bug due to BKL removal from open/close
> fops. maybe you're calling open() before having the device fully
> initialized?

It's actually the other way around. open() is closed while unloading the 
module. As v4l is being moved to cdev the bug will go away.

> Anyway, I think that the proposed check is interesting on other places
> where there are similar code.

Best regards,

Laurent Pinchart


From laurent.pinchart at skynet.be  Sat Oct 25 13:50:15 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Sat, 25 Oct 2008 13:50:15 +0200
Subject: [Linux-uvc-devel] support request for Philips SPC530NC
	(0471:2034)
In-Reply-To: <48FE4BAA.8010900@linuxbr.com>
References: <48FE2EF0.4040600@linuxbr.com>
	<200810212200.30096.laurent.pinchart@skynet.be>
	<48FE4BAA.8010900@linuxbr.com>
Message-ID: <200810251350.16007.laurent.pinchart@skynet.be>

Hi Mauricio,

On Tuesday 21 October 2008, Mauricio Silveira wrote:
> Hi Laurent,
>
> Fast answer huh!?
>
> ** VERSIONS
> TVTIME version: 1.0.2
> USBUTILS version: 0.73
> kernel:  2.6.27.1
> uvcvideo: SVN r261
>
> ** INSMOD messages, general:
>
> uvcvideo 2-5:1.0: usb_probe_interface
> uvcvideo 2-5:1.0: usb_probe_interface - got id
> uvcvideo: Found UVC 1.00 device USB Video Camera (0471:2034)
> input: USB Video Camera as /class/input/input52
> usb 2-5: link qh1024-0001/f6d93180 start 1023 [1/0 us]
> usbcore: registered new interface driver uvcvideo
> USB Video Class driver (SVN r261)
>
>
> **QUIRKS
>
> * Quirks 0 to 7
>
> ANY QUIRK GENERAL MESSAGES
> TVTIME Output:
> videoinput: Driver won't tell us its norm: Invalid argument
> videoinput: Can't get tuner info: Invalid argument
> videoinput: Driver won't tell us its norm: Invalid argument
> videoinput: Can't get tuner info: Invalid argument

tvtime tries to get the tv norm, but that's not applicable to webcams as they 
have no tv tuner. Nothing wrong there on the driver's side.

> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).

There's a bug in tvtime. A patch is available at

svn://svn.berlios.de/linux-uvc/patches/tvtime/

> videoinput: Can't mute card.  Post a bug report with your
> videoinput: driver info to http://tvtime.net/

The UVC part of the camera doesn't handle sound, so it can't be muted. Nothing 
wrong there either.

> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't read frame. Error was: Invalid argument (0).
> videoinput: Can't mute card.  Post a bug report with your
> videoinput: driver info to http://tvtime.net/
> videoinput: Include this error: 'Invalid argument'
> Thank you for using tvtime.
>
> KERNEL MESSAGES(dmesg):
> uvcvideo: device USB Video Camera requested null bandwidth, defaulting
> to lowest.
> (repeats 14 times)

No worry there either, that's just a warning.

[snip]

> *** Now let's see the messages with some changes in tvtime's config:
>
> ->> Changed norm to SECAM:
>
> no kernel messages
> TVTIME screen with the message:
> "Frames too short from uvcvideo
> Cannot open capture device /dev/v4l/video1"
>
> **TVTIME console output:
>
> videoinput: Driver won't tell us its norm: Invalid argument
> videoinput: Can't get tuner info: Invalid argument
>
>     Your capture card driver: uvcvideo [USB Video Camera/0000:00:0a.1/256]
>     does not support full size studio-quality images required by tvtime.
>     This is true for many low-quality webcams.  Please select a
>     different video device for tvtime to use with the command line
>     option --device.

That was true a long time ago when video devices where either tv tuners or 
low-quality webcams, but hardware have evolved :-)

> ***** I Just can't get to reproduce the messages below again! Might have
> something to do with the pwc module

[snip]

Best regards,

Laurent Pinchart


From msilveira at linuxbr.com  Mon Oct 27 16:43:20 2008
From: msilveira at linuxbr.com (Mauricio Silveira)
Date: Mon, 27 Oct 2008 13:43:20 -0200
Subject: [Linux-uvc-devel] Report: Working SPC530NC
Message-ID: <4905E198.9030908@linuxbr.com>

Hi all,

Thanks for the great work, Philips SPC530NC works indeed.



The problem relied on the TVTIME bug, after patching with the file 
pointed by Laurent, I was able to get it working, later on I downloaded 
skype and tested it, working great.


Now I just have to guess how to get the camera's usb audio working (I'll 
mess with asound.conf for a while).

And now I wonder (probably I'll never use it, but I'm curious), where 
may I find information about using the camera's Button for taking snapshots?


Thanks Laurent and everyone of the uvcvideo project.


Att,

Mauricio Silveira
-------------- next part --------------
A non-text attachment was scrubbed...
Name: msilveira.vcf
Type: text/x-vcard
Size: 318 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20081027/1fe7d578/attachment.vcf>

From laurent.pinchart at skynet.be  Tue Oct 28 00:25:44 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Tue, 28 Oct 2008 00:25:44 +0100
Subject: [Linux-uvc-devel] Report: Working SPC530NC
In-Reply-To: <4905E198.9030908@linuxbr.com>
References: <4905E198.9030908@linuxbr.com>
Message-ID: <200810280025.44615.laurent.pinchart@skynet.be>

Hi Mauricio,

On Monday 27 October 2008, Mauricio Silveira wrote:
> Hi all,
>
> Thanks for the great work, Philips SPC530NC works indeed.
>
> The problem relied on the TVTIME bug, after patching with the file
> pointed by Laurent, I was able to get it working, later on I downloaded
> skype and tested it, working great.
>
> Now I just have to guess how to get the camera's usb audio working (I'll
> mess with asound.conf for a while).
>
> And now I wonder (probably I'll never use it, but I'm curious), where
> may I find information about using the camera's Button for taking
> snapshots?

The button is exported as an input device and should be accessible through one 
of the /dev/input/event device nodes.

Button even reporting should work, but the snapshot function is currently not 
implemented in the driver. The main issue is that V4L2 lacks a way to capture 
snapshots.

> Thanks Laurent and everyone of the uvcvideo project.

You're welcome.

Best regards,

Laurent Pinchart


From herton at mandriva.com.br  Tue Oct 28 22:12:55 2008
From: herton at mandriva.com.br (Herton Ronaldo Krzesinski)
Date: Tue, 28 Oct 2008 19:12:55 -0200
Subject: [Linux-uvc-devel] [RFC] Video probe control refactoring
In-Reply-To: <200810281847.00075.herton@mandriva.com.br>
References: <200810151659.13006.laurent.pinchart@skynet.be>
	<200810281847.00075.herton@mandriva.com.br>
Message-ID: <200810281912.57022.herton@mandriva.com.br>

On Tuesday 28 October 2008 18:46:58 Herton Ronaldo Krzesinski wrote:
> 
> Hi Laurent, I tested here today:
> 
> ALi M5606 (Clevo M540SR)	(0402:5606)
> 
> I also saw that you commited the patch in svn, so far so good here, found no
> problems testing with ucview/ekiga, here is kernel log after ucview run:
> 
> uvcvideo: Found UVC 1.00 device USB2.0 Camera (0402:5606)
> uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported. Enabling workaround.
> input: USB2.0 Camera as /class/input/input13
> usbcore: registered new interface driver uvcvideo
> USB Video Class driver (SVN r262)
> uvcvideo: UVC non compliance - GET_MIN/MAX(PROBE) incorrectly supported. Enabling workaround.
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: device USB2.0 Camera requested null bandwidth, defaulting to lowest.
> 
> If you want more tests, with other applications, please drop a note.

Found another one on a msi wind here that was also on the list, working ok too:
uvcvideo: Found UVC 1.00 device BisonCam, NB Pro (5986:0203)
uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported. Enabling workaround.
input: BisonCam, NB Pro as /class/input/input11
usbcore: registered new interface driver uvcvideo
USB Video Class driver (v0.1.0)
uvcvideo: UVC non compliance - GET_MIN/MAX(PROBE) incorrectly supported. Enabling workaround.
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: device BisonCam, NB Pro requested null bandwidth, defaulting to lowest.
uvcvideo: Failed to query (129) UVC control 2 (unit 5) : -110 (exp. 2).

--
[]'s
Herton


From herton at mandriva.com.br  Tue Oct 28 21:46:58 2008
From: herton at mandriva.com.br (Herton Ronaldo Krzesinski)
Date: Tue, 28 Oct 2008 18:46:58 -0200
Subject: [Linux-uvc-devel] [RFC] Video probe control refactoring
In-Reply-To: <200810151659.13006.laurent.pinchart@skynet.be>
References: <200810151659.13006.laurent.pinchart@skynet.be>
Message-ID: <200810281847.00075.herton@mandriva.com.br>

On Wednesday 15 October 2008 11:59:12 Laurent Pinchart wrote:
> Hi everybody,
>
> I've been working on code refactoring to make the UVC driver more robust
> when used with non-compliant UVC devices (we all know there are many of
> them). Before you rejoice, this has nothing to do with the Logitech
> firmware bug. Sorry.
>
> Anyway, the attached patch (against SVN head) modifies video control
> handling to handle failed GET_MIN/GET_MAX/GET_DEF requests more gracefully.
> Failed requests will now generate a one-time warning message instead of the
> usual "Failed to query..." error, which should be more user-friendly. The
> driver will also recover automatically from failed GET_MIN/GET_MAX requests
> when the device is half-broken without requiring the MINMAX quirk (fully
> broken devices still need the quirk).
>
> The patch is required to implement JPEG quality control which I will soon
> work on. As it's quite intrusive, I'd like to make sure it doesn't break
> anything. I'd appreciate if you could test it, especially if you got one of
> the following cameras:
>
> ALi M5606 (Clevo M540SR)	(0402:5606)
> Creative Live! Optia		(041e:4057)
> Microsoft Lifecam NX-6000	(045e:00f8)
> Microsoft Lifecam VX-7000	(045e:0723)
> Apple Built-In iSight		(05ac:8501)
> Silicon Motion SM371		(090c:b371)
> Acer OEM Webcam			(5986:0100)
> Packard Bell OEM Webcam		(5986:0101)
> Acer Crystal Eye webcam		(5986:0102)
> Compaq Presario B1200		(5986:0104)
> Acer Travelmate 7720		(5986:0105)
> Medion Akoya Mini E1210		(5986:0141)
> Acer OrbiCam			(5986:0200)
> Fujitsu Amilo SI2636		(5986:0202)
> Advent 4211			(5986:0203)
> ???				(5986:0300)
> Clevo M570TU			(5986:0303)
>
> Testing the patch means making sure the webcam is still detected properly
> by the driver (it should be as I haven't changed anything there) and is
> still able to stream video (use any software you like, pick one that you
> know is working).
>
> Of course nothing should break, but bugs happen. That's not completely
> true, as I don't have enough information about the two Microsoft cameras to
> make sure they will still work. I'm thus especially interesting in hearing
> from you if you got a supported Microsoft webcam.
>
> Cameras in the above list should print a few extra messages in the kernel
> log when starting a video stream. Please include them in your report.
>
> Enough said, I wish you all happy testing :-)

Hi Laurent, I tested here today:

ALi M5606 (Clevo M540SR)	(0402:5606)

I also saw that you commited the patch in svn, so far so good here, found no
problems testing with ucview/ekiga, here is kernel log after ucview run:

uvcvideo: Found UVC 1.00 device USB2.0 Camera (0402:5606)
uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported. Enabling workaround.
input: USB2.0 Camera as /class/input/input13
usbcore: registered new interface driver uvcvideo
USB Video Class driver (SVN r262)
uvcvideo: UVC non compliance - GET_MIN/MAX(PROBE) incorrectly supported. Enabling workaround.
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: wCompQuality(130) : 0
uvcvideo: wCompQuality(131) : 100
uvcvideo: device USB2.0 Camera requested null bandwidth, defaulting to lowest.

If you want more tests, with other applications, please drop a note.

>
> Best regards,
>
> Laurent Pinchart

--
[]'s
Herton


From laurent.pinchart at skynet.be  Thu Oct 30 01:50:27 2008
From: laurent.pinchart at skynet.be (Laurent Pinchart)
Date: Thu, 30 Oct 2008 01:50:27 +0100
Subject: [Linux-uvc-devel] [RFC] Video probe control refactoring
In-Reply-To: <200810281912.57022.herton@mandriva.com.br>
References: <200810151659.13006.laurent.pinchart@skynet.be>
	<200810281847.00075.herton@mandriva.com.br>
	<200810281912.57022.herton@mandriva.com.br>
Message-ID: <200810300150.27134.laurent.pinchart@skynet.be>

Hi Herton,

On Tuesday 28 October 2008, Herton Ronaldo Krzesinski wrote:
> On Tuesday 28 October 2008 18:46:58 Herton Ronaldo Krzesinski wrote:
> > Hi Laurent, I tested here today:
> >
> > ALi M5606 (Clevo M540SR)	(0402:5606)
> >
> > I also saw that you commited the patch in svn, so far so good here, found
> > no problems testing with ucview/ekiga, here is kernel log after ucview
> > run:
> >
> > uvcvideo: Found UVC 1.00 device USB2.0 Camera (0402:5606)
> > uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported. Enabling
> > workaround. input: USB2.0 Camera as /class/input/input13
> > usbcore: registered new interface driver uvcvideo
> > USB Video Class driver (SVN r262)
> > uvcvideo: UVC non compliance - GET_MIN/MAX(PROBE) incorrectly supported.
> > Enabling workaround. uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: wCompQuality(130) : 0
> > uvcvideo: wCompQuality(131) : 100
> > uvcvideo: device USB2.0 Camera requested null bandwidth, defaulting to
> > lowest.
> >
> > If you want more tests, with other applications, please drop a note.
>
> Found another one on a msi wind here that was also on the list, working ok
> too: uvcvideo: Found UVC 1.00 device BisonCam, NB Pro (5986:0203)
> uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported. Enabling
> workaround. input: BisonCam, NB Pro as /class/input/input11
> usbcore: registered new interface driver uvcvideo
> USB Video Class driver (v0.1.0)
> uvcvideo: UVC non compliance - GET_MIN/MAX(PROBE) incorrectly supported.
> Enabling workaround. uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: wCompQuality(130) : 0
> uvcvideo: wCompQuality(131) : 100
> uvcvideo: device BisonCam, NB Pro requested null bandwidth, defaulting to
> lowest. uvcvideo: Failed to query (129) UVC control 2 (unit 5) : -110 (exp.
> 2).

Thanks a lot for both reports. I've indeed committed the change to SVN after 
getting a successful report of a Bison webcam user.

Best regards,

Laurent Pinchart


