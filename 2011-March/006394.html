<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Linux-uvc-devel] a new camera for the list - imagingsource	DFK72BUC02
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/linux-uvc-devel/2011-March/index.html" >
   <LINK REL="made" HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20a%20new%20camera%20for%20the%20list%20-%20imagingsource%0A%09DFK72BUC02&In-Reply-To=%3CE73468FC-55DF-4D01-A07B-261427344CB8%40mpi-cbg.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006367.html">
   <LINK REL="Next"  HREF="006368.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Linux-uvc-devel] a new camera for the list - imagingsource	DFK72BUC02</H1>
    <B>Daniel James White</B> 
    <A HREF="mailto:linux-uvc-devel%40lists.berlios.de?Subject=Re%3A%20%5BLinux-uvc-devel%5D%20a%20new%20camera%20for%20the%20list%20-%20imagingsource%0A%09DFK72BUC02&In-Reply-To=%3CE73468FC-55DF-4D01-A07B-261427344CB8%40mpi-cbg.de%3E"
       TITLE="[Linux-uvc-devel] a new camera for the list - imagingsource	DFK72BUC02">white at mpi-cbg.de
       </A><BR>
    <I>Fri Mar 25 11:48:57 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="006367.html">[Linux-uvc-devel] a new camera for the list - imagingsource	DFK72BUC02
</A></li>
        <LI>Next message: <A HREF="006368.html">[Linux-uvc-devel]  Vimicro USB Camera (Altair)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6394">[ date ]</a>
              <a href="thread.html#6394">[ thread ]</a>
              <a href="subject.html#6394">[ subject ]</a>
              <a href="author.html#6394">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Laurent,

So I finally got a little time to keep investigating this:

On Mar 7, 2011, at 11:51 PM, Laurent Pinchart wrote:

snip

&gt;<i> Hi Dan,
</I>&gt;<i> 
</I>&gt;<i> On Monday 07 March 2011 21:54:21 Dan White wrote:
</I>&gt;&gt;<i> Hi Laurent,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> not so good news from imagingsource...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> they explained that they dont support UVC on linux directly themselves....
</I>&gt;&gt;<i> but there is some 3rd party support (eg right here with the linux kernel
</I>&gt;&gt;<i> UVC driver, and with unicam)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> then they pointed me to this .pdf, which says the cmos cameras are !NOT!  
</I>&gt;&gt;<i> UVC compliant at all....  :-(
</I>&gt;<i> 
</I>&gt;<i> It might not be *that* bad, see below.
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Please download attachments from:
</I>&gt;&gt;&gt;&gt;<i> <A HREF="ftp://tis_ftp:Imaging199@ftp.theimagingsource.com/Imaging/728a91/Linux%2">ftp://tis_ftp:Imaging199@ftp.theimagingsource.com/Imaging/728a91/Linux%2</A>
</I>&gt;&gt;&gt;&gt;<i> 0and%20TIS%20cameras.pdf
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> In that doc i read this:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> &quot;
</I>&gt;&gt;&gt;<i> The Imaging Source USB CMOS cameras are not UVC compliant, however in
</I>&gt;&gt;&gt;<i> some cases, the &#8222;uvcvideo&#8220; driver can be modified to deliver video data
</I>&gt;&gt;&gt;<i> from such a camera. The camera reports an incorrect UVC Video Format
</I>&gt;&gt;&gt;<i> descriptor so that the driver will see two color formats: YUY2 and UYVY.
</I>&gt;&gt;&gt;<i> The video data streamed by the camera will always be 8 bit monochrome
</I>&gt;&gt;&gt;<i> video.
</I>&gt;&gt;&gt;<i> The height will be as indicated in the video format descriptor. The width
</I>&gt;&gt;&gt;<i> of the video format is twice the width indicated by the video format
</I>&gt;&gt;&gt;<i> descriptor. On color cameras, the video data will contain a &#8222;bayer
</I>&gt;&gt;&gt;<i> pattern&#8220; which needs to be interpolated to get a color image from the
</I>&gt;&gt;&gt;<i> monochrome data. The video format descriptor will report only one frame
</I>&gt;&gt;&gt;<i> rate. There is no way to alter the frame rate via the UVC video format
</I>&gt;&gt;&gt;<i> interface. Important: due to unpredictable variations of the chipsets
</I>&gt;&gt;&gt;<i> used in The Imaging Source USB CMOS cameras these parameters are subject
</I>&gt;&gt;&gt;<i> to change without any notice &quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I wrote these words to them expressing my disappointment...
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Frankly, this is disappointing:
</I>&gt;&gt;&gt;<i> On your front webpage, you make a big deal out of implementing
</I>&gt;&gt;&gt;<i> &quot;Technology based on standards&quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So i fear these imaging source USB cmos cameras are not good targets for
</I>&gt;&gt;<i> easy inclusion into the linux-uvc world.... maybe i'm wrong...?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I think i will have to try the USB CCD cameras or even the firewire ones...
</I>&gt;<i> 
</I>&gt;<i> [snip]
</I>&gt;<i> 
</I>&gt;&gt;<i> Bus 005 Device 004-199e-8207-ef-02: ID 199e:8207
</I>&gt;&gt;<i> Device Descriptor:
</I>&gt;&gt;<i>  bLength                18
</I>&gt;&gt;<i>  bDescriptorType         1
</I>&gt;&gt;<i>  bcdUSB               2.00
</I>&gt;&gt;<i>  bDeviceClass          239
</I>&gt;&gt;<i>  bDeviceSubClass         2
</I>&gt;&gt;<i>  bDeviceProtocol         1
</I>&gt;&gt;<i>  bMaxPacketSize0        64
</I>&gt;&gt;<i>  idVendor           0x199e
</I>&gt;&gt;<i>  idProduct          0x8207
</I>&gt;&gt;<i>  bcdDevice            8.13
</I>&gt;&gt;<i>  iManufacturer           2 The Imaging Source, GmbH
</I>&gt;&gt;<i>  iProduct                1 DFK 72BUC02
</I>&gt;&gt;<i>  iSerial                 3 44010155
</I>&gt;&gt;<i>  bNumConfigurations      1
</I>&gt;&gt;<i>  Configuration Descriptor:
</I>&gt;&gt;<i>    bLength                 9
</I>&gt;&gt;<i>    bDescriptorType         2
</I>&gt;&gt;<i>    wTotalLength          349
</I>&gt;&gt;<i>    bNumInterfaces          2
</I>&gt;&gt;<i>    bConfigurationValue     1
</I>&gt;&gt;<i>    iConfiguration          0
</I>&gt;&gt;<i>    bmAttributes         0x80
</I>&gt;&gt;<i>      (Bus Powered)
</I>&gt;&gt;<i>    MaxPower              500mA
</I>&gt;&gt;<i>    Interface Association:
</I>&gt;&gt;<i>      bLength                 8
</I>&gt;&gt;<i>      bDescriptorType        11
</I>&gt;&gt;<i>      bFirstInterface         0
</I>&gt;&gt;<i>      bInterfaceCount         2
</I>&gt;&gt;<i>      bFunctionClass        255
</I>&gt;&gt;<i>      bFunctionSubClass       3
</I>&gt;&gt;<i>      bFunctionProtocol       0
</I>&gt;&gt;<i>      iFunction               0
</I>&gt;&gt;<i>    Interface Descriptor:
</I>&gt;&gt;<i>      bLength                 9
</I>&gt;&gt;<i>      bDescriptorType         4
</I>&gt;&gt;<i>      bInterfaceNumber        0
</I>&gt;&gt;<i>      bAlternateSetting       0
</I>&gt;&gt;<i>      bNumEndpoints           1
</I>&gt;&gt;<i>      bInterfaceClass       255
</I>&gt;&gt;<i>      bInterfaceSubClass      1
</I>&gt;&gt;<i>      bInterfaceProtocol      0
</I>&gt;&gt;<i>      iInterface              0
</I>&gt;<i> 
</I>&gt;<i> That's definitely not UVC compliant, but it looks like that's the only UVC 
</I>&gt;<i> non-compliance in the descriptors.
</I>&gt;<i> 
</I>&gt;<i> Could you try adding the following entry in the uvc_ids array (uvc_driver.c) ?
</I>&gt;<i> 
</I>&gt;<i>        { .match_flags          = USB_DEVICE_ID_MATCH_DEVICE
</I>&gt;<i>                                | USB_DEVICE_ID_MATCH_INT_INFO,
</I>&gt;<i>          .idVendor             = 0x199e,
</I>&gt;<i>          .idProduct            = 0x8207,
</I>&gt;<i>          .bInterfaceClass      = USB_CLASS_VENDOR_SPEC,
</I>&gt;<i>          .bInterfaceSubClass   = 1,
</I>&gt;<i>          .bInterfaceProtocol   = 0 },
</I>&gt;<i> 
</I>&gt;<i> Please load the module with trace=65535 for additional debug messages in the 
</I>&gt;<i> kernel log.
</I>
After learning how to compile the linux kernel (thanks Johannes for help there!)

(
and realising that to insmod the uvcvideo.ko kernel module
I needed to first
 modprobe v4l1_compat
then 
modprobe videodev
since uvcvideo depends on them!
)

I got the modified kernel module loaded, 
and connected the camera, 
and yes, it was recognised and cheese could see it. 

Cheese sees 2 resolution modes, 
but neither seems to give a sensible image. 
The higher resolution mode is all black, 
and the 1024 mode is a magenta modern art piece. 

Looks like some tweaking is needed to get the data in the right order?
Maybe something to do the the paragraph copied in above from 
<A HREF="ftp://tis_ftp:Imaging199@ftp.theimagingsource.com/Imaging/728a91/Linux%20and%20TIS%20cameras.pdf">ftp://tis_ftp:Imaging199@ftp.theimagingsource.com/Imaging/728a91/Linux%20and%20TIS%20cameras.pdf</A>

I did 
sudo insmod uvcvideo.ko trace=65535

so there are lots of nice messages in my kernel log, 
which I hope mean more to you than they do to me, so far... but I am learning along the way here. 

The relevant part of the kernel log is attached as a zipped .txt file (it was quite big!)

Maybe Johannes and I can now figure out the rest, 
but if you have any tips on how to proceed, they would certainly be very welcome. 

My colleague Pete has bought some similar cameras that we also need to make work, 
for a fancy new portable / briefcase SPIM microscope...
so it will bear more fruit than just my own success. 

cheers for the help so far... its very much appreciated!

Dan



-------------- next part --------------
A non-text attachment was scrubbed...
Name: DFK72BUC02-kernelLog.txt.zip
Type: application/zip
Size: 170720 bytes
Desc: not available
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110325/e47d6ee3/attachment.zip">https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20110325/e47d6ee3/attachment.zip</A>&gt;
-------------- next part --------------




&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Laurent Pinchart
</I>
Dr. Daniel James White BSc. (Hons.) PhD
Senior Microscopist / Image Visualisation, Processing and Analysis
Light Microscopy and Image Processing Facilities 
Max Planck Institute of Molecular Cell Biology and Genetics
Pfotenhauerstrasse 108
01307 DRESDEN
Germany

+49 (0)15114966933 (German Mobile)
+49 (0)351 210 2627 (Work phone at MPI-CBG)
+49 (0)351 210 1078 (Fax MPI-CBG LMF)

<A HREF="http://www.bioimagexd.net">http://www.bioimagexd.net</A> 	BioImageXD
<A HREF="http://pacific.mpi-cbg.de">http://pacific.mpi-cbg.de</A>		Fiji -  is just ImageJ (Batteries Included)
<A HREF="http://www.chalkie.org.uk">http://www.chalkie.org.uk</A>		Dan's Homepages
<A HREF="https://ifn.mpi-cbg.de">https://ifn.mpi-cbg.de</A> 			Dresden Imaging Facility Network
dan (at) chalkie.org.uk
( white (at) mpi-cbg.de )











</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006367.html">[Linux-uvc-devel] a new camera for the list - imagingsource	DFK72BUC02
</A></li>
	<LI>Next message: <A HREF="006368.html">[Linux-uvc-devel]  Vimicro USB Camera (Altair)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6394">[ date ]</a>
              <a href="thread.html#6394">[ thread ]</a>
              <a href="subject.html#6394">[ subject ]</a>
              <a href="author.html#6394">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/linux-uvc-devel">More information about the Linux-uvc-devel
mailing list</a><br>
</body></html>
