From shop at open-t.co.uk  Tue Nov  1 00:14:21 2011
From: shop at open-t.co.uk (Sebastian Arcus)
Date: Mon, 31 Oct 2011 23:14:21 +0000
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
Message-ID: <4EAF2BCD.1000707@open-t.co.uk>

An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111031/b3a0d0ec/attachment.html>

From shop at open-t.co.uk  Wed Nov  2 14:14:19 2011
From: shop at open-t.co.uk (Sebastian Arcus)
Date: Wed, 02 Nov 2011 13:14:19 +0000
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
In-Reply-To: <4EAF2BCD.1000707@open-t.co.uk>
References: <4EAF2BCD.1000707@open-t.co.uk>
Message-ID: <4EB1422B.9010109@open-t.co.uk>

An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111102/bfe7effb/attachment.html>

From laurent.pinchart at ideasonboard.com  Wed Nov  2 17:16:36 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 17:16:36 +0100
Subject: [Linux-uvc-devel] (no subject)
In-Reply-To: <20111031112235.256810@gmx.net>
References: <20111030181230.30350@gmx.net> <4EAE4D48.4000906@fisher-privat.net>
	<20111031112235.256810@gmx.net>
Message-ID: <201111021716.37587.laurent.pinchart@ideasonboard.com>

Hi Josef,

Thanks for the report.

On Monday 31 October 2011 12:22:35 Josef Burg wrote:
> Hi Alexey,
> 
> I tested all the modes you reported and came up with te following table:
>                                |     Dell    |  Logilink
> 
> -------------------------------+--------------------------
> without quirks                 | working     | not working
> UVC_QUIRK_STATUS_INTERVAL      | working     | not working
> UVC_QUIRK_PROBE_MINMAX         | working *1  | working
> UVC_QUIRK_PROBE_EXTRAFIELDS    | not working | not working
> UVC_QUIRK_BUILTIN_ISIGHT       | not working | not working
> UVC_QUIRK_STREAM_NO_FID        | not working | not working
> UVC_QUIRK_IGNORE_SELECTOR_UNIT | working     | not working
> UVC_QUIRK_FIX_BANDWIDTH        | working     | not working
> UVC_QUIRK_PROBE_DEF            | working     | not working
> UVC_QUIRK_RESTRICT_FRAME_RATE  | working     | not working
> 
> *1 the image looks very pixelated
> 
> 
> So sorry for the report for the Dell webcam. I had quirks enabled by
> default for my Logilink-Webcam and didn't test it without quirks :-/
> 
> But the Logilink USB-Webcam is only working with quirks set to 0x2
> (UVC_QUIRK_PROBE_MINMAX). Otherwise I get 'Unable to set format:
> Input/output error\n Init v4L2 failed !! exit fatal' when starting
> luvcview.

I've added the quirk to the driver and updated the supported devices list. I 
will push the changes to v3.3.

-- 
Regards,

Laurent Pinchart


From aab at cichlid.com  Wed Nov  2 17:19:27 2011
From: aab at cichlid.com (Andrew Burgess)
Date: Wed, 02 Nov 2011 09:19:27 -0700
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
In-Reply-To: <4EB1422B.9010109@open-t.co.uk> (from shop@open-t.co.uk on Wed
	Nov  2 06:14:19 2011)
Message-ID: <1320250767.21196.22@hogo>

On 11/02/2011 06:14:19 AM, Sebastian Arcus wrote:
> On 31/10/11 23:14, Sebastian Arcus wrote:
> 
> > I seem to recall some discussion about a hack/patch/quirk to get
> > several of the newer HD cameras to work in mjpg mode on a single usb
> > hub/bus.

i looked at this for similar reasons as you a few months ago.
as i recall, there was just one line to change to essentially
disable the bandwidth limitations, just changing the calculated
bandwidth to always be one (or something like that).

my requirements changed and i never got as far as
testing it with multiple cameras.

if you can make this change and collect data about how well your system
then works you might have a better chance to get some sort of sysfs
control to disable bandwidth checks into mainstream.

hth


From laurent.pinchart at ideasonboard.com  Wed Nov  2 17:38:24 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 17:38:24 +0100
Subject: [Linux-uvc-devel] Dual sensor, single controller, one USB Device
In-Reply-To: <4EABAB7C.2070709@fisher-privat.net>
References: <1319212248.30755.135@hogo> <1319817669.32254.21.camel@Nadie>
	<4EABAB7C.2070709@fisher-privat.net>
Message-ID: <201111021738.25161.laurent.pinchart@ideasonboard.com>

Hi,

On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
> Am 28.10.2011 18:01, schrieb cheshirekow:
> > On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
> >> On 10/22/2011 03:16 AM, Alexey Fisher wrote:
> >>> Can you please attach the output of this command:
> >>> lsusb -vd 10f1:1a26>  lsusb_dump
> >> 
> >> Sure. The dump file is attached.
> >> 
> >> Thanks!
> > 
> > Has anyone by chance managed to take a look at this lsusb dump?
> > 
> > To recap:
> > the HP Slate has two integrated we cams: One forward facing for video
> > calls, and one higher-resolution rear-facing for snapping photos. There
> > appears to be a single controller for both cameras. In linux, lsusb only
> > shows one webcam device. In windows, the device manager also shows only
> > one device for the webcam. However, in windows applications that use the
> > webcam (i.e. HP's webcam application, and in skype) I'm able to select
> > which one to use as an option. In linux, there is only one video
> > device, /dev/video0.
> > 
> > There does not appear to be any control available from uvcdynctrl or
> > within vlc to select which physical camera to use. I've tried setting
> > the resolution in vlc when I use the "open capture device" menu item. I
> > know that the forward facing camera is VGA so I tried specifying
> > 640x480, but the result is that it shows the rear-camera stream at a low
> > resolution, rather then showing the forward-camera stream.
> > 
> > I'd appreciate any suggestions on how to get the forward-facing camera
> > to work in linux (for skype/google video calls). Also, if it is clear
> > that this facility is not available in UVC and that there is no way this
> > is possilble, that would also be useful information.
> > 
> > Thanks again
> 
> Hi,
> 
> suddenly i do not see any control to switch the sensor. I assume there
> can be two variants how it may work:
> 1. vendor specific extension unit for uvc
> 2. or usb mode switcher
> 
> if both sensors have same capabilities, the 1. make sense. If not then
> second. Because this usb dump report settings only for one sensor.
> 
> For 1. it will be probably possible to control it with libwebcam. For 2.
> it should be possible to control it with some kind of usb_modeswitch
> (i'm not up to date).
> 
> To find what it is actually, there can be fallowing options:
> 1. sniff usb traffic
> 2. see if the windows driver has some advise for us
> 3. unscrew your laptop and find what control use your webcam.

My guess is that the camera uses either an extension unit (XU) control or a 
vendor-specific request to select between the two sensors (which is very 
unfortunate, given that the UVC specification has explicit support for dual-
sensor cameras, and I would have liked to test that code :-)).

Let's start with the XU control. I've attached a patch for the yavta test 
application (http://git.ideasonboard.org/?p=yavta.git;a=summary) to this e-
mail. Could you please apply it, compile the application with

make

run

yavta /dev/video0

and report the results ?

If your kernel headers are not recent enough (which I expect), compilation 
will fail. In that case you will need to download a recent kernel source tree, 
run

make headers_install

in the kernel tree (this will install the headers in the local directory, it 
won't mess up with your system) and then compile yavta with

make KDIR=/path/to/kernel/tree

-- 
Regards,

Laurent Pinchart
-------------- next part --------------
A non-text attachment was scrubbed...
Name: yavta-uvc-xu.patch
Type: text/x-patch
Size: 2551 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111102/8d435f6b/attachment.bin>

From laurent.pinchart at ideasonboard.com  Wed Nov  2 17:41:26 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 17:41:26 +0100
Subject: [Linux-uvc-devel] Microsoft Lifecam Studio catch button
In-Reply-To: <CAMxVRxBFRhQxFO-1Kxi0tYsamxAhTq6534SmkJPSvgdpHTathA@mail.gmail.com>
References: <CAMxVRxBFRhQxFO-1Kxi0tYsamxAhTq6534SmkJPSvgdpHTathA@mail.gmail.com>
Message-ID: <201111021741.27096.laurent.pinchart@ideasonboard.com>

Hi Max,

On Friday 14 October 2011 17:57:02 Max Lapshin wrote:
> Hi. Is it possible to capture button press on microsoft lifecam studio?
> 
> There is small button on top of camera and it would be nice to be able
> to catch pressing on it. It there any way?

The first thing to check is whether the button is detected by the uvcvideo 
driver and registered as an input device. Here's what dmesg reports when I 
plug a Logitech webcam with a button:

[27583.858330] uvcvideo: Found UVC 1.00 device <unnamed> (046d:080a)
[27583.898843] input: UVC Camera (046d:080a) as 
/devices/pci0000:00/0000:00:1d.7/usb2/2-3/2-3:1.0/input/input10

Does the uvcvideo driver print a line starting with 'input' when you plug your 
camera in ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov  2 17:43:23 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 17:43:23 +0100
Subject: [Linux-uvc-devel] Mark Microsoft LifeCam Studio as having the
	usb bandwidth bug
In-Reply-To: <4EA9C3C3.1010504@open-t.co.uk>
References: <4EA9C3C3.1010504@open-t.co.uk>
Message-ID: <201111021743.24110.laurent.pinchart@ideasonboard.com>

Hi Sebastian,

On Thursday 27 October 2011 22:49:07 Sebastian Arcus wrote:
> Hello all,
> 
> Would it be possible to add the corresponding note next to the Microsoft
> LifeCam Studio in the supported devices list on the Linux uvc website
> (http://www.ideasonboard.org/uvc/), so that people will know that it has
> the same usb bandwidth bug as the Microsoft LifeCam Cinema, please.

Done. Thank you.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov  2 17:49:41 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 17:49:41 +0100
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
Message-ID: <201111021749.41935.laurent.pinchart@ideasonboard.com>

Hi Edwin,

On Saturday 22 October 2011 00:36:14 Edwin Aponte wrote:
> libv4l2 is giving having problems with a Microsoft LifeCam NX-6000
> webcam (045e:00f8). I have to run skype as below to get the webcam
> working well for a moment, though an error is generated, until the
> system freezes completely after some minutes and even SysRq doesn't
> work.

Those two problems are likely unrelated, and the second one is pretty bad. Is 
your machine connected to a network ? Can you still ping it after it freezes ? 
What about ssh ?

> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype
> libv4l2: error converting / decoding frame data: v4l-convert: error
> parsing
> JPEG header: Not a JPG file ?

Your camera seems to produce bad MJPEG frames. From the log you've attached it 
seems that the first frame is bigger than the next ones. This might be 
related. Could you try luvcview, which doesn't use libv4l ?

> Sometimes, I get the same error with the program webcam:
> --------------------------
> ~> webcam
> reading config file: /home/edwinh/.webcamrc
> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> grabber config:
>   size 320x240 [none]
>   input (null), norm (null), jpeg quality 75
>   rotate=0, top=0, left=0, bottom=240, right=320
> libv4l2: error converting / decoding frame data: v4l-convert: error
> parsing
> JPEG header: Not a JPG file ?
> 
> 
> v4l2: read: Input/output error
> capturing image failed
> -------------------------
> 
> and some times this other error:
> 
> -------------------------
> ~> webcam
> reading config file: /home/edwinh/.webcamrc
> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> grabber config:
>   size 320x240 [none]
>   input (null), norm (null), jpeg quality 75
>   rotate=0, top=0, left=0, bottom=240, right=320
> libv4lconvert: Error decompressing JPEG: fill_nbits error: need 1 more
> bits
> -------------------------
> 
> I have attached some information based on this thread
> http://lists.berlios.de/pipermail/linux-uvc-devel/2008-November/004265.html
> that seems to be a similar case of my problem.
> I set the trace level to 255:
> 
> # echo 255 > /sys/module/uvcvideo/parameters/trace
> 
> and I record a frame using:
> ~> luvcview -f mjpg -c
> 
> and after that I saved the output of dmesg.
> 
> Thanks.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov  2 17:51:01 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 17:51:01 +0100
Subject: [Linux-uvc-devel] Is 064E:E285 supported?
In-Reply-To: <4EA26E80.7070700@fisher-privat.net>
References: <4EA179BE.7070709@karila.com> <4EA26E80.7070700@fisher-privat.net>
Message-ID: <201111021751.01631.laurent.pinchart@ideasonboard.com>

Hi Art,

On Saturday 22 October 2011 09:19:28 Alexey Fisher wrote:
> Can you please attach the output of this command:
> lsusb -vd 064e:e285 > lsusb_dump

I second that request :-)

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov  2 18:01:43 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 18:01:43 +0100
Subject: [Linux-uvc-devel] Flipped video on (13d3:5126)
In-Reply-To: <CAK6ywbJrTOdrS3=Cj6-69X3V3pPfK4qF-fatt9PK-Yi6Of54Uw@mail.gmail.com>
References: <CAK6ywbJrTOdrS3=Cj6-69X3V3pPfK4qF-fatt9PK-Yi6Of54Uw@mail.gmail.com>
Message-ID: <201111021801.43937.laurent.pinchart@ideasonboard.com>

Hi Nicholas,

On Thursday 20 October 2011 19:38:39 Nicholas Hall wrote:
> uvcvideo: Found UVC 1.00 device USB 2.0 PC Cam (13d3:5126)
> 
> I applied one of the "flip video" patches floating around to correct the
> issue.
> 
> This is an Asus Eee PC T101MT.  Unfortunately, I don't have dmidecode
> on this system.  Please let me know if there is any other information
> I can get you.

To automatically activate image rotation in libv4l for your webcam we need 
both the USB VID:PID (which you provided) and the dmidecode output. The same 
webcam module can be mounted correctly or upside-down depending on the 
machine, so we can't activate image rotation blindly based on the USB VID:PID 
only.

Could you install dmidecode on your machine ? It shouldn't be difficult to 
compile it directly from sources if needed.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov  2 18:31:17 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 18:31:17 +0100
Subject: [Linux-uvc-devel] Accessing XU controls in an UVC webcam
In-Reply-To: <20a528441429404091c5606388e25892@mail.whitequark.org>
References: <20a528441429404091c5606388e25892@mail.whitequark.org>
Message-ID: <201111021831.17745.laurent.pinchart@ideasonboard.com>

Hi Peter,

On Friday 07 October 2011 06:54:48 Peter Zotov wrote:
> Hello.
> 
> I have an h.264 encoding webcam, and I am trying to make it
> work. Currently, it outputs a valid h.264 stream, but each frame
> is compressed to ~12K of data, resulting in a very distorted, but
> still barely recognizable image. I suppose that some of the XU controls
> are responsible for the encoding quality, and they're in some extreme
> position by default.
> 
> The webcam is "046d:0828 Logitech, Inc. HD Webcam B990".
> 
> Here are the XU descriptors (whole `lsusb -v' is 52K long, and I'm not
> sure if I really should post it to the list):

Messages are currently limited to 75kB. You can also post the descriptors 
compressed, or send them privately to me.

[snip]

> I've googled all the GUIDs, and it turned out that first four of them
> also appear in lsusb listings for non-encoding webcams as well. So, I
> decided that some of the other three contain the quality control. (It
> may not be true, of course, but that's what I will start with.) They
> have 19 different controls, apparently.
> 
> Now, I am trying to tune some of these with UVC, with no success. Here
> is the relevant code:
> 
> ----%<----%<----%<----%<----%<----%<----
> void init_controls()
> {
> 	struct uvc_xu_control_mapping mapping = {
> 		.id   = XU_START,
> 		.name = "XU control",
> 		.selector = 1,
> 		.size = 1,
> 		.offset = 0,
> 		.v4l2_type = V4L2_CTRL_TYPE_INTEGER,
> 		.data_type = UVC_CTRL_DATA_TYPE_SIGNED,
> 	};
> 
> 	guid_to_byte_array("{a032c549-154f-fc4c-908a-5bce154b1cea}",
> mapping.entity);
> 
> 	if(ioctl(fd, UVCIOC_CTRL_MAP, &mapping) < 0) {
> 		fprintf(stderr, "Cannot add control: %d, %s\n",
>                           errno, strerror(errno));
>                  exit(EXIT_FAILURE);
> 	}
> }
> ----%<----%<----%<----%<----%<----%<----
> 
> (The `guid_to_byte_array' function was taken from libwebcam
> sources. Handcrafting the GUID with proper endianness gives
> the same result).
> 
> It outputs: Cannot add control: 2, No such file or directory
> 
> I've examined USB bus transactions. They include a control `request'
> and an interrupt `reply'.
> 
> The control frame is here:
>    bmRequestType: 0x21
>    bRequest: 1
>    wValue: 0x0200
>    wIndex: 1
>    wLength: 26
>
> This is somewhat strange. Per sect. 4.2.2.4 of UVC1.1 spec,
> bmRequestType=0x21 and bRequest=1 indicate a SET_CUR transfer.
> wValue of 0x0200 addresses selects control 2 instead of 1 (through
> this is still in range), and wIndex selects XU 1 (while my one
> has bUnitID of 8).

wIndex selects the interface, and wValue the control. This request is a 
SET_CUR request on the UVC video commit control. It got sent by a 
uvc_commit_video() call, either from uvc_video_resume() if the camera got 
resumed or from uvc_video_enable() if the driver received a VIDIOC_STREAMON 
call.

> Also, I do not understand at all what does the
> data transmitted means:
> 
>      00:00:01:01:00:00:00:00
>      00:00:00:00:00:00:00:00
>      32:00:00:60:09:00:00:0c
>      00:00
> 
> The reply contains a -ENOENT (-2) code, as shown by Wireshark.
> 
> Using different GUID's or different selectors does not change
> anything.
> 
> What am I doing wrong here?

I'm not sure exactly what you're doing wrong. Setting the uvcvideo trace 
parameter to 0xffff might give you more information.

On a side note, if you're using a recent kernel, you should use 
UVCIOC_CTRL_QUERY. This will let you query a UVC control directly without 
going through mappings. That's much easier when experimenting with XU 
controls.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov  2 18:38:32 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 18:38:32 +0100
Subject: [Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb
	bandwidth issue under Windows
In-Reply-To: <4E8EE9C3.6070209@open-t.co.uk>
References: <4E8D9FD3.80106@open-t.co.uk> <4E8EC995.9080603@fisher-privat.net>
	<4E8EE9C3.6070209@open-t.co.uk>
Message-ID: <201111021838.32724.laurent.pinchart@ideasonboard.com>

Hi Sebastian,

On Friday 07 October 2011 14:00:03 Sebastian Arcus wrote:
> On 07/10/11 10:42, Alexey Fisher wrote:
> > Am 07.10.2011 10:59, schrieb Sebastian Arcus:
> >> On 06/10/11 17:28, Alexey Fisher wrote:
> >>> On 06.10.2011 18:16, Sebastian Arcus wrote:
> >>>> On 06/10/11 15:59, Alexey Fisher wrote:
> >>>>> On 06.10.2011 14:32, Sebastian Arcus wrote:
> >>>>>> Hello list,
> >>>>>> 
> >>>>>> The above two cameras, which have the well known usb bandwidth bug
> >>>>>> under Linux don't seem to display the same problems under Windows.
> >>>>>> I've tried them under Windows Vista and Windows 7 32bit. I've managed
> >>>>>> to display a LifeCam Studio and LifeCam Cinema at the same time
> >>>>>> through separate instances of VLC all the way to 1920x1080 for
> >>>>>> LifeCam Studio and 1280x720 for the LifeCam Cinema - which I believe
> >>>>>> are the maximum video resolutions for both cameras. I've forced VLC
> >>>>>> on 25fps - and the Cinema seems to do that. However, looking at the
> >>>>>> footage from the Studio at maximum resolution - it looks more like
> >>>>>> 5fps.
> >>>>>> 
> >>>>>> However, what all the above means is that these cameras don't seem to
> >>>>>> suffer from the usb bandwidth bug under Windows. I've input "mjpg"
> >>>>>> under chroma settings for VLC - but I can't find a way to tell for
> >>>>>> sure if VLC is using the mjpeg stream from the camera, or raw.
> >>>>>> 
> >>>>>> Can someone here help me push this further? Is there any way of
> >>>>>> debugging what is happening under Windows - so that maybe the Linux
> >>>>>> uvc> driver can be modified to get these cameras to work properly?
> >>>>> 
> >>>>> Probably usb sniffing will be most correct option, but currently i'll
> >>>>> would not interpret usb dump.
> >>>>> Other option is visual test:
> >>>>> - Jpeg stream has lower quality, try it under linux and you will see
> >>>>> the difference.
> >>>>> - according to frame rate the webcam controller will change
> >>>>> demosaicing algorithm. Simple alorithm produce pure qualithy, and
> >>>>> image looks like up scaled image from smaller image. Logitech webcams
> >>>>> use better algorithm before 15 fps and pure after 15 fps.
> >>>>> - you can check frame rate by capturing some timer with milliseconds:
> >>>>> http://tools.arantius.com/stopwatch
> >>>> 
> >>>> Thank you Alexey. Looking at the quality of the footage - I would
> >>>> guess it is not mjpeg. However, it still means that the camera is not
> >>>> grabbing all the available usb bandwidth like it does under Linux -
> >>>> which is good news.
> >>> 
> >>> Then try bandwidth quirk:
> >>> sudo rmmod&& sudo modprobe uvcvideo quirks=0x80
> >>> But reduce frame rate, 1280x720 at 30 fps will take complete bindwidth,
> >>> try 10fps if you wont to use two webcams.
> >> 
> >> Anybody knows if I can use VLC or some other software under windows to
> >> view the mjpeg stream? I could then test how many cameras I can use at
> >> the same time under Windows with mjpeg. This should tell us if the
> >> Windows driver doesn't have any of the usb bandwidth problems which
> >> exist under Linux for these cameras.
> > 
> > It is not a driver problem,
> > 
> > the webcam tell how match it need, the driver will give it. If cam tell
> > it need every thing we have, the driver will give it. It is defined
> > behavior of UVC, if device is broken, there is nothing driver can do. I
> > will not wonder if Microsoft will have quirks for devices it produce.
> > For some time i send here some jpeg patches, you can test it on your own
> > risk and force the bandwidth. But this patches will probably never go to
> > upstream.
> 
> Thanks Alexey. What I was suggesting is that, under Windows, the camera
> doesn't seem to suffer from this bug - as it is possible to run two of
> them at the same time. I don't know how this is accomplished, I don't
> know if the Windows driver makes use of special signalling to stop the
> camera from asking for all the available usb bandwidth. I was only
> thinking that if it would be possible to find out how the camera is
> "convinced" to not asked for full bandwidth under Windows - maybe that
> can be replicated in the uvc driver under Linux.

I don't think Windows tells the camera to use less bandwidth. I obviously 
can't tell for sure what the Windows driver does, but I expected it to either

- use heuristics to compute the amount of bandwidth a webcam really requires
- have device-specific quirks (quite unlikely though, unless the webcam comes 
with its specific driver)
- allow allocation of more than 80% of the USB bandwidth to periodic USB 
transfers

If I'm not mistaken Linux recently got support for the third option, maybe 
this could help you. Details can be found on the linux-usb mailing list AFAIR.

Another option would be to snoop USB transfers in Windows to find out how much 
bandwidth the webcam requests and how much bandwidth Windows allocates.

> However, I know almost nothing about the intricacies of the uvc standard and
> the corresponding Linux (or Windows) implementation - that is why I was
> asking if there is anyway to probe the uvc driver in Windows and find out
> more that way.

-- 
Regards,

Laurent Pinchart


From ngharo at gmail.com  Wed Nov  2 18:40:19 2011
From: ngharo at gmail.com (Nicholas Hall)
Date: Wed, 2 Nov 2011 12:40:19 -0500
Subject: [Linux-uvc-devel] Flipped video on (13d3:5126)
In-Reply-To: <201111021801.43937.laurent.pinchart@ideasonboard.com>
References: <CAK6ywbJrTOdrS3=Cj6-69X3V3pPfK4qF-fatt9PK-Yi6Of54Uw@mail.gmail.com>
	<201111021801.43937.laurent.pinchart@ideasonboard.com>
Message-ID: <CAK6ywb+ufHzXgsy4phRQSBpiuduHV9NYP91njYdyL5=1FHU62Q@mail.gmail.com>

On Wed, Nov 2, 2011 at 12:01 PM, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
> Hi Nicholas,
>
> On Thursday 20 October 2011 19:38:39 Nicholas Hall wrote:
>> uvcvideo: Found UVC 1.00 device USB 2.0 PC Cam (13d3:5126)
>>
>> I applied one of the "flip video" patches floating around to correct the
>> issue.
>>
>> This is an Asus Eee PC T101MT. ?Unfortunately, I don't have dmidecode
>> on this system. ?Please let me know if there is any other information
>> I can get you.
>
> To automatically activate image rotation in libv4l for your webcam we need
> both the USB VID:PID (which you provided) and the dmidecode output. The same
> webcam module can be mounted correctly or upside-down depending on the
> machine, so we can't activate image rotation blindly based on the USB VID:PID
> only.
>
> Could you install dmidecode on your machine ? It shouldn't be difficult to
> compile it directly from sources if needed.

dmidecode output attached
-------------- next part --------------
# dmidecode 2.11
SMBIOS 2.6 present.
30 structures occupying 1337 bytes.
Table at 0x000F0740.

Handle 0x0000, DMI type 0, 24 bytes
BIOS Information
	Vendor: American Megatrends Inc.
	Version: 0601   
	Release Date: 07/26/2010
	Address: 0xF0000
	Runtime Size: 64 kB
	ROM Size: 512 kB
	Characteristics:
		ISA is supported
		PCI is supported
		PNP is supported
		APM is supported
		BIOS is upgradeable
		BIOS shadowing is allowed
		ESCD support is available
		Boot from CD is supported
		Selectable boot is supported
		BIOS ROM is socketed
		EDD is supported
		5.25"/1.2 MB floppy services are supported (int 13h)
		3.5"/720 kB floppy services are supported (int 13h)
		3.5"/2.88 MB floppy services are supported (int 13h)
		Print screen service is supported (int 5h)
		8042 keyboard services are supported (int 9h)
		Serial services are supported (int 14h)
		Printer services are supported (int 17h)
		CGA/mono video services are supported (int 10h)
		ACPI is supported
		USB legacy is supported
		LS-120 boot is supported
		ATAPI Zip drive boot is supported
		BIOS boot specification is supported
		Targeted content distribution is supported
	BIOS Revision: 8.12
	Firmware Revision: 0.39

Handle 0x0001, DMI type 1, 27 bytes
System Information
	Manufacturer: ASUSTeK Computer INC.
	Product Name: T101MT
	Version: x.x
	Serial Number: ACOAAS029767
	UUID: D678FD00-6D01-8147-2B0B-BCAEC52B8AA2
	Wake-up Type: Power Switch
	SKU Number: T101MT
	Family: Eee PC

Handle 0x0002, DMI type 2, 15 bytes
Base Board Information
	Manufacturer: ASUSTeK Computer INC.
	Product Name: T101MT
	Version: x.xx
	Serial Number: EeePC-0123456789
	Asset Tag: To Be Filled By O.E.M.
	Features:
		Board is a hosting board
		Board is replaceable
	Location In Chassis: To Be Filled By O.E.M.
	Chassis Handle: 0x0003
	Type: Motherboard
	Contained Object Handles: 0

Handle 0x0003, DMI type 3, 21 bytes
Chassis Information
	Manufacturer: ASUSTeK Computer INC.
	Type: Notebook
	Lock: Present
	Version: x.x
	Serial Number: 0x00000000
	Asset Tag: 0x00000000
	Boot-up State: Safe
	Power Supply State: Safe
	Thermal State: Safe
	Security Status: None
	OEM Information: 0x00000000
	Height: Unspecified
	Number Of Power Cords: 1
	Contained Elements: 0

Handle 0x0004, DMI type 4, 42 bytes
Processor Information
	Socket Designation: CPU 1
	Type: Central Processor
	Family: Core Solo
	Manufacturer: Intel            
	ID: CA 06 01 00 FF FB E9 BF
	Signature: Type 0, Family 6, Model 28, Stepping 10
	Flags:
		FPU (Floating-point unit on-chip)
		VME (Virtual mode extension)
		DE (Debugging extension)
		PSE (Page size extension)
		TSC (Time stamp counter)
		MSR (Model specific registers)
		PAE (Physical address extension)
		MCE (Machine check exception)
		CX8 (CMPXCHG8 instruction supported)
		APIC (On-chip APIC hardware supported)
		SEP (Fast system call)
		MTRR (Memory type range registers)
		PGE (Page global enable)
		MCA (Machine check architecture)
		CMOV (Conditional move instruction supported)
		PAT (Page attribute table)
		CLFSH (CLFLUSH instruction supported)
		DS (Debug store)
		ACPI (ACPI supported)
		MMX (MMX technology supported)
		FXSR (FXSAVE and FXSTOR instructions supported)
		SSE (Streaming SIMD extensions)
		SSE2 (Streaming SIMD extensions 2)
		SS (Self-snoop)
		HTT (Multi-threading)
		TM (Thermal monitor supported)
		PBE (Pending break enabled)
	Version: Intel(R) Atom(TM) CPU N455   @ 1.66GHz              
	Voltage: 1.2 V
	External Clock: 167 MHz
	Max Speed: 1750 MHz
	Current Speed: 1666 MHz
	Status: Populated, Enabled
	Upgrade: Other
	L1 Cache Handle: 0x0005
	L2 Cache Handle: 0x0006
	L3 Cache Handle: Not Provided
	Serial Number: To Be Filled By O.E.M.
	Asset Tag: To Be Filled By O.E.M.
	Part Number: To Be Filled By O.E.M.
	Core Count: 1
	Core Enabled: 1
	Thread Count: 2
	Characteristics:
		64-bit capable

Handle 0x0005, DMI type 7, 19 bytes
Cache Information
	Socket Designation: L1-Cache
	Configuration: Enabled, Not Socketed, Level 1
	Operational Mode: Write Back
	Location: Internal
	Installed Size: 24 kB
	Maximum Size: 24 kB
	Supported SRAM Types:
		Other
	Installed SRAM Type: Other
	Speed: Unknown
	Error Correction Type: Parity
	System Type: Data
	Associativity: Other

Handle 0x0006, DMI type 7, 19 bytes
Cache Information
	Socket Designation: L2-Cache
	Configuration: Enabled, Not Socketed, Level 2
	Operational Mode: Write Back
	Location: Internal
	Installed Size: 512 kB
	Maximum Size: 512 kB
	Supported SRAM Types:
		Other
	Installed SRAM Type: Other
	Speed: Unknown
	Error Correction Type: Single-bit ECC
	System Type: Unified
	Associativity: 8-way Set-associative

Handle 0x0007, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J1A1
	Internal Connector Type: None
	External Reference Designator: PS2Mouse
	External Connector Type: PS/2
	Port Type: Mouse Port

Handle 0x0008, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J1A1
	Internal Connector Type: None
	External Reference Designator: Keyboard
	External Connector Type: PS/2
	Port Type: Keyboard Port

Handle 0x0009, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J2A2
	Internal Connector Type: None
	External Reference Designator: USB1
	External Connector Type: Access Bus (USB)
	Port Type: USB

Handle 0x000A, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J2A2
	Internal Connector Type: None
	External Reference Designator: USB2
	External Connector Type: Access Bus (USB)
	Port Type: USB

Handle 0x000B, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J4A1
	Internal Connector Type: None
	External Reference Designator: LPT 1
	External Connector Type: DB-25 male
	Port Type: Parallel Port ECP/EPP

Handle 0x000C, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J2A1
	Internal Connector Type: None
	External Reference Designator: COM A
	External Connector Type: DB-9 male
	Port Type: Serial Port 16550A Compatible

Handle 0x000D, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J6A1
	Internal Connector Type: None
	External Reference Designator: Audio Mic In
	External Connector Type: Mini Jack (headphones)
	Port Type: Audio Port

Handle 0x000E, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J6A1
	Internal Connector Type: None
	External Reference Designator: Audio Line In
	External Connector Type: Mini Jack (headphones)
	Port Type: Audio Port

Handle 0x000F, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J6B1 - AUX IN
	Internal Connector Type: On Board Sound Input From CD-ROM
	External Reference Designator: Not Specified
	External Connector Type: None
	Port Type: Audio Port

Handle 0x0010, DMI type 8, 9 bytes
Port Connector Information
	Internal Reference Designator: J6B2 - CDIN
	Internal Connector Type: On Board Sound Input From CD-ROM
	External Reference Designator: Not Specified
	External Connector Type: None
	Port Type: Audio Port

Handle 0x0011, DMI type 11, 5 bytes
OEM Strings
	String 1: BCAEC52B8AA2
	String 2: 10806856028206011080453800842
	String 3: 90OAM1QD29212181U11HQ
	String 4: 5

Handle 0x0012, DMI type 13, 22 bytes
BIOS Language Information
	Language Description Format: Long
	Installable Languages: 1
		en|US|iso8859-1
	Currently Installed Language: en|US|iso8859-1

Handle 0x0013, DMI type 15, 35 bytes
System Event Log
	Area Length: 4 bytes
	Header Start Offset: 0x0000
	Header Length: 2 bytes
	Data Start Offset: 0x0002
	Access Method: Indexed I/O, one 16-bit index port, one 8-bit data port
	Access Address: Index 0x046A, Data 0x046C
	Status: Invalid, Not Full
	Change Token: 0x00000000
	Header Format: No Header
	Supported Log Type Descriptors: 6
	Descriptor 1: End of log
	Data Format 1: OEM-specific
	Descriptor 2: End of log
	Data Format 2: OEM-specific
	Descriptor 3: End of log
	Data Format 3: OEM-specific
	Descriptor 4: End of log
	Data Format 4: OEM-specific
	Descriptor 5: End of log
	Data Format 5: OEM-specific
	Descriptor 6: End of log
	Data Format 6: OEM-specific

Handle 0x0014, DMI type 16, 15 bytes
Physical Memory Array
	Location: System Board Or Motherboard
	Use: System Memory
	Error Correction Type: None
	Maximum Capacity: 4 GB
	Error Information Handle: Not Provided
	Number Of Devices: 2

Handle 0x0015, DMI type 19, 15 bytes
Memory Array Mapped Address
	Starting Address: 0x00000000000
	Ending Address: 0x0003FFFFFFF
	Range Size: 1 GB
	Physical Array Handle: 0x0014
	Partition Width: 4

Handle 0x0016, DMI type 17, 28 bytes
Memory Device
	Array Handle: 0x0014
	Error Information Handle: Not Provided
	Total Width: Unknown
	Data Width: Unknown
	Size: No Module Installed
	Form Factor: DIMM
	Set: None
	Locator: DIMM0
	Bank Locator: BANK0
	Type: Unknown
	Type Detail: Unknown
	Speed: Unknown
	Manufacturer: Manufacturer00
	Serial Number: SerNum00
	Asset Tag: AssetTagNum0
	Part Number: ModulePartNumber00
	Rank: Unknown

Handle 0x0017, DMI type 20, 19 bytes
Memory Device Mapped Address
	Starting Address: 0x00000000000
	Ending Address: 0x000000003FF
	Range Size: 1 kB
	Physical Device Handle: 0x0016
	Memory Array Mapped Address Handle: 0x0015
	Partition Row Position: 1
	Interleaved Data Depth: 1

Handle 0x0018, DMI type 17, 28 bytes
Memory Device
	Array Handle: 0x0014
	Error Information Handle: Not Provided
	Total Width: 64 bits
	Data Width: 64 bits
	Size: 1024 MB
	Form Factor: DIMM
	Set: None
	Locator: DIMM1
	Bank Locator: BANK1
	Type: DDR2
	Type Detail: Synchronous
	Speed: 667 MHz
	Manufacturer: Manufacturer01
	Serial Number: SerNum01
	Asset Tag: AssetTagNum1
	Part Number: ModulePartNumber01
	Rank: Unknown

Handle 0x0019, DMI type 20, 19 bytes
Memory Device Mapped Address
	Starting Address: 0x00000000000
	Ending Address: 0x0003FFFFFFF
	Range Size: 1 GB
	Physical Device Handle: 0x0018
	Memory Array Mapped Address Handle: 0x0015
	Partition Row Position: 1
	Interleaved Data Depth: 1

Handle 0x001A, DMI type 32, 20 bytes
System Boot Information
	Status: No errors detected

Handle 0x001B, DMI type 41, 11 bytes
Onboard Device
	Reference Designation: To Be Filled By O.E.M.
	Type: Video
	Status: Enabled
	Type Instance: 0

Handle 0x001C, DMI type 41, 11 bytes
Onboard Device
	Reference Designation: To Be Filled By O.E.M.
	Type: SCSI Controller
	Status: Disabled
	Type Instance: 0

Handle 0x001D, DMI type 127, 4 bytes
End Of Table

From laurent.pinchart at ideasonboard.com  Wed Nov  2 18:47:59 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 2 Nov 2011 18:47:59 +0100
Subject: [Linux-uvc-devel] Chicony web cam not working
In-Reply-To: <CAE_nYdAwsVw5+Dszqt8owrKrkW_zU47XX62M0rU3EqX7ARCfjA@mail.gmail.com>
References: <CAE_nYdAwsVw5+Dszqt8owrKrkW_zU47XX62M0rU3EqX7ARCfjA@mail.gmail.com>
Message-ID: <201111021848.00278.laurent.pinchart@ideasonboard.com>

Hi Bogdan,

On Sunday 02 October 2011 10:05:56 Bogdan Milanovic wrote:
> I have a weird issue.
> 
> Relevant lsusb:
> 
> Bus 001 Device 002: ID 04f2:b23b Chicony Electronics Co., Ltd

Could you please send the output of

lsusb -v -d 04f2:b23b

> It's a built-in cam in a laptop. The problem is it doesn't work. Not
> with Skype, not with luvcview. However, if I do
> 
> chmod 666 /dev/video0
> 
> It then works fine.

So this is simply a permission issue.

> Another thing, here's my errors.log:
> 
> Oct  2 03:01:38 localhost udevd[318]: timeout: killing 'usb_id
> --export /devices/pci0000:00/0000:00:12.2/usb1/1-3' [514]
> Oct  2 03:01:39 localhost udevd[318]: timeout: killing 'usb_id
> --export /devices/pci0000:00/0000:00:12.2/usb1/1-3' [514]
> Oct  2 03:01:40 localhost udevd[318]: timeout: killing 'usb_id
> --export /devices/pci0000:00/0000:00:12.2/usb1/1-3' [514]

For some reason usb_id times out, which makes udev fail to set the correct 
permissions on the device node.

Do you get any error message in the kernel log (dmesg) ?

> As you can see, this updates every second with the same message.
> 
> Because of this problem, I've discovered also that I cannot suspend my
> system, and it often fails to properly turn off as well.
> 
> Luckily I have an option in BIOS to disable the webcam. If I do so,
> the system functions perfectly fine.
> 
> Googling the VID:PID codes yielded no real results. Apparently
> uvcvideo module still doesn't support this camera.
> 
> Any help?

As Jason suggested, linux-usb might turn out to be more helpful, as this looks 
like a core USB issue.

-- 
Regards,

Laurent Pinchart


From shop at open-t.co.uk  Wed Nov  2 19:00:31 2011
From: shop at open-t.co.uk (Sebastian Arcus)
Date: Wed, 02 Nov 2011 18:00:31 +0000
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
In-Reply-To: <1320250767.21196.22@hogo>
References: <1320250767.21196.22@hogo>
Message-ID: <4EB1853F.2010601@open-t.co.uk>

On 02/11/11 16:19, Andrew Burgess wrote:
> On 11/02/2011 06:14:19 AM, Sebastian Arcus wrote:
>> On 31/10/11 23:14, Sebastian Arcus wrote:
>>
>> > I seem to recall some discussion about a hack/patch/quirk to get
>> > several of the newer HD cameras to work in mjpg mode on a single usb
>> > hub/bus.
>
> i looked at this for similar reasons as you a few months ago.
> as i recall, there was just one line to change to essentially
> disable the bandwidth limitations, just changing the calculated
> bandwidth to always be one (or something like that).
>
> my requirements changed and i never got as far as
> testing it with multiple cameras.
>
> if you can make this change and collect data about how well your system
> then works you might have a better chance to get some sort of sysfs
> control to disable bandwidth checks into mainstream.
>
> hth
Hi Andrew,

Thanks for replying. I think I can just about make sense of the part 
about disabling the bandwidth limitation in code. My programming skills 
in C are less than basic (I assume the uvc driver is written in C?) - 
but I will try nevertheless to see if I can get anywhere.

Sebastian


From shop at open-t.co.uk  Wed Nov  2 19:02:36 2011
From: shop at open-t.co.uk (Sebastian Arcus)
Date: Wed, 02 Nov 2011 18:02:36 +0000
Subject: [Linux-uvc-devel] MS LifeCam Cinema and Studio have no usb
 bandwidth issue under Windows
In-Reply-To: <201111021838.32724.laurent.pinchart@ideasonboard.com>
References: <4E8D9FD3.80106@open-t.co.uk> <4E8EC995.9080603@fisher-privat.net>
	<4E8EE9C3.6070209@open-t.co.uk>
	<201111021838.32724.laurent.pinchart@ideasonboard.com>
Message-ID: <4EB185BC.8000500@open-t.co.uk>

On 02/11/11 17:38, Laurent Pinchart wrote:
> Hi Sebastian,
>
> On Friday 07 October 2011 14:00:03 Sebastian Arcus wrote:
>> On 07/10/11 10:42, Alexey Fisher wrote:
>>> Am 07.10.2011 10:59, schrieb Sebastian Arcus:
>>>> On 06/10/11 17:28, Alexey Fisher wrote:
>>>>> On 06.10.2011 18:16, Sebastian Arcus wrote:
>>>>>> On 06/10/11 15:59, Alexey Fisher wrote:
>>>>>>> On 06.10.2011 14:32, Sebastian Arcus wrote:
>>>>>>>> Hello list,
>>>>>>>>
>>>>>>>> The above two cameras, which have the well known usb bandwidth bug
>>>>>>>> under Linux don't seem to display the same problems under Windows.
>>>>>>>> I've tried them under Windows Vista and Windows 7 32bit. I've managed
>>>>>>>> to display a LifeCam Studio and LifeCam Cinema at the same time
>>>>>>>> through separate instances of VLC all the way to 1920x1080 for
>>>>>>>> LifeCam Studio and 1280x720 for the LifeCam Cinema - which I believe
>>>>>>>> are the maximum video resolutions for both cameras. I've forced VLC
>>>>>>>> on 25fps - and the Cinema seems to do that. However, looking at the
>>>>>>>> footage from the Studio at maximum resolution - it looks more like
>>>>>>>> 5fps.
>>>>>>>>
>>>>>>>> However, what all the above means is that these cameras don't seem to
>>>>>>>> suffer from the usb bandwidth bug under Windows. I've input "mjpg"
>>>>>>>> under chroma settings for VLC - but I can't find a way to tell for
>>>>>>>> sure if VLC is using the mjpeg stream from the camera, or raw.
>>>>>>>>
>>>>>>>> Can someone here help me push this further? Is there any way of
>>>>>>>> debugging what is happening under Windows - so that maybe the Linux
>>>>>>>> uvc>  driver can be modified to get these cameras to work properly?
>>>>>>> Probably usb sniffing will be most correct option, but currently i'll
>>>>>>> would not interpret usb dump.
>>>>>>> Other option is visual test:
>>>>>>> - Jpeg stream has lower quality, try it under linux and you will see
>>>>>>> the difference.
>>>>>>> - according to frame rate the webcam controller will change
>>>>>>> demosaicing algorithm. Simple alorithm produce pure qualithy, and
>>>>>>> image looks like up scaled image from smaller image. Logitech webcams
>>>>>>> use better algorithm before 15 fps and pure after 15 fps.
>>>>>>> - you can check frame rate by capturing some timer with milliseconds:
>>>>>>> http://tools.arantius.com/stopwatch
>>>>>> Thank you Alexey. Looking at the quality of the footage - I would
>>>>>> guess it is not mjpeg. However, it still means that the camera is not
>>>>>> grabbing all the available usb bandwidth like it does under Linux -
>>>>>> which is good news.
>>>>> Then try bandwidth quirk:
>>>>> sudo rmmod&&  sudo modprobe uvcvideo quirks=0x80
>>>>> But reduce frame rate, 1280x720 at 30 fps will take complete bindwidth,
>>>>> try 10fps if you wont to use two webcams.
>>>> Anybody knows if I can use VLC or some other software under windows to
>>>> view the mjpeg stream? I could then test how many cameras I can use at
>>>> the same time under Windows with mjpeg. This should tell us if the
>>>> Windows driver doesn't have any of the usb bandwidth problems which
>>>> exist under Linux for these cameras.
>>> It is not a driver problem,
>>>
>>> the webcam tell how match it need, the driver will give it. If cam tell
>>> it need every thing we have, the driver will give it. It is defined
>>> behavior of UVC, if device is broken, there is nothing driver can do. I
>>> will not wonder if Microsoft will have quirks for devices it produce.
>>> For some time i send here some jpeg patches, you can test it on your own
>>> risk and force the bandwidth. But this patches will probably never go to
>>> upstream.
>> Thanks Alexey. What I was suggesting is that, under Windows, the camera
>> doesn't seem to suffer from this bug - as it is possible to run two of
>> them at the same time. I don't know how this is accomplished, I don't
>> know if the Windows driver makes use of special signalling to stop the
>> camera from asking for all the available usb bandwidth. I was only
>> thinking that if it would be possible to find out how the camera is
>> "convinced" to not asked for full bandwidth under Windows - maybe that
>> can be replicated in the uvc driver under Linux.
> I don't think Windows tells the camera to use less bandwidth. I obviously
> can't tell for sure what the Windows driver does, but I expected it to either
>
> - use heuristics to compute the amount of bandwidth a webcam really requires
> - have device-specific quirks (quite unlikely though, unless the webcam comes
> with its specific driver)
> - allow allocation of more than 80% of the USB bandwidth to periodic USB
> transfers
>
> If I'm not mistaken Linux recently got support for the third option, maybe
> this could help you. Details can be found on the linux-usb mailing list AFAIR.
>
> Another option would be to snoop USB transfers in Windows to find out how much
> bandwidth the webcam requests and how much bandwidth Windows allocates.
>
Thanks for your reply Laurent. I will look for that modification you 
mentioned on the mailing list and see if I can get more then one camera 
working.

Sebastian


From philip at gladstonefamily.net  Wed Nov  2 19:17:18 2011
From: philip at gladstonefamily.net (Philip Gladstone)
Date: Wed, 02 Nov 2011 14:17:18 -0400
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
In-Reply-To: <1320250767.21196.22@hogo>
References: <1320250767.21196.22@hogo>
Message-ID: <4EB1892E.50209@gladstonefamily.net>



On 11/2/2011 12:19 PM, Andrew Burgess wrote:
>
> i looked at this for similar reasons as you a few months ago.
> as i recall, there was just one line to change to essentially
> disable the bandwidth limitations, just changing the calculated
> bandwidth to always be one (or something like that).
>
> my requirements changed and i never got as far as
> testing it with multiple cameras.
>
> if you can make this change and collect data about how well your system
> then works you might have a better chance to get some sort of sysfs
> control to disable bandwidth checks into mainstream.
>
I have been running 3 Logitech C910s simultaneously capturing full 
resolution (5MP) video at the slowest rate (5 FPS) with one of the patch 
sets. It has been stable for me.

Philip

-- 
Philip Gladstone
Ham: N1DQ



From shop at open-t.co.uk  Wed Nov  2 19:41:47 2011
From: shop at open-t.co.uk (Sebastian Arcus)
Date: Wed, 02 Nov 2011 18:41:47 +0000
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
In-Reply-To: <4EB1892E.50209@gladstonefamily.net>
References: <1320250767.21196.22@hogo> <4EB1892E.50209@gladstonefamily.net>
Message-ID: <4EB18EEB.8090903@open-t.co.uk>

On 02/11/11 18:17, Philip Gladstone wrote:
>
>
> On 11/2/2011 12:19 PM, Andrew Burgess wrote:
>>
>> i looked at this for similar reasons as you a few months ago.
>> as i recall, there was just one line to change to essentially
>> disable the bandwidth limitations, just changing the calculated
>> bandwidth to always be one (or something like that).
>>
>> my requirements changed and i never got as far as
>> testing it with multiple cameras.
>>
>> if you can make this change and collect data about how well your system
>> then works you might have a better chance to get some sort of sysfs
>> control to disable bandwidth checks into mainstream.
>>
> I have been running 3 Logitech C910s simultaneously capturing full 
> resolution (5MP) video at the slowest rate (5 FPS) with one of the 
> patch sets. It has been stable for me.
>
> Philip

Hi Philip,

Could I be a pain and ask for a link to the thread about the patch, or 
to the patch itself please.

Thank you,

Sebastian



From kaz at kylheku.com  Thu Nov  3 02:20:30 2011
From: kaz at kylheku.com (Kaz Kylheku)
Date: Wed, 02 Nov 2011 18:20:30 -0700
Subject: [Linux-uvc-devel] Working with Logitech B990: Issues.
Message-ID: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>


Hey all,

I'm working with the B990 on an ARM-based embedded system based on 
linux-2.6.27.47.

H.264 is coming out of the cam, but I don't see an SPS/PPS, and all 
the frames are
P slices, e.g. like this and similar:

 00 00 00 01 61 9a 00 38 37 e0 20 30 ...

Secondly, after some period of running, the USB controller throws up 
an over-current error,
and then the device is not usable without a reboot. Maybe this big 
sucker
really draws too much current?

Usually I am not able to two consecutive successful opens of the 
device.

By the way, I patched the driver to make the trace and quirks sysctl
parameters, since I have it compiled into the kernel.


Index: linux-2.6.27.47/drivers/media/video/uvc/uvc_driver.c
===================================================================
--- linux-2.6.27.47.orig/drivers/media/video/uvc/uvc_driver.c
+++ linux-2.6.27.47/drivers/media/video/uvc/uvc_driver.c
@@ -30,6 +30,7 @@
 #include <linux/usb.h>
 #include <linux/videodev2.h>
 #include <linux/vmalloc.h>
+#include <linux/sysctl.h>
 #include <linux/wait.h>
 #include <asm/atomic.h>

@@ -39,6 +40,7 @@

 #define DRIVER_AUTHOR          "Laurent Pinchart 
<laurent.pinchart at skynet.be>"
 #define DRIVER_DESC            "USB Video Class driver"
+#define DRIVER_NAME            "uvcvideo"
 #ifndef DRIVER_VERSION
 #define DRIVER_VERSION         "v0.1.0"
 #endif
@@ -1970,6 +1972,37 @@ struct uvc_driver uvc_driver = {
        },
 };

+static struct ctl_table uvc_sysctl_entries[] =
+{
+       {
+               .procname       = "trace",
+               .data           = &uvc_trace_param,
+               .maxlen         = sizeof( int ),
+               .mode           = 0644,
+               .proc_handler   = &proc_dointvec,
+       },
+       {
+               .procname       = "quirks",
+               .data           = &uvc_quirks_param,
+               .maxlen         = sizeof( int ),
+               .mode           = 0644,
+               .proc_handler   = &proc_dointvec,
+       },
+       {       .ctl_name       = 0 }
+};
+
+static struct ctl_table uvc_sysctl_root[] =
+{
+       {
+               .procname       = "uvc_video",
+               .mode           = 0555,
+               .child          = uvc_sysctl_entries,
+       },
+       {       .ctl_name       = 0 }
+};
+
+static struct ctl_table_header  *uvc_sysctl_header;
+
 static int __init uvc_init(void)
 {
        int result;
@@ -1981,14 +2014,22 @@ static int __init uvc_init(void)

        uvc_ctrl_init();

+       uvc_sysctl_header = register_sysctl_table(uvc_sysctl_root);
+
        result = usb_register(&uvc_driver.driver);
+
        if (result == 0)
-               printk(KERN_INFO DRIVER_DESC " (" DRIVER_VERSION 
")\n");
+               printk(KERN_INFO DRIVER_NAME ": " DRIVER_DESC " (" 
DRIVER_VERSION ")\n");
+
+       if (uvc_sysctl_header == 0)
+               printk(KERN_ERR DRIVER_NAME ": unable to register 
sysctl table\n");
+
        return result;
 }

 static void __exit uvc_cleanup(void)
 {
+       unregister_sysctl_table(uvc_sysctl_header);
        usb_deregister(&uvc_driver.driver);
 }



From pmichaud at pobox.com  Thu Nov  3 03:33:49 2011
From: pmichaud at pobox.com (Patrick R. Michaud)
Date: Wed, 2 Nov 2011 21:33:49 -0500
Subject: [Linux-uvc-devel] Microsoft Lifecam Studio catch button
In-Reply-To: <201111021741.27096.laurent.pinchart@ideasonboard.com>
References: <CAMxVRxBFRhQxFO-1Kxi0tYsamxAhTq6534SmkJPSvgdpHTathA@mail.gmail.com>
	<201111021741.27096.laurent.pinchart@ideasonboard.com>
Message-ID: <20111103023349.GA5031@pmichaud.com>

On Wed, Nov 02, 2011 at 05:41:26PM +0100, Laurent Pinchart wrote:
> On Friday 14 October 2011 17:57:02 Max Lapshin wrote:
> > Hi. Is it possible to capture button press on microsoft lifecam studio?
> > 
> > There is small button on top of camera and it would be nice to be able
> > to catch pressing on it. It there any way?
> 
> The first thing to check is whether the button is detected by the uvcvideo 
> driver and registered as an input device. Here's what dmesg reports when I 
> plug a Logitech webcam with a button:
> 
> [27583.858330] uvcvideo: Found UVC 1.00 device <unnamed> (046d:080a)
> [27583.898843] input: UVC Camera (046d:080a) as 
> /devices/pci0000:00/0000:00:1d.7/usb2/2-3/2-3:1.0/input/input10
> 
> Does the uvcvideo driver print a line starting with 'input' when you plug your 
> camera in ?

For the Lifecam Studio, my system gives:

  [33604.108093] usb 1-5: new high speed USB device number 4 using ehci_hcd
  [33604.276241] uvcvideo: Found UVC 1.00 device Microsoft? LifeCam Studio(TM) (045e:0772)
  [33604.334468] input: Microsoft? LifeCam Studio(TM) as /devices/pci0000:00/0000:00:12.2/usb1/1-5/1-5:1.0/input/input7

For the Lifecam Cinema, I get:

  [33729.476089] usb 1-5: new high speed USB device number 5 using ehci_hcd
  [33729.626964] uvcvideo: Found UVC 1.00 device Microsoft? LifeCam Cinema(TM) (045e:075d)
  [33729.633068] input: Microsoft? LifeCam Cinema(TM) as /devices/pci0000:00/0000:00:12.2/usb1/1-5/1-5:1.0/input/input8

On my system the button works for the Cinema but not for the Studio.

Pm


From bug-track at fisher-privat.net  Thu Nov  3 07:57:25 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 03 Nov 2011 07:57:25 +0100
Subject: [Linux-uvc-devel] Working with Logitech B990: Issues.
In-Reply-To: <4EB23B21.5080407@gmx.net>
References: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
	<4EB23B21.5080407@gmx.net>
Message-ID: <4EB23B55.3070201@fisher-privat.net>

Am 03.11.2011 07:56, schrieb Alexey Rempel:
> Am 03.11.2011 02:20, schrieb Kaz Kylheku:
>>
>> Hey all,
>>
>> I'm working with the B990 on an ARM-based embedded system based on
>> linux-2.6.27.47.
>>
>> H.264 is coming out of the cam, but I don't see an SPS/PPS, and all the
>> frames are
>> P slices, e.g. like this and similar:
>>
>> 00 00 00 01 61 9a 00 38 37 e0 20 30 ...
>>
>> Secondly, after some period of running, the USB controller throws up an
>> over-current error,
>> and then the device is not usable without a reboot. Maybe this big sucker
>> really draws too much current?

Interesting, i tested some different Logitech webcams. The standard
cams, which can do only yav and jpeg, suck ~170 mA in low qulity mode
(frame rate higer then 15fps). By frame rate lower or equal to 15fps,
they go to high quality mode, and suck ~200 mA. Do h264 encoder will
really add 300mA more?

>> Usually I am not able to two consecutive successful opens of the device.
>>
>> By the way, I patched the driver to make the trace and quirks sysctl
>> parameters, since I have it compiled into the kernel.
>>
>>
>> Index: linux-2.6.27.47/drivers/media/video/uvc/uvc_driver.c
>> ===================================================================
>> --- linux-2.6.27.47.orig/drivers/media/video/uvc/uvc_driver.c
>> +++ linux-2.6.27.47/drivers/media/video/uvc/uvc_driver.c
>> @@ -30,6 +30,7 @@
>> #include <linux/usb.h>
>> #include <linux/videodev2.h>
>> #include <linux/vmalloc.h>
>> +#include <linux/sysctl.h>
>> #include <linux/wait.h>
>> #include <asm/atomic.h>
>>
>> @@ -39,6 +40,7 @@
>>
>> #define DRIVER_AUTHOR "Laurent Pinchart <laurent.pinchart at skynet.be>"
>> #define DRIVER_DESC "USB Video Class driver"
>> +#define DRIVER_NAME "uvcvideo"
>> #ifndef DRIVER_VERSION
>> #define DRIVER_VERSION "v0.1.0"
>> #endif
>> @@ -1970,6 +1972,37 @@ struct uvc_driver uvc_driver = {
>> },
>> };
>>
>> +static struct ctl_table uvc_sysctl_entries[] =
>> +{
>> + {
>> + .procname = "trace",
>> + .data = &uvc_trace_param,
>> + .maxlen = sizeof( int ),
>> + .mode = 0644,
>> + .proc_handler = &proc_dointvec,
>> + },
>> + {
>> + .procname = "quirks",
>> + .data = &uvc_quirks_param,
>> + .maxlen = sizeof( int ),
>> + .mode = 0644,
>> + .proc_handler = &proc_dointvec,
>> + },
>> + { .ctl_name = 0 }
>> +};
>> +
>> +static struct ctl_table uvc_sysctl_root[] =
>> +{
>> + {
>> + .procname = "uvc_video",
>> + .mode = 0555,
>> + .child = uvc_sysctl_entries,
>> + },
>> + { .ctl_name = 0 }
>> +};
>> +
>> +static struct ctl_table_header *uvc_sysctl_header;
>> +
>> static int __init uvc_init(void)
>> {
>> int result;
>> @@ -1981,14 +2014,22 @@ static int __init uvc_init(void)
>>
>> uvc_ctrl_init();
>>
>> + uvc_sysctl_header = register_sysctl_table(uvc_sysctl_root);
>> +
>> result = usb_register(&uvc_driver.driver);
>> +
>> if (result == 0)
>> - printk(KERN_INFO DRIVER_DESC " (" DRIVER_VERSION ")\n");
>> + printk(KERN_INFO DRIVER_NAME ": " DRIVER_DESC " (" DRIVER_VERSION
>> ")\n");
>> +
>> + if (uvc_sysctl_header == 0)
>> + printk(KERN_ERR DRIVER_NAME ": unable to register sysctl table\n");
>> +
>> return result;
>> }
>>
>> static void __exit uvc_cleanup(void)
>> {
>> + unregister_sysctl_table(uvc_sysctl_header);
>> usb_deregister(&uvc_driver.driver);
>> }
>>
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>



From hdegoede at redhat.com  Thu Nov  3 08:29:32 2011
From: hdegoede at redhat.com (Hans de Goede)
Date: Thu, 03 Nov 2011 08:29:32 +0100
Subject: [Linux-uvc-devel] Microsoft Lifecam Studio catch button
In-Reply-To: <20111103023349.GA5031@pmichaud.com>
References: <CAMxVRxBFRhQxFO-1Kxi0tYsamxAhTq6534SmkJPSvgdpHTathA@mail.gmail.com>
	<201111021741.27096.laurent.pinchart@ideasonboard.com>
	<20111103023349.GA5031@pmichaud.com>
Message-ID: <4EB242DC.80206@redhat.com>

Hi,

On 11/03/2011 03:33 AM, Patrick R. Michaud wrote:
> On Wed, Nov 02, 2011 at 05:41:26PM +0100, Laurent Pinchart wrote:
>> On Friday 14 October 2011 17:57:02 Max Lapshin wrote:
>>> Hi. Is it possible to capture button press on microsoft lifecam studio?
>>>
>>> There is small button on top of camera and it would be nice to be able
>>> to catch pressing on it. It there any way?
>>
>> The first thing to check is whether the button is detected by the uvcvideo
>> driver and registered as an input device. Here's what dmesg reports when I
>> plug a Logitech webcam with a button:
>>
>> [27583.858330] uvcvideo: Found UVC 1.00 device<unnamed>  (046d:080a)
>> [27583.898843] input: UVC Camera (046d:080a) as
>> /devices/pci0000:00/0000:00:1d.7/usb2/2-3/2-3:1.0/input/input10
>>
>> Does the uvcvideo driver print a line starting with 'input' when you plug your
>> camera in ?
>
> For the Lifecam Studio, my system gives:
>
>    [33604.108093] usb 1-5: new high speed USB device number 4 using ehci_hcd
>    [33604.276241] uvcvideo: Found UVC 1.00 device Microsoft? LifeCam Studio(TM) (045e:0772)
>    [33604.334468] input: Microsoft? LifeCam Studio(TM) as /devices/pci0000:00/0000:00:12.2/usb1/1-5/1-5:1.0/input/input7
>
> For the Lifecam Cinema, I get:
>
>    [33729.476089] usb 1-5: new high speed USB device number 5 using ehci_hcd
>    [33729.626964] uvcvideo: Found UVC 1.00 device Microsoft? LifeCam Cinema(TM) (045e:075d)
>    [33729.633068] input: Microsoft? LifeCam Cinema(TM) as /devices/pci0000:00/0000:00:12.2/usb1/1-5/1-5:1.0/input/input8
>
> On my system the button works for the Cinema but not for the Studio.
>

I'ev a studio too and I investigated this a while back, the studio does not use the standard
uvc method for reporting button events, but instead has a separate usb hid interface for this,
by catting the rawhid device created one can see that this is hooked up to the button. Unfortunately
it seems to not be standard usb hid, so even with the hid driver loaded it does not work
out of the box. It looks like someone will need to write a kernel driver for it translating
the raw hid stuff to button events.

Regards,

Hans


From laurent.pinchart at ideasonboard.com  Thu Nov  3 10:13:51 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 10:13:51 +0100
Subject: [Linux-uvc-devel] Annoying HTTPS in link to list archive.
In-Reply-To: <ffa655691f67087dd7a952861430987b@127.0.0.1>
References: <ffa655691f67087dd7a952861430987b@127.0.0.1>
Message-ID: <201111031013.51582.laurent.pinchart@ideasonboard.com>

Hi,

On Friday 30 September 2011 22:41:29 Kaz Kylheku wrote:
> Hi all,
> 
> If you view this list's page (note the HTTP here)
> 
> http://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 
> the link which it gives to the list archives is HTTPS!
> 
> Because of this stupidity, Google has indexed this list using HTTPS
> URLs.
> You have to accept the self-signed security certificate when you
> navigate to the archive pages from a Google search result.
> 
> Can someone fix that?

I have no control over the link to the archives in 
http://lists.berlios.de/mailman/listinfo/linux-uvc-devel. I could ask Google 
to remove the https:// URLs from its cache, but they will come back anyway, so 
it's a bit pointless.

Berlios will close at the end of the year and the mailing list will move 
elsewhere, hopefully fixing the problem.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 10:17:21 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 10:17:21 +0100
Subject: [Linux-uvc-devel] H.264 camera options.
In-Reply-To: <ba7a791d03f0c0bf7965c9e75274d682@127.0.0.1>
References: <ba7a791d03f0c0bf7965c9e75274d682@127.0.0.1>
Message-ID: <201111031017.21462.laurent.pinchart@ideasonboard.com>

Hi Kaz,

On Friday 30 September 2011 04:24:02 Kaz Kylheku wrote:
> Hi All,
> 
> I'm searching for a suitable H.264 camera to use as a "reference
> hardware" for a a Linux-based embedded platform.
> 
> I've seen references to the B990 from Logitech, so that looks like a
> good candidate.
> 
> Is there anything out there which goes above 720p, maybe as high as
> 1080p?
> 
> This is not a hard requirement, but a "nice to have".
> 
> It would be nice to have as capable a H.264 camera as possible for the
> reference.
> 
> An important requirement is that the un-encoded video stream is available
> from the camera, not only the coded stream. It should be possible to loop
> back the picture without decoding anything, since decoding resources are
> limited on the platform, especially when we get into higher resolutions.

I expect most H.264 webcams to support streaming a compressed and an 
uncompressed stream concurrently. However, most of them do so in a completely 
proprietary way, and are not supported by the uvcvideo driver at the moment.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 10:25:31 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 10:25:31 +0100
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <1453703659.52628.1315550662003.JavaMail.root@ahm.einfochips.com>
References: <1453703659.52628.1315550662003.JavaMail.root@ahm.einfochips.com>
Message-ID: <201111031025.31489.laurent.pinchart@ideasonboard.com>

Hi Ajay,

On Friday 09 September 2011 08:44:22 Ajay Bhargav wrote:
> Hi Srinivas,
> 
> Patches are attached here... There are more modifications I did to
> uvc_video to set size of buffer + fid bit toggle after 44 MPEG2-TS
> packets.

Why 44 ?

> What kind of camera are you using?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 10:30:47 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 10:30:47 +0100
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CAPueXH5ZyMzfY=0va4cF9vircdvZPZjLNKOSDttosjP8boS2JQ@mail.gmail.com>
References: <CA+DpathzsChYjjV_rTk3uwH8_4XnM1W0gQz+yAoZ8zZKgjmNkg@mail.gmail.com>
	<291712423.55129.1315575608085.JavaMail.root@ahm.einfochips.com>
	<CAPueXH5ZyMzfY=0va4cF9vircdvZPZjLNKOSDttosjP8boS2JQ@mail.gmail.com>
Message-ID: <201111031030.47771.laurent.pinchart@ideasonboard.com>

Hi Paulo,

On Friday 09 September 2011 16:05:24 Paulo Assis wrote:
> Well one important thing to notice is the pixel format returned by the
> driver, will it differentiate between avc and svc streams, or even
> mpeg2 ?

That very much depends on the camera. Facevsion cameras seem to report MPEG2-
TS but stream H.264. It then becomes difficult for the driver to know what to 
expose to userspace.

> If not maybe then it becomes harder for generic apps to decode it,
> unless we use a bunch of switch cases for the different cameras
> (something like this would be best implemented in the driver though)

-- 
Regards,

Laurent Pinchart


From ajay.bhargav at einfochips.com  Thu Nov  3 10:18:52 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Thu, 3 Nov 2011 14:48:52 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201111031025.31489.laurent.pinchart@ideasonboard.com>
Message-ID: <1870343627.296686.1320311932899.JavaMail.root@ahm.einfochips.com>


----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:

> Hi Ajay,
> 
> On Friday 09 September 2011 08:44:22 Ajay Bhargav wrote:
> > Hi Srinivas,
> > 
> > Patches are attached here... There are more modifications I did to
> > uvc_video to set size of buffer + fid bit toggle after 44 MPEG2-TS
> > packets.
> 
> Why 44 ?
> 
> > What kind of camera are you using?
> 
> -- 
> Regards,
> 
> Laurent Pinchart
> 

Hi Laurent,

There is nothing specific about it.. Even after one packet FID can be toggled but when doing live streaming using gstreamer, I faced problem in decoding and lot of frames were dropped, so after some iterations I changed it 100 from 44 as of now. Video looks smooth. While capturing video in a file I do not face any problem. Video is captured properly and can be played using VLC or mplayer both.

Regards,
Ajay Bhargav


From ajay.bhargav at einfochips.com  Thu Nov  3 10:25:42 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Thu, 3 Nov 2011 14:55:42 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <406696368.296698.1320312165679.JavaMail.root@ahm.einfochips.com>
Message-ID: <1582088.296710.1320312342373.JavaMail.root@ahm.einfochips.com>


----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:

> Hi Paulo,
> 
> On Friday 09 September 2011 16:05:24 Paulo Assis wrote:
> > Well one important thing to notice is the pixel format returned by
> the
> > driver, will it differentiate between avc and svc streams, or even
> > mpeg2 ?
> 
> That very much depends on the camera. Facevsion cameras seem to report
> MPEG2-
> TS but stream H.264. It then becomes difficult for the driver to know
> what to 
> expose to userspace.
> 
> > If not maybe then it becomes harder for generic apps to decode it,
> > unless we use a bunch of switch cases for the different cameras
> > (something like this would be best implemented in the driver
> though)
> 
> -- 
> Regards,
> 
> Laurent Pinchart
> 
I think its better to give raw MPEG2-TS stream to user application later application may decide how to decode that stream. As for my camera I had H.264 AVC stream where as Facevision gives SVC (as per discussion with Robert).

and If an MPEG2-TS cam is used for boardcasting application then we can directly use the MPEG2-TS stream what we get from camera.

Regards,
Ajay Bhargav


From laurent.pinchart at ideasonboard.com  Thu Nov  3 10:46:58 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 10:46:58 +0100
Subject: [Linux-uvc-devel] New unsupported UVC WebCam
In-Reply-To: <op.v1nckhnmg2xmj0@localhost.localdomain>
References: <op.v1nckhnmg2xmj0@localhost.localdomain>
Message-ID: <201111031046.59513.laurent.pinchart@ideasonboard.com>

Hi,

On Sunday 11 September 2011 15:46:55 gudvinr at gmail.com wrote:
> Hi, I bought a laptop ASUS U31SD with "USB2.0 UVC VGA WebCam" webcam, that
> doesn't work with uvcvideo driver.
> 
> See info from lsusb:
> Bus 001 Device 004: ID 13d3:5710 IMC Networks

Could you please send me the output of lsusb -v -d 13d3:5710 ?

> And dmesg log:

[snip]

> [10013.494171] kernel BUG at drivers/media/media-entity.c:346!

[snip]

This is a known bug that was introduced in v3.0 and got fixed in both the 3.0 
stable branch and in v3.1.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 11:20:06 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 11:20:06 +0100
Subject: [Linux-uvc-devel] Sweex WC061 HD Webcam Sliver
In-Reply-To: <4E670B24.1040504@fisher-privat.net>
References: <CAHGSkqgyRgbt_G5MB6DewazJML8B1OkGyF0yP=qqKoRm28FapQ@mail.gmail.com>
	<CAHGSkqjee4DbDMnOKsrfp1Haih_bybkGSvWhPi_2YmraDa4rpQ@mail.gmail.com>
	<4E670B24.1040504@fisher-privat.net>
Message-ID: <201111031120.06914.laurent.pinchart@ideasonboard.com>

Hi,

On Wednesday 07 September 2011 08:11:48 Alexey Fisher wrote:
> Am 06.09.2011 12:53, schrieb Michael Tandy:
> > [99317.553237] uvcvideo: uvc_v4l2_ioctl(VIDIOC_STREAMON)
> > [99317.554747] uvcvideo: uvc_v4l2_poll
> > [99333.472385] uvcvideo: Dropping payload (error bit set).
> > [99333.472389] uvcvideo: Frame complete (EOF found).
> > [99333.472391] uvcvideo: EOF in empty payload.
> > [99333.472429] uvcvideo: uvc_v4l2_poll
> > [99333.472438] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
> > [99333.472447] uvcvideo: Dequeuing buffer 0 (3, 2676 bytes).
> 
> hmm... the camera notify us about with error bit set, but current driver
> will just drop it and mark the buffer as faulty.

As the data can't be trusted, the uvcvideo driver decides to drop the packet.
Alternatively the packet could be processed normally and the buffer market as
bad. It would then be up to the application to decide what to do with such
buffers (you will have to set the no_drop module parameter to 1, as the driver
drops faulty buffers by default).

The following patch should implement that behaviour, in case you want to test
it.

diff --git a/drivers/media/video/uvc/uvc_video.c b/drivers/media/video/uvc/uvc_video.c
index ffd1158..baa5850 100644
--- a/drivers/media/video/uvc/uvc_video.c
+++ b/drivers/media/video/uvc/uvc_video.c
@@ -419,13 +419,6 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
 	if (len < 2 || data[0] < 2 || data[0] > len)
 		return -EINVAL;
 
-	/* Skip payloads marked with the error bit ("error frames"). */
-	if (data[1] & UVC_STREAM_ERR) {
-		uvc_trace(UVC_TRACE_FRAME, "Dropping payload (error bit "
-			  "set).\n");
-		return -ENODATA;
-	}
-
 	fid = data[1] & UVC_STREAM_FID;
 
 	/* Increase the sequence number regardless of any buffer states, so
@@ -442,6 +435,13 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
 		return -ENODATA;
 	}
 
+	/* Mark the buffer as bad if the error bit is set. */
+	if (data[1] & UVC_STREAM_ERR) {
+		uvc_trace(UVC_TRACE_FRAME, "Marking buffer as bad (error bit "
+			  "set).\n");
+		buf->error = 1;
+	}
+
 	/* Synchronize to the input stream by waiting for the FID bit to be
 	 * toggled when the the buffer state is not UVC_BUF_STATE_ACTIVE.
 	 * stream->last_fid is initialized to -1, so the first isochronous


> According to uvc specification v1.1 in "4.3.1.7 Stream Error Code
> Control" we can/should check the error reason:
> -------------------------------------------------------------------
> The host software should send a GET_CUR request to this control to
> determine the error when one of the following events occurs:
> - The Error bit in the video or still image payload header is set by the
> device
> ....
> For scenarios where the host is transmitting video data to the device,
> the host can not use the Error bit in the payload header to detect a
> device error. Therefore, in order to determine when a streaming error
> occurs, the host must rely on either a Control Change interrupt from the
> device or a bulk endpoint stall.
> --------------------------------------------------------------------
> 
> I'm suddenly not so good to implement ne things without testing and
> probing. May be Laurent can do this? Or i need access to the webcam.

Retrieving the cause of the error requires sending a control request, which
can't be done in interrupt context. This could be implemented, but won't be
trivial, and I'm not sure it will give any useful information anyway. Knowing
whether the error comes from a buffer underrun, a buffer overrun or something
else won't let the driver fix the error.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 11:34:54 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 11:34:54 +0100
Subject: [Linux-uvc-devel] UVC H264 Support
In-Reply-To: <CAMxVRxDQoFwnf+f+Lg9uqRK9F7mRmmKxu2S1escxBmcSyCJDpw@mail.gmail.com>
References: <CADanNGyGx+v9wPpGiXrkVzzTVpMH93DPKm+4Jc6CZprksdvNNg@mail.gmail.com>
	<CADanNGx+ZWZE2Z_bKR96_xhCXLDV8fzzW=A6PjJdbVCz5EbBaw@mail.gmail.com>
	<CAMxVRxDQoFwnf+f+Lg9uqRK9F7mRmmKxu2S1escxBmcSyCJDpw@mail.gmail.com>
Message-ID: <201111031134.54514.laurent.pinchart@ideasonboard.com>

Hi Max,

On Tuesday 25 October 2011 08:53:15 Max Lapshin wrote:
> Looks like this camera is not supported for no serious reasons.

One of the reasons is that nobody has submitted a proper patch yet. I'll let 
you decide whether it's a serious reason or not :-)

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 11:54:55 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 11:54:55 +0100
Subject: [Linux-uvc-devel] Working with Logitech B990: Issues.
In-Reply-To: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
References: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
Message-ID: <201111031154.55972.laurent.pinchart@ideasonboard.com>

Hi Kaz,

On Thursday 03 November 2011 02:20:30 Kaz Kylheku wrote:
> Hey all,
> 
> I'm working with the B990 on an ARM-based embedded system based on
> linux-2.6.27.47.
> 
> H.264 is coming out of the cam, but I don't see an SPS/PPS, and all
> the frames are
> P slices, e.g. like this and similar:
> 
>  00 00 00 01 61 9a 00 38 37 e0 20 30 ...

I can't really help you with that, I haven't tried H.264 on a B990 yet (one of 
the reasons is that I don't own any B990 :-)).

> Secondly, after some period of running, the USB controller throws up an
> over-current error, and then the device is not usable without a reboot.
> Maybe this big sucker really draws too much current?

That's not impossible. At least one Logitech webcam actually runs Linux 
embedded in the device (see https://opensource.logitech.com/logitech/), the 
B990 might as well. This could explain why the current consumption is higher 
than with microcontroller-based cameras.

> Usually I am not able to two consecutive successful opens of the
> device.
> 
> By the way, I patched the driver to make the trace and quirks sysctl
> parameters, since I have it compiled into the kernel.

Aren't uvcvideo module parameters available through 
/sys/modules/uvcvideo/parameters/ even when uvcvideo is compiled in ?

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Thu Nov  3 12:55:35 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 3 Nov 2011 12:55:35 +0100
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+Dpatieu+7JxoDSvptwdcf2c8_4vE9CLqGM7RBcwOZfvGBs4Q@mail.gmail.com>
References: <406696368.296698.1320312165679.JavaMail.root@ahm.einfochips.com>
	<1582088.296710.1320312342373.JavaMail.root@ahm.einfochips.com>
	<CA+Dpatieu+7JxoDSvptwdcf2c8_4vE9CLqGM7RBcwOZfvGBs4Q@mail.gmail.com>
Message-ID: <201111031255.36411.laurent.pinchart@ideasonboard.com>

Hi Robert,

On Thursday 03 November 2011 12:34:55 Robert Krakora wrote:
> Hi Guys,
> 
> I did not see audio in the MPEG2 TS stream that I was able to get out of the
> FaceVsion camera. I purchased one for Laurent for development purposes. It
> sounds like he has been working with it some.

Yes I've finally started working on it. Thanks for the hardware.

I'll post prototype patches to the list. I've been able to get a video stream 
out of the device, but it looks pretty bad when played in mplayer. I'm not 
sure who is at fault that.

> I wish these vendors would come to some kind of consensus on how to expose
> H.264 via USB interface.

The latest version of the UVC 1.1 specification includes an H.264 payload 
format. Unfortunately Microsoft, Logitech and Skype designed something really 
horrible, without much input from anyone else.

> It seems like it would make life easier for the UVC developers such as
> Laurent.

I should come up with my own H.264 UVC payload specification :-)

> If Laurent needs any more makes/models of H.264 cameras for development, I
> will accommodate.

Thank you. I will first try to finish the Facevsion support.

-- 
Regards,

Laurent Pinchart


From ajay.bhargav at einfochips.com  Thu Nov  3 13:43:17 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Thu, 3 Nov 2011 18:13:17 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <1753759954.298102.1320323994243.JavaMail.root@ahm.einfochips.com>
Message-ID: <1081303779.298119.1320324197540.JavaMail.root@ahm.einfochips.com>


----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:

> Hi Robert,
> 
> On Thursday 03 November 2011 12:34:55 Robert Krakora wrote:
> > Hi Guys,
> > 
> > I did not see audio in the MPEG2 TS stream that I was able to get
> out of the
> > FaceVsion camera. I purchased one for Laurent for development
> purposes. It
> > sounds like he has been working with it some.
> 
> Yes I've finally started working on it. Thanks for the hardware.
> 
> I'll post prototype patches to the list. I've been able to get a video
> stream 
> out of the device, but it looks pretty bad when played in mplayer. I'm
> not 
> sure who is at fault that.
> 
> > I wish these vendors would come to some kind of consensus on how to
> expose
> > H.264 via USB interface.
> 
> The latest version of the UVC 1.1 specification includes an H.264
> payload 
> format. Unfortunately Microsoft, Logitech and Skype designed something
> really 
> horrible, without much input from anyone else.
> 
> > It seems like it would make life easier for the UVC developers such
> as
> > Laurent.
> 
> I should come up with my own H.264 UVC payload specification :-)
> 
> > If Laurent needs any more makes/models of H.264 cameras for
> development, I
> > will accommodate.
> 
> Thank you. I will first try to finish the Facevsion support.
> 
> -- 
> Regards,
> 
> Laurent Pinchart
> 
Hi Laurent,

Thank you taking charge on the MPEG2-TS support. I was thinking that MPEG2-TS container format may contain video stream encoded differently other than H.264. So is it good to take out the container part and exposing the raw stream? I faced problem when I was storing H.264 stream only using gstreamer. Video was running too fast with no timing information and VLC was unable to play that stream.

how did you deal with the FID problem? coz MPEG2-TS does not provide such information. What I did was to count certain number of packets and toggle FID forcefully so that buffer is ready for reading. It looks like you are missing some packets coz of which video is bad. I faced the same problem untill i added that FID hack.

I hope this will help you. Please let me know if I can help you in this.

Regards,
Ajay Bhargav


From ajay.bhargav at einfochips.com  Thu Nov  3 13:49:16 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Thu, 3 Nov 2011 18:19:16 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <118340009.298184.1320324473416.JavaMail.root@ahm.einfochips.com>
Message-ID: <327620405.298193.1320324556561.JavaMail.root@ahm.einfochips.com>


----- "Ajay Bhargav" <ajay.bhargav at einfochips.com> wrote:

> ----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:
> 
> > Hi Robert,
> > 
> > On Thursday 03 November 2011 12:34:55 Robert Krakora wrote:
> > > Hi Guys,
> > > 
> > > I did not see audio in the MPEG2 TS stream that I was able to get
> > out of the
> > > FaceVsion camera. I purchased one for Laurent for development
> > purposes. It
> > > sounds like he has been working with it some.
> > 
> > Yes I've finally started working on it. Thanks for the hardware.
> > 
> > I'll post prototype patches to the list. I've been able to get a
> video
> > stream 
> > out of the device, but it looks pretty bad when played in mplayer.
> I'm
> > not 
> > sure who is at fault that.
> > 
> > > I wish these vendors would come to some kind of consensus on how
> to
> > expose
> > > H.264 via USB interface.
> > 
> > The latest version of the UVC 1.1 specification includes an H.264
> > payload 
> > format. Unfortunately Microsoft, Logitech and Skype designed
> something
> > really 
> > horrible, without much input from anyone else.
> > 
> > > It seems like it would make life easier for the UVC developers
> such
> > as
> > > Laurent.
> > 
> > I should come up with my own H.264 UVC payload specification :-)
> > 
> > > If Laurent needs any more makes/models of H.264 cameras for
> > development, I
> > > will accommodate.
> > 
> > Thank you. I will first try to finish the Facevsion support.
> > 
> > -- 
> > Regards,
> > 
> > Laurent Pinchart
> > 
> Hi Laurent,
> 
> Thank you taking charge on the MPEG2-TS support. I was thinking that
> MPEG2-TS container format may contain video stream encoded differently
> other than H.264. So is it good to take out the container part and
> exposing the raw stream? I faced problem when I was storing H.264
> stream only using gstreamer. Video was running too fast with no timing
> information and VLC was unable to play that stream.
> 
> how did you deal with the FID problem? coz MPEG2-TS does not provide
> such information. What I did was to count certain number of packets
> and toggle FID forcefully so that buffer is ready for reading. It
> looks like you are missing some packets coz of which video is bad. I
> faced the same problem untill i added that FID hack.
> 
> I hope this will help you. Please let me know if I can help you in
> this.
> 
> Regards,
> Ajay Bhargav
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 

I am attaching my patch for kernel 2.6.34 for MPEG2-TS cam support with FID hack I added for my camera. Hope this is helpful. This is just a hack not really a solution, though we can create a FID_QUIRK to actually support dummy FID toggle for compressed streams or something like that.

Regards,
Ajay Bhargav
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0010-uvc-Add-MPEG2-TS-webcam-support.patch
Type: text/x-patch
Size: 5053 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111103/e1992749/attachment.bin>

From laurent.pinchart at ideasonboard.com  Thu Nov  3 17:27:19 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu,  3 Nov 2011 17:27:19 +0100
Subject: [Linux-uvc-devel] [RFC PATCH]  uvc debugfs interface,
	initial patch
In-Reply-To: <4E7983BA.7010103@fisher-privat.net>
References: <4E7983BA.7010103@fisher-privat.net>
Message-ID: <1320337641-27084-1-git-send-email-laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Wednesday 21 September 2011 08:27:06 Alexey Fisher wrote:
> 
> this is initial patch for debugfs interface. I didn't implemented all
> requests, i think the size of this patch is any way too big now.

I've finally found time to go through your patch :-) I'm sorry for the way too
long delay.

> Here is how it's working. After driver is loaded it create
> debugfs/usb/uvcvideo directory. If some device is attached it create
> device dir like this: 001.007_046d.0991 (first part is usb bus, second
> is usb id). In this directory it create file called stats. Here is the
> content of this file:
> 
> usb id: 046d:0991, usb bus: 001:007
> packet size: 944(6)
> state: idle  <-- show the state of device. capture or idle
> start time: 1316585466 <- unix epoch time in seconds.
> capture time: 106   <- capture time in seconds.
> format: YUV 4:2:2 (YUYV)
> resolution: 320x240 @ 30
> decode_start: 846880  <- this show how many payloads we started to
> decoding. bad_header: 0 <-- haw many payloads was dropped, because of bad
> header uvc_empty: 604160  <-- correct uvc payloads without video data
> uvc_stream_err: 0  <-- count of payloads with err bit set
> sequence: 955  <-- count of fid switches
> out_of_sync: 0  <-- out of sync calls

I like the patch but have lots of small comments. Instead of playing ping-pong
with you to get everything fixed, I've reworked your patch. The result can be
found as replies to this e-mail.

First of all I've split the patch in two. The first patch adds debugfs support
to the driver, and the second patch exports video stream statistics. This makes
review easier.

Then, I've modified statistics gathering to store per-stream stats instead of
per-device as a UVC device can expose several streams.

Finally I've removed the state information from the statistics, as they're not
really statistics. It should be easi to add them back in a "state" or "info"
debugfs file once we agree on these patches.

Both patches are currently authored by me. I'll will use your name and e-mail
address if you send me your SoB line.

Laurent Pinchart (2):
  uvcvideo: Add debugfs support
  uvcvideo: Extract video stream statistics

 drivers/media/video/uvc/Makefile      |    2 +-
 drivers/media/video/uvc/uvc_debugfs.c |  136 +++++++++++++++++++++++++++++++++
 drivers/media/video/uvc/uvc_driver.c  |   21 ++++-
 drivers/media/video/uvc/uvc_video.c   |  111 ++++++++++++++++++++++++++-
 drivers/media/video/uvc/uvcvideo.h    |   39 ++++++++++
 5 files changed, 302 insertions(+), 7 deletions(-)
 create mode 100644 drivers/media/video/uvc/uvc_debugfs.c

-- 
Regards,

Laurent Pinchart



From laurent.pinchart at ideasonboard.com  Thu Nov  3 17:27:20 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu,  3 Nov 2011 17:27:20 +0100
Subject: [Linux-uvc-devel] [PATCH 1/2] uvcvideo: Add debugfs support
In-Reply-To: <4E7983BA.7010103@fisher-privat.net>
References: <4E7983BA.7010103@fisher-privat.net>
Message-ID: <1320337641-27084-2-git-send-email-laurent.pinchart@ideasonboard.com>

Create a debugfs entry per UVC stream. This will be used to export
stream statistics.

Signed-off-by: Laurent Pinchart <laurent.pinchart at ideasonboard.com>
---
 drivers/media/video/uvc/Makefile      |    2 +-
 drivers/media/video/uvc/uvc_debugfs.c |   76 +++++++++++++++++++++++++++++++++
 drivers/media/video/uvc/uvc_driver.c  |   21 +++++++--
 drivers/media/video/uvc/uvcvideo.h    |    9 ++++
 4 files changed, 102 insertions(+), 6 deletions(-)
 create mode 100644 drivers/media/video/uvc/uvc_debugfs.c

diff --git a/drivers/media/video/uvc/Makefile b/drivers/media/video/uvc/Makefile
index 2071ca8..c26d12f 100644
--- a/drivers/media/video/uvc/Makefile
+++ b/drivers/media/video/uvc/Makefile
@@ -1,5 +1,5 @@
 uvcvideo-objs  := uvc_driver.o uvc_queue.o uvc_v4l2.o uvc_video.o uvc_ctrl.o \
-		  uvc_status.o uvc_isight.o
+		  uvc_status.o uvc_isight.o uvc_debugfs.o
 ifeq ($(CONFIG_MEDIA_CONTROLLER),y)
 uvcvideo-objs  += uvc_entity.o
 endif
diff --git a/drivers/media/video/uvc/uvc_debugfs.c b/drivers/media/video/uvc/uvc_debugfs.c
new file mode 100644
index 0000000..f58969a
--- /dev/null
+++ b/drivers/media/video/uvc/uvc_debugfs.c
@@ -0,0 +1,76 @@
+/*
+ *      uvc_debugfs.c --  USB Video Class driver - Debugging support
+ *
+ *      Copyright (C) 2011
+ *          Laurent Pinchart (laurent.pinchart at ideasonboard.com)
+ *
+ *      This program is free software; you can redistribute it and/or modify
+ *      it under the terms of the GNU General Public License as published by
+ *      the Free Software Foundation; either version 2 of the License, or
+ *      (at your option) any later version.
+ *
+ */
+
+#include <linux/debugfs.h>
+#include <linux/slab.h>
+#include <linux/usb.h>
+
+#include "uvcvideo.h"
+
+/* -----------------------------------------------------------------------------
+ * Global and stream initialization/cleanup
+ */
+
+static struct dentry *uvc_debugfs_root_dir;
+
+int uvc_debugfs_init_stream(struct uvc_streaming *stream)
+{
+	struct usb_device *udev = stream->dev->udev;
+	struct dentry *dent;
+	char dir_name[32];
+
+	if (uvc_debugfs_root_dir == NULL)
+		return -ENODEV;
+
+	sprintf(dir_name, "%u-%u", udev->bus->busnum, udev->devnum);
+
+	dent = debugfs_create_dir(dir_name, uvc_debugfs_root_dir);
+	if (IS_ERR_OR_NULL(dent)) {
+		uvc_printk(KERN_INFO, "Unable to create debugfs %s directory.\n",
+			   dir_name);
+		return -ENODEV;
+	}
+
+	stream->debugfs_dir = dent;
+
+	return 0;
+}
+
+void uvc_debugfs_cleanup_stream(struct uvc_streaming *stream)
+{
+	if (stream->debugfs_dir == NULL)
+		return;
+
+	debugfs_remove_recursive(stream->debugfs_dir);
+	stream->debugfs_dir = NULL;
+}
+
+int uvc_debugfs_init(void)
+{
+	struct dentry *dir;
+
+	dir = debugfs_create_dir("uvcvideo", usb_debug_root);
+	if (IS_ERR_OR_NULL(dir)) {
+		uvc_printk(KERN_INFO, "Unable to create debugfs directory\n");
+		return -ENODATA;
+	}
+
+	uvc_debugfs_root_dir = dir;
+	return 0;
+}
+
+void uvc_debugfs_cleanup(void)
+{
+	if (uvc_debugfs_root_dir != NULL)
+		debugfs_remove_recursive(uvc_debugfs_root_dir);
+}
diff --git a/drivers/media/video/uvc/uvc_driver.c b/drivers/media/video/uvc/uvc_driver.c
index 750ab68..a240d43 100644
--- a/drivers/media/video/uvc/uvc_driver.c
+++ b/drivers/media/video/uvc/uvc_driver.c
@@ -1675,6 +1675,8 @@ static void uvc_unregister_video(struct uvc_device *dev)
 
 		video_unregister_device(stream->vdev);
 		stream->vdev = NULL;
+
+		uvc_debugfs_cleanup_stream(stream);
 	}
 
 	/* Decrement the stream count and call uvc_delete explicitly if there
@@ -1700,6 +1702,8 @@ static int uvc_register_video(struct uvc_device *dev,
 		return ret;
 	}
 
+	uvc_debugfs_init_stream(stream);
+
 	/* Register the device with V4L. */
 	vdev = video_device_alloc();
 	if (vdev == NULL) {
@@ -2405,17 +2409,24 @@ struct uvc_driver uvc_driver = {
 
 static int __init uvc_init(void)
 {
-	int result;
+	int ret;
 
-	result = usb_register(&uvc_driver.driver);
-	if (result == 0)
-		printk(KERN_INFO DRIVER_DESC " (" DRIVER_VERSION ")\n");
-	return result;
+	uvc_debugfs_init();
+
+	ret = usb_register(&uvc_driver.driver);
+	if (ret < 0) {
+		uvc_debugfs_cleanup();
+		return ret;
+	}
+
+	printk(KERN_INFO DRIVER_DESC " (" DRIVER_VERSION ")\n");
+	return 0;
 }
 
 static void __exit uvc_cleanup(void)
 {
 	usb_deregister(&uvc_driver.driver);
+	uvc_debugfs_cleanup();
 }
 
 module_init(uvc_init);
diff --git a/drivers/media/video/uvc/uvcvideo.h b/drivers/media/video/uvc/uvcvideo.h
index 882159a..2d45e58 100644
--- a/drivers/media/video/uvc/uvcvideo.h
+++ b/drivers/media/video/uvc/uvcvideo.h
@@ -403,6 +403,9 @@ struct uvc_streaming {
 
 	__u32 sequence;
 	__u8 last_fid;
+
+	/* debugfs */
+	struct dentry *debugfs_dir;
 };
 
 enum uvc_device_state {
@@ -605,4 +608,10 @@ extern struct usb_host_endpoint *uvc_find_endpoint(
 void uvc_video_decode_isight(struct urb *urb, struct uvc_streaming *stream,
 		struct uvc_buffer *buf);
 
+/* debugfs */
+int uvc_debugfs_init(void);
+void uvc_debugfs_cleanup(void);
+int uvc_debugfs_init_stream(struct uvc_streaming *stream);
+void uvc_debugfs_cleanup_stream(struct uvc_streaming *stream);
+
 #endif
-- 
1.7.3.4



From laurent.pinchart at ideasonboard.com  Thu Nov  3 17:27:21 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu,  3 Nov 2011 17:27:21 +0100
Subject: [Linux-uvc-devel] [PATCH 2/2] uvcvideo: Extract video stream
	statistics
In-Reply-To: <4E7983BA.7010103@fisher-privat.net>
References: <4E7983BA.7010103@fisher-privat.net>
Message-ID: <1320337641-27084-3-git-send-email-laurent.pinchart@ideasonboard.com>

Export the statistics through debugfs.

Signed-off-by: Laurent Pinchart <laurent.pinchart at ideasonboard.com>
---
 drivers/media/video/uvc/uvc_debugfs.c |   60 ++++++++++++++++++
 drivers/media/video/uvc/uvc_video.c   |  111 ++++++++++++++++++++++++++++++++-
 drivers/media/video/uvc/uvcvideo.h    |   32 +++++++++-
 3 files changed, 201 insertions(+), 2 deletions(-)

diff --git a/drivers/media/video/uvc/uvc_debugfs.c b/drivers/media/video/uvc/uvc_debugfs.c
index f58969a..bdba016 100644
--- a/drivers/media/video/uvc/uvc_debugfs.c
+++ b/drivers/media/video/uvc/uvc_debugfs.c
@@ -18,6 +18,57 @@
 #include "uvcvideo.h"
 
 /* -----------------------------------------------------------------------------
+ * Statistics
+ */
+
+#define UVC_DEBUGFS_BUF_SIZE	1024
+
+struct uvc_debugfs_buffer {
+	size_t count;
+	char data[UVC_DEBUGFS_BUF_SIZE];
+};
+
+static int uvc_debugfs_stats_open(struct inode *inode, struct file *file)
+{
+	struct uvc_streaming *stream = inode->i_private;
+	struct uvc_debugfs_buffer *buf;
+
+	buf = kmalloc(sizeof(*buf), GFP_KERNEL);
+	if (buf == NULL)
+		return -ENOMEM;
+
+	buf->count = uvc_video_stats_dump(stream, buf->data, sizeof(buf->data));
+
+	file->private_data = buf;
+	return 0;
+}
+
+static ssize_t uvc_debugfs_stats_read(struct file *file, char __user *user_buf,
+				      size_t nbytes, loff_t *ppos)
+{
+	struct uvc_debugfs_buffer *buf = file->private_data;
+
+	return simple_read_from_buffer(user_buf, nbytes, ppos, buf->data,
+				       buf->count);
+}
+
+static int uvc_debugfs_stats_release(struct inode *inode, struct file *file)
+{
+	kfree(file->private_data);
+	file->private_data = NULL;
+
+	return 0;
+}
+
+static const struct file_operations uvc_debugfs_stats_fops = {
+	.owner = THIS_MODULE,
+	.open = uvc_debugfs_stats_open,
+	.llseek = no_llseek,
+	.read = uvc_debugfs_stats_read,
+	.release = uvc_debugfs_stats_release,
+};
+
+/* -----------------------------------------------------------------------------
  * Global and stream initialization/cleanup
  */
 
@@ -43,6 +94,15 @@ int uvc_debugfs_init_stream(struct uvc_streaming *stream)
 
 	stream->debugfs_dir = dent;
 
+	dent = debugfs_create_file("stats", 0600, stream->debugfs_dir,
+				   stream, &uvc_debugfs_stats_fops);
+	if (IS_ERR_OR_NULL(dent)) {
+		uvc_printk(KERN_INFO, "Unable to create debugfs %s directory.\n",
+			   dir_name);
+		uvc_debugfs_cleanup_stream(stream);
+		return -ENODEV;
+	}
+
 	return 0;
 }
 
diff --git a/drivers/media/video/uvc/uvc_video.c b/drivers/media/video/uvc/uvc_video.c
index a57f813..2ab92a7 100644
--- a/drivers/media/video/uvc/uvc_video.c
+++ b/drivers/media/video/uvc/uvc_video.c
@@ -358,6 +358,106 @@ static int uvc_commit_video(struct uvc_streaming *stream,
 }
 
 /* ------------------------------------------------------------------------
+ * Timestamp statistics
+ */
+
+static void uvc_video_stats_decode(struct uvc_streaming *stream,
+		const __u8 *data, int len)
+{
+	unsigned int header_size;
+
+	if (stream->stats.stream.nb_frames == 0 &&
+	    stream->stats.frame.nb_packets == 0)
+		ktime_get_ts(&stream->stats.stream.start_ts);
+
+	/* Make sure we have at least 2 bytes of header. */
+	if (len < 2) {
+		stream->stats.frame.nb_invalid++;
+		return;
+	}
+
+	switch (data[1] & (UVC_STREAM_PTS | UVC_STREAM_SCR)) {
+	case UVC_STREAM_PTS | UVC_STREAM_SCR:
+		header_size = 12;
+		break;
+	case UVC_STREAM_PTS:
+		header_size = 6;
+		break;
+	case UVC_STREAM_SCR:
+		header_size = 8;
+		break;
+	default:
+		header_size = 2;
+		break;
+	}
+
+	/* Check for invalid headers. */
+	if (len < header_size || data[0] < header_size) {
+		stream->stats.frame.nb_invalid++;
+		return;
+	}
+
+	/* Record the first non-empty packet number. */
+	if (stream->stats.frame.size == 0 && len > header_size)
+		stream->stats.frame.first_data = stream->stats.frame.nb_packets;
+
+	/* Update the frame size. */
+	stream->stats.frame.size += len - header_size;
+
+	/* Update the packets counters. */
+	stream->stats.frame.nb_packets++;
+	if (len > header_size)
+		stream->stats.frame.nb_empty++;
+
+	if (data[1] & UVC_STREAM_ERR)
+		stream->stats.frame.nb_errors++;
+}
+
+static void uvc_video_stats_update(struct uvc_streaming *stream)
+{
+	struct uvc_stats_frame *frame = &stream->stats.frame;
+
+	uvc_trace(UVC_TRACE_STATS, "frame %u stats: %u/%u/%u packets\n",
+		  stream->sequence, frame->first_data,
+		  frame->nb_packets - frame->nb_empty, frame->nb_packets);
+
+	stream->stats.stream.nb_frames++;
+	stream->stats.stream.nb_packets += stream->stats.frame.nb_packets;
+	stream->stats.stream.nb_empty += stream->stats.frame.nb_empty;
+	stream->stats.stream.nb_errors += stream->stats.frame.nb_errors;
+	stream->stats.stream.nb_invalid += stream->stats.frame.nb_invalid;
+
+	memset(&stream->stats.frame, 0, sizeof(stream->stats.frame));
+}
+
+size_t uvc_video_stats_dump(struct uvc_streaming *stream, char *buf,
+			    size_t size)
+{
+	size_t count = 0;
+
+	count += scnprintf(buf + count, size - count,
+			   "frames:  %u\npackets: %u\nempty:   %u\n"
+			   "errors:  %u\ninvalid: %u\n",
+			   stream->stats.stream.nb_frames,
+			   stream->stats.stream.nb_packets,
+			   stream->stats.stream.nb_empty,
+			   stream->stats.stream.nb_errors,
+			   stream->stats.stream.nb_invalid);
+
+	return count;
+}
+
+static void uvc_video_stats_start(struct uvc_streaming *stream)
+{
+	memset(&stream->stats, 0, sizeof(stream->stats));
+}
+
+static void uvc_video_stats_stop(struct uvc_streaming *stream)
+{
+	ktime_get_ts(&stream->stats.stream.stop_ts);
+}
+
+/* ------------------------------------------------------------------------
  * Video codecs
  */
 
@@ -401,6 +501,8 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
 {
 	__u8 fid;
 
+	uvc_video_stats_decode(stream, data, len);
+
 	/* Sanity checks:
 	 * - packet must be at least 2 bytes long
 	 * - bHeaderLength value must be at least 2 bytes (see above)
@@ -414,8 +516,11 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
 	/* Increase the sequence number regardless of any buffer states, so
 	 * that discontinuous sequence numbers always indicate lost frames.
 	 */
-	if (stream->last_fid != fid)
+	if (stream->last_fid != fid) {
 		stream->sequence++;
+		if (stream->sequence)
+			uvc_video_stats_update(stream);
+	}
 
 	/* Store the payload FID bit and return immediately when the buffer is
 	 * NULL.
@@ -860,6 +965,8 @@ static void uvc_uninit_video(struct uvc_streaming *stream, int free_buffers)
 	struct urb *urb;
 	unsigned int i;
 
+	uvc_video_stats_stop(stream);
+
 	for (i = 0; i < UVC_URBS; ++i) {
 		urb = stream->urb[i];
 		if (urb == NULL)
@@ -999,6 +1106,8 @@ static int uvc_init_video(struct uvc_streaming *stream, gfp_t gfp_flags)
 	stream->bulk.skip_payload = 0;
 	stream->bulk.payload_size = 0;
 
+	uvc_video_stats_start(stream);
+
 	if (intf->num_altsetting > 1) {
 		struct usb_host_endpoint *best_ep = NULL;
 		unsigned int best_psize = 3 * 1024;
diff --git a/drivers/media/video/uvc/uvcvideo.h b/drivers/media/video/uvc/uvcvideo.h
index 2d45e58..e2da57b 100644
--- a/drivers/media/video/uvc/uvcvideo.h
+++ b/drivers/media/video/uvc/uvcvideo.h
@@ -356,6 +356,28 @@ struct uvc_video_chain {
 	struct mutex ctrl_mutex;		/* Protects ctrl.info */
 };
 
+struct uvc_stats_frame {
+	unsigned int size;		/* Number of bytes captured */
+	unsigned int first_data;	/* Index of the first non-empty packet */
+
+	unsigned int nb_packets;	/* Number of packets */
+	unsigned int nb_empty;		/* Number of empty packets */
+	unsigned int nb_invalid;	/* Number of packets with an invalid header */
+	unsigned int nb_errors;		/* Number of packets with the error bit set */
+};
+
+struct uvc_stats_stream {
+	struct timespec start_ts;	/* Stream start timestamp */
+	struct timespec stop_ts;	/* Stream stop timestamp */
+
+	unsigned int nb_frames;		/* Number of frames */
+
+	unsigned int nb_packets;	/* Number of packets */
+	unsigned int nb_empty;		/* Number of empty packets */
+	unsigned int nb_invalid;	/* Number of packets with an invalid header */
+	unsigned int nb_errors;		/* Number of packets with the error bit set */
+};
+
 struct uvc_streaming {
 	struct list_head list;
 	struct uvc_device *dev;
@@ -406,6 +428,10 @@ struct uvc_streaming {
 
 	/* debugfs */
 	struct dentry *debugfs_dir;
+	struct {
+		struct uvc_stats_frame frame;
+		struct uvc_stats_stream stream;
+	} stats;
 };
 
 enum uvc_device_state {
@@ -477,6 +503,7 @@ struct uvc_driver {
 #define UVC_TRACE_SUSPEND	(1 << 8)
 #define UVC_TRACE_STATUS	(1 << 9)
 #define UVC_TRACE_VIDEO		(1 << 10)
+#define UVC_TRACE_STATS		(1 << 11)
 
 #define UVC_WARN_MINMAX		0
 #define UVC_WARN_PROBE_DEF	1
@@ -608,10 +635,13 @@ extern struct usb_host_endpoint *uvc_find_endpoint(
 void uvc_video_decode_isight(struct urb *urb, struct uvc_streaming *stream,
 		struct uvc_buffer *buf);
 
-/* debugfs */
+/* debugfs and statistics */
 int uvc_debugfs_init(void);
 void uvc_debugfs_cleanup(void);
 int uvc_debugfs_init_stream(struct uvc_streaming *stream);
 void uvc_debugfs_cleanup_stream(struct uvc_streaming *stream);
 
+size_t uvc_video_stats_dump(struct uvc_streaming *stream, char *buf,
+			    size_t size);
+
 #endif
-- 
1.7.3.4



From ajay.bhargav at einfochips.com  Fri Nov  4 06:38:20 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Fri, 4 Nov 2011 11:08:20 +0530 (IST)
Subject: [Linux-uvc-devel] Annoying HTTPS in link to list archive.
In-Reply-To: <201111031013.51582.laurent.pinchart@ideasonboard.com>
Message-ID: <1404547628.300477.1320385100896.JavaMail.root@ahm.einfochips.com>


----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:

> Hi,
> 
> On Friday 30 September 2011 22:41:29 Kaz Kylheku wrote:
> > Hi all,
> > 
> > If you view this list's page (note the HTTP here)
> > 
> > http://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> > 
> > the link which it gives to the list archives is HTTPS!
> > 
> > Because of this stupidity, Google has indexed this list using HTTPS
> > URLs.
> > You have to accept the self-signed security certificate when you
> > navigate to the archive pages from a Google search result.
> > 
> > Can someone fix that?
> 
> I have no control over the link to the archives in 
> http://lists.berlios.de/mailman/listinfo/linux-uvc-devel. I could ask
> Google 
> to remove the https:// URLs from its cache, but they will come back
> anyway, so 
> it's a bit pointless.
> 
> Berlios will close at the end of the year and the mailing list will
> move 
> elsewhere, hopefully fixing the problem.
> 
> -- 
> Regards,
> 
> Laurent Pinchart

You can put a redirect in your .htaccess file if someone tries to access https links then he/she will be redirected to http://... Put a permanent redirect so that google will automatically remove all the https links from its cache. Hope this is helpful :)

Regards,
Ajay Bhargav


From kaz at kylheku.com  Fri Nov  4 06:55:12 2011
From: kaz at kylheku.com (Kaz Kylheku)
Date: Thu, 03 Nov 2011 22:55:12 -0700
Subject: [Linux-uvc-devel] Working with Logitech B990: Issues.
In-Reply-To: <201111031154.55972.laurent.pinchart@ideasonboard.com>
References: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
	<201111031154.55972.laurent.pinchart@ideasonboard.com>
Message-ID: <f9269cd46fbea61ae8b7d1d26a51af40@127.0.0.1>


On Thu, 3 Nov 2011 11:54:55 +0100, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
> On Thursday 03 November 2011 02:20:30 Kaz Kylheku wrote:
>> Secondly, after some period of running, the USB controller throws up an
>> over-current error, and then the device is not usable without a reboot.
>> Maybe this big sucker really draws too much current?
> 
> That's not impossible. At least one Logitech webcam actually runs Linux 
> embedded in the device (see https://opensource.logitech.com/logitech/), the 
> B990 might as well. This could explain why the current consumption is higher 
> than with microcontroller-based cameras.

Hi Laurent,

It's behaving itself now in this regard, after being proxied through
a powered USB hub.

>> Usually I am not able to two consecutive successful opens of the
>> device.

Closing and re-opening instability also seems to have gone away.



From bug-track at fisher-privat.net  Fri Nov  4 09:19:45 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 04 Nov 2011 09:19:45 +0100
Subject: [Linux-uvc-devel] [PATCH 1/2] uvcvideo: Add debugfs support
In-Reply-To: <1320337641-27084-2-git-send-email-laurent.pinchart@ideasonboard.com>
References: <4E7983BA.7010103@fisher-privat.net>
	<1320337641-27084-2-git-send-email-laurent.pinchart@ideasonboard.com>
Message-ID: <4EB3A021.2040801@fisher-privat.net>

Am 03.11.2011 17:27, schrieb Laurent Pinchart:
> Create a debugfs entry per UVC stream. This will be used to export
> stream statistics.
>
> Signed-off-by: Laurent Pinchart<laurent.pinchart at ideasonboard.com>

Ok, i see you made it in mind more fore online statistic. I wonted to 
make it more for postmortum trouble shooting. For example i added start 
time and time of first frame because some apps make problems if cam 
starting too slow. I also added time of first error_bit and so. 
(probably not in the patch i send you before)
The question is, do you wont to make separate files for verbose report 
and for statistic?
My idea is, if some body has some problem with the cam, instead of 
telling reload module with ...blabla... i can just tell: reproduce the 
error and send me content of /sys/debug...bla ...
You know what i mean?
For example we can add firs usb error we got and time stamp of it, to 
make it more computer forensic friendly :)

So if you prefer to make separate files i give my SoB :)

Signed-off-by: Alexey Fisher <bug-track at fisher-privat.net>


From bug-track at fisher-privat.net  Fri Nov  4 09:20:13 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 04 Nov 2011 09:20:13 +0100
Subject: [Linux-uvc-devel] [PATCH 2/2] uvcvideo: Extract video stream
	statistics
In-Reply-To: <1320337641-27084-3-git-send-email-laurent.pinchart@ideasonboard.com>
References: <4E7983BA.7010103@fisher-privat.net>
	<1320337641-27084-3-git-send-email-laurent.pinchart@ideasonboard.com>
Message-ID: <4EB3A03D.4020406@fisher-privat.net>

Am 03.11.2011 17:27, schrieb Laurent Pinchart:
> Export the statistics through debugfs.
>
> Signed-off-by: Laurent Pinchart<laurent.pinchart at ideasonboard.com>


Signed-off-by: Alexey Fisher <bug-track at fisher-privat.net>


From laurent.pinchart at ideasonboard.com  Fri Nov  4 10:57:05 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Fri, 4 Nov 2011 10:57:05 +0100
Subject: [Linux-uvc-devel] Annoying HTTPS in link to list archive.
In-Reply-To: <1404547628.300477.1320385100896.JavaMail.root@ahm.einfochips.com>
References: <1404547628.300477.1320385100896.JavaMail.root@ahm.einfochips.com>
Message-ID: <201111041057.07129.laurent.pinchart@ideasonboard.com>

Hi Ajay,

On Friday 04 November 2011 06:38:20 Ajay Bhargav wrote:
> ----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:
> > On Friday 30 September 2011 22:41:29 Kaz Kylheku wrote:
> > > Hi all,
> > > 
> > > If you view this list's page (note the HTTP here)
> > > 
> > > http://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> > > 
> > > the link which it gives to the list archives is HTTPS!
> > > 
> > > Because of this stupidity, Google has indexed this list using HTTPS
> > > URLs.
> > > You have to accept the self-signed security certificate when you
> > > navigate to the archive pages from a Google search result.
> > > 
> > > Can someone fix that?
> > 
> > I have no control over the link to the archives in
> > http://lists.berlios.de/mailman/listinfo/linux-uvc-devel. I could ask
> > Google to remove the https:// URLs from its cache, but they will come back
> > anyway, so it's a bit pointless.
> > 
> > Berlios will close at the end of the year and the mailing list will
> > move elsewhere, hopefully fixing the problem.
> 
> You can put a redirect in your .htaccess file if someone tries to access
> https links then he/she will be redirected to http://... Put a permanent
> redirect so that google will automatically remove all the https links from
> its cache. Hope this is helpful :)

The problem is that I have no control over lists.berlios.de. I can't modify 
the .htaccess file.

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Fri Nov  4 11:23:51 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Fri, 4 Nov 2011 11:23:51 +0100
Subject: [Linux-uvc-devel] [PATCH 1/2] uvcvideo: Add debugfs support
In-Reply-To: <4EB3A021.2040801@fisher-privat.net>
References: <4E7983BA.7010103@fisher-privat.net>
	<1320337641-27084-2-git-send-email-laurent.pinchart@ideasonboard.com>
	<4EB3A021.2040801@fisher-privat.net>
Message-ID: <201111041123.52339.laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Friday 04 November 2011 09:19:45 Alexey Fisher wrote:
> Am 03.11.2011 17:27, schrieb Laurent Pinchart:
> > Create a debugfs entry per UVC stream. This will be used to export
> > stream statistics.
> > 
> > Signed-off-by: Laurent Pinchart<laurent.pinchart at ideasonboard.com>
> 
> Ok, i see you made it in mind more fore online statistic. I wonted to
> make it more for postmortum trouble shooting. For example i added start
> time and time of first frame because some apps make problems if cam
> starting too slow. I also added time of first error_bit and so.
> (probably not in the patch i send you before)

It's indeed not in the latest patch I've got.

> The question is, do you wont to make separate files for verbose report
> and for statistic?
> My idea is, if some body has some problem with the cam, instead of
> telling reload module with ...blabla... i can just tell: reproduce the
> error and send me content of /sys/debug...bla ...
> You know what i mean?
> For example we can add firs usb error we got and time stamp of it, to
> make it more computer forensic friendly :)

That sounds like a good idea to me. The real question will then be to pick 
what information to report. Things like the selected alternate setting and the 
bandwidth requested by the camera are very important for instance.

I'd like that to be exposed through a separate file, as that information isn't 
really statistics. Are you OK with such an approach ?

> So if you prefer to make separate files i give my SoB :)
> 
> Signed-off-by: Alexey Fisher <bug-track at fisher-privat.net>

-- 
Regards,

Laurent Pinchart


From bug-track at fisher-privat.net  Fri Nov  4 12:14:22 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 04 Nov 2011 12:14:22 +0100
Subject: [Linux-uvc-devel] [PATCH 1/2] uvcvideo: Add debugfs support
In-Reply-To: <201111041123.52339.laurent.pinchart@ideasonboard.com>
References: <4E7983BA.7010103@fisher-privat.net>
	<1320337641-27084-2-git-send-email-laurent.pinchart@ideasonboard.com>
	<4EB3A021.2040801@fisher-privat.net>
	<201111041123.52339.laurent.pinchart@ideasonboard.com>
Message-ID: <4EB3C90E.5050904@fisher-privat.net>

Am 04.11.2011 11:23, schrieb Laurent Pinchart:
> Hi Alexey,
>
> On Friday 04 November 2011 09:19:45 Alexey Fisher wrote:
>> Am 03.11.2011 17:27, schrieb Laurent Pinchart:
>>> Create a debugfs entry per UVC stream. This will be used to export
>>> stream statistics.
>>>
>>> Signed-off-by: Laurent Pinchart<laurent.pinchart at ideasonboard.com>
>>
>> Ok, i see you made it in mind more fore online statistic. I wonted to
>> make it more for postmortum trouble shooting. For example i added start
>> time and time of first frame because some apps make problems if cam
>> starting too slow. I also added time of first error_bit and so.
>> (probably not in the patch i send you before)
>
> It's indeed not in the latest patch I've got.
>
>> The question is, do you wont to make separate files for verbose report
>> and for statistic?
>> My idea is, if some body has some problem with the cam, instead of
>> telling reload module with ...blabla... i can just tell: reproduce the
>> error and send me content of /sys/debug...bla ...
>> You know what i mean?
>> For example we can add firs usb error we got and time stamp of it, to
>> make it more computer forensic friendly :)
>
> That sounds like a good idea to me. The real question will then be to pick
> what information to report. Things like the selected alternate setting and the
> bandwidth requested by the camera are very important for instance.
>
> I'd like that to be exposed through a separate file, as that information isn't
> really statistics. Are you OK with such an approach ?

OK :)



From cheshirekow at gmail.com  Fri Nov  4 13:46:36 2011
From: cheshirekow at gmail.com (cheshirekow)
Date: Fri, 04 Nov 2011 08:46:36 -0400
Subject: [Linux-uvc-devel] Dual sensor, single controller, one USB Device
In-Reply-To: <201111021738.25161.laurent.pinchart@ideasonboard.com>
References: <1319212248.30755.135@hogo> <1319817669.32254.21.camel@Nadie>
	<4EABAB7C.2070709@fisher-privat.net>
	<201111021738.25161.laurent.pinchart@ideasonboard.com>
Message-ID: <1320410796.24915.6.camel@Nadie>

On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
> Hi,
> 
> On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
> > Am 28.10.2011 18:01, schrieb cheshirekow:
> > > On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
> > >> On 10/22/2011 03:16 AM, Alexey Fisher wrote:
> > >>> Can you please attach the output of this command:
> > >>> lsusb -vd 10f1:1a26>  lsusb_dump
> > >> 
> > >> Sure. The dump file is attached.
> > >> 
> > >> Thanks!
> > > 
> > > Has anyone by chance managed to take a look at this lsusb dump?
> > > 
> > > To recap:
> > > the HP Slate has two integrated we cams: One forward facing for video
> > > calls, and one higher-resolution rear-facing for snapping photos. There
> > > appears to be a single controller for both cameras. In linux, lsusb only
> > > shows one webcam device. In windows, the device manager also shows only
> > > one device for the webcam. However, in windows applications that use the
> > > webcam (i.e. HP's webcam application, and in skype) I'm able to select
> > > which one to use as an option. In linux, there is only one video
> > > device, /dev/video0.
> > > 
> > > There does not appear to be any control available from uvcdynctrl or
> > > within vlc to select which physical camera to use. I've tried setting
> > > the resolution in vlc when I use the "open capture device" menu item. I
> > > know that the forward facing camera is VGA so I tried specifying
> > > 640x480, but the result is that it shows the rear-camera stream at a low
> > > resolution, rather then showing the forward-camera stream.
> > > 
> > > I'd appreciate any suggestions on how to get the forward-facing camera
> > > to work in linux (for skype/google video calls). Also, if it is clear
> > > that this facility is not available in UVC and that there is no way this
> > > is possilble, that would also be useful information.
> > > 
> > > Thanks again
> > 
> > Hi,
> > 
> > suddenly i do not see any control to switch the sensor. I assume there
> > can be two variants how it may work:
> > 1. vendor specific extension unit for uvc
> > 2. or usb mode switcher
> > 
> > if both sensors have same capabilities, the 1. make sense. If not then
> > second. Because this usb dump report settings only for one sensor.
> > 
> > For 1. it will be probably possible to control it with libwebcam. For 2.
> > it should be possible to control it with some kind of usb_modeswitch
> > (i'm not up to date).
> > 
> > To find what it is actually, there can be fallowing options:
> > 1. sniff usb traffic
> > 2. see if the windows driver has some advise for us
> > 3. unscrew your laptop and find what control use your webcam.
> 
> My guess is that the camera uses either an extension unit (XU) control or a 
> vendor-specific request to select between the two sensors (which is very 
> unfortunate, given that the UVC specification has explicit support for dual-
> sensor cameras, and I would have liked to test that code :-)).

Thanks for the information. It is unfortunate that the camera doesn't
take advantage of what is already in the spec.

> Let's start with the XU control. I've attached a patch for the yavta test 
> application (http://git.ideasonboard.org/?p=yavta.git;a=summary) to this e-
> mail. Could you please apply it, compile the application with

Ok sure. I downloaded the test, applied the patch, and ran it with the
following output:

Device /dev/video0 opened.
Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
XU control 0: info GET SET (0x03) 2 bytes
XU control 1: info GET SET (0x03) 64 bytes
XU control 2: info GET SET (0x03) 64 bytes
XU control 3: info GET SET (0x03) 2 bytes
XU control 4: info GET SET (0x03) 2 bytes
XU control 5: info GET SET (0x03) 2 bytes
XU control 6: info GET SET (0x03) 2 bytes
XU control 7: info GET SET (0x03) 2 bytes
Video format: YUYV (56595559) 640x480 buffer size 614400



From laurent.pinchart at ideasonboard.com  Fri Nov  4 14:44:41 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Fri, 4 Nov 2011 14:44:41 +0100
Subject: [Linux-uvc-devel] Dual sensor, single controller, one USB Device
In-Reply-To: <1320410796.24915.6.camel@Nadie>
References: <1319212248.30755.135@hogo>
	<201111021738.25161.laurent.pinchart@ideasonboard.com>
	<1320410796.24915.6.camel@Nadie>
Message-ID: <201111041444.42202.laurent.pinchart@ideasonboard.com>

Hi,

On Friday 04 November 2011 13:46:36 cheshirekow wrote:
> On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
> > On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
> > > Am 28.10.2011 18:01, schrieb cheshirekow:
> > > > On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
> > > >> On 10/22/2011 03:16 AM, Alexey Fisher wrote:
> > > >>> Can you please attach the output of this command:
> > > >>> lsusb -vd 10f1:1a26>  lsusb_dump
> > > >> 
> > > >> Sure. The dump file is attached.
> > > >> 
> > > >> Thanks!
> > > > 
> > > > Has anyone by chance managed to take a look at this lsusb dump?
> > > > 
> > > > To recap:
> > > > the HP Slate has two integrated we cams: One forward facing for video
> > > > calls, and one higher-resolution rear-facing for snapping photos.
> > > > There appears to be a single controller for both cameras. In linux,
> > > > lsusb only shows one webcam device. In windows, the device manager
> > > > also shows only one device for the webcam. However, in windows
> > > > applications that use the webcam (i.e. HP's webcam application, and
> > > > in skype) I'm able to select which one to use as an option. In
> > > > linux, there is only one video device, /dev/video0.
> > > > 
> > > > There does not appear to be any control available from uvcdynctrl or
> > > > within vlc to select which physical camera to use. I've tried setting
> > > > the resolution in vlc when I use the "open capture device" menu item.
> > > > I know that the forward facing camera is VGA so I tried specifying
> > > > 640x480, but the result is that it shows the rear-camera stream at a
> > > > low resolution, rather then showing the forward-camera stream.
> > > > 
> > > > I'd appreciate any suggestions on how to get the forward-facing
> > > > camera to work in linux (for skype/google video calls). Also, if it
> > > > is clear that this facility is not available in UVC and that there
> > > > is no way this is possilble, that would also be useful information.
> > > > 
> > > > Thanks again
> > > 
> > > Hi,
> > > 
> > > suddenly i do not see any control to switch the sensor. I assume there
> > > can be two variants how it may work:
> > > 1. vendor specific extension unit for uvc
> > > 2. or usb mode switcher
> > > 
> > > if both sensors have same capabilities, the 1. make sense. If not then
> > > second. Because this usb dump report settings only for one sensor.
> > > 
> > > For 1. it will be probably possible to control it with libwebcam. For
> > > 2. it should be possible to control it with some kind of
> > > usb_modeswitch (i'm not up to date).
> > > 
> > > To find what it is actually, there can be fallowing options:
> > > 1. sniff usb traffic
> > > 2. see if the windows driver has some advise for us
> > > 3. unscrew your laptop and find what control use your webcam.
> > 
> > My guess is that the camera uses either an extension unit (XU) control or
> > a vendor-specific request to select between the two sensors (which is
> > very unfortunate, given that the UVC specification has explicit support
> > for dual- sensor cameras, and I would have liked to test that code :-)).
> 
> Thanks for the information. It is unfortunate that the camera doesn't
> take advantage of what is already in the spec.
> 
> > Let's start with the XU control. I've attached a patch for the yavta test
> > application (http://git.ideasonboard.org/?p=yavta.git;a=summary) to this
> > e- mail. Could you please apply it, compile the application with
> 
> Ok sure. I downloaded the test, applied the patch, and ran it with the
> following output:
> 
> Device /dev/video0 opened.
> Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
> XU control 0: info GET SET (0x03) 2 bytes
> XU control 1: info GET SET (0x03) 64 bytes
> XU control 2: info GET SET (0x03) 64 bytes
> XU control 3: info GET SET (0x03) 2 bytes
> XU control 4: info GET SET (0x03) 2 bytes
> XU control 5: info GET SET (0x03) 2 bytes
> XU control 6: info GET SET (0x03) 2 bytes
> XU control 7: info GET SET (0x03) 2 bytes
> Video format: YUYV (56595559) 640x480 buffer size 614400

Those XU controls seem to be quite generic, and are found in other webcams 
that use the same chipset. They probably allow direct access to the sensor and 
bridge registers.

More information will be needed to find out how to select the sensor. I'm 
afraid USB sniffing in windows seems to be unavoidable. I will need a trace of 
all USB control requests (if your USB sniffer allows filtering out the 
isochronous transfers, please do so) sent to the device when you switch from 
one sensor to the other one.

-- 
Regards,

Laurent Pinchart


From vickylinuxer at gmail.com  Sat Nov  5 14:20:34 2011
From: vickylinuxer at gmail.com (vignesh rajendran)
Date: Sat, 5 Nov 2011 13:20:34 +0000
Subject: [Linux-uvc-devel] camera problem
Message-ID: <CALoDM-GTFXkaABnvnBUj-xQvdR6wO5521Aw7nnvcFcW_mVbqEQ@mail.gmail.com>

Hi all

 I am in embedded linux and facing a problem with Z-star electronics camera
having the id  "0acda:3430".

 When testing with mplayer ,  I am getting following error,

# mplayer tv:// -tv
driver=v4l2:width=320:height=220:device=/dev/video0:noaudio
-flip -vo fbdev2 -fs 30
MPlayer UNKNOWN-4.6.1 (C) 2000-2010 MPlayer Team

Playing tv://.
TV file format detected.
Selected driver: v4l2
 name: Video 4 Linux 2 input
 author: Martin Olschewski <olschewski at zpr.uni-koeln.de>
 comment: first try, more to come ;-)
v4l2: your device driver does not support VIDIOC_G_STD ioctl, VIDIOC_G_PARM
was used instead.
Selected device: NAMUGA 1.3M Webcam
 Capabilities:  video capture  streaming
 supported norms:
 inputs: 0 = Camera 1;
 Current input: 0
 Current format: YUYV
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
tv.c: norm_from_string(pal): Bogus norm parameter, setting default.
v4l2: ioctl enum norm failed: Invalid argument
Error: Cannot set norm!
Selected input hasn't got a tuner!
v4l2: ioctl set mute failed: Invalid argument
v4l2: ioctl query control failed: Invalid argument
v4l2: select timeout
==========================================================================
Opening video decoder: [raw] RAW Uncompressed Video
Could not find matching colorspace - retrying with -vf scale...
Opening video filter: [scale]
[fbdev2] Can't put VSCREENINFO: Invalid argument
[fbdev2] Can't put VSCREENINFO: Invalid argument
Opening video filter: [flip]
Movie-Aspect is undefined - no prescaling applied.
[fbdev2] Can't put VSCREENINFO: Invalid argument
[fbdev2] Can't put VSCREENINFO: Invalid argument
[swscaler @ 0x21f77d0] BICUBIC scaler, from yuyv422 to rgb555le using C
VO: [fbdev2] 320x240 => 320x240 BGR 15-bit  [fs]
Selected video codec: [rawyuy2] vfm: raw (RAW YUY2)
==========================================================================
Audio: no sound
Starting playback...
v4l2: select timeout
V:   0.0   1/  1 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
V:   0.0   2/  2 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
V:   0.0   3/  3 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout


MPlayer interrupted by signal 2 in module: video_read_frame
V:   0.0   4/  4 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
v4l2: ioctl set mute failed: Invalid argument
v4l2: 0 frames successfully processed, 1 frames dropped.

Exiting... (Quit)

I am getting v4l2: select timeout repeatedly.I am using 3.0 kernel.

And my another camera Namuga(0ac8:c335) is working fine

Please help me out of this.

Regards
Vignesh Rajendran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111105/c0a98244/attachment.html>

From roberto.lionello at gmail.com  Sun Nov  6 05:50:03 2011
From: roberto.lionello at gmail.com (Roberto Lionello)
Date: Sat, 5 Nov 2011 21:50:03 -0700
Subject: [Linux-uvc-devel] Problem with webcam
Message-ID: <CAPVaGO6iMtyS2VSWNSijPG7PjKUhjt32d-r5CLDGSzAAP+-XBA@mail.gmail.com>

Hi,

I'm running Debian Squeeze (kernel 2.6.32-5-xen-686) on my Dell Mini 9,
which has the following camera:

[  242.005696] uvcvideo: Found UVC 1.00 device Integrated Webcam (064e:a118)
[  242.022709] input: Integrated Webcam as
/devices/pci0000:00/0000:00:1d.7/usb1/1-2/1-2:1.0/input/input11

When I try to record from the webcam using

ffmpeg -f video4linux2 -s 640x480 -i /dev/video0 -r 30 -f avi -vcodec mpeg4
-vtag xvid -sameq -f alsa -ac 2 -i hw:0,0 -acodec libmp3lame -loglevel
debug webcam.avi

it works for a while but eventually I get this error:

video:1103012kB audio:19552kB global headers:0kB muxing overhead 0.464303%
Received signal 2: terminating.

In the past it used to work without problems.
I tried other programs with similar results. I was wondering whether it is
a problem with uvc, with other software, or with my hardware.
Many thanks!

Cheers,

RL

-- 
+ Non nobis, Domine, non nobis, sed nomini tuo da gloriam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111105/a43c23cd/attachment.html>

From helbert2a at gmail.com  Mon Nov  7 00:46:14 2011
From: helbert2a at gmail.com (Edwin Aponte)
Date: Sun, 06 Nov 2011 23:46:14 +0000
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
Message-ID: <1320623174.9537.5.camel@edwinaponteL.WORKGROUP>

Well, the camera works well with luvcview. It doesn't report any error.

With regard to the test in a network, I will try later when I will be
connected.

Thanks.



On Fri, 2011-10-21 at 23:36 +0100, Edwin Aponte wrote:
> libv4l2 is giving having problems with a Microsoft LifeCam NX-6000
> webcam (045e:00f8). I have to run skype as below to get the webcam
> working well for a moment, though an error is generated, until the
> system freezes completely after some minutes and even SysRq doesn't
> work.
> 
> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype 
> libv4l2: error converting / decoding frame data: v4l-convert: error
> parsing
> JPEG header: Not a JPG file ?
> 
> Sometimes, I get the same error with the program webcam:
> --------------------------
> ~> webcam 
> reading config file: /home/edwinh/.webcamrc
> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> grabber config:
>   size 320x240 [none]
>   input (null), norm (null), jpeg quality 75
>   rotate=0, top=0, left=0, bottom=240, right=320
> libv4l2: error converting / decoding frame data: v4l-convert: error
> parsing
> JPEG header: Not a JPG file ?
> 
> 
> v4l2: read: Input/output error
> capturing image failed
> -------------------------
> 
> and some times this other error:
> 
> -------------------------
> ~> webcam
> reading config file: /home/edwinh/.webcamrc
> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> grabber config:
>   size 320x240 [none]
>   input (null), norm (null), jpeg quality 75
>   rotate=0, top=0, left=0, bottom=240, right=320
> libv4lconvert: Error decompressing JPEG: fill_nbits error: need 1 more
> bits
> -------------------------
> 
> I have attached some information based on this thread
> http://lists.berlios.de/pipermail/linux-uvc-devel/2008-November/004265.html
> that seems to be a similar case of my problem.
> I set the trace level to 255:
> 
> # echo 255 > /sys/module/uvcvideo/parameters/trace
> 
> and I record a frame using:
> ~> luvcview -f mjpg -c
> 
> and after that I saved the output of dmesg.
> 
> Thanks.




From vickylinuxer at gmail.com  Mon Nov  7 05:46:00 2011
From: vickylinuxer at gmail.com (vignesh rajendran)
Date: Mon, 7 Nov 2011 04:46:00 +0000
Subject: [Linux-uvc-devel] z-star camera problem
Message-ID: <CALoDM-HFeL_ZPYC8-ur8DvNQHvg=saRu9ddNEdb-4u3vXVv_vQ@mail.gmail.com>

Hi

   I am using 3.0 kernel in embedded linux for armv5tel platform. I am
facing problem with  ID 0ac8:c335 Z-Star Microelectronics Corp.When testing
with mplayer, It repeats "v4l2:Select timeout" continuously and getting
green display.I googled this problem and i couldnt find any valid solutions.

 Any ideas.?


Regards
Vignesh Rajendran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111107/4cc52203/attachment.html>

From vickylinuxer at gmail.com  Mon Nov  7 06:06:07 2011
From: vickylinuxer at gmail.com (vignesh rajendran)
Date: Mon, 7 Nov 2011 05:06:07 +0000
Subject: [Linux-uvc-devel] Z-star Camera Problem
Message-ID: <CALoDM-HxUD65__eZxwsaMkijSruw9mXKEoDF17BkgBCeVoOVag@mail.gmail.com>

Hi all

 I am in embedded linux and facing a problem with Z-star electronics camera
having the id  "0acda:3430".

 When testing with mplayer ,  I am getting following error,

# mplayer tv:// -tv
driver=v4l2:width=320:height=220:device=/dev/video0:noaudio
-flip -vo fbdev2 -fs 30
MPlayer UNKNOWN-4.6.1 (C) 2000-2010 MPlayer Team

Playing tv://.
TV file format detected.
Selected driver: v4l2
 name: Video 4 Linux 2 input
 author: Martin Olschewski <olschewski at zpr.uni-koeln.de>
 comment: first try, more to come ;-)
v4l2: your device driver does not support VIDIOC_G_STD ioctl, VIDIOC_G_PARM
was used instead.
Selected device: NAMUGA 1.3M Webcam
 Capabilities:  video capture  streaming
 supported norms:
 inputs: 0 = Camera 1;
 Current input: 0
 Current format: YUYV
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
tv.c: norm_from_string(pal): Bogus norm parameter, setting default.
v4l2: ioctl enum norm failed: Invalid argument
Error: Cannot set norm!
Selected input hasn't got a tuner!
v4l2: ioctl set mute failed: Invalid argument
v4l2: ioctl query control failed: Invalid argument
v4l2: select timeout
==========================================================================
Opening video decoder: [raw] RAW Uncompressed Video
Could not find matching colorspace - retrying with -vf scale...
Opening video filter: [scale]
[fbdev2] Can't put VSCREENINFO: Invalid argument
[fbdev2] Can't put VSCREENINFO: Invalid argument
Opening video filter: [flip]
Movie-Aspect is undefined - no prescaling applied.
[fbdev2] Can't put VSCREENINFO: Invalid argument
[fbdev2] Can't put VSCREENINFO: Invalid argument
[swscaler @ 0x21f77d0] BICUBIC scaler, from yuyv422 to rgb555le using C
VO: [fbdev2] 320x240 => 320x240 BGR 15-bit  [fs]
Selected video codec: [rawyuy2] vfm: raw (RAW YUY2)
==========================================================================
Audio: no sound
Starting playback...
v4l2: select timeout
V:   0.0   1/  1 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
V:   0.0   2/  2 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
V:   0.0   3/  3 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout


MPlayer interrupted by signal 2 in module: video_read_frame
V:   0.0   4/  4 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
v4l2: ioctl set mute failed: Invalid argument
v4l2: 0 frames successfully processed, 1 frames dropped.

Exiting... (Quit)

I am getting v4l2: select timeout repeatedly.I am using 3.0 kernel.

And my another camera Namuga(0ac8:c335) is working fine

Please help me out of this.

Regards
Vignesh Rajendran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111107/5b6d8326/attachment.html>

From laurent.pinchart at ideasonboard.com  Mon Nov  7 17:29:41 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Mon, 7 Nov 2011 17:29:41 +0100
Subject: [Linux-uvc-devel] Dual sensor, single controller, one USB Device
In-Reply-To: <1320433523.24915.57.camel@Nadie>
References: <1319212248.30755.135@hogo>
	<201111041444.42202.laurent.pinchart@ideasonboard.com>
	<1320433523.24915.57.camel@Nadie>
Message-ID: <201111071729.42351.laurent.pinchart@ideasonboard.com>

Hi,

On Friday 04 November 2011 20:05:23 cheshirekow wrote:
> On Fri, 2011-11-04 at 14:44 +0100, Laurent Pinchart wrote:
> > On Friday 04 November 2011 13:46:36 cheshirekow wrote:
> > > On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
> > > > On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
> > > > > Am 28.10.2011 18:01, schrieb cheshirekow:
> > > > > > On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
> > > > > >> On 10/22/2011 03:16 AM, Alexey Fisher wrote:
> > > > > >>> Can you please attach the output of this command:
> > > > > >>> lsusb -vd 10f1:1a26>  lsusb_dump
> > > > > >> 
> > > > > >> Sure. The dump file is attached.
> > > > > >> 
> > > > > >> Thanks!
> > > > > > 
> > > > > > Has anyone by chance managed to take a look at this lsusb dump?
> > > > > > 
> > > > > > To recap:
> > > > > > the HP Slate has two integrated we cams: One forward facing for
> > > > > > video calls, and one higher-resolution rear-facing for snapping
> > > > > > photos. There appears to be a single controller for both
> > > > > > cameras. In linux, lsusb only shows one webcam device. In
> > > > > > windows, the device manager also shows only one device for the
> > > > > > webcam. However, in windows applications that use the webcam
> > > > > > (i.e. HP's webcam application, and in skype) I'm able to select
> > > > > > which one to use as an option. In linux, there is only one video
> > > > > > device, /dev/video0.
> > > > > > 
> > > > > > There does not appear to be any control available from uvcdynctrl
> > > > > > or within vlc to select which physical camera to use. I've tried
> > > > > > setting the resolution in vlc when I use the "open capture
> > > > > > device" menu item. I know that the forward facing camera is VGA
> > > > > > so I tried specifying 640x480, but the result is that it shows
> > > > > > the rear-camera stream at a low resolution, rather then showing
> > > > > > the forward-camera stream.
> > > > > > 
> > > > > > I'd appreciate any suggestions on how to get the forward-facing
> > > > > > camera to work in linux (for skype/google video calls). Also, if
> > > > > > it is clear that this facility is not available in UVC and that
> > > > > > there is no way this is possilble, that would also be useful
> > > > > > information.
> > > > > > 
> > > > > > Thanks again
> > > > > 
> > > > > Hi,
> > > > > 
> > > > > suddenly i do not see any control to switch the sensor. I assume
> > > > > there can be two variants how it may work:
> > > > > 1. vendor specific extension unit for uvc
> > > > > 2. or usb mode switcher
> > > > > 
> > > > > if both sensors have same capabilities, the 1. make sense. If not
> > > > > then second. Because this usb dump report settings only for one
> > > > > sensor.
> > > > > 
> > > > > For 1. it will be probably possible to control it with libwebcam.
> > > > > For 2. it should be possible to control it with some kind of
> > > > > usb_modeswitch (i'm not up to date).
> > > > > 
> > > > > To find what it is actually, there can be fallowing options:
> > > > > 1. sniff usb traffic
> > > > > 2. see if the windows driver has some advise for us
> > > > > 3. unscrew your laptop and find what control use your webcam.
> > > > 
> > > > My guess is that the camera uses either an extension unit (XU)
> > > > control or a vendor-specific request to select between the two
> > > > sensors (which is very unfortunate, given that the UVC specification
> > > > has explicit support for dual- sensor cameras, and I would have
> > > > liked to test that code :-)).
> > > 
> > > Thanks for the information. It is unfortunate that the camera doesn't
> > > take advantage of what is already in the spec.
> > > 
> > > > Let's start with the XU control. I've attached a patch for the yavta
> > > > test application
> > > > (http://git.ideasonboard.org/?p=yavta.git;a=summary) to this e-
> > > > mail. Could you please apply it, compile the application with
> > > 
> > > Ok sure. I downloaded the test, applied the patch, and ran it with the
> > > following output:
> > > 
> > > Device /dev/video0 opened.
> > > Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
> > > XU control 0: info GET SET (0x03) 2 bytes
> > > XU control 1: info GET SET (0x03) 64 bytes
> > > XU control 2: info GET SET (0x03) 64 bytes
> > > XU control 3: info GET SET (0x03) 2 bytes
> > > XU control 4: info GET SET (0x03) 2 bytes
> > > XU control 5: info GET SET (0x03) 2 bytes
> > > XU control 6: info GET SET (0x03) 2 bytes
> > > XU control 7: info GET SET (0x03) 2 bytes
> > > Video format: YUYV (56595559) 640x480 buffer size 614400
> > 
> > Those XU controls seem to be quite generic, and are found in other
> > webcams that use the same chipset. They probably allow direct access to
> > the sensor and bridge registers.
> > 
> > More information will be needed to find out how to select the sensor. I'm
> > afraid USB sniffing in windows seems to be unavoidable. I will need a
> > trace of all USB control requests (if your USB sniffer allows filtering
> > out the isochronous transfers, please do so) sent to the device when you
> > switch from one sensor to the other one.
> 
> Ok, so I've started trying to sniff some data from windows. I've done
> this before but it was so long ago I think I forgot everything I knew
> about USB hardware stuff. Anyway, I'm trying to use usbsnoopy
> (sourceforge.net/projects/usbsnoop). I'm not sure this is working.
> 
> There are two devices listed which have a VID/PID that matches from
> device manager. One is listed as "HP Webcam" and the other "USB
> Composite Device". I installed a sniffer on both, and "restart" the
> device. Then approximately 5 seconds later I start the webcam
> application. Around 3 seconds after that the application starts showing
> images. I wait 10 seconds and then press the button to switch to the
> other input. After a few more seconds I close the application, and then
> stop the log in usbsnoopy.
> 
> However, the last event that is recorded by usbsnoopy is at about 7,8
> seconds, roughly corresponding to when the webcam started up. Nothing is
> recorded after that. I've attached the log anyway, but I suspect it is
> maybe not useful. It looks like it's not a plain text format. I'm not
> sure if the format is any kind of standard thing. It looks like
> usbsnoopy has an export option so I can send this in another format if
> it'd be better.

I'd appreciate if you could try the export option, as the binary log is not 
very useful in Linux.

> Lastly, just to do some experimentation. I tried opening the camera from
> two separate applications in windows. If I open the HP Webcam
> application it shows the image from the rear camera (I don't press the
> button to switch input), and then I open skype's video settings and
> select the VGA camera. When I do this the image in the other application
> changes to that of the forward facing camera, and then freezes. Skype
> never actually displays anything while doing this. Anyway, I'm not sure
> that information is useful in anyway but there it is.

-- 
Regards,

Laurent Pinchart


From bigboi at wackywombats.com  Tue Nov  8 22:47:20 2011
From: bigboi at wackywombats.com (bigboi at wackywombats.com)
Date: Tue, 08 Nov 2011 14:47:20 -0700
Subject: [Linux-uvc-devel] Frame rate for Logitech QuickCam Pro for Notebooks
Message-ID: <20111108144720.3807b01a6b786410f2c03b7144562216.b9e9ab616f.wbe@email13.secureserver.net>

An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111108/a3137378/attachment.html>

From bug-track at fisher-privat.net  Wed Nov  9 09:22:07 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 09 Nov 2011 09:22:07 +0100
Subject: [Linux-uvc-devel] Frame rate for Logitech QuickCam Pro for
	Notebooks
In-Reply-To: <20111108144720.3807b01a6b786410f2c03b7144562216.b9e9ab616f.wbe@email13.secureserver.net>
References: <20111108144720.3807b01a6b786410f2c03b7144562216.b9e9ab616f.wbe@email13.secureserver.net>
Message-ID: <4EBA382F.9000505@fisher-privat.net>

Am 08.11.2011 22:47, schrieb bigboi at wackywombats.com:
> Hi,
> I have a linux application that uses the Logitech QuickCam Pro for
> Notebooks (vendor/device id 0469:0991). I am using openCV to grab the
> frame and then display it. I get 15 frames/second wih this app. If I
> plug this same camera into a Windows box and run the same app, I get 30
> frames/second. I'm trying to understand what is causing this difference
> in frame rates.
> Does anyone have any ideas on what could be going on?
> Thanks!

Hi,
Because this cam use exposure with auto priority. Disable it and you 
will get your noisy 30 fps.
You can do it with:
uvcdynctrl -s "Exposure, Auto Priority" 0


From cheshirekow at gmail.com  Fri Nov  4 20:05:23 2011
From: cheshirekow at gmail.com (cheshirekow)
Date: Fri, 04 Nov 2011 15:05:23 -0400
Subject: [Linux-uvc-devel] Dual sensor, single controller, one USB Device
In-Reply-To: <201111041444.42202.laurent.pinchart@ideasonboard.com>
References: <1319212248.30755.135@hogo>
	<201111021738.25161.laurent.pinchart@ideasonboard.com>
	<1320410796.24915.6.camel@Nadie>
	<201111041444.42202.laurent.pinchart@ideasonboard.com>
Message-ID: <1320433523.24915.57.camel@Nadie>

On Fri, 2011-11-04 at 14:44 +0100, Laurent Pinchart wrote:
> Hi,
> 
> On Friday 04 November 2011 13:46:36 cheshirekow wrote:
> > On Wed, 2011-11-02 at 17:38 +0100, Laurent Pinchart wrote:
> > > On Saturday 29 October 2011 09:30:04 Alexey Fisher wrote:
> > > > Am 28.10.2011 18:01, schrieb cheshirekow:
> > > > > On Sun, 2011-10-23 at 13:50 -0400, cheshirekow wrote:
> > > > >> On 10/22/2011 03:16 AM, Alexey Fisher wrote:
> > > > >>> Can you please attach the output of this command:
> > > > >>> lsusb -vd 10f1:1a26>  lsusb_dump
> > > > >> 
> > > > >> Sure. The dump file is attached.
> > > > >> 
> > > > >> Thanks!
> > > > > 
> > > > > Has anyone by chance managed to take a look at this lsusb dump?
> > > > > 
> > > > > To recap:
> > > > > the HP Slate has two integrated we cams: One forward facing for video
> > > > > calls, and one higher-resolution rear-facing for snapping photos.
> > > > > There appears to be a single controller for both cameras. In linux,
> > > > > lsusb only shows one webcam device. In windows, the device manager
> > > > > also shows only one device for the webcam. However, in windows
> > > > > applications that use the webcam (i.e. HP's webcam application, and
> > > > > in skype) I'm able to select which one to use as an option. In
> > > > > linux, there is only one video device, /dev/video0.
> > > > > 
> > > > > There does not appear to be any control available from uvcdynctrl or
> > > > > within vlc to select which physical camera to use. I've tried setting
> > > > > the resolution in vlc when I use the "open capture device" menu item.
> > > > > I know that the forward facing camera is VGA so I tried specifying
> > > > > 640x480, but the result is that it shows the rear-camera stream at a
> > > > > low resolution, rather then showing the forward-camera stream.
> > > > > 
> > > > > I'd appreciate any suggestions on how to get the forward-facing
> > > > > camera to work in linux (for skype/google video calls). Also, if it
> > > > > is clear that this facility is not available in UVC and that there
> > > > > is no way this is possilble, that would also be useful information.
> > > > > 
> > > > > Thanks again
> > > > 
> > > > Hi,
> > > > 
> > > > suddenly i do not see any control to switch the sensor. I assume there
> > > > can be two variants how it may work:
> > > > 1. vendor specific extension unit for uvc
> > > > 2. or usb mode switcher
> > > > 
> > > > if both sensors have same capabilities, the 1. make sense. If not then
> > > > second. Because this usb dump report settings only for one sensor.
> > > > 
> > > > For 1. it will be probably possible to control it with libwebcam. For
> > > > 2. it should be possible to control it with some kind of
> > > > usb_modeswitch (i'm not up to date).
> > > > 
> > > > To find what it is actually, there can be fallowing options:
> > > > 1. sniff usb traffic
> > > > 2. see if the windows driver has some advise for us
> > > > 3. unscrew your laptop and find what control use your webcam.
> > > 
> > > My guess is that the camera uses either an extension unit (XU) control or
> > > a vendor-specific request to select between the two sensors (which is
> > > very unfortunate, given that the UVC specification has explicit support
> > > for dual- sensor cameras, and I would have liked to test that code :-)).
> > 
> > Thanks for the information. It is unfortunate that the camera doesn't
> > take advantage of what is already in the spec.
> > 
> > > Let's start with the XU control. I've attached a patch for the yavta test
> > > application (http://git.ideasonboard.org/?p=yavta.git;a=summary) to this
> > > e- mail. Could you please apply it, compile the application with
> > 
> > Ok sure. I downloaded the test, applied the patch, and ran it with the
> > following output:
> > 
> > Device /dev/video0 opened.
> > Device `HP Webcam' on `usb-0000:00:1d.7-8' is a video capture device.
> > XU control 0: info GET SET (0x03) 2 bytes
> > XU control 1: info GET SET (0x03) 64 bytes
> > XU control 2: info GET SET (0x03) 64 bytes
> > XU control 3: info GET SET (0x03) 2 bytes
> > XU control 4: info GET SET (0x03) 2 bytes
> > XU control 5: info GET SET (0x03) 2 bytes
> > XU control 6: info GET SET (0x03) 2 bytes
> > XU control 7: info GET SET (0x03) 2 bytes
> > Video format: YUYV (56595559) 640x480 buffer size 614400
> 
> Those XU controls seem to be quite generic, and are found in other webcams 
> that use the same chipset. They probably allow direct access to the sensor and 
> bridge registers.
> 
> More information will be needed to find out how to select the sensor. I'm 
> afraid USB sniffing in windows seems to be unavoidable. I will need a trace of 
> all USB control requests (if your USB sniffer allows filtering out the 
> isochronous transfers, please do so) sent to the device when you switch from 
> one sensor to the other one.


Ok, so I've started trying to sniff some data from windows. I've done
this before but it was so long ago I think I forgot everything I knew
about USB hardware stuff. Anyway, I'm trying to use usbsnoopy
(sourceforge.net/projects/usbsnoop). I'm not sure this is working.

There are two devices listed which have a VID/PID that matches from
device manager. One is listed as "HP Webcam" and the other "USB
Composite Device". I installed a sniffer on both, and "restart" the
device. Then approximately 5 seconds later I start the webcam
application. Around 3 seconds after that the application starts showing
images. I wait 10 seconds and then press the button to switch to the
other input. After a few more seconds I close the application, and then
stop the log in usbsnoopy. 

However, the last event that is recorded by usbsnoopy is at about 7,8
seconds, roughly corresponding to when the webcam started up. Nothing is
recorded after that. I've attached the log anyway, but I suspect it is
maybe not useful. It looks like it's not a plain text format. I'm not
sure if the format is any kind of standard thing. It looks like
usbsnoopy has an export option so I can send this in another format if
it'd be better. 

Lastly, just to do some experimentation. I tried opening the camera from
two separate applications in windows. If I open the HP Webcam
application it shows the image from the rear camera (I don't press the
button to switch input), and then I open skype's video settings and
select the VGA camera. When I do this the image in the other application
changes to that of the forward facing camera, and then freezes. Skype
never actually displays anything while doing this. Anyway, I'm not sure
that information is useful in anyway but there it is.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: HPWebcam.usblog
Type: application/octet-stream
Size: 140298 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111104/aec9980f/attachment.obj>

From barsnick at gmx.net  Wed Nov  9 22:57:33 2011
From: barsnick at gmx.net (Moritz Barsnick)
Date: Wed, 9 Nov 2011 22:57:33 +0100
Subject: [Linux-uvc-devel] Working with Logitech B990: Issues.
In-Reply-To: <201111031154.55972.laurent.pinchart@ideasonboard.com>
References: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
	<201111031154.55972.laurent.pinchart@ideasonboard.com>
Message-ID: <20111109215733.GA17569@sunshine.barsnick.net>

On Thu, Nov 03, 2011 at 11:54:55 +0100, Laurent Pinchart wrote:
> On Thursday 03 November 2011 02:20:30 Kaz Kylheku wrote:
> > By the way, I patched the driver to make the trace and quirks sysctl
> > parameters, since I have it compiled into the kernel.
> 
> Aren't uvcvideo module parameters available through 
> /sys/modules/uvcvideo/parameters/ even when uvcvideo is compiled in ?

It seems to be /sys/module/uvcvideo/parameters/ (note "module" vs.
"modules"). And indeed, compiled-in features also seem to support this
interface.

And it is very funky. You actually don't need to rmmod && insmod
modules to change parameters, you just "cat" the value into that
interface. If the module is programmed as such (and uvcvideo is, IIRC),
the module will pick it up automatically.

rmmod is way too complicated! :-)

Moritz


From vickylinuxer at gmail.com  Thu Nov 10 12:02:56 2011
From: vickylinuxer at gmail.com (vignesh rajendran)
Date: Thu, 10 Nov 2011 11:02:56 +0000
Subject: [Linux-uvc-devel] Z-star camera problem
Message-ID: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>

Hi all

 I am in embedded linux and facing a problem with Z-star electronics camera
having the id  "0acda:3430".

 When testing with mplayer ,  I am getting following error,

# mplayer tv:// -tv
driver=v4l2:width=320:height=220:device=/dev/video0:noaudio
-flip -vo fbdev2 -fs 30
MPlayer UNKNOWN-4.6.1 (C) 2000-2010 MPlayer Team

Playing tv://.
TV file format detected.
Selected driver: v4l2
 name: Video 4 Linux 2 input
 author: Martin Olschewski <olschewski at zpr.uni-koeln.de>
 comment: first try, more to come ;-)
v4l2: your device driver does not support VIDIOC_G_STD ioctl, VIDIOC_G_PARM
was used instead.
Selected device: NAMUGA 1.3M Webcam
 Capabilities:  video capture  streaming
 supported norms:
 inputs: 0 = Camera 1;
 Current input: 0
 Current format: YUYV
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
v4l2: ioctl set format failed: Invalid argument
tv.c: norm_from_string(pal): Bogus norm parameter, setting default.
v4l2: ioctl enum norm failed: Invalid argument
Error: Cannot set norm!
Selected input hasn't got a tuner!
v4l2: ioctl set mute failed: Invalid argument
v4l2: ioctl query control failed: Invalid argument
v4l2: select timeout
==========================================================================
Opening video decoder: [raw] RAW Uncompressed Video
Could not find matching colorspace - retrying with -vf scale...
Opening video filter: [scale]
[fbdev2] Can't put VSCREENINFO: Invalid argument
[fbdev2] Can't put VSCREENINFO: Invalid argument
Opening video filter: [flip]
Movie-Aspect is undefined - no prescaling applied.
[fbdev2] Can't put VSCREENINFO: Invalid argument
[fbdev2] Can't put VSCREENINFO: Invalid argument
[swscaler @ 0x21f77d0] BICUBIC scaler, from yuyv422 to rgb555le using C
VO: [fbdev2] 320x240 => 320x240 BGR 15-bit  [fs]
Selected video codec: [rawyuy2] vfm: raw (RAW YUY2)
==========================================================================
Audio: no sound
Starting playback...
v4l2: select timeout
V:   0.0   1/  1 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
V:   0.0   2/  2 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
V:   0.0   3/  3 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout


MPlayer interrupted by signal 2 in module: video_read_frame
V:   0.0   4/  4 ??% ??% ??,?% 0 0 $<50>
v4l2: select timeout
v4l2: ioctl set mute failed: Invalid argument
v4l2: 0 frames successfully processed, 1 frames dropped.

Exiting... (Quit)

I am getting v4l2: select timeout repeatedly.I am using 3.0 kernel.

And my another camera Namuga(0ac8:c335) is working fine

Please help me out of this.



-- 
Regards

Vignesh Rajendran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111110/d9f932a5/attachment.html>

From bug-track at fisher-privat.net  Thu Nov 10 12:59:15 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 10 Nov 2011 12:59:15 +0100
Subject: [Linux-uvc-devel] Z-star camera problem
In-Reply-To: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>
References: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>
Message-ID: <4EBBBC93.7010901@fisher-privat.net>

Hi Vignesh,

can you please attach output of:
lsusb -vd 0acda:3430 > lsusb_dump


Am 10.11.2011 12:02, schrieb vignesh rajendran:
> Hi all
>
>   I am in embedded linux and facing a problem with Z-star electronics
> camera having the id "0acda:3430".
>
>   When testing with mplayer ,  I am getting following error,
>
> # mplayer tv:// -tv
> driver=v4l2:width=320:height=220:device=/dev/video0:noaudio
> -flip -vo fbdev2 -fs 30
> MPlayer UNKNOWN-4.6.1 (C) 2000-2010 MPlayer Team
>
> Playing tv://.
> TV file format detected.
> Selected driver: v4l2
>   name: Video 4 Linux 2 input
>   author: Martin Olschewski <olschewski at zpr.uni-koeln.de
> <mailto:olschewski at zpr.uni-koeln.de>>
>   comment: first try, more to come ;-)
> v4l2: your device driver does not support VIDIOC_G_STD ioctl,
> VIDIOC_G_PARM was used instead.
> Selected device: NAMUGA 1.3M Webcam
>   Capabilities:  video capture  streaming
>   supported norms:
>   inputs: 0 = Camera 1;
>   Current input: 0
>   Current format: YUYV
> v4l2: ioctl set format failed: Invalid argument
> v4l2: ioctl set format failed: Invalid argument
> v4l2: ioctl set format failed: Invalid argument
> tv.c: norm_from_string(pal): Bogus norm parameter, setting default.
> v4l2: ioctl enum norm failed: Invalid argument
> Error: Cannot set norm!
> Selected input hasn't got a tuner!
> v4l2: ioctl set mute failed: Invalid argument
> v4l2: ioctl query control failed: Invalid argument
> v4l2: select timeout
> ==========================================================================
> Opening video decoder: [raw] RAW Uncompressed Video
> Could not find matching colorspace - retrying with -vf scale...
> Opening video filter: [scale]
> [fbdev2] Can't put VSCREENINFO: Invalid argument
> [fbdev2] Can't put VSCREENINFO: Invalid argument
> Opening video filter: [flip]
> Movie-Aspect is undefined - no prescaling applied.
> [fbdev2] Can't put VSCREENINFO: Invalid argument
> [fbdev2] Can't put VSCREENINFO: Invalid argument
> [swscaler @ 0x21f77d0] BICUBIC scaler, from yuyv422 to rgb555le using C
> VO: [fbdev2] 320x240 => 320x240 BGR 15-bit  [fs]
> Selected video codec: [rawyuy2] vfm: raw (RAW YUY2)
> ==========================================================================
> Audio: no sound
> Starting playback...
> v4l2: select timeout
> V:   0.0   1/  1 ??% ??% ??,?% 0 0 $<50>
> v4l2: select timeout
> V:   0.0   2/  2 ??% ??% ??,?% 0 0 $<50>
> v4l2: select timeout
> V:   0.0   3/  3 ??% ??% ??,?% 0 0 $<50>
> v4l2: select timeout
>
>
> MPlayer interrupted by signal 2 in module: video_read_frame
> V:   0.0   4/  4 ??% ??% ??,?% 0 0 $<50>
> v4l2: select timeout
> v4l2: ioctl set mute failed: Invalid argument
> v4l2: 0 frames successfully processed, 1 frames dropped.
>
> Exiting... (Quit)
>
> I am getting v4l2: select timeout repeatedly.I am using 3.0 kernel.
>
> And my another camera Namuga(0ac8:c335) is working fine
>
> Please help me out of this.
>
>
>
> --
> Regards
>
> Vignesh Rajendran
>
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From bug-track at fisher-privat.net  Thu Nov 10 13:16:41 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 10 Nov 2011 13:16:41 +0100
Subject: [Linux-uvc-devel] Suggestion for FAQ update
Message-ID: <4EBBC0A9.1040205@fisher-privat.net>

Hi Laurent,

i think it is good time to update FAQ. And add notice about reading the 
FAQ before ask some thing on maeling list.

My suggestion entry to FAQ:
================================================================
I have an UVC webcam but it is not working. What do you need to 
troubleshoot it?

1. Read "How do I find out whether my camera is a UVC device or not?"
2. Create usb dump file and attach it to email:

lsusb -vd 046d:08cb > lsusb_dump

3. Enable debug for uvcvideo module:

sudo echo 0xfff > /sys/module/uvcvideo/parameters/trace

4. reproduce the problem
5. attach dmesg to email

dmesg > dmesg

PS: Please do not use HTML formatet mails.

==============================================================


Your suggestions?

Regards,
Alexey


From bug-track at fisher-privat.net  Fri Nov 11 08:57:34 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 11 Nov 2011 08:57:34 +0100
Subject: [Linux-uvc-devel] Z-star camera problem
In-Reply-To: <CALoDM-Eveph+AVXTHzunNMNbkawoRXA0F7eMX+ufw_TN+Uw+Gg@mail.gmail.com>
References: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>
	<4EBBBC93.7010901@fisher-privat.net>
	<CALoDM-FDMO_F-NHcvxJxpCtTOX45NjS6FnKX=73RvDSBxU4Zgw@mail.gmail.com>
	<CALoDM-EQiiDK_CB-ux0zoDenpsbN=sv8ivx_YQjE_YCjPLKwag@mail.gmail.com>
	<CALoDM-Eveph+AVXTHzunNMNbkawoRXA0F7eMX+ufw_TN+Uw+Gg@mail.gmail.com>
Message-ID: <4EBCD56E.9010801@fisher-privat.net>

Hi,

it looks like you use not hi-speed (usb2.0) controller.
If it work in full speed then you can get only ~10 Mbit/sec.
with 320x240 it should be low frame rate or try 160x120.

please send dmesg from you arm system.

Enable debug for uvcvideo module:

sudo echo 0xfff > /sys/module/uvcvideo/parameters/trace

reproduce the problem
attach dmesg to email

dmesg > dmesg

PS: Please do not use HTML formatet mails.

Am 11.11.2011 07:34, schrieb vignesh rajendran:
>
>
> On Fri, Nov 11, 2011 at 6:25 AM, vignesh rajendran
> <vickylinuxer at gmail.com <mailto:vickylinuxer at gmail.com>> wrote:
>
>
>
>     On Fri, Nov 11, 2011 at 5:19 AM, vignesh rajendran
>     <vickylinuxer at gmail.com <mailto:vickylinuxer at gmail.com>> wrote:
>
>
>
>         On Thu, Nov 10, 2011 at 11:59 AM, Alexey Fisher
>         <bug-track at fisher-privat.net
>         <mailto:bug-track at fisher-privat.net>> wrote:
>
>             Hi Vignesh,
>
>             can you please attach output of:
>             lsusb -vd 0ac8:3430 > lsusb_dump
>
>
>         Hi
>
>           Sorry.I changed the id.Z-star camera id is 0ac8:c335.And the
>         lsusb log attached with this mail.The log with ubuntu 10.04 and
>         it was working fine in ubuntu when tested with mplayer.But in
>         arm , it is not working.
>
>         Regards
>         Vignesh Rajendran
>
>
>     And this is the log with arm-board.
>
>
> Sorry again.I changed the log.This is the correct log.
>
>
>
>             Am 10.11.2011 12:02, schrieb vignesh rajendran:
>
>                 Hi all
>
>                   I am in embedded linux and facing a problem with
>                 Z-star electronics
>                 camera having the id "0acda:3430".
>
>                   When testing with mplayer ,  I am getting following error,
>
>                 # mplayer tv:// -tv
>                 driver=v4l2:width=320:height=__220:device=/dev/video0:noaudio
>                 -flip -vo fbdev2 -fs 30
>                 MPlayer UNKNOWN-4.6.1 (C) 2000-2010 MPlayer Team
>
>                 Playing tv://.
>                 TV file format detected.
>                 Selected driver: v4l2
>                   name: Video 4 Linux 2 input
>                   author: Martin Olschewski <olschewski at zpr.uni-koeln.de
>                 <mailto:olschewski at zpr.uni-koeln.de>
>                 <mailto:olschewski at zpr.uni-__koeln.de
>                 <mailto:olschewski at zpr.uni-koeln.de>>>
>
>                   comment: first try, more to come ;-)
>                 v4l2: your device driver does not support VIDIOC_G_STD
>                 ioctl,
>                 VIDIOC_G_PARM was used instead.
>                 Selected device: NAMUGA 1.3M Webcam
>                   Capabilities:  video capture  streaming
>                   supported norms:
>                   inputs: 0 = Camera 1;
>                   Current input: 0
>                   Current format: YUYV
>                 v4l2: ioctl set format failed: Invalid argument
>                 v4l2: ioctl set format failed: Invalid argument
>                 v4l2: ioctl set format failed: Invalid argument
>                 tv.c: norm_from_string(pal): Bogus norm parameter,
>                 setting default.
>                 v4l2: ioctl enum norm failed: Invalid argument
>                 Error: Cannot set norm!
>                 Selected input hasn't got a tuner!
>                 v4l2: ioctl set mute failed: Invalid argument
>                 v4l2: ioctl query control failed: Invalid argument
>                 v4l2: select timeout
>                 ==============================__==============================__==============
>                 Opening video decoder: [raw] RAW Uncompressed Video
>                 Could not find matching colorspace - retrying with -vf
>                 scale...
>                 Opening video filter: [scale]
>                 [fbdev2] Can't put VSCREENINFO: Invalid argument
>                 [fbdev2] Can't put VSCREENINFO: Invalid argument
>                 Opening video filter: [flip]
>                 Movie-Aspect is undefined - no prescaling applied.
>                 [fbdev2] Can't put VSCREENINFO: Invalid argument
>                 [fbdev2] Can't put VSCREENINFO: Invalid argument
>                 [swscaler @ 0x21f77d0] BICUBIC scaler, from yuyv422 to
>                 rgb555le using C
>                 VO: [fbdev2] 320x240 => 320x240 BGR 15-bit  [fs]
>                 Selected video codec: [rawyuy2] vfm: raw (RAW YUY2)
>                 ==============================__==============================__==============
>                 Audio: no sound
>                 Starting playback...
>                 v4l2: select timeout
>                 V:   0.0   1/  1 ??% ??% ??,?% 0 0 $<50>
>                 v4l2: select timeout
>                 V:   0.0   2/  2 ??% ??% ??,?% 0 0 $<50>
>                 v4l2: select timeout
>                 V:   0.0   3/  3 ??% ??% ??,?% 0 0 $<50>
>                 v4l2: select timeout
>
>
>                 MPlayer interrupted by signal 2 in module: video_read_frame
>                 V:   0.0   4/  4 ??% ??% ??,?% 0 0 $<50>
>                 v4l2: select timeout
>                 v4l2: ioctl set mute failed: Invalid argument
>                 v4l2: 0 frames successfully processed, 1 frames dropped.
>
>                 Exiting... (Quit)
>
>                 I am getting v4l2: select timeout repeatedly.I am using
>                 3.0 kernel.
>
>                 And my another camera Namuga(0ac8:c335) is working fine
>
>                 Please help me out of this.
>
>
>
>
>
>
>                 _________________________________________________
>                 Linux-uvc-devel mailing list
>                 Linux-uvc-devel at lists.berlios.__de
>                 <mailto:Linux-uvc-devel at lists.berlios.de>
>                 https://lists.berlios.de/__mailman/listinfo/linux-uvc-__devel
>                 <https://lists.berlios.de/mailman/listinfo/linux-uvc-devel>
>
>
>             _________________________________________________
>             Linux-uvc-devel mailing list
>             Linux-uvc-devel at lists.berlios.__de
>             <mailto:Linux-uvc-devel at lists.berlios.de>
>             https://lists.berlios.de/__mailman/listinfo/linux-uvc-__devel <https://lists.berlios.de/mailman/listinfo/linux-uvc-devel>
>
>
>
>
>         --
>         Regards
>
>         Vignesh Rajendran
>
>
>
>
>     --
>     Regards
>
>     Vignesh Rajendran
>
>
>
>
> --
> Regards
>
> Vignesh Rajendran
>



From vickylinuxer at gmail.com  Fri Nov 11 10:32:12 2011
From: vickylinuxer at gmail.com (vignesh rajendran)
Date: Fri, 11 Nov 2011 09:32:12 +0000
Subject: [Linux-uvc-devel] Z-star camera problem
In-Reply-To: <4EBCD56E.9010801@fisher-privat.net>
References: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>
	<4EBBBC93.7010901@fisher-privat.net>
	<CALoDM-FDMO_F-NHcvxJxpCtTOX45NjS6FnKX=73RvDSBxU4Zgw@mail.gmail.com>
	<CALoDM-EQiiDK_CB-ux0zoDenpsbN=sv8ivx_YQjE_YCjPLKwag@mail.gmail.com>
	<CALoDM-Eveph+AVXTHzunNMNbkawoRXA0F7eMX+ufw_TN+Uw+Gg@mail.gmail.com>
	<4EBCD56E.9010801@fisher-privat.net>
Message-ID: <CALoDM-G+hXNLCnNUkExSTJMQ6vAHTayTprKqgn-doBqBaV0=cw@mail.gmail.com>

Hi

 Again the same.No changes.I am getting green display in my touchscreen.

I attached Dmesg with this mail

Regards
Vignesh Rajendran



On Fri, Nov 11, 2011 at 7:57 AM, Alexey Fisher
<bug-track at fisher-privat.net>wrote:

> Hi,
>
> it looks like you use not hi-speed (usb2.0) controller.
> If it work in full speed then you can get only ~10 Mbit/sec.
> with 320x240 it should be low frame rate or try 160x120.
>
> please send dmesg from you arm system.
>
> Enable debug for uvcvideo module:
>
> sudo echo 0xfff > /sys/module/uvcvideo/**parameters/trace
>
> reproduce the problem
> attach dmesg to email
>
> dmesg > dmesg
>
> PS: Please do not use HTML formatet mails.
>
> Am 11.11.2011 07:34, schrieb vignesh rajendran:
>
>>
>>
>> On Fri, Nov 11, 2011 at 6:25 AM, vignesh rajendran
>> <vickylinuxer at gmail.com <mailto:vickylinuxer at gmail.com**>> wrote:
>>
>>
>>
>>    On Fri, Nov 11, 2011 at 5:19 AM, vignesh rajendran
>>    <vickylinuxer at gmail.com <mailto:vickylinuxer at gmail.com**>> wrote:
>>
>>
>>
>>        On Thu, Nov 10, 2011 at 11:59 AM, Alexey Fisher
>>        <bug-track at fisher-privat.net
>>        <mailto:bug-track at fisher-**privat.net<bug-track at fisher-privat.net>>>
>> wrote:
>>
>>            Hi Vignesh,
>>
>>            can you please attach output of:
>>            lsusb -vd 0ac8:3430 > lsusb_dump
>>
>>
>>        Hi
>>
>>          Sorry.I changed the id.Z-star camera id is 0ac8:c335.And the
>>        lsusb log attached with this mail.The log with ubuntu 10.04 and
>>        it was working fine in ubuntu when tested with mplayer.But in
>>        arm , it is not working.
>>
>>        Regards
>>        Vignesh Rajendran
>>
>>
>>    And this is the log with arm-board.
>>
>>
>> Sorry again.I changed the log.This is the correct log.
>>
>>
>>
>>            Am 10.11.2011 12:02, schrieb vignesh rajendran:
>>
>>                Hi all
>>
>>                  I am in embedded linux and facing a problem with
>>                Z-star electronics
>>                camera having the id "0acda:3430".
>>
>>                  When testing with mplayer ,  I am getting following
>> error,
>>
>>                # mplayer tv:// -tv
>>                driver=v4l2:width=320:height=_**_220:device=/dev/video0:**
>> noaudio
>>
>>                -flip -vo fbdev2 -fs 30
>>                MPlayer UNKNOWN-4.6.1 (C) 2000-2010 MPlayer Team
>>
>>                Playing tv://.
>>                TV file format detected.
>>                Selected driver: v4l2
>>                  name: Video 4 Linux 2 input
>>                  author: Martin Olschewski <olschewski at zpr.uni-koeln.de
>>                <mailto:olschewski at zpr.uni-**koeln.de<olschewski at zpr.uni-koeln.de>
>> >
>>                <mailto:olschewski at zpr.uni-__**koeln.de<olschewski at zpr.uni-__koeln.de>
>>
>>                <mailto:olschewski at zpr.uni-**koeln.de<olschewski at zpr.uni-koeln.de>
>> >>>
>>
>>                  comment: first try, more to come ;-)
>>                v4l2: your device driver does not support VIDIOC_G_STD
>>                ioctl,
>>                VIDIOC_G_PARM was used instead.
>>                Selected device: NAMUGA 1.3M Webcam
>>                  Capabilities:  video capture  streaming
>>                  supported norms:
>>                  inputs: 0 = Camera 1;
>>                  Current input: 0
>>                  Current format: YUYV
>>                v4l2: ioctl set format failed: Invalid argument
>>                v4l2: ioctl set format failed: Invalid argument
>>                v4l2: ioctl set format failed: Invalid argument
>>                tv.c: norm_from_string(pal): Bogus norm parameter,
>>                setting default.
>>                v4l2: ioctl enum norm failed: Invalid argument
>>                Error: Cannot set norm!
>>                Selected input hasn't got a tuner!
>>                v4l2: ioctl set mute failed: Invalid argument
>>                v4l2: ioctl query control failed: Invalid argument
>>                v4l2: select timeout
>>                ==============================**
>> __============================**==__==============
>>
>>                Opening video decoder: [raw] RAW Uncompressed Video
>>                Could not find matching colorspace - retrying with -vf
>>                scale...
>>                Opening video filter: [scale]
>>                [fbdev2] Can't put VSCREENINFO: Invalid argument
>>                [fbdev2] Can't put VSCREENINFO: Invalid argument
>>                Opening video filter: [flip]
>>                Movie-Aspect is undefined - no prescaling applied.
>>                [fbdev2] Can't put VSCREENINFO: Invalid argument
>>                [fbdev2] Can't put VSCREENINFO: Invalid argument
>>                [swscaler @ 0x21f77d0] BICUBIC scaler, from yuyv422 to
>>                rgb555le using C
>>                VO: [fbdev2] 320x240 => 320x240 BGR 15-bit  [fs]
>>                Selected video codec: [rawyuy2] vfm: raw (RAW YUY2)
>>                ==============================**
>> __============================**==__==============
>>
>>                Audio: no sound
>>                Starting playback...
>>                v4l2: select timeout
>>                V:   0.0   1/  1 ??% ??% ??,?% 0 0 $<50>
>>                v4l2: select timeout
>>                V:   0.0   2/  2 ??% ??% ??,?% 0 0 $<50>
>>                v4l2: select timeout
>>                V:   0.0   3/  3 ??% ??% ??,?% 0 0 $<50>
>>                v4l2: select timeout
>>
>>
>>                MPlayer interrupted by signal 2 in module: video_read_frame
>>                V:   0.0   4/  4 ??% ??% ??,?% 0 0 $<50>
>>                v4l2: select timeout
>>                v4l2: ioctl set mute failed: Invalid argument
>>                v4l2: 0 frames successfully processed, 1 frames dropped.
>>
>>                Exiting... (Quit)
>>
>>                I am getting v4l2: select timeout repeatedly.I am using
>>                3.0 kernel.
>>
>>                And my another camera Namuga(0ac8:c335) is working fine
>>
>>                Please help me out of this.
>>
>>
>>
>>
>>
>>
>>                ______________________________**___________________
>>                Linux-uvc-devel mailing list
>>                Linux-uvc-devel at lists.berlios.**__de
>>                <mailto:Linux-uvc-devel at lists.**berlios.de<Linux-uvc-devel at lists.berlios.de>
>> >
>>                https://lists.berlios.de/__**mailman/listinfo/linux-uvc-__
>> **devel <https://lists.berlios.de/__mailman/listinfo/linux-uvc-__devel>
>>                <https://lists.berlios.de/**mailman/listinfo/linux-uvc-**
>> devel <https://lists.berlios.de/mailman/listinfo/linux-uvc-devel>>
>>
>>
>>            ______________________________**___________________
>>            Linux-uvc-devel mailing list
>>            Linux-uvc-devel at lists.berlios.**__de
>>            <mailto:Linux-uvc-devel at lists.**berlios.de<Linux-uvc-devel at lists.berlios.de>
>> >
>>            https://lists.berlios.de/__**mailman/listinfo/linux-uvc-__**
>> devel <https://lists.berlios.de/__mailman/listinfo/linux-uvc-__devel> <
>> https://lists.berlios.de/**mailman/listinfo/linux-uvc-**devel<https://lists.berlios.de/mailman/listinfo/linux-uvc-devel>
>> >
>>
>>
>>
>>
>>
>>        --
>>        Regards
>>
>>        Vignesh Rajendran
>>
>>
>>
>>
>>    --
>>    Regards
>>
>>    Vignesh Rajendran
>>
>>
>>
>>
>> --
>> Regards
>>
>> Vignesh Rajendran
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111111/6a52eb19/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmesg
Type: application/octet-stream
Size: 15408 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111111/6a52eb19/attachment.obj>

From bug-track at fisher-privat.net  Fri Nov 11 11:53:37 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 11 Nov 2011 11:53:37 +0100
Subject: [Linux-uvc-devel] Z-star camera problem
In-Reply-To: <CALoDM-G+hXNLCnNUkExSTJMQ6vAHTayTprKqgn-doBqBaV0=cw@mail.gmail.com>
References: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>
	<4EBBBC93.7010901@fisher-privat.net>
	<CALoDM-FDMO_F-NHcvxJxpCtTOX45NjS6FnKX=73RvDSBxU4Zgw@mail.gmail.com>
	<CALoDM-EQiiDK_CB-ux0zoDenpsbN=sv8ivx_YQjE_YCjPLKwag@mail.gmail.com>
	<CALoDM-Eveph+AVXTHzunNMNbkawoRXA0F7eMX+ufw_TN+Uw+Gg@mail.gmail.com>
	<4EBCD56E.9010801@fisher-privat.net>
	<CALoDM-G+hXNLCnNUkExSTJMQ6vAHTayTprKqgn-doBqBaV0=cw@mail.gmail.com>
Message-ID: <4EBCFEB1.6040307@fisher-privat.net>

Am 11.11.2011 10:32, schrieb vignesh rajendran:
> Hi
>
>   Again the same.No changes.I am getting green display in my touchscreen.
>
> I attached Dmesg with this mail

There is no debug info in this dmesg if you enable debug it loogs like this:
[19585.878562] uvcvideo: Queuing buffer 0.
[19585.879289] uvcvideo: uvc_v4l2_poll
[19585.942567] uvcvideo: Frame complete (EOF found).
[19585.942582] uvcvideo: uvc_v4l2_poll
[19585.942592] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
[19585.942598] uvcvideo: Dequeuing buffer 1 (4, 614400 bytes).
[19585.942602] uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
[19585.942605] uvcvideo: Queuing buffer 1.
[19585.944600] uvcvideo: uvc_v4l2_poll
[19586.010537] uvcvideo: Frame complete (EOF found).
[19586.010560] uvcvideo: uvc_v4l2_poll
[19586.010568] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
[19586.010574] uvcvideo: Dequeuing buffer 2 (4, 614400 bytes).
[19586.010578] uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
[19586.010581] uvcvideo: Queuing buffer 2.


From helbert2a at gmail.com  Fri Nov 11 18:26:01 2011
From: helbert2a at gmail.com (Edwin Aponte)
Date: Fri, 11 Nov 2011 17:26:01 +0000
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <201111021749.41935.laurent.pinchart@ideasonboard.com>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
	<201111021749.41935.laurent.pinchart@ideasonboard.com>
Message-ID: <1321032361.3048.8.camel@edwinaponteL.WORKGROUP>

Finally, I could do the network test in the school.

When the computer freezes completely some time after having loaded skype
using:
> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype\

and been using the web-cam in skype, I cannot ssh it neither ping it.

Also, the camera works well with luvcview (I used luvcview to get the
frames that I attached in my first post)  

Regards.

On Wed, 2011-11-02 at 17:49 +0100, Laurent Pinchart wrote:
> Hi Edwin,
> 
> On Saturday 22 October 2011 00:36:14 Edwin Aponte wrote:
> > libv4l2 is giving having problems with a Microsoft LifeCam NX-6000
> > webcam (045e:00f8). I have to run skype as below to get the webcam
> > working well for a moment, though an error is generated, until the
> > system freezes completely after some minutes and even SysRq doesn't
> > work.
> 
> Those two problems are likely unrelated, and the second one is pretty bad. Is 
> your machine connected to a network ? Can you still ping it after it freezes ? 
> What about ssh ?
> 
> > env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype
> > libv4l2: error converting / decoding frame data: v4l-convert: error
> > parsing
> > JPEG header: Not a JPG file ?
> 
> Your camera seems to produce bad MJPEG frames. From the log you've attached it 
> seems that the first frame is bigger than the next ones. This might be 
> related. Could you try luvcview, which doesn't use libv4l ?
> 
> > Sometimes, I get the same error with the program webcam:
> > --------------------------
> > ~> webcam
> > reading config file: /home/edwinh/.webcamrc
> > video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> > grabber config:
> >   size 320x240 [none]
> >   input (null), norm (null), jpeg quality 75
> >   rotate=0, top=0, left=0, bottom=240, right=320
> > libv4l2: error converting / decoding frame data: v4l-convert: error
> > parsing
> > JPEG header: Not a JPG file ?
> > 
> > 
> > v4l2: read: Input/output error
> > capturing image failed
> > -------------------------
> > 
> > and some times this other error:
> > 
> > -------------------------
> > ~> webcam
> > reading config file: /home/edwinh/.webcamrc
> > video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> > grabber config:
> >   size 320x240 [none]
> >   input (null), norm (null), jpeg quality 75
> >   rotate=0, top=0, left=0, bottom=240, right=320
> > libv4lconvert: Error decompressing JPEG: fill_nbits error: need 1 more
> > bits
> > -------------------------
> > 
> > I have attached some information based on this thread
> > http://lists.berlios.de/pipermail/linux-uvc-devel/2008-November/004265.html
> > that seems to be a similar case of my problem.
> > I set the trace level to 255:
> > 
> > # echo 255 > /sys/module/uvcvideo/parameters/trace
> > 
> > and I record a frame using:
> > ~> luvcview -f mjpg -c
> > 
> > and after that I saved the output of dmesg.
> > 
> > Thanks.
> 




From bug-track at fisher-privat.net  Fri Nov 11 19:33:33 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 11 Nov 2011 19:33:33 +0100
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <1321032361.3048.8.camel@edwinaponteL.WORKGROUP>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
	<201111021749.41935.laurent.pinchart@ideasonboard.com>
	<1321032361.3048.8.camel@edwinaponteL.WORKGROUP>
Message-ID: <4EBD6A7D.3060508@fisher-privat.net>

Do your webcam has build in mic? Do you use this mic with skype?
If yes. Can you please do fallowing test. Start your webcam with 
luvcview or guvcview and start the attached script.

edid the script and replace device name to yours. my is
alsa_input.usb-046d_0991_9671DCEE-02-U0x46d0x991.analog-mono

you can find proper name with this command:
pacmd list | grep alsa_input

with this script we can try to reproduce skype behavior.

Am 11.11.2011 18:26, schrieb Edwin Aponte:
> Finally, I could do the network test in the school.
>
> When the computer freezes completely some time after having loaded skype
> using:
>> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype\
>
> and been using the web-cam in skype, I cannot ssh it neither ping it.
>
> Also, the camera works well with luvcview (I used luvcview to get the
> frames that I attached in my first post)
>
> Regards.
>
> On Wed, 2011-11-02 at 17:49 +0100, Laurent Pinchart wrote:
>> Hi Edwin,
>>
>> On Saturday 22 October 2011 00:36:14 Edwin Aponte wrote:
>>> libv4l2 is giving having problems with a Microsoft LifeCam NX-6000
>>> webcam (045e:00f8). I have to run skype as below to get the webcam
>>> working well for a moment, though an error is generated, until the
>>> system freezes completely after some minutes and even SysRq doesn't
>>> work.
>>
>> Those two problems are likely unrelated, and the second one is pretty bad. Is
>> your machine connected to a network ? Can you still ping it after it freezes ?
>> What about ssh ?
>>
>>> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype
>>> libv4l2: error converting / decoding frame data: v4l-convert: error
>>> parsing
>>> JPEG header: Not a JPG file ?
>>
>> Your camera seems to produce bad MJPEG frames. From the log you've attached it
>> seems that the first frame is bigger than the next ones. This might be
>> related. Could you try luvcview, which doesn't use libv4l ?
>>
>>> Sometimes, I get the same error with the program webcam:
>>> --------------------------
>>> ~>  webcam
>>> reading config file: /home/edwinh/.webcamrc
>>> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
>>> grabber config:
>>>    size 320x240 [none]
>>>    input (null), norm (null), jpeg quality 75
>>>    rotate=0, top=0, left=0, bottom=240, right=320
>>> libv4l2: error converting / decoding frame data: v4l-convert: error
>>> parsing
>>> JPEG header: Not a JPG file ?
>>>
>>>
>>> v4l2: read: Input/output error
>>> capturing image failed
>>> -------------------------
>>>
>>> and some times this other error:
>>>
>>> -------------------------
>>> ~>  webcam
>>> reading config file: /home/edwinh/.webcamrc
>>> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
>>> grabber config:
>>>    size 320x240 [none]
>>>    input (null), norm (null), jpeg quality 75
>>>    rotate=0, top=0, left=0, bottom=240, right=320
>>> libv4lconvert: Error decompressing JPEG: fill_nbits error: need 1 more
>>> bits
>>> -------------------------
>>>
>>> I have attached some information based on this thread
>>> http://lists.berlios.de/pipermail/linux-uvc-devel/2008-November/004265.html
>>> that seems to be a similar case of my problem.
>>> I set the trace level to 255:
>>>
>>> # echo 255>  /sys/module/uvcvideo/parameters/trace
>>>
>>> and I record a frame using:
>>> ~>  luvcview -f mjpg -c
>>>
>>> and after that I saved the output of dmesg.
>>>
>>> Thanks.
>>
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: audio_vol
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111111/266107c5/attachment.ksh>

From helbert2a at gmail.com  Sun Nov 13 01:20:41 2011
From: helbert2a at gmail.com (Edwin Aponte)
Date: Sun, 13 Nov 2011 00:20:41 +0000
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <4EBD6A7D.3060508@fisher-privat.net>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
	<201111021749.41935.laurent.pinchart@ideasonboard.com>
	<1321032361.3048.8.camel@edwinaponteL.WORKGROUP>
	<4EBD6A7D.3060508@fisher-privat.net>
Message-ID: <1321143641.2750.17.camel@edwinaponteL.WORKGROUP>

My webcam has a build in mic but I don't think it is used because in the
tab "Sound Devices" of Skype configuration, "Microphone" is set to
"PulseAudio server (local)" and the default source is the internal mic:

__________________
~> pacmd list|grep alsa_input
Default source name: alsa_input.pci-0000_00_1b.0.analog-stereo
	name: <alsa_input.pci-0000_00_1b.0.analog-stereo>

	name:
<alsa_input.usb-Microsoft_Microsoft___LifeCam_NX-6000-02-NX6000.analog-mono>

	alsa_input.pci-0000_00_1b.0.analog-stereo/#1: Internal 					 Audio
Analog Stereo

alsa_input.usb-Microsoft_Microsoft___LifeCam_NX-6000-02-NX6000.analog-mono/#2: 	   	 LifeCam NX-6000 Analog Mono

	source: 1 <alsa_input.pci-0000_00_1b.0.analog-stereo>
__________________

Any way, I tested this script because I saw in PulseAudio Volume control
that both mics were receiving signal, i.e. both were active. I got this
output:

__________________
>>> >>> 1
Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
...
>>> >>> 1
Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
>>> >>> Welcome to PulseAudio! Use "help" for usage information.
...
__________________

And the system didn't freeze.

After that I changed the default source to the webcam's mic and repeat
the test with the same results.

Regards.

On Fri, 2011-11-11 at 19:33 +0100, Alexey Fisher wrote:
> Do your webcam has build in mic? Do you use this mic with skype?
> If yes. Can you please do fallowing test. Start your webcam with 
> luvcview or guvcview and start the attached script.
> 
> edid the script and replace device name to yours. my is
> alsa_input.usb-046d_0991_9671DCEE-02-U0x46d0x991.analog-mono
> 
> you can find proper name with this command:
> pacmd list | grep alsa_input
> 
> with this script we can try to reproduce skype behavior.
> 
> Am 11.11.2011 18:26, schrieb Edwin Aponte:
> > Finally, I could do the network test in the school.
> >
> > When the computer freezes completely some time after having loaded skype
> > using:
> >> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype\
> >
> > and been using the web-cam in skype, I cannot ssh it neither ping it.
> >
> > Also, the camera works well with luvcview (I used luvcview to get the
> > frames that I attached in my first post)
> >
> > Regards.
> >
> > On Wed, 2011-11-02 at 17:49 +0100, Laurent Pinchart wrote:
> >> Hi Edwin,
> >>
> >> On Saturday 22 October 2011 00:36:14 Edwin Aponte wrote:
> >>> libv4l2 is giving having problems with a Microsoft LifeCam NX-6000
> >>> webcam (045e:00f8). I have to run skype as below to get the webcam
> >>> working well for a moment, though an error is generated, until the
> >>> system freezes completely after some minutes and even SysRq doesn't
> >>> work.
> >>
> >> Those two problems are likely unrelated, and the second one is pretty bad. Is
> >> your machine connected to a network ? Can you still ping it after it freezes ?
> >> What about ssh ?
> >>
> >>> env LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so skype
> >>> libv4l2: error converting / decoding frame data: v4l-convert: error
> >>> parsing
> >>> JPEG header: Not a JPG file ?
> >>
> >> Your camera seems to produce bad MJPEG frames. From the log you've attached it
> >> seems that the first frame is bigger than the next ones. This might be
> >> related. Could you try luvcview, which doesn't use libv4l ?
> >>
> >>> Sometimes, I get the same error with the program webcam:
> >>> --------------------------
> >>> ~>  webcam
> >>> reading config file: /home/edwinh/.webcamrc
> >>> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> >>> grabber config:
> >>>    size 320x240 [none]
> >>>    input (null), norm (null), jpeg quality 75
> >>>    rotate=0, top=0, left=0, bottom=240, right=320
> >>> libv4l2: error converting / decoding frame data: v4l-convert: error
> >>> parsing
> >>> JPEG header: Not a JPG file ?
> >>>
> >>>
> >>> v4l2: read: Input/output error
> >>> capturing image failed
> >>> -------------------------
> >>>
> >>> and some times this other error:
> >>>
> >>> -------------------------
> >>> ~>  webcam
> >>> reading config file: /home/edwinh/.webcamrc
> >>> video4linux webcam v1.5 - (c) 1998-2002 Gerd Knorr
> >>> grabber config:
> >>>    size 320x240 [none]
> >>>    input (null), norm (null), jpeg quality 75
> >>>    rotate=0, top=0, left=0, bottom=240, right=320
> >>> libv4lconvert: Error decompressing JPEG: fill_nbits error: need 1 more
> >>> bits
> >>> -------------------------
> >>>
> >>> I have attached some information based on this thread
> >>> http://lists.berlios.de/pipermail/linux-uvc-devel/2008-November/004265.html
> >>> that seems to be a similar case of my problem.
> >>> I set the trace level to 255:
> >>>
> >>> # echo 255>  /sys/module/uvcvideo/parameters/trace
> >>>
> >>> and I record a frame using:
> >>> ~>  luvcview -f mjpg -c
> >>>
> >>> and after that I saved the output of dmesg.
> >>>
> >>> Thanks.
> >>
> >
> >
> > _______________________________________________
> > Linux-uvc-devel mailing list
> > Linux-uvc-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 




From bfkyyuan at gmail.com  Sun Nov 13 04:51:47 2011
From: bfkyyuan at gmail.com (ge s)
Date: Sun, 13 Nov 2011 11:51:47 +0800
Subject: [Linux-uvc-devel] Webcam with nv12
Message-ID: <CA+dM+uLhjEppJY7bnX2YhYdaNy-72OU=ocALzEfMyx0m8j5_=w@mail.gmail.com>

hi,all.I need a pixel format for NV12 and resolution for 720p or 1080p USB
webcam.
For a long time did not find the corresponding usb webcam.Please give me
some advice!Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111113/bc11f5d2/attachment.html>

From kaz at kylheku.com  Sun Nov 13 06:43:31 2011
From: kaz at kylheku.com (Kaz Kylheku)
Date: Sat, 12 Nov 2011 21:43:31 -0800
Subject: [Linux-uvc-devel] Webcam with nv12
In-Reply-To: <CA+dM+uLhjEppJY7bnX2YhYdaNy-72OU=ocALzEfMyx0m8j5_=w@mail.gmail.com>
References: <CA+dM+uLhjEppJY7bnX2YhYdaNy-72OU=ocALzEfMyx0m8j5_=w@mail.gmail.com>
Message-ID: <edf0e5abb016131fb3c1b7894af74c3f@127.0.0.1>



On Sun, 13 Nov 2011 11:51:47 +0800, ge s  wrote: hi,all.I need a
pixel format for NV12 and resolution for 720p or 1080p USB webcam. 
For
a long time did not find the corresponding usb webcam.Please give me
some advice!Thank you!  

Are you serious? You're looking for hardware
to match a requirement for a particular YUV storage format? 

What
dictates the requirement, and why does the camera have to be chosen to
adapt to /it/? 

Why don't you push the bits around to change a
different YUV format to the 4:2:2 semi-planar that you want? 

It's
pretty trivial, and can be hacked up in hand-written assembly if need
be.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111112/862071e6/attachment.html>

From bug-track at fisher-privat.net  Sun Nov 13 12:29:21 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Sun, 13 Nov 2011 12:29:21 +0100
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <1321143641.2750.17.camel@edwinaponteL.WORKGROUP>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
	<201111021749.41935.laurent.pinchart@ideasonboard.com>
	<1321032361.3048.8.camel@edwinaponteL.WORKGROUP>
	<4EBD6A7D.3060508@fisher-privat.net>
	<1321143641.2750.17.camel@edwinaponteL.WORKGROUP>
Message-ID: <4EBFAA11.9000305@fisher-privat.net>

Ok, i reread you mails and see now that it is really other issue.

i try to summarize it:
1. It is regression, some old kernel works and new one not.
2. you get problems with jpeg stream
3. but skype do not use jpeg so it is brocken in raw stream
4. you can reproduce complete freeze only with skype

if it is kernel regression, can you compile kernel from git source and 
do git-bisect? There are lots of resource in internet how to do it, but 
if you still need help, then ask.

Am 13.11.2011 01:20, schrieb Edwin Aponte:
> My webcam has a build in mic but I don't think it is used because in the
> tab "Sound Devices" of Skype configuration, "Microphone" is set to
> "PulseAudio server (local)" and the default source is the internal mic:
>
> __________________
> ~>  pacmd list|grep alsa_input
> Default source name: alsa_input.pci-0000_00_1b.0.analog-stereo
> 	name:<alsa_input.pci-0000_00_1b.0.analog-stereo>
>
> 	name:
> <alsa_input.usb-Microsoft_Microsoft___LifeCam_NX-6000-02-NX6000.analog-mono>
>
> 	alsa_input.pci-0000_00_1b.0.analog-stereo/#1: Internal 					 Audio
> Analog Stereo
>
> alsa_input.usb-Microsoft_Microsoft___LifeCam_NX-6000-02-NX6000.analog-mono/#2: 	   	 LifeCam NX-6000 Analog Mono
>
> 	source: 1<alsa_input.pci-0000_00_1b.0.analog-stereo>
> __________________
>
> Any way, I tested this script because I saw in PulseAudio Volume control
> that both mics were receiving signal, i.e. both were active. I got this
> output:


From helbert2a at gmail.com  Sun Nov 13 19:57:41 2011
From: helbert2a at gmail.com (Edwin Aponte)
Date: Sun, 13 Nov 2011 18:57:41 +0000
Subject: [Linux-uvc-devel] libv4l2 error with 045e:00f8 cameras
In-Reply-To: <4EBFAA11.9000305@fisher-privat.net>
References: <1319236574.7398.6.camel@edwinaponteL.WORKGROUP>
	<201111021749.41935.laurent.pinchart@ideasonboard.com>
	<1321032361.3048.8.camel@edwinaponteL.WORKGROUP>
	<4EBD6A7D.3060508@fisher-privat.net>
	<1321143641.2750.17.camel@edwinaponteL.WORKGROUP>
	<4EBFAA11.9000305@fisher-privat.net>
Message-ID: <1321210661.2720.0.camel@edwinaponteL.WORKGROUP>

I will do that in a couple of days when I will have time.

Regards.

On Sun, 2011-11-13 at 12:29 +0100, Alexey Fisher wrote:
> Ok, i reread you mails and see now that it is really other issue.
> 
> i try to summarize it:
> 1. It is regression, some old kernel works and new one not.
> 2. you get problems with jpeg stream
> 3. but skype do not use jpeg so it is brocken in raw stream
> 4. you can reproduce complete freeze only with skype
> 
> if it is kernel regression, can you compile kernel from git source and 
> do git-bisect? There are lots of resource in internet how to do it, but 
> if you still need help, then ask.
> 
> Am 13.11.2011 01:20, schrieb Edwin Aponte:
> > My webcam has a build in mic but I don't think it is used because in the
> > tab "Sound Devices" of Skype configuration, "Microphone" is set to
> > "PulseAudio server (local)" and the default source is the internal mic:
> >
> > __________________
> > ~>  pacmd list|grep alsa_input
> > Default source name: alsa_input.pci-0000_00_1b.0.analog-stereo
> > 	name:<alsa_input.pci-0000_00_1b.0.analog-stereo>
> >
> > 	name:
> > <alsa_input.usb-Microsoft_Microsoft___LifeCam_NX-6000-02-NX6000.analog-mono>
> >
> > 	alsa_input.pci-0000_00_1b.0.analog-stereo/#1: Internal 					 Audio
> > Analog Stereo
> >
> > alsa_input.usb-Microsoft_Microsoft___LifeCam_NX-6000-02-NX6000.analog-mono/#2: 	   	 LifeCam NX-6000 Analog Mono
> >
> > 	source: 1<alsa_input.pci-0000_00_1b.0.analog-stereo>
> > __________________
> >
> > Any way, I tested this script because I saw in PulseAudio Volume control
> > that both mics were receiving signal, i.e. both were active. I got this
> > output:
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel




From coronasensei at gmail.com  Sun Nov 13 23:39:41 2011
From: coronasensei at gmail.com (Andrew Leech)
Date: Mon, 14 Nov 2011 09:39:41 +1100
Subject: [Linux-uvc-devel] Webcam with nv12
In-Reply-To: <CA+dM+uLhjEppJY7bnX2YhYdaNy-72OU=ocALzEfMyx0m8j5_=w@mail.gmail.com>
References: <CA+dM+uLhjEppJY7bnX2YhYdaNy-72OU=ocALzEfMyx0m8j5_=w@mail.gmail.com>
Message-ID: <4EC0472D.5040109@gmail.com>

It's quite safe to say no one has ever made a camera like this 
commercially. Even yuy2 is very rare, as the bandwidth requirements are 
too high. I've made custom built hardware that captures PAL to yuy2 uvc 
at 768 x 576 and that takes ~22MB/s on the USB bus, which only works on 
quite stable usb connections (ie most front ports can't keep up because 
of error rates). To even get 720p at 25fps you would need 35MB/s which 
is relatively rare to achive on a real device. You've got not chance of 
getting 1080p except at a very low frame rate.

On top of that, Windows UVC driver doesn't support NV12 as standard, so 
you would need to add your own directshow filter to convert it. This is 
what I do to support Y800 which isn't officially supported by uvc 
anyway, but by adding my own custom filter I can convert it into RGB24 
at the computer end and use it fine.

Manufacturers just use mjpeg typically, because it means they can get 
high resolutions, windows support and still work on a normal usb port 
easily.

If you really need NV12 you will basically need to make your own 
controller, I can suggest the LPC3131 because I know it works, but it 
takes a lot of work to make it, and you would need frame buffer memory 
added to it to handle NV12 (my hardware doesn't have any ram for 
framebuffering).

On 13/11/2011 2:51 PM, ge s wrote:
> hi,all.I need a pixel format for NV12 and resolution for 720p or 1080p 
> USB webcam.
> For a long time did not find the corresponding usb webcam.Please give 
> me some advice!Thank you!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111114/b55d97e1/attachment.html>

From michaeltandy at gmail.com  Mon Nov 14 20:20:12 2011
From: michaeltandy at gmail.com (Michael Tandy)
Date: Mon, 14 Nov 2011 19:20:12 +0000
Subject: [Linux-uvc-devel] Sweex WC061 HD Webcam Sliver
In-Reply-To: <201111031120.06914.laurent.pinchart@ideasonboard.com>
References: <CAHGSkqgyRgbt_G5MB6DewazJML8B1OkGyF0yP=qqKoRm28FapQ@mail.gmail.com>
	<CAHGSkqjee4DbDMnOKsrfp1Haih_bybkGSvWhPi_2YmraDa4rpQ@mail.gmail.com>
	<4E670B24.1040504@fisher-privat.net>
	<201111031120.06914.laurent.pinchart@ideasonboard.com>
Message-ID: <CAHGSkqiA8pk+ETg7BmLYcM=dyKmZ3qxV7hzxSDrogQokHCnHOQ@mail.gmail.com>

I did some more experiments with this webcam, and with a nasty hack
got it working.

Basically the problem seems to be the frame interval requested. If I
replace line 175 of uvc_v4l2.c [1] with

probe->dwFrameInterval = 2500000;

the camera works fine in mjpeg mode.

The frame interval behaves oddly in this camera, in that if you set
the frame interval above a certain threshold the camera seems to
ignore it and send frames at whatever rate it feels like, but if you
set it below a certain threshold the camera exhibits the bug I've
described above, sending back corrupted frames and error codes. Most
likely a firmware bug, as I can't imagine anyone would design a camera
to function that way.

I assume we wouldn't be inclined to patch the kernel to deal with this
one camera's weird behaviour?

[1] http://lxr.free-electrons.com/source/drivers/media/video/uvc/uvc_v4l2.c?v=2.6.28#L175


On 3 November 2011 10:20, Laurent Pinchart
<laurent.pinchart at ideasonboard.com> wrote:
> Hi,
>
> On Wednesday 07 September 2011 08:11:48 Alexey Fisher wrote:
>> Am 06.09.2011 12:53, schrieb Michael Tandy:
>> > [99317.553237] uvcvideo: uvc_v4l2_ioctl(VIDIOC_STREAMON)
>> > [99317.554747] uvcvideo: uvc_v4l2_poll
>> > [99333.472385] uvcvideo: Dropping payload (error bit set).
>> > [99333.472389] uvcvideo: Frame complete (EOF found).
>> > [99333.472391] uvcvideo: EOF in empty payload.
>> > [99333.472429] uvcvideo: uvc_v4l2_poll
>> > [99333.472438] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
>> > [99333.472447] uvcvideo: Dequeuing buffer 0 (3, 2676 bytes).
>>
>> hmm... the camera notify us about with error bit set, but current driver
>> will just drop it and mark the buffer as faulty.
>
> As the data can't be trusted, the uvcvideo driver decides to drop the packet.
> Alternatively the packet could be processed normally and the buffer market as
> bad. It would then be up to the application to decide what to do with such
> buffers (you will have to set the no_drop module parameter to 1, as the driver
> drops faulty buffers by default).
>
> The following patch should implement that behaviour, in case you want to test
> it.
>
> diff --git a/drivers/media/video/uvc/uvc_video.c b/drivers/media/video/uvc/uvc_video.c
> index ffd1158..baa5850 100644
> --- a/drivers/media/video/uvc/uvc_video.c
> +++ b/drivers/media/video/uvc/uvc_video.c
> @@ -419,13 +419,6 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
> ? ? ? ?if (len < 2 || data[0] < 2 || data[0] > len)
> ? ? ? ? ? ? ? ?return -EINVAL;
>
> - ? ? ? /* Skip payloads marked with the error bit ("error frames"). */
> - ? ? ? if (data[1] & UVC_STREAM_ERR) {
> - ? ? ? ? ? ? ? uvc_trace(UVC_TRACE_FRAME, "Dropping payload (error bit "
> - ? ? ? ? ? ? ? ? ? ? ? ? "set).\n");
> - ? ? ? ? ? ? ? return -ENODATA;
> - ? ? ? }
> -
> ? ? ? ?fid = data[1] & UVC_STREAM_FID;
>
> ? ? ? ?/* Increase the sequence number regardless of any buffer states, so
> @@ -442,6 +435,13 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
> ? ? ? ? ? ? ? ?return -ENODATA;
> ? ? ? ?}
>
> + ? ? ? /* Mark the buffer as bad if the error bit is set. */
> + ? ? ? if (data[1] & UVC_STREAM_ERR) {
> + ? ? ? ? ? ? ? uvc_trace(UVC_TRACE_FRAME, "Marking buffer as bad (error bit "
> + ? ? ? ? ? ? ? ? ? ? ? ? "set).\n");
> + ? ? ? ? ? ? ? buf->error = 1;
> + ? ? ? }
> +
> ? ? ? ?/* Synchronize to the input stream by waiting for the FID bit to be
> ? ? ? ? * toggled when the the buffer state is not UVC_BUF_STATE_ACTIVE.
> ? ? ? ? * stream->last_fid is initialized to -1, so the first isochronous
>
>
>> According to uvc specification v1.1 in "4.3.1.7 Stream Error Code
>> Control" we can/should check the error reason:
>> -------------------------------------------------------------------
>> The host software should send a GET_CUR request to this control to
>> determine the error when one of the following events occurs:
>> - The Error bit in the video or still image payload header is set by the
>> device
>> ....
>> For scenarios where the host is transmitting video data to the device,
>> the host can not use the Error bit in the payload header to detect a
>> device error. Therefore, in order to determine when a streaming error
>> occurs, the host must rely on either a Control Change interrupt from the
>> device or a bulk endpoint stall.
>> --------------------------------------------------------------------
>>
>> I'm suddenly not so good to implement ne things without testing and
>> probing. May be Laurent can do this? Or i need access to the webcam.
>
> Retrieving the cause of the error requires sending a control request, which
> can't be done in interrupt context. This could be implemented, but won't be
> trivial, and I'm not sure it will give any useful information anyway. Knowing
> whether the error comes from a buffer underrun, a buffer overrun or something
> else won't let the driver fix the error.
>
> --
> Regards,
>
> Laurent Pinchart
>


From jpitt at fhcrc.org  Tue Nov 15 19:43:36 2011
From: jpitt at fhcrc.org (Pitt, Jason N)
Date: Tue, 15 Nov 2011 10:43:36 -0800 (PST)
Subject: [Linux-uvc-devel] possible uvcvideo driver error with current 3.1
	kernel
In-Reply-To: <1321210661.2720.0.camel@edwinaponteL.WORKGROUP>
Message-ID: <113683370.22487.1321382616117.JavaMail.root@zimbra2.fhcrc.org>

I have a bunch of usb cards that have moschip ehci controllers in them that have a silicon bug that causes the microframe counter to be updated before the frame counter here's the details of the patch:

This patch (as1489) works around a hardware bug in MosChip EHCI
controllers.  Evidently when one of these controllers increments the
frame-index register, it changes the three low-order bits (the
microframe counter) before changing the higher order bits (the frame
counter).  If the register is read at just the wrong time, the value
obtained is too low by 8.

When the appropriate quirk flag is set, we work around this problem by
reading the frame-index register a second time if the first value's
three low-order bits are all 0.  This gives the hardware a chance to
finish updating the register, yielding the correct value.

This prevents the main problem of the driver crashing but there is a lingering issue that I believe is due to the uvcvideo driver's handling of the patch.  The video stream eventually seems to "loose sync" is the best way i can describe it....I've posted a video of the problem on youtube here: http://www.youtube.com/watch?v=W-gAHa0zL7A 

There are 12 instances of guvcvideo running, 3 or 4 of the cameras have developed the issue after about 12 hours.  When the glitch happens, the bottom portion of the image freezes and the flashing segments at the top are still updating but clearly something is messed up.  Any thoughts?

-Jason  

-- 
/*
Jason Pitt PhD                                   206.667.5603
Roth Lab                                      jpitt at fhcrc.org
Basic Sciences Division 
Fred Hutchinson Cancer Research Center
1100 Fairview Ave N A3-135
Seattle, WA 98109
*/


From laurent.pinchart at ideasonboard.com  Wed Nov 16 03:21:31 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 16 Nov 2011 03:21:31 +0100
Subject: [Linux-uvc-devel] Suggestion for FAQ update
In-Reply-To: <4EBBC0A9.1040205@fisher-privat.net>
References: <4EBBC0A9.1040205@fisher-privat.net>
Message-ID: <201111160321.32841.laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Thursday 10 November 2011 13:16:41 Alexey Fisher wrote:
> Hi Laurent,
> 
> i think it is good time to update FAQ. And add notice about reading the
> FAQ before ask some thing on maeling list.
> 
> My suggestion entry to FAQ:
> ================================================================
> I have an UVC webcam but it is not working. What do you need to
> troubleshoot it?
> 
> 1. Read "How do I find out whether my camera is a UVC device or not?"
> 2. Create usb dump file and attach it to email:
> 
> lsusb -vd 046d:08cb > lsusb_dump
> 
> 3. Enable debug for uvcvideo module:
> 
> sudo echo 0xfff > /sys/module/uvcvideo/parameters/trace
> 
> 4. reproduce the problem
> 5. attach dmesg to email
> 
> dmesg > dmesg
> 
> PS: Please do not use HTML formatet mails.
> 
> ==============================================================
> 
> 
> Your suggestions?

Thanks for the suggestion. I've updated the FAQ (after modifying the text 
slightly).

-- 
Regards,

Laurent Pinchart


From kaz at kylheku.com  Thu Nov 17 03:20:20 2011
From: kaz at kylheku.com (Kaz Kylheku)
Date: Wed, 16 Nov 2011 19:20:20 -0700
Subject: [Linux-uvc-devel] Simultaneous encoded stream and unencoded preview.
In-Reply-To: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
References: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
Message-ID: <149b8ec5e93c0721e9ccf802a6778fa4@127.0.0.1>


On Wed, 02 Nov 2011 18:20:30 -0700, Kaz Kylheku <kaz at kylheku.com>
wrote:
> Hey all,
> 
> I'm working with the B990 on an ARM-based embedded system based on
> linux-2.6.27.47.

H.264 is working fine for me, but what I'd like to know is how to
capture an unencoded preview stream at the same time?

I see there is a kind of mutual exclusion mechanism whereby everyone
opens the device in "nonprivileged" mode, but only one of the
file descriptors can hold the "privilege" stick.  Only the holder of
the privilege stick can request a video capture.  The others
attempting to do do that get an -EBUSY and that is that?

Is there no way to capture two streams at the same time?

I would think this is a common requirement. E.g. in two-way video
calls (a popular application for USB cams) you can send video encoded
by the camera itself to the remote host, and produce the local image
(e.g. in a smaller picture-in-picture window) from an unencoded
stream coming from the camera in parallel (perhaps at a different
resolution and frame rate). So the only decoding task going on
is for displaying the remote video. The local host doesn't have
to decode the local video just to display the preview image.




From kaz at kylheku.com  Thu Nov 17 03:51:58 2011
From: kaz at kylheku.com (Kaz Kylheku)
Date: Wed, 16 Nov 2011 19:51:58 -0700
Subject: [Linux-uvc-devel] Simultaneous encoded stream and unencoded
	preview.
In-Reply-To: <149b8ec5e93c0721e9ccf802a6778fa4@127.0.0.1>
References: <7f64ed4e85a9d95b2eb13c4a1a3816c4@127.0.0.1>
	<149b8ec5e93c0721e9ccf802a6778fa4@127.0.0.1>
Message-ID: <054c1903ab7f04920e866e112bdc86bf@127.0.0.1>


On Wed, 16 Nov 2011 19:20:20 -0700, Kaz Kylheku <kaz at kylheku.com>
wrote:
> I'd like to know is how to
> capture an unencoded preview stream at the same time?

I see Laurent put out patches for this a couple of years ago:

http://lists.berlios.de/pipermail/linux-uvc-devel/2009-July/004999.html

Messages entitled:

[Linux-uvc-devel] [PATCH 1/2] uvcvideo: Restructure the driver to
support multiple simultaneous streams.

Unfortunately, the code I have here rather resembles the --- side much
more than the +++, heh!

Slight oopsie there!

So, I will grab these and run with them.



From bug-track at fisher-privat.net  Thu Nov 17 08:39:30 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 17 Nov 2011 08:39:30 +0100
Subject: [Linux-uvc-devel] Sweex WC061 HD Webcam Sliver
In-Reply-To: <CAHGSkqiA8pk+ETg7BmLYcM=dyKmZ3qxV7hzxSDrogQokHCnHOQ@mail.gmail.com>
References: <CAHGSkqgyRgbt_G5MB6DewazJML8B1OkGyF0yP=qqKoRm28FapQ@mail.gmail.com>
	<CAHGSkqjee4DbDMnOKsrfp1Haih_bybkGSvWhPi_2YmraDa4rpQ@mail.gmail.com>
	<4E670B24.1040504@fisher-privat.net>
	<201111031120.06914.laurent.pinchart@ideasonboard.com>
	<CAHGSkqiA8pk+ETg7BmLYcM=dyKmZ3qxV7hzxSDrogQokHCnHOQ@mail.gmail.com>
Message-ID: <4EC4BA32.9050901@fisher-privat.net>

Am 14.11.2011 20:20, schrieb Michael Tandy:
> I did some more experiments with this webcam, and with a nasty hack
> got it working.
>
> Basically the problem seems to be the frame interval requested. If I
> replace line 175 of uvc_v4l2.c [1] with
>
> probe->dwFrameInterval = 2500000;
>
> the camera works fine in mjpeg mode.
>
> The frame interval behaves oddly in this camera, in that if you set
> the frame interval above a certain threshold the camera seems to
> ignore it and send frames at whatever rate it feels like, but if you
> set it below a certain threshold the camera exhibits the bug I've
> described above, sending back corrupted frames and error codes. Most
> likely a firmware bug, as I can't imagine anyone would design a camera
> to function that way.
>
> I assume we wouldn't be inclined to patch the kernel to deal with this
> one camera's weird behaviour?
>
> [1] http://lxr.free-electrons.com/source/drivers/media/video/uvc/uvc_v4l2.c?v=2.6.28#L175
>

Hi Laurent,
i still think that checking the reason of error bit, make sense.
In this case we check the reason of error bit. If we get permanent 
buffer underrun or overrun, we should switch to different framerate. Or 
notify user to do that.

And probably add the "error bit handler" to the uvc status list on your 
page :)

Regards,
Alexey.


From bug-track at fisher-privat.net  Thu Nov 17 08:52:18 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 17 Nov 2011 08:52:18 +0100
Subject: [Linux-uvc-devel] possible uvcvideo driver error with current
 3.1 kernel
In-Reply-To: <113683370.22487.1321382616117.JavaMail.root@zimbra2.fhcrc.org>
References: <113683370.22487.1321382616117.JavaMail.root@zimbra2.fhcrc.org>
Message-ID: <4EC4BD32.5040705@fisher-privat.net>

Am 15.11.2011 19:43, schrieb Pitt, Jason N:
> I have a bunch of usb cards that have moschip ehci controllers in them that have a silicon bug that causes the microframe counter to be updated before the frame counter here's the details of the patch:
>
> This patch (as1489) works around a hardware bug in MosChip EHCI
> controllers.  Evidently when one of these controllers increments the
> frame-index register, it changes the three low-order bits (the
> microframe counter) before changing the higher order bits (the frame
> counter).  If the register is read at just the wrong time, the value
> obtained is too low by 8.
>
> When the appropriate quirk flag is set, we work around this problem by
> reading the frame-index register a second time if the first value's
> three low-order bits are all 0.  This gives the hardware a chance to
> finish updating the register, yielding the correct value.
>
> This prevents the main problem of the driver crashing but there is a lingering issue that I believe is due to the uvcvideo driver's handling of the patch.  The video stream eventually seems to "loose sync" is the best way i can describe it....I've posted a video of the problem on youtube here: http://www.youtube.com/watch?v=W-gAHa0zL7A
>
> There are 12 instances of guvcvideo running, 3 or 4 of the cameras have developed the issue after about 12 hours.  When the glitch happens, the bottom portion of the image freezes and the flashing segments at the top are still updating but clearly something is messed up.  Any thoughts?

The problem in this case is to run uvcvideo trace for 12 hours :)
can you try to run it again and enable trace for short time with correct 
image and with brocken image.

you do not need reloading module to do that. Do fallowing:

sudo echo 0xffff > /sys/module/uvcvideo/parameters/trace &&
sleep 10s &&
sudo echo 0 > /sys/module/uvcvideo/parameters/trace


Regards,
Alexey


From bug-track at fisher-privat.net  Thu Nov 17 09:16:11 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 17 Nov 2011 09:16:11 +0100
Subject: [Linux-uvc-devel] [PATCH] uvcvideo: correct error message for
	debugfs stats file
Message-ID: <1321517771-4851-1-git-send-email-bug-track@fisher-privat.net>

Signed-off-by: Alexey Fisher <bug-track at fisher-privat.net>
---
 drivers/media/video/uvc/uvc_debugfs.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/drivers/media/video/uvc/uvc_debugfs.c b/drivers/media/video/uvc/uvc_debugfs.c
index bdba016..1b0087b 100644
--- a/drivers/media/video/uvc/uvc_debugfs.c
+++ b/drivers/media/video/uvc/uvc_debugfs.c
@@ -97,8 +97,7 @@ int uvc_debugfs_init_stream(struct uvc_streaming *stream)
 	dent = debugfs_create_file("stats", 0600, stream->debugfs_dir,
 				   stream, &uvc_debugfs_stats_fops);
 	if (IS_ERR_OR_NULL(dent)) {
-		uvc_printk(KERN_INFO, "Unable to create debugfs %s directory.\n",
-			   dir_name);
+		uvc_printk(KERN_INFO, "Unable to create debugfs stats file.\n");
 		uvc_debugfs_cleanup_stream(stream);
 		return -ENODEV;
 	}
-- 
1.7.5.4



From vickylinuxer at gmail.com  Thu Nov 17 10:41:56 2011
From: vickylinuxer at gmail.com (vignesh rajendran)
Date: Thu, 17 Nov 2011 09:41:56 +0000
Subject: [Linux-uvc-devel] Z-star camera problem
In-Reply-To: <4EBCFEB1.6040307@fisher-privat.net>
References: <CALoDM-FSECWcYJ9J3ykSa=S_d7UzrJfGNhXLbT0_i2preN7vPA@mail.gmail.com>
	<4EBBBC93.7010901@fisher-privat.net>
	<CALoDM-FDMO_F-NHcvxJxpCtTOX45NjS6FnKX=73RvDSBxU4Zgw@mail.gmail.com>
	<CALoDM-EQiiDK_CB-ux0zoDenpsbN=sv8ivx_YQjE_YCjPLKwag@mail.gmail.com>
	<CALoDM-Eveph+AVXTHzunNMNbkawoRXA0F7eMX+ufw_TN+Uw+Gg@mail.gmail.com>
	<4EBCD56E.9010801@fisher-privat.net>
	<CALoDM-G+hXNLCnNUkExSTJMQ6vAHTayTprKqgn-doBqBaV0=cw@mail.gmail.com>
	<4EBCFEB1.6040307@fisher-privat.net>
Message-ID: <CALoDM-EMLTM4eFwM9h81nderi9oZXucg3ukAFtkMSwrM4eHVCA@mail.gmail.com>

On Fri, Nov 11, 2011 at 10:53 AM, Alexey Fisher <bug-track at fisher-privat.net
> wrote:

> Am 11.11.2011 10:32, schrieb vignesh rajendran:
>
>  Hi
>>
>>  Again the same.No changes.I am getting green display in my touchscreen.
>>
>> I attached Dmesg with this mail
>>
>
> There is no debug info in this dmesg if you enable debug it loogs like
> this:
> [19585.878562] uvcvideo: Queuing buffer 0.
> [19585.879289] uvcvideo: uvc_v4l2_poll
> [19585.942567] uvcvideo: Frame complete (EOF found).
> [19585.942582] uvcvideo: uvc_v4l2_poll
> [19585.942592] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
> [19585.942598] uvcvideo: Dequeuing buffer 1 (4, 614400 bytes).
> [19585.942602] uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
> [19585.942605] uvcvideo: Queuing buffer 1.
> [19585.944600] uvcvideo: uvc_v4l2_poll
> [19586.010537] uvcvideo: Frame complete (EOF found).
> [19586.010560] uvcvideo: uvc_v4l2_poll
> [19586.010568] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
> [19586.010574] uvcvideo: Dequeuing buffer 2 (4, 614400 bytes).
> [19586.010578] uvcvideo: uvc_v4l2_ioctl(VIDIOC_QBUF)
> [19586.010581] uvcvideo: Queuing buffer 2.
>

I enabled debug.But it not showing anything in dmesg.

-- 
Regards

Vignesh Rajendran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111117/903636f3/attachment.html>

From laurent.pinchart at ideasonboard.com  Thu Nov 17 11:11:33 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Thu, 17 Nov 2011 11:11:33 +0100
Subject: [Linux-uvc-devel] [PATCH] uvcvideo: correct error message for
	debugfs stats file
In-Reply-To: <1321517771-4851-1-git-send-email-bug-track@fisher-privat.net>
References: <1321517771-4851-1-git-send-email-bug-track@fisher-privat.net>
Message-ID: <201111171111.34996.laurent.pinchart@ideasonboard.com>

Hi Alexey,

Thanks for the patch.

As your original patch hasn't been pushed to upstream yet, I've combined it 
with this patch.

On Thursday 17 November 2011 09:16:11 Alexey Fisher wrote:
> Signed-off-by: Alexey Fisher <bug-track at fisher-privat.net>
> ---
>  drivers/media/video/uvc/uvc_debugfs.c |    3 +--
>  1 files changed, 1 insertions(+), 2 deletions(-)
> 
> diff --git a/drivers/media/video/uvc/uvc_debugfs.c
> b/drivers/media/video/uvc/uvc_debugfs.c index bdba016..1b0087b 100644
> --- a/drivers/media/video/uvc/uvc_debugfs.c
> +++ b/drivers/media/video/uvc/uvc_debugfs.c
> @@ -97,8 +97,7 @@ int uvc_debugfs_init_stream(struct uvc_streaming *stream)
>  	dent = debugfs_create_file("stats", 0600, stream->debugfs_dir,
>  				   stream, &uvc_debugfs_stats_fops);
>  	if (IS_ERR_OR_NULL(dent)) {
> -		uvc_printk(KERN_INFO, "Unable to create debugfs %s directory.\n",
> -			   dir_name);
> +		uvc_printk(KERN_INFO, "Unable to create debugfs stats file.\n");
>  		uvc_debugfs_cleanup_stream(stream);
>  		return -ENODEV;
>  	}

-- 
Regards,

Laurent Pinchart


From bug-track at fisher-privat.net  Thu Nov 17 11:15:53 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 17 Nov 2011 11:15:53 +0100
Subject: [Linux-uvc-devel] [PATCH] uvcvideo: correct error message for
	debugfs stats file
In-Reply-To: <201111171111.34996.laurent.pinchart@ideasonboard.com>
References: <1321517771-4851-1-git-send-email-bug-track@fisher-privat.net>
	<201111171111.34996.laurent.pinchart@ideasonboard.com>
Message-ID: <4EC4DED9.1080002@fisher-privat.net>

Am 17.11.2011 11:11, schrieb Laurent Pinchart:
> Hi Alexey,
>
> Thanks for the patch.
>
> As your original patch hasn't been pushed to upstream yet, I've combined it
> with this patch.

Great, thanks!
i'm currently about to add the uvc "report" file debugfs. Any wishes?


From sandro at w3.org  Thu Nov 17 17:03:44 2011
From: sandro at w3.org (Sandro Hawke)
Date: Thu, 17 Nov 2011 16:03:44 +0000 (UTC)
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
References: <1320250767.21196.22@hogo> <4EB1892E.50209@gladstonefamily.net>
	<4EB18EEB.8090903@open-t.co.uk>
Message-ID: <loom.20111117T170100-849@post.gmane.org>

> Could I be a pain and ask for a link to the thread about the patch, or 
> to the patch itself please.

I would very much appreciate this, too.

    - Sandro







From philip at gladstonefamily.net  Thu Nov 17 17:29:28 2011
From: philip at gladstonefamily.net (Philip Gladstone)
Date: Thu, 17 Nov 2011 11:29:28 -0500
Subject: [Linux-uvc-devel] Quirk for mjpeg bandwidth
In-Reply-To: <loom.20111117T170100-849@post.gmane.org>
References: <1320250767.21196.22@hogo> <4EB1892E.50209@gladstonefamily.net>
	<4EB18EEB.8090903@open-t.co.uk>
	<loom.20111117T170100-849@post.gmane.org>
Message-ID: <4EC53668.8090506@gladstonefamily.net>

I have put the patches that I am using on:  http://pskreporter.info/uvc.pf

Unfortunately, these patches also include a change to convert from 
uvc_trace to pr_debug, so there are a lot more changes than necessary.

Philip

On 11/17/2011 11:03 AM, Sandro Hawke wrote:
>> Could I be a pain and ask for a link to the thread about the patch, or
>> to the patch itself please.
> I would very much appreciate this, too.
>
>      - Sandro
>
>
>
>
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>

-- 
Philip Gladstone
Ham: N1DQ



From jrvp at bordenrhodes.com  Sat Nov 19 23:36:18 2011
From: jrvp at bordenrhodes.com (Borden Rhodes)
Date: Sat, 19 Nov 2011 17:36:18 -0500
Subject: [Linux-uvc-devel] Chicony webcam report
Message-ID: <CABeHYocPeq+CPvH=dY6aGo9_DHk9tPUbp8YWeTR1NyiyneqL5Q@mail.gmail.com>

Good afternoon, list,

I wanted to report that Fujitsu Lifebook T4410s come with a Chicony
CNF8248 webcam installed (predictably) upside down.  The UVC page does
not list this webcam (which has USB ID 04f2:b169) nor do the v4l
drivers correct for the upside-downness.  It's possible my drivers are
out of date because, otherwise, everything else works fine.  I'm using
Debian Wheezy.  Just thought I'd let you know.

Borden


From dixlor at gmail.com  Mon Nov 21 02:52:08 2011
From: dixlor at gmail.com (DIXLOR)
Date: Mon, 21 Nov 2011 05:52:08 +0400
Subject: [Linux-uvc-devel] Send some bytes to device
Message-ID: <4EC9AEC8.6010301@gmail.com>

Good day All!

How and where in your uvc driver code to be inserted,
?o pass in the USB a few bytes?

With libusb this string looks like:

#define ON_LED  "\x00\x00\x01\xc2\x00\x00\x00"
memcpy(buf, ON_LED, 0x7);
usb_control_msg(devh, USB_TYPE_CLASS + USB_RECIP_INTERFACE,  1, 0x600, 0x400,
buf, 0x7, 1000);

The problem is that this code works only when the camera is turned on.

---
In kernel code with looks like

#define ON_LED  "\x00\x00\x01\xc2\x00\x00\x00"

buff = kmalloc(0x7, GFP_KERNEL);
memcpy(buff, ON_LED, 0x7);
ret = usb_control_msg(udev, usb_sndctrlpipe(udev, 0x83), 0x21, 0x1, 0x600,
0x400, buff, 0x7, 1000);

uvc_printk(KERN_ERR, "retval = %d\n", ret);

But where to insert this code?
And it should be sent only after the start the video.



From aversa at email.arizona.edu  Mon Nov 21 04:17:23 2011
From: aversa at email.arizona.edu (Alan Aversa)
Date: Sun, 20 Nov 2011 20:17:23 -0700
Subject: [Linux-uvc-devel] JVC GR-D72 support
Message-ID: <4EC9C2C3.3050502@email.arizona.edu>

Hello,
     I would like to suggest that uvcvideo add JVC GR-D72 support.

Thank you,
Alan Aversa
-- 
Laud?tur Iesus Christus in s?cula. <http://bit.ly/f9FtGt>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111120/984c4824/attachment.html>

From bug-track at fisher-privat.net  Mon Nov 21 08:34:08 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 21 Nov 2011 08:34:08 +0100
Subject: [Linux-uvc-devel] JVC GR-D72 support
In-Reply-To: <4EC9C2C3.3050502@email.arizona.edu>
References: <4EC9C2C3.3050502@email.arizona.edu>
Message-ID: <4EC9FEF0.3000201@fisher-privat.net>

Please read FAQ

http://www.ideasonboard.org/uvc/faq/

Regards,
Alexey

On 21.11.2011 04:17, Alan Aversa wrote:
> Hello,
>     I would like to suggest that uvcvideo add JVC GR-D72 support.
> 
> Thank you,
> Alan Aversa
> 
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From bug-track at fisher-privat.net  Mon Nov 21 08:41:32 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 21 Nov 2011 08:41:32 +0100
Subject: [Linux-uvc-devel] Send some bytes to device
In-Reply-To: <4EC9AEC8.6010301@gmail.com>
References: <4EC9AEC8.6010301@gmail.com>
Message-ID: <4ECA00AC.4090407@fisher-privat.net>

Hi,

i'm not sure, but it looks like all non-uvc controls are done in
libwebcam and uvcdynctrl-data. For example this one is for logitech
uvcdynctrl-data: /usr/share/uvcdynctrl/data/046d/logitech.xml


On 21.11.2011 02:52, DIXLOR wrote:
> Good day All!
> 
> How and where in your uvc driver code to be inserted,
> ?o pass in the USB a few bytes?
> 
> With libusb this string looks like:
> 
> #define ON_LED  "\x00\x00\x01\xc2\x00\x00\x00"
> memcpy(buf, ON_LED, 0x7);
> usb_control_msg(devh, USB_TYPE_CLASS + USB_RECIP_INTERFACE,  1, 0x600, 0x400,
> buf, 0x7, 1000);
> 
> The problem is that this code works only when the camera is turned on.
> 
> ---
> In kernel code with looks like
> 
> #define ON_LED  "\x00\x00\x01\xc2\x00\x00\x00"
> 
> buff = kmalloc(0x7, GFP_KERNEL);
> memcpy(buff, ON_LED, 0x7);
> ret = usb_control_msg(udev, usb_sndctrlpipe(udev, 0x83), 0x21, 0x1, 0x600,
> 0x400, buff, 0x7, 1000);
> 
> uvc_printk(KERN_ERR, "retval = %d\n", ret);
> 
> But where to insert this code?
> And it should be sent only after the start the video.
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From aversa at email.arizona.edu  Mon Nov 21 09:30:35 2011
From: aversa at email.arizona.edu (Alan Aversa)
Date: Mon, 21 Nov 2011 01:30:35 -0700
Subject: [Linux-uvc-devel] JVC GR-D72 support
In-Reply-To: <4EC9FEF0.3000201@fisher-privat.net>
References: <4EC9C2C3.3050502@email.arizona.edu>
	<4EC9FEF0.3000201@fisher-privat.net>
Message-ID: <4ECA0C2B.5090106@email.arizona.edu>

Hello,

I have followed the instructions at the link you gave and have attached 
the lsusb.log for my camera as well as the dmesg.log of running "dvgrab -V".

Thanks,
Alan

On 21/11/11 00:34, Alexey Fisher wrote:
> Please read FAQ
>
> http://www.ideasonboard.org/uvc/faq/
>
> Regards,
> Alexey
>
> On 21.11.2011 04:17, Alan Aversa wrote:
>> Hello,
>>      I would like to suggest that uvcvideo add JVC GR-D72 support.
>>
>> Thank you,
>> Alan Aversa
>>
>>
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel

-- 
Laud?tur Iesus Christus in s?cula. <http://bit.ly/f9FtGt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dmesg.log
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111121/392b6771/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lsusb.log
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111121/392b6771/attachment-0001.ksh>

From bug-track at fisher-privat.net  Mon Nov 21 09:37:48 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 21 Nov 2011 09:37:48 +0100
Subject: [Linux-uvc-devel] JVC GR-D72 support
In-Reply-To: <4ECA0C2B.5090106@email.arizona.edu>
References: <4EC9C2C3.3050502@email.arizona.edu>
	<4EC9FEF0.3000201@fisher-privat.net>
	<4ECA0C2B.5090106@email.arizona.edu>
Message-ID: <4ECA0DDC.3000500@fisher-privat.net>

It is not UVC device. There is nothing we can do about it.


On 21.11.2011 09:30, Alan Aversa wrote:
> Hello,
> 
> I have followed the instructions at the link you gave and have attached
> the lsusb.log for my camera as well as the dmesg.log of running "dvgrab
> -V".
> 
> Thanks,
> Alan
> 
> On 21/11/11 00:34, Alexey Fisher wrote:
>> Please read FAQ
>>
>> http://www.ideasonboard.org/uvc/faq/
>>
>> Regards,
>> Alexey
>>
>> On 21.11.2011 04:17, Alan Aversa wrote:
>>> Hello,
>>>      I would like to suggest that uvcvideo add JVC GR-D72 support.
>>>
>>> Thank you,
>>> Alan Aversa
>>>
>>>
>>> _______________________________________________
>>> Linux-uvc-devel mailing list
>>> Linux-uvc-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 
> 
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From dixlor at gmail.com  Mon Nov 21 10:09:58 2011
From: dixlor at gmail.com (DIXLOR)
Date: Mon, 21 Nov 2011 13:09:58 +0400
Subject: [Linux-uvc-devel] Send some bytes to device
Message-ID: <4ECA1566.9080802@gmail.com>


21, 01, 1, 0x600, 0x400, buf, 0x7, 1000

21 - CLASS
01 - DIRECTION
0x600 - ?
0x400 - ?
buf - buf
0x7 - sizeof(buf)
1000 - timeout

it's dump via usbmon.


For example  setting brightness

# v4l2-ctl -c brightness=1

in dump look like a

s 21 01 0200 0001 001a 26 =
01000101 15160500 00000000 00000000 52890060 0900000c 0000
. . . .  . . . .  . . . .  . . . .  R . . `  . . . .  . .

503f1000 3992.234728 S Co:1:021:0 s 21 01 0200 0300 0002 2 =
    0200

or in libusb

#define BRIGHT  "\x02\x00"
memcpy(buf, BRIGHT, 0x2);
usb_control_msg(devh, USB_TYPE_CLASS + USB_RECIP_INTERFACE,  1, 0x200, 0x300,
buf, 0x2, 1000);

or via ioctl()

 struct v4l2_ext_control xctrl;
 ctrl.id = V4L2_CID_BRIGHTNESS;
 ctrl.value = 0x2;

 fd = open("/dev/video0", O_RDWR);
 ioctl(fd, VIDIOC_S_EXT_CTRLS, &xctrl);

---
What do you think, what me need insert into struct v4l2_ext_control,
that have turned out 0x600 and 0x400 in USB control message?




From bug-track at fisher-privat.net  Mon Nov 21 15:51:47 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 21 Nov 2011 15:51:47 +0100
Subject: [Linux-uvc-devel] [patch] add "report" file to debugfs
Message-ID: <4ECA6583.6010501@fisher-privat.net>

Hi Laurent,

here is my version of bug_report file for debugfs.
It include usb.id, dmi.system.product (for upsidedown report). And
stream specific information. I think it is good size for initial patch.
I near future i would like to add control call count  and control error
rate to stats. And probably firs urb error number to report file.
I think it will be enough to provide needed info for troubleshooting.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: uvc_debugfs_3.diff
Type: text/x-patch
Size: 7357 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111121/125c4eac/attachment.bin>

From tango13 at gmail.com  Mon Nov 21 22:37:56 2011
From: tango13 at gmail.com (Michele)
Date: Mon, 21 Nov 2011 22:37:56 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
Message-ID: <201111212237.56651.tango13@gmail.com>

Hello to all uvc developers!

I've bought an Philips UVC SPZ2000 webcam that most of the time doesn't work.
Only once, out of nowhere started to work, but I can't figure out what 
happened: the only different thing was that i was running xawtv as root.

Normally all I got from xawtv is a message like this and a black screen.
The camera as a led lamp, that switches on when I launch xawtv or 


$local/bin/xawtv -noxv -c /dev/video2
local/bin/xawtv -noxv -c /dev/video2
This is xawtv-3.101, running on Linux/i686 (3.0.0-1-686-pae)
xinerama 0: 1920x1080+0+0
Alsa devices: cap: hw:3,0 (/dev/video2), out: default
alsa: Channels count (2) not available for capture: Argomento non valido
alsa: setparams failed
alsa: stream stopped
libv4l2: error turning on stream: Spazio esaurito sul device
v4l2: ioctl(fildes = 4 "/dev/video2", request = _IOW('V', 18, int), data = 
0x0900417C) failed, Spazio esaurito sul device (28, ENOSPC)
v4l2: oops: select timeout
libv4l2: error turning on stream: Dispositivo o risorsa occupata
libv4l2: error reading: Argomento non valido
v4l2: read: Argomento non valido

(in C locale)

This is xawtv-3.101, running on Linux/i686 (3.0.0-1-686-pae)
xinerama 0: 1920x1080+0+0
Alsa devices: cap: hw:3,0 (/dev/video2), out: default
alsa: Channels count (2) not available for capture: Invalid argument
alsa: setparams failed
alsa: stream stopped
libv4l2: error turning on stream: No space left on device
v4l2: ioctl(fildes = 4 "/dev/video2", request = _IOW('V', 18, int), data = 
0x0859C21C) failed, No space left on device (28, ENOSPC)
v4l2: oops: select timeout
libv4l2: error turning on stream: Device or resource busy
libv4l2: error reading: Invalid argument
v4l2: read: Invalid argument

I have two TV cards installed in the PC, so the /dev/video2 device is the 
webcam. I've also tried to use guvcview with similar results, if need I could 
also post the logs obtained with this program. Skype while working flawlessly 
with both  tv captre card displays a black screen if I try to use the cam.

The dmesg log is attached. 

What I could try to make the webcam work? I think there's something wrong 
during the initialization of the camera that make it freeze.

Thank you in advance.
--
Mike
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmesg.log
Type: text/x-log
Size: 28426 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111121/ac8a4147/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lsusb.log
Type: text/x-log
Size: 23662 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111121/ac8a4147/attachment-0001.bin>

From bug-track at fisher-privat.net  Tue Nov 22 08:57:44 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Tue, 22 Nov 2011 08:57:44 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
In-Reply-To: <201111212237.56651.tango13@gmail.com>
References: <201111212237.56651.tango13@gmail.com>
Message-ID: <4ECB55F8.2050305@fisher-privat.net>

Hi, if you can, you should immediately send it back. It is really bad
device.
According to specification found on Phillips support page, this is
640x480 with interpolated 1280x960 resolution. According the usb dump it
can get 640x480 only in MJPEG format. In RAW-YUV it get max
320x240 at 5fps. Skype on linux use only RAW format, so if you will be
lucky you will get 5 frame per second. For this price (amazon.de 20?)
you can get better webcam.
UVC device should just work (even on linux). If it is not working, it is
most probably bad.


On 21.11.2011 22:37, Michele wrote:
> Hello to all uvc developers!
> 
> I've bought an Philips UVC SPZ2000 webcam that most of the time doesn't work.
> Only once, out of nowhere started to work, but I can't figure out what 
> happened: the only different thing was that i was running xawtv as root.
> 
> Normally all I got from xawtv is a message like this and a black screen.
> The camera as a led lamp, that switches on when I launch xawtv or 
> 
> 
> $local/bin/xawtv -noxv -c /dev/video2
> local/bin/xawtv -noxv -c /dev/video2
> This is xawtv-3.101, running on Linux/i686 (3.0.0-1-686-pae)
> xinerama 0: 1920x1080+0+0
> Alsa devices: cap: hw:3,0 (/dev/video2), out: default
> alsa: Channels count (2) not available for capture: Argomento non valido
> alsa: setparams failed
> alsa: stream stopped
> libv4l2: error turning on stream: Spazio esaurito sul device
> v4l2: ioctl(fildes = 4 "/dev/video2", request = _IOW('V', 18, int), data = 
> 0x0900417C) failed, Spazio esaurito sul device (28, ENOSPC)
> v4l2: oops: select timeout
> libv4l2: error turning on stream: Dispositivo o risorsa occupata
> libv4l2: error reading: Argomento non valido
> v4l2: read: Argomento non valido
> 
> (in C locale)
> 
> This is xawtv-3.101, running on Linux/i686 (3.0.0-1-686-pae)
> xinerama 0: 1920x1080+0+0
> Alsa devices: cap: hw:3,0 (/dev/video2), out: default
> alsa: Channels count (2) not available for capture: Invalid argument
> alsa: setparams failed
> alsa: stream stopped
> libv4l2: error turning on stream: No space left on device
> v4l2: ioctl(fildes = 4 "/dev/video2", request = _IOW('V', 18, int), data = 
> 0x0859C21C) failed, No space left on device (28, ENOSPC)
> v4l2: oops: select timeout
> libv4l2: error turning on stream: Device or resource busy
> libv4l2: error reading: Invalid argument
> v4l2: read: Invalid argument
> 
> I have two TV cards installed in the PC, so the /dev/video2 device is the 
> webcam. I've also tried to use guvcview with similar results, if need I could 
> also post the logs obtained with this program. Skype while working flawlessly 
> with both  tv captre card displays a black screen if I try to use the cam.
> 
> The dmesg log is attached. 
> 
> What I could try to make the webcam work? I think there's something wrong 
> during the initialization of the camera that make it freeze.
> 
> Thank you in advance.
> --
> Mike
> 
> 
> 
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel



From laurent.pinchart at ideasonboard.com  Wed Nov 23 14:39:32 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 23 Nov 2011 14:39:32 +0100
Subject: [Linux-uvc-devel] Sweex WC061 HD Webcam Sliver
In-Reply-To: <4EC4BA32.9050901@fisher-privat.net>
References: <CAHGSkqgyRgbt_G5MB6DewazJML8B1OkGyF0yP=qqKoRm28FapQ@mail.gmail.com>
	<CAHGSkqiA8pk+ETg7BmLYcM=dyKmZ3qxV7hzxSDrogQokHCnHOQ@mail.gmail.com>
	<4EC4BA32.9050901@fisher-privat.net>
Message-ID: <201111231439.32954.laurent.pinchart@ideasonboard.com>

Hi Alexey,

On Thursday 17 November 2011 08:39:30 Alexey Fisher wrote:
> Am 14.11.2011 20:20, schrieb Michael Tandy:
> > I did some more experiments with this webcam, and with a nasty hack
> > got it working.
> > 
> > Basically the problem seems to be the frame interval requested. If I
> > replace line 175 of uvc_v4l2.c [1] with
> > 
> > probe->dwFrameInterval = 2500000;
> > 
> > the camera works fine in mjpeg mode.
> > 
> > The frame interval behaves oddly in this camera, in that if you set
> > the frame interval above a certain threshold the camera seems to
> > ignore it and send frames at whatever rate it feels like, but if you
> > set it below a certain threshold the camera exhibits the bug I've
> > described above, sending back corrupted frames and error codes. Most
> > likely a firmware bug, as I can't imagine anyone would design a camera
> > to function that way.
> > 
> > I assume we wouldn't be inclined to patch the kernel to deal with this
> > one camera's weird behaviour?
> > 
> > [1]
> > http://lxr.free-electrons.com/source/drivers/media/video/uvc/uvc_v4l2.c?
> > v=2.6.28#L175
> 
> Hi Laurent,
> i still think that checking the reason of error bit, make sense.
> In this case we check the reason of error bit. If we get permanent
> buffer underrun or overrun, we should switch to different framerate. Or
> notify user to do that.

I could make sense, but I think there are more pressing issues than that :-) 
Automatically lowering the frame rate when we detect that the device is buggy 
is really icing on the cake (and I'm not even sure whether devices will 
correctly report the error causes...).

> And probably add the "error bit handler" to the uvc status list on your
> page :)

The goal is to shorten the list, not make it longer ;-)

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Wed Nov 23 14:54:08 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Wed, 23 Nov 2011 14:54:08 +0100
Subject: [Linux-uvc-devel] Sweex WC061 HD Webcam Sliver
In-Reply-To: <CAHGSkqiA8pk+ETg7BmLYcM=dyKmZ3qxV7hzxSDrogQokHCnHOQ@mail.gmail.com>
References: <CAHGSkqgyRgbt_G5MB6DewazJML8B1OkGyF0yP=qqKoRm28FapQ@mail.gmail.com>
	<201111031120.06914.laurent.pinchart@ideasonboard.com>
	<CAHGSkqiA8pk+ETg7BmLYcM=dyKmZ3qxV7hzxSDrogQokHCnHOQ@mail.gmail.com>
Message-ID: <201111231454.09112.laurent.pinchart@ideasonboard.com>

Hi Michael,

On Monday 14 November 2011 20:20:12 Michael Tandy wrote:
> I did some more experiments with this webcam, and with a nasty hack
> got it working.
> 
> Basically the problem seems to be the frame interval requested. If I
> replace line 175 of uvc_v4l2.c [1] with
> 
> probe->dwFrameInterval = 2500000;
> 
> the camera works fine in mjpeg mode.
> 
> The frame interval behaves oddly in this camera, in that if you set
> the frame interval above a certain threshold the camera seems to
> ignore it and send frames at whatever rate it feels like, but if you
> set it below a certain threshold the camera exhibits the bug I've
> described above, sending back corrupted frames and error codes. Most
> likely a firmware bug, as I can't imagine anyone would design a camera
> to function that way.
> 
> I assume we wouldn't be inclined to patch the kernel to deal with this
> one camera's weird behaviour?

That could be done, but it would likely require something different than the 
current quirks system.

What is the frame interval threshold value for the device ?

> [1]
> http://lxr.free-electrons.com/source/drivers/media/video/uvc/uvc_v4l2.c?v=
> 2.6.28#L175
> 
> 
> On 3 November 2011 10:20, Laurent Pinchart wrote:
> > On Wednesday 07 September 2011 08:11:48 Alexey Fisher wrote:
> >> Am 06.09.2011 12:53, schrieb Michael Tandy:
> >> > [99317.553237] uvcvideo: uvc_v4l2_ioctl(VIDIOC_STREAMON)
> >> > [99317.554747] uvcvideo: uvc_v4l2_poll
> >> > [99333.472385] uvcvideo: Dropping payload (error bit set).
> >> > [99333.472389] uvcvideo: Frame complete (EOF found).
> >> > [99333.472391] uvcvideo: EOF in empty payload.
> >> > [99333.472429] uvcvideo: uvc_v4l2_poll
> >> > [99333.472438] uvcvideo: uvc_v4l2_ioctl(VIDIOC_DQBUF)
> >> > [99333.472447] uvcvideo: Dequeuing buffer 0 (3, 2676 bytes).
> >> 
> >> hmm... the camera notify us about with error bit set, but current driver
> >> will just drop it and mark the buffer as faulty.
> > 
> > As the data can't be trusted, the uvcvideo driver decides to drop the
> > packet. Alternatively the packet could be processed normally and the
> > buffer market as bad. It would then be up to the application to decide
> > what to do with such buffers (you will have to set the no_drop module
> > parameter to 1, as the driver drops faulty buffers by default).
> > 
> > The following patch should implement that behaviour, in case you want to
> > test it.
> > 
> > diff --git a/drivers/media/video/uvc/uvc_video.c
> > b/drivers/media/video/uvc/uvc_video.c index ffd1158..baa5850 100644
> > --- a/drivers/media/video/uvc/uvc_video.c
> > +++ b/drivers/media/video/uvc/uvc_video.c
> > @@ -419,13 +419,6 @@ static int uvc_video_decode_start(struct
> > uvc_streaming *stream, if (len < 2 || data[0] < 2 || data[0] > len)
> >                return -EINVAL;
> > 
> > -       /* Skip payloads marked with the error bit ("error frames"). */
> > -       if (data[1] & UVC_STREAM_ERR) {
> > -               uvc_trace(UVC_TRACE_FRAME, "Dropping payload (error bit "
> > -                         "set).\n");
> > -               return -ENODATA;
> > -       }
> > -
> >        fid = data[1] & UVC_STREAM_FID;
> > 
> >        /* Increase the sequence number regardless of any buffer states,
> > so @@ -442,6 +435,13 @@ static int uvc_video_decode_start(struct
> > uvc_streaming *stream, return -ENODATA;
> >        }
> > 
> > +       /* Mark the buffer as bad if the error bit is set. */
> > +       if (data[1] & UVC_STREAM_ERR) {
> > +               uvc_trace(UVC_TRACE_FRAME, "Marking buffer as bad (error
> > bit " +                         "set).\n");
> > +               buf->error = 1;
> > +       }
> > +
> >        /* Synchronize to the input stream by waiting for the FID bit to
> > be * toggled when the the buffer state is not UVC_BUF_STATE_ACTIVE. *
> > stream->last_fid is initialized to -1, so the first isochronous

-- 
Regards,

Laurent Pinchart


From antonio at hellocatfood.com  Thu Nov 24 00:10:52 2011
From: antonio at hellocatfood.com (Antonio Roberts)
Date: Wed, 23 Nov 2011 23:10:52 +0000
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
Message-ID: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>

I recently bought this wireless webcam;
http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm having
trouble getting it to work on Ubuntu 11.04.

I ran lsusb and got the folowing information about the device:

Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.

I did a Google serach for the device ID and the Linux UVC website
(http://www.ideasonboard.org/uvc/ ) informs me that it matches the
LogiLink Wireless Webcam (so Maplin probably just rebranded this!).
What this website states is that this device should work, which it
doesn't.

The problem I'm facing is that I don't get any actual video being
streamed or shown. The built in microphone works and, when running
Cheese, when I press the camera button on the webcam itself the
software recognises that the button is pressed.

On that note, when running cheese from the terminal with this webcam
attached I get the following error:

libv4l2: error getting pixformat: Invalid argument
libv4l2: error setting pixformat: Input/output error

Any help is appreciated


-- 
============================
antonio at hellocatfood.com
http://www.hellocatfood.com
============================


From solca at guug.org  Thu Nov 24 03:17:42 2011
From: solca at guug.org (Otto Solares Cabrera)
Date: Wed, 23 Nov 2011 20:17:42 -0600
Subject: [Linux-uvc-devel] Image distorted from a C910 on WRT160NL (mips)
Message-ID: <20111124021742.GD9572@guug.org>

Hi!

I have been trying a Logitech Webcam C910 connected to a Linksys
WRT160NL wireless router running a custom OpenWRT firmware.

If I compile the firmware with kernel 2.6.32.48 there's no latency for
fetching the image but it get's distorted as this one:

http://home.galileo.edu/~solca/c910_bizarre.jpg

If I use kernel 3.0.9 the image is right but the I have a multiseconds
(from 1 to 5 secs) latency for getting the whole frame.

I'm not a kernel guy but there's no differences in the ar71xx-ehci
driver between both kernels so I presume is the UVC driver or USB
subsystem.  On x86/x86-64 image is right and no latency.

Can somebody help me to find the problem?

Thank you!
--
 Otto


From pj.assis at gmail.com  Thu Nov 24 10:28:10 2011
From: pj.assis at gmail.com (Paulo Assis)
Date: Thu, 24 Nov 2011 09:28:10 +0000
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
In-Reply-To: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
References: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
Message-ID: <CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>

Hi,
Have you tried any other software besides cheese? (guvcview, luvcview,...)

Regards,
Paulo

2011/11/23 Antonio Roberts <antonio at hellocatfood.com>:
> I recently bought this wireless webcam;
> http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm having
> trouble getting it to work on Ubuntu 11.04.
>
> I ran lsusb and got the folowing information about the device:
>
> Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.
>
> I did a Google serach for the device ID and the Linux UVC website
> (http://www.ideasonboard.org/uvc/ ) informs me that it matches the
> LogiLink Wireless Webcam (so Maplin probably just rebranded this!).
> What this website states is that this device should work, which it
> doesn't.
>
> The problem I'm facing is that I don't get any actual video being
> streamed or shown. The built in microphone works and, when running
> Cheese, when I press the camera button on the webcam itself the
> software recognises that the button is pressed.
>
> On that note, when running cheese from the terminal with this webcam
> attached I get the following error:
>
> libv4l2: error getting pixformat: Invalid argument
> libv4l2: error setting pixformat: Input/output error
>
> Any help is appreciated
>
>
> --
> ============================
> antonio at hellocatfood.com
> http://www.hellocatfood.com
> ============================
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>


From antonio at hellocatfood.com  Thu Nov 24 10:49:47 2011
From: antonio at hellocatfood.com (Antonio Roberts)
Date: Thu, 24 Nov 2011 09:49:47 +0000
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
In-Reply-To: <CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>
References: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
	<CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>
Message-ID: <CAOkiBYjE6y0EuqfZy+ALOJHzGPZovc5Dx8YCZ3UYmqvJycXp6w@mail.gmail.com>

I've tried camorama, cheese, guvcview and loading cameras through
websites like tumblr and facebook. They recognise that a new device is
there but I get no video output

I've just tried luvcview with "luvcview -d /dev/video2" and got this error:

SDL information:
  Video driver: x11
  A window manager is available
Device information:
  Device path:  /dev/video2
Stream settings:
  Frame format: MJPG
Unable to set format: Input/output error
 Init v4L2 failed !! exit fatal


On 24 November 2011 09:28, Paulo Assis <pj.assis at gmail.com> wrote:
> Hi,
> Have you tried any other software besides cheese? (guvcview, luvcview,...)
>
> Regards,
> Paulo
>
> 2011/11/23 Antonio Roberts <antonio at hellocatfood.com>:
>> I recently bought this wireless webcam;
>> http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm having
>> trouble getting it to work on Ubuntu 11.04.
>>
>> I ran lsusb and got the folowing information about the device:
>>
>> Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.
>>
>> I did a Google serach for the device ID and the Linux UVC website
>> (http://www.ideasonboard.org/uvc/ ) informs me that it matches the
>> LogiLink Wireless Webcam (so Maplin probably just rebranded this!).
>> What this website states is that this device should work, which it
>> doesn't.
>>
>> The problem I'm facing is that I don't get any actual video being
>> streamed or shown. The built in microphone works and, when running
>> Cheese, when I press the camera button on the webcam itself the
>> software recognises that the button is pressed.
>>
>> On that note, when running cheese from the terminal with this webcam
>> attached I get the following error:
>>
>> libv4l2: error getting pixformat: Invalid argument
>> libv4l2: error setting pixformat: Input/output error
>>
>> Any help is appreciated
>>
>>
>> --
>> ============================
>> antonio at hellocatfood.com
>> http://www.hellocatfood.com
>> ============================
>> _______________________________________________
>> Linux-uvc-devel mailing list
>> Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>
>



-- 
============================
antonio at hellocatfood.com
http://www.hellocatfood.com
============================


From bug-track at fisher-privat.net  Thu Nov 24 15:19:28 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Thu, 24 Nov 2011 15:19:28 +0100
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
In-Reply-To: <CAOkiBYjE6y0EuqfZy+ALOJHzGPZovc5Dx8YCZ3UYmqvJycXp6w@mail.gmail.com>
References: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
	<CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>
	<CAOkiBYjE6y0EuqfZy+ALOJHzGPZovc5Dx8YCZ3UYmqvJycXp6w@mail.gmail.com>
Message-ID: <4ECE5270.5080500@fisher-privat.net>

Hi,

Please read this FAQ:
http://www.ideasonboard.org/uvc/faq/

On 24.11.2011 10:49, Antonio Roberts wrote:
> I've tried camorama, cheese, guvcview and loading cameras through
> websites like tumblr and facebook. They recognise that a new device is
> there but I get no video output
> 
> I've just tried luvcview with "luvcview -d /dev/video2" and got this error:
> 
> SDL information:
>   Video driver: x11
>   A window manager is available
> Device information:
>   Device path:  /dev/video2
> Stream settings:
>   Frame format: MJPG
> Unable to set format: Input/output error
>  Init v4L2 failed !! exit fatal
> 
> 
> On 24 November 2011 09:28, Paulo Assis <pj.assis at gmail.com> wrote:
>> Hi,
>> Have you tried any other software besides cheese? (guvcview, luvcview,...)
>>
>> Regards,
>> Paulo
>>
>> 2011/11/23 Antonio Roberts <antonio at hellocatfood.com>:
>>> I recently bought this wireless webcam;
>>> http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm having
>>> trouble getting it to work on Ubuntu 11.04.
>>>
>>> I ran lsusb and got the folowing information about the device:
>>>
>>> Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.
>>>
>>> I did a Google serach for the device ID and the Linux UVC website
>>> (http://www.ideasonboard.org/uvc/ ) informs me that it matches the
>>> LogiLink Wireless Webcam (so Maplin probably just rebranded this!).
>>> What this website states is that this device should work, which it
>>> doesn't.
>>>
>>> The problem I'm facing is that I don't get any actual video being
>>> streamed or shown. The built in microphone works and, when running
>>> Cheese, when I press the camera button on the webcam itself the
>>> software recognises that the button is pressed.
>>>
>>> On that note, when running cheese from the terminal with this webcam
>>> attached I get the following error:
>>>
>>> libv4l2: error getting pixformat: Invalid argument
>>> libv4l2: error setting pixformat: Input/output error
>>>
>>> Any help is appreciated



From tango13 at gmail.com  Thu Nov 24 22:40:05 2011
From: tango13 at gmail.com (Michele)
Date: Thu, 24 Nov 2011 22:40:05 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
In-Reply-To: <mailman.27.1321959605.6151.linux-uvc-devel@lists.berlios.de>
References: <mailman.27.1321959605.6151.linux-uvc-devel@lists.berlios.de>
Message-ID: <201111242240.05702.tango13@gmail.com>

 22/11/2011  12:00

Hello!
> Hi, if you can, you should immediately send it back. It is really bad
> device.
Unfortunately I cant't, having bought int in a store.
Skype on linux use only RAW format, so if you will be
> lucky you will get 5 frame per second. For this price (amazon.de 20?)
> you can get better webcam.
Now I've an idea of why was sold at 9.99 euro in a bin near the cash register.

> UVC device should just work (even on linux). If it is not working, it is
> most probably bad.

It works on Windows 7, and actually works in Linux but is unstable.
using xawtv -c /dev/video1 (note the nissing -noxv) makes the camera working 
ever as normal user. Trying to change the video parameters, say brightness or 
saturation makes the camera stop working with a device or resource busy error 
most of the time. I suppose there's a race condition that makes the 
application of the parameters failing.

If I have time I'll make some tests during the weekend to find if there'a a 
workaround.


--
Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111124/cfd2c2d4/attachment.html>

From bug-track at fisher-privat.net  Fri Nov 25 11:13:58 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Fri, 25 Nov 2011 11:13:58 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
In-Reply-To: <201111242240.05702.tango13@gmail.com>
References: <mailman.27.1321959605.6151.linux-uvc-devel@lists.berlios.de>
	<201111242240.05702.tango13@gmail.com>
Message-ID: <4ECF6A66.5070203@fisher-privat.net>

On 24.11.2011 22:40, Michele wrote:
>  22/11/2011  12:00
> 
> Hello!
>> Hi, if you can, you should immediately send it back. It is really bad
>> device.
> Unfortunately I cant't, having bought int in a store.
> Skype on linux use only RAW format, so if you will be
>> lucky you will get 5 frame per second. For this price (amazon.de 20?)
>> you can get better webcam.
> Now I've an idea of why was sold at 9.99 euro in a bin near the cash register.
> 
>> UVC device should just work (even on linux). If it is not working, it is
>> most probably bad.
> 
> It works on Windows 7, and actually works in Linux but is unstable.
> using xawtv -c /dev/video1 (note the nissing -noxv) makes the camera working 
> ever as normal user. Trying to change the video parameters, say brightness or 
> saturation makes the camera stop working with a device or resource busy error 
> most of the time. I suppose there's a race condition that makes the 
> application of the parameters failing.
> 
> If I have time I'll make some tests during the weekend to find if there'a a 
> workaround.

Hi,
please use luvcview or guvcview for testing. If you need root, then you
should check you permission rights on /dev/video* or /dev/dri/card* .
Check also FAQ on how to collect information for troubleshoting
http://www.ideasonboard.org/uvc/faq/

Do the cam work stable if change  video parameters on windows. Did you
installed phillips driver on windows?

Regards,
Alexey


From laurent.pinchart at ideasonboard.com  Fri Nov 25 14:40:14 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Fri, 25 Nov 2011 14:40:14 +0100
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <CA+DpatgeUL3U-UO_11sOpQzN7Z+_KF-1npYPtdRYjNGD-JbBQA@mail.gmail.com>
References: <406696368.296698.1320312165679.JavaMail.root@ahm.einfochips.com>
	<CA+Dpatj9HTN4bJK7T16W_Om_CJ3XCfAk0FB3gqoCOPEESzUa5g@mail.gmail.com>
	<CA+DpatgeUL3U-UO_11sOpQzN7Z+_KF-1npYPtdRYjNGD-JbBQA@mail.gmail.com>
Message-ID: <201111251440.15354.laurent.pinchart@ideasonboard.com>

Hi Robert,

On Monday 21 November 2011 16:49:46 Robert Krakora wrote:
> On Thu, Nov 10, 2011 at 3:34 PM, Robert Krakora wrote:
> > On Thu, Nov 3, 2011 at 7:55 AM, Laurent Pinchart wrote:
> >> On Thursday 03 November 2011 12:34:55 Robert Krakora wrote:
> >> > Hi Guys,
> >> > 
> >> > I did not see audio in the MPEG2 TS stream that I was able to get out
> >> > of the FaceVsion camera. I purchased one for Laurent for development
> >> > purposes.
> >> >
> >> > It sounds like he has been working with it some.
> >> 
> >> Yes I've finally started working on it. Thanks for the hardware.
> >> 
> >> I'll post prototype patches to the list. I've been able to get a video
> >> stream out of the device, but it looks pretty bad when played in mplayer.
> >> I'm not sure who is at fault that.
> >> 
> >> > I wish these vendors would come to some kind of consensus on how to
> >> > expose H.264 via USB interface.
> >> 
> >> The latest version of the UVC 1.1 specification includes an H.264
> >> payload format. Unfortunately Microsoft, Logitech and Skype designed
> >> something really horrible, without much input from anyone else.
> >> 
> >> > It seems like it would make life easier for the UVC developers such as
> >> > Laurent.
> >> 
> >> I should come up with my own H.264 UVC payload specification :-)
> >> 
> >> > If Laurent needs any more makes/models of H.264 cameras for
> >> > development, I will accommodate.
> >> 
> >> Thank you. I will first try to finish the Facevsion support.
> > 
> > Let me know when you have some patches available for FaceVsion.  In my
> > hacking, I was able to get MPEG2 TS H.264, but the video looked very
> > washed out although motion was fluid (not jerky).
> 
> Have you had time to work on the FaceVsion support lately?  ;-)

Not as much as I would have liked, but yes, I have :-)

I've pushed patches to the uvcvideo-wip-mpeg branch in 
git://linuxtv.org/pinchartl/uvcvideo.git. The last patch is still work in 
progress, and I'm not totally happy with the "psize * 500" heuristic.

I've also updated yavta to support writing all frames to a single file. 
Capturing 100 frames with yavta to a single file produces something I can play 
with mplayer, but not without issues. The video doesn't look very good, and 
mplayer prints lots of error messages:

$ mplayer mpeg.bin 
MPlayer SVN-r33094-4.4.5 (C) 2000-2011 MPlayer Team

Playing mpeg.bin.
TS file format detected.
VIDEO H264(pid=68) NO AUDIO!  NO SUBS (yet)!  PROGRAM N. 1
FPS seems to be: 29.970030
Load subtitles in ./
==========================================================================
Opening video decoder: [ffmpeg] FFmpeg's libavcodec codec family
Selected video codec: [ffh264] vfm: ffmpeg (FFmpeg H.264)
==========================================================================
Audio: no sound
Starting playback...
Movie-Aspect is 1.78:1 - prescaling to correct movie aspect.
VO: [xv] 1280x720 => 1280x720 Planar YV12 
V:   0.1   1/  1 ??% ??% ??,?% 0 0 
[h264 @ 0xae68a0]out of range intra chroma pred mode at 28 19
[h264 @ 0xae68a0]error while decoding MB 28 19
[h264 @ 0xae68a0]concealing 2101 DC, 2101 AC, 2101 MV errors
V:   0.1   3/  3 ??% ??% ??,?% 0 0 
[h264 @ 0xae68a0]mb_type 109 in P slice too large at 19 16
[h264 @ 0xae68a0]error while decoding MB 19 16
[h264 @ 0xae68a0]concealing 2350 DC, 2350 AC, 2350 MV errors
V:   0.2   5/  5 ??% ??% ??,?% 0 0 
[h264 @ 0xae68a0]P sub_mb_type 22 out of range at 47 7
[h264 @ 0xae68a0]error while decoding MB 47 7
[h264 @ 0xae68a0]concealing 3042 DC, 3042 AC, 3042 MV errors
V:   0.3   7/  7 ??% ??% ??,?% 0 0 
[h264 @ 0xae68a0]out of range intra chroma pred mode at 60 3
[h264 @ 0xae68a0]error while decoding MB 60 3
[h264 @ 0xae68a0]concealing 3349 DC, 3349 AC, 3349 MV errors
V:   0.3   9/  9 ??% ??% ??,?% 0 0 
[h264 @ 0xae68a0]P sub_mb_type 28 out of range at 50 20
[h264 @ 0xae68a0]error while decoding MB 50 20
[h264 @ 0xae68a0]concealing 1999 DC, 1999 AC, 1999 MV errors
[...]

-- 
Regards,

Laurent Pinchart


From laurent.pinchart at ideasonboard.com  Fri Nov 25 14:43:30 2011
From: laurent.pinchart at ideasonboard.com (Laurent Pinchart)
Date: Fri, 25 Nov 2011 14:43:30 +0100
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <1081303779.298119.1320324197540.JavaMail.root@ahm.einfochips.com>
References: <1081303779.298119.1320324197540.JavaMail.root@ahm.einfochips.com>
Message-ID: <201111251443.30384.laurent.pinchart@ideasonboard.com>

Hi Ajay,

On Thursday 03 November 2011 13:43:17 Ajay Bhargav wrote:
> 
> Thank you taking charge on the MPEG2-TS support. I was thinking that
> MPEG2-TS container format may contain video stream encoded differently
> other than H.264. So is it good to take out the container part and
> exposing the raw stream?

I'm not sure about that. Demuxing should really be done in userspace, not 
inside the kernel. If we need something uvcvideo-specific, it should probably 
live in libv4l.

> I faced problem when I was storing H.264 stream only using gstreamer. Video
> was running too fast with no timing information and VLC was unable to play
> that stream.
> 
> how did you deal with the FID problem? coz MPEG2-TS does not provide such
> information. What I did was to count certain number of packets and toggle
> FID forcefully so that buffer is ready for reading. It looks like you are
> missing some packets coz of which video is bad. I faced the same problem
> untill i added that FID hack.

Please see the patches I've just pushed to the uvcvideo-wip-mpeg branch 
git://linuxtv.org/pinchartl/uvcvideo.git, and especially patch "uvcvideo: Fix 
FID and EOF handling for stream-based formats" which deals with this problem.

> I hope this will help you. Please let me know if I can help you in this.

Could you please test the patches ?

-- 
Regards,

Laurent Pinchart


From tango13 at gmail.com  Sun Nov 27 19:08:31 2011
From: tango13 at gmail.com (Michele)
Date: Sun, 27 Nov 2011 19:08:31 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
In-Reply-To: <mailman.31.1322218805.5611.linux-uvc-devel@lists.berlios.de>
References: <mailman.31.1322218805.5611.linux-uvc-devel@lists.berlios.de>
Message-ID: <201111271908.31910.tango13@gmail.com>

Il giorno 25/11/2011 alle ore 12:00, Alexey Fisher  ha scritto:


> Hi,

Hello,

Thank for you patience.

> please use luvcview or guvcview for testing. If you need root, then you
> should check you permission rights on /dev/video* or /dev/dri/card* .

I think root was a red herring due different setups of the environment.


> Do the cam work stable if change  video parameters on windows. Did you
> installed phillips driver on windows?

This is the driver used as a driver for the webcam. in the webcam box thre's 
no installation CD anyway.

Driver Name 	usbvideo.sys
Address 	0x95C13000
End Address 	0x95C37000
Size 	0x00024000
Load Count 	1
Index 	136
File Type 	Driver
Description 	USB Video Class Driver
Version 	6.1.7601.17514 (win7sp1_rtm.101119-1850)
Company 	Microsoft Corporation
Product Name 	Microsoft? Windows? Operating System
Modified Date 	20/11/2010 22:29:03
Created Date 	20/11/2010 22:29:03
Filename 	C:\Windows\System32\Drivers\usbvideo.sys
File Attributes 	A
Service Name 	usbvideo
Service Display Name 	Dispositivo video USB (WDM) 

seems to me that is the stock USB driver of Seven.
I've had non problems with MSN live, Skype or even DScaler (that sees the cam 
as Direct show).

I've made some experiments using guvcview.

I've asked to use a resolution of 172x144, then a resolution of 320x240
then again 172x144.

The first time i can see the image correctly.
The second time the program fails with a device or resource busy message
The third time with the same resolution it fails with the same error

To make  guvcview work again, I've to disconnect and reconnect the webcam from 
the usb bus. This behaviour is reproducible as normal use or root.

Attached to this messages there is a log of the kernel messages and the 
console output of guvcview.

I hope these data could pinpoint the area where the problem could lie and also 
warn the potential buyers of the cam of the possible problems with this 
Philips branded webcam.

Best Regards.

Mike


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111127/2bae3018/attachment.html>
-------------- next part --------------
### sucessful opening
$  guvcview -s 176x144 -d /dev/video0
guvcview 1.5.0
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.rear
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.center_lfe
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.side
ALSA lib pcm_dmix.c:957:(snd_pcm_dmix_open) The dmix plugin supports only playback stream
Cannot connect to server socket err = No such file or directory
Cannot connect to server socket
jack server is not running or cannot be started
video device: /dev/video0 
Unable to find parent usb device.Unable to find parent usb device.Unable to find parent usb device.Unable to find parent usb device.Init. Philips SPZ2000 (location: usb-0000:00:1d.0-1.3)
{ pixelformat = 'MJPG', description = 'MJPEG' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YUYV', description = 'YUV 4:2:2 (YUYV)' }
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/5, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/20, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/15, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/4, 
{ pixelformat = 'RGB3', description = 'RGB3' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'BGR3', description = 'BGR3' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YU12', description = 'YU12' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YV12', description = 'YV12' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
vid:0471 
pid:20d0 
driver:uvcvideo
checking format: 1196444237
VIDIOC_G_COMP:: Invalid argument
   compression control not supported
fps is set to 1/30
drawing controls

fps is set to 1/30
Checking video mode 176x144 at 32bpp : OK 
write /home/mike/.guvcviewrc OK
free controls
cleaned allocations - 100%
Closing portaudio ...OK
Closing GTK... OK

#### now it fails 
$ guvcview -s 320x240 -d /dev/video0
guvcview 1.5.0
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.rear
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.center_lfe
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.side
ALSA lib pcm_dmix.c:957:(snd_pcm_dmix_open) The dmix plugin supports only playback stream
Cannot connect to server socket err = No such file or directory
Cannot connect to server socket
jack server is not running or cannot be started
video device: /dev/video0 
Unable to find parent usb device.Unable to find parent usb device.Unable to find parent usb device.Unable to find parent usb device.Init. Philips SPZ2000 (location: usb-0000:00:1d.0-1.3)
{ pixelformat = 'MJPG', description = 'MJPEG' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YUYV', description = 'YUV 4:2:2 (YUYV)' }
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/5, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/20, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/15, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/4, 
{ pixelformat = 'RGB3', description = 'RGB3' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'BGR3', description = 'BGR3' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YU12', description = 'YU12' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YV12', description = 'YV12' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
vid:0471 
pid:20d0 
driver:uvcvideo
checking format: 1196444237
VIDIOC_G_COMP:: Invalid argument
   compression control not supported
fps is set to 1/30
drawing controls

libv4l2: error turning on stream: No space left on device
VIDIOC_STREAMON - Unable to start capture: No space left on device
fps is set to 1/30
Checking video mode 320x240 at 32bpp : OK 
libv4l2: error turning on stream: Device or resource busy
VIDIOC_STREAMON - Unable to start capture: Device or resource busy
libv4l2: error turning on stream: Device or resource busy
VIDIOC_STREAMON - Unable to start capture: Device or resource busy
write /home/mike/.guvcviewrc OK
free controls
cleaned allocations - 100%
Closing portaudio ...OK
Closing GTK... OK

### now fails even with smaller picture
$  guvcview -s 176x144 -d /dev/video0
guvcview 1.5.0
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.rear
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.center_lfe
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.side
ALSA lib pcm_dmix.c:957:(snd_pcm_dmix_open) The dmix plugin supports only playback stream
Cannot connect to server socket err = No such file or directory
Cannot connect to server socket
jack server is not running or cannot be started
video device: /dev/video0 
Unable to find parent usb device.Unable to find parent usb device.Unable to find parent usb device.Unable to find parent usb device.Init. Philips SPZ2000 (location: usb-0000:00:1d.0-1.3)
{ pixelformat = 'MJPG', description = 'MJPEG' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YUYV', description = 'YUV 4:2:2 (YUYV)' }
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/5, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/20, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/15, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/4, 
{ pixelformat = 'RGB3', description = 'RGB3' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'BGR3', description = 'BGR3' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YU12', description = 'YU12' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ pixelformat = 'YV12', description = 'YV12' }
{ discrete: width = 640, height = 480 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 320, height = 240 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 160, height = 120 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 176, height = 144 }
        Time interval between frame: 1/30, 1/15, 1/1, 
{ discrete: width = 352, height = 288 }
        Time interval between frame: 1/30, 1/15, 1/1, 
vid:0471 
pid:20d0 
driver:uvcvideo
checking format: 1196444237
VIDIOC_G_COMP:: Invalid argument
   compression control not supported
Unable to set 1/30 fps
VIDIOC_S_PARM error: Device or resource busy
fps is set to 1/30
drawing controls

libv4l2: error turning on stream: Device or resource busy
VIDIOC_STREAMON - Unable to start capture: Device or resource busy
fps is set to 1/30
Checking video mode 176x144 at 32bpp : OK 
libv4l2: error turning on stream: Device or resource busy
VIDIOC_STREAMON - Unable to start capture: Device or resource busy
libv4l2: error turning on stream: Device or resource busy
VIDIOC_STREAMON - Unable to start capture: Device or resource busy
write /home/mike/.guvcviewrc OK
free controls
cleaned allocations - 100%
Closing portaudio ...OK
Closing GTK... OK
$ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kern.log
Type: text/x-log
Size: 32756 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111127/2bae3018/attachment.bin>

From ajay.bhargav at einfochips.com  Mon Nov 28 07:43:47 2011
From: ajay.bhargav at einfochips.com (Ajay Bhargav)
Date: Mon, 28 Nov 2011 12:13:47 +0530 (IST)
Subject: [Linux-uvc-devel] Webcam with H264 encoder not in Devicelist
In-Reply-To: <201111251443.30384.laurent.pinchart@ideasonboard.com>
Message-ID: <855915324.32594.1322462627481.JavaMail.root@ahm.einfochips.com>


----- "Laurent Pinchart" <laurent.pinchart at ideasonboard.com> wrote:

> Hi Ajay,
> 
> On Thursday 03 November 2011 13:43:17 Ajay Bhargav wrote:
> > 
> > Thank you taking charge on the MPEG2-TS support. I was thinking
> that
> > MPEG2-TS container format may contain video stream encoded
> differently
> > other than H.264. So is it good to take out the container part and
> > exposing the raw stream?
> 
> I'm not sure about that. Demuxing should really be done in userspace,
> not 
> inside the kernel. If we need something uvcvideo-specific, it should
> probably 
> live in libv4l.
> 
> > I faced problem when I was storing H.264 stream only using
> gstreamer. Video
> > was running too fast with no timing information and VLC was unable
> to play
> > that stream.
> > 
> > how did you deal with the FID problem? coz MPEG2-TS does not provide
> such
> > information. What I did was to count certain number of packets and
> toggle
> > FID forcefully so that buffer is ready for reading. It looks like
> you are
> > missing some packets coz of which video is bad. I faced the same
> problem
> > untill i added that FID hack.
> 
> Please see the patches I've just pushed to the uvcvideo-wip-mpeg
> branch 
> git://linuxtv.org/pinchartl/uvcvideo.git, and especially patch
> "uvcvideo: Fix 
> FID and EOF handling for stream-based formats" which deals with this
> problem.
> 
> > I hope this will help you. Please let me know if I can help you in
> this.
> 
> Could you please test the patches ?
> 
> -- 
> Regards,
> 
> Laurent Pinchart
> 

Hi Laurent,

Thank you so much for working on this. I wont be able to test these patches right now coz I am not working this December :) But when I get back to work I will surely test them.

Regards,
Ajay Bhargav


From bug-track at fisher-privat.net  Mon Nov 28 11:25:29 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 28 Nov 2011 11:25:29 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
In-Reply-To: <201111271908.31910.tango13@gmail.com>
References: <mailman.31.1322218805.5611.linux-uvc-devel@lists.berlios.de>
	<201111271908.31910.tango13@gmail.com>
Message-ID: <4ED36199.1090906@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Am 27.11.2011 19:08, schrieb Michele:
> Il giorno 25/11/2011 alle ore 12:00, Alexey Fisher  ha scritto:
> 
> 
>> Hi,
> 
> Hello,
> 
> Thank for you patience.
> 
>> please use luvcview or guvcview for testing. If you need root,
>> then you should check you permission rights on /dev/video* or
>> /dev/dri/card* .
> 
> I think root was a red herring due different setups of the
> environment.
> 
> 
>> Do the cam work stable if change  video parameters on windows.
>> Did you installed phillips driver on windows?
> 
> This is the driver used as a driver for the webcam. in the webcam
> box thre's no installation CD anyway.
> 
> Driver Name 	usbvideo.sys Address 	0x95C13000 End Address
> 0x95C37000 Size 	0x00024000 Load Count 	1 Index 	136 File Type
> Driver Description 	USB Video Class Driver Version 	6.1.7601.17514
> (win7sp1_rtm.101119-1850) Company 	Microsoft Corporation Product
> Name 	Microsoft? Windows? Operating System Modified Date
> 20/11/2010 22:29:03 Created Date 	20/11/2010 22:29:03 Filename
> C:\Windows\System32\Drivers\usbvideo.sys File Attributes 	A Service
> Name 	usbvideo Service Display Name 	Dispositivo video USB (WDM)
> 
> seems to me that is the stock USB driver of Seven. I've had non
> problems with MSN live, Skype or even DScaler (that sees the cam as
> Direct show).
> 
> I've made some experiments using guvcview.
> 
> I've asked to use a resolution of 172x144, then a resolution of
> 320x240 then again 172x144.
> 
> The first time i can see the image correctly. The second time the
> program fails with a device or resource busy message The third time
> with the same resolution it fails with the same error
> 
> To make  guvcview work again, I've to disconnect and reconnect the
> webcam from the usb bus. This behaviour is reproducible as normal
> use or root.
> 
> Attached to this messages there is a log of the kernel messages and
> the console output of guvcview.
> 
> I hope these data could pinpoint the area where the problem could
> lie and also warn the potential buyers of the cam of the possible
> problems with this Philips branded webcam.
> 
> Best Regards.
> 
> Mike

hmm...
you used mjpeg compressed stream for testing. how i said before, skype
on linux use only yuv-raw stream.
With the debug message you send i can see following
jpeg 172x144 at 30fps set 512 B/frame
jpeg 320x240 at 30fps set 768 B/frame - in this case we get error
 -28 ENOSPC No space left on device.

The bandwidth provided by this cam seems to be really wrong. My
logitech set for bot jpeg 172x144 at 30fps and 320x240 at 30fps 192 B/frame.

How about raw? do it request wrong bandwidth for raw to?
Currently i do not know how to handle the freeze issue.
So here is the list of problems by this cam:
- - it is not USB 2.0, this is why we can request bigger resolution
- - it cant handle resolution switch on the fly, and in case of URB
error, we need to hard reset it.
If we will try to reset the cam with uvcvideo we will kill audio
stream (for cam with build in mic). This will make other people angry
and add unexpected bug.
- - it provide wrong bandwidth info.

I still ask my self, how windows handle this? or is there some
undocumented agreement between factories and microsoft?
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7TYZQACgkQw8E0jNwoJm9XUgCgiwNK2VFdvfEJwxV/1fdTsCya
3BwAn2KwsLEhAiROhOmzPXs6I85lot7q
=BhM4
-----END PGP SIGNATURE-----


From bug-track at fisher-privat.net  Mon Nov 28 11:27:49 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 28 Nov 2011 11:27:49 +0100
Subject: [Linux-uvc-devel] Philips SPZ2000/00
In-Reply-To: <201111271908.31910.tango13@gmail.com>
References: <mailman.31.1322218805.5611.linux-uvc-devel@lists.berlios.de>
	<201111271908.31910.tango13@gmail.com>
Message-ID: <4ED36225.5040308@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Am 27.11.2011 19:08, schrieb Michele:
> Il giorno 25/11/2011 alle ore 12:00, Alexey Fisher  ha scritto:
> 
> 
>> Hi,
> 
> Hello,
> 
> Thank for you patience.
> 
>> please use luvcview or guvcview for testing. If you need root,
>> then you should check you permission rights on /dev/video* or
>> /dev/dri/card* .
> 
> I think root was a red herring due different setups of the
> environment.
> 
> 
>> Do the cam work stable if change  video parameters on windows.
>> Did you installed phillips driver on windows?
> 
> This is the driver used as a driver for the webcam. in the webcam
> box thre's no installation CD anyway.
> 
> Driver Name 	usbvideo.sys Address 	0x95C13000 End Address
> 0x95C37000 Size 	0x00024000 Load Count 	1 Index 	136 File Type
> Driver Description 	USB Video Class Driver Version 	6.1.7601.17514
> (win7sp1_rtm.101119-1850) Company 	Microsoft Corporation Product
> Name 	Microsoft? Windows? Operating System Modified Date
> 20/11/2010 22:29:03 Created Date 	20/11/2010 22:29:03 Filename
> C:\Windows\System32\Drivers\usbvideo.sys File Attributes 	A Service
> Name 	usbvideo Service Display Name 	Dispositivo video USB (WDM)
> 
> seems to me that is the stock USB driver of Seven. I've had non
> problems with MSN live, Skype or even DScaler (that sees the cam as
> Direct show).
> 
> I've made some experiments using guvcview.
> 
> I've asked to use a resolution of 172x144, then a resolution of
> 320x240 then again 172x144.
> 
> The first time i can see the image correctly. The second time the
> program fails with a device or resource busy message The third time
> with the same resolution it fails with the same error
> 
> To make  guvcview work again, I've to disconnect and reconnect the
> webcam from the usb bus. This behaviour is reproducible as normal
> use or root.
> 
> Attached to this messages there is a log of the kernel messages and
> the console output of guvcview.
> 
> I hope these data could pinpoint the area where the problem could
> lie and also warn the potential buyers of the cam of the possible
> problems with this Philips branded webcam.
> 
> Best Regards.
> 
> Mike

And please, use plaiin text for this maeling list, no HTML formated
messages.


- -- 
Regards,
Alexey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7TYiUACgkQw8E0jNwoJm9iLACfep9Z0jIM1UqP24O//2Qt6j7D
iBQAn0Wp6gZkVYRDYy+VfXyL67vEYFYF
=7ast
-----END PGP SIGNATURE-----


From antonio at hellocatfood.com  Mon Nov 28 14:43:21 2011
From: antonio at hellocatfood.com (Antonio Roberts)
Date: Mon, 28 Nov 2011 13:43:21 +0000
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
In-Reply-To: <4ECE5270.5080500@fisher-privat.net>
References: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
	<CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>
	<CAOkiBYjE6y0EuqfZy+ALOJHzGPZovc5Dx8YCZ3UYmqvJycXp6w@mail.gmail.com>
	<4ECE5270.5080500@fisher-privat.net>
Message-ID: <CAOkiBYjANkxrbgmF04m7XRj2Z4ckWDzznMQ44tyKveMCE25ypQ@mail.gmail.com>

Hi,

Thanks for that FAQ. I executed "lsusb -d 046d:08cb -v | grep "14
Video"" and I get no output

* However * , could this be because it is only reading the wireless
dongle? There's no way for me to physically connect the wireless
webcam to my computer

On 24 November 2011 14:19, Alexey Fisher <bug-track at fisher-privat.net> wrote:
> Hi,
>
> Please read this FAQ:
> http://www.ideasonboard.org/uvc/faq/
>
> On 24.11.2011 10:49, Antonio Roberts wrote:
>> I've tried camorama, cheese, guvcview and loading cameras through
>> websites like tumblr and facebook. They recognise that a new device is
>> there but I get no video output
>>
>> I've just tried luvcview with "luvcview -d /dev/video2" and got this error:
>>
>> SDL information:
>> ? Video driver: x11
>> ? A window manager is available
>> Device information:
>> ? Device path: ?/dev/video2
>> Stream settings:
>> ? Frame format: MJPG
>> Unable to set format: Input/output error
>> ?Init v4L2 failed !! exit fatal
>>
>>
>> On 24 November 2011 09:28, Paulo Assis <pj.assis at gmail.com> wrote:
>>> Hi,
>>> Have you tried any other software besides cheese? (guvcview, luvcview,...)
>>>
>>> Regards,
>>> Paulo
>>>
>>> 2011/11/23 Antonio Roberts <antonio at hellocatfood.com>:
>>>> I recently bought this wireless webcam;
>>>> http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm having
>>>> trouble getting it to work on Ubuntu 11.04.
>>>>
>>>> I ran lsusb and got the folowing information about the device:
>>>>
>>>> Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.
>>>>
>>>> I did a Google serach for the device ID and the Linux UVC website
>>>> (http://www.ideasonboard.org/uvc/ ) informs me that it matches the
>>>> LogiLink Wireless Webcam (so Maplin probably just rebranded this!).
>>>> What this website states is that this device should work, which it
>>>> doesn't.
>>>>
>>>> The problem I'm facing is that I don't get any actual video being
>>>> streamed or shown. The built in microphone works and, when running
>>>> Cheese, when I press the camera button on the webcam itself the
>>>> software recognises that the button is pressed.
>>>>
>>>> On that note, when running cheese from the terminal with this webcam
>>>> attached I get the following error:
>>>>
>>>> libv4l2: error getting pixformat: Invalid argument
>>>> libv4l2: error setting pixformat: Input/output error
>>>>
>>>> Any help is appreciated
>
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>



-- 
============================
antonio at hellocatfood.com
http://www.hellocatfood.com
============================


From bug-track at fisher-privat.net  Mon Nov 28 15:59:12 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Mon, 28 Nov 2011 15:59:12 +0100
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
In-Reply-To: <CAOkiBYjANkxrbgmF04m7XRj2Z4ckWDzznMQ44tyKveMCE25ypQ@mail.gmail.com>
References: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
	<CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>
	<CAOkiBYjE6y0EuqfZy+ALOJHzGPZovc5Dx8YCZ3UYmqvJycXp6w@mail.gmail.com>
	<4ECE5270.5080500@fisher-privat.net>
	<CAOkiBYjANkxrbgmF04m7XRj2Z4ckWDzznMQ44tyKveMCE25ypQ@mail.gmail.com>
Message-ID: <4ED3A1C0.50100@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

it works like this:
- - after you connected some usb device to the host
- - it will be checked by usb-core driver
- - every device has some class description.
- - if your device say, it belong to: 14 - video class, uvcvideo will
initiate it.
- - if the device is not video class device, then there is no way to
uvcvideo will know about it. (except you will force it, but there is
no guaranty)

On 28.11.2011 14:43, Antonio Roberts wrote:
> Thanks for that FAQ. I executed "lsusb -d 046d:08cb -v | grep "14 
> Video"" and I get no output
> 
> * However * , could this be because it is only reading the
> wireless dongle? There's no way for me to physically connect the
> wireless webcam to my computer
> 
> On 24 November 2011 14:19, Alexey Fisher
> <bug-track at fisher-privat.net> wrote:
>> Hi,
>> 
>> Please read this FAQ: http://www.ideasonboard.org/uvc/faq/
>> 
>> On 24.11.2011 10:49, Antonio Roberts wrote:
>>> I've tried camorama, cheese, guvcview and loading cameras
>>> through websites like tumblr and facebook. They recognise that
>>> a new device is there but I get no video output
>>> 
>>> I've just tried luvcview with "luvcview -d /dev/video2" and got
>>> this error:
>>> 
>>> SDL information: Video driver: x11 A window manager is
>>> available Device information: Device path:  /dev/video2 Stream
>>> settings: Frame format: MJPG Unable to set format: Input/output
>>> error Init v4L2 failed !! exit fatal
>>> 
>>> 
>>> On 24 November 2011 09:28, Paulo Assis <pj.assis at gmail.com>
>>> wrote:
>>>> Hi, Have you tried any other software besides cheese?
>>>> (guvcview, luvcview,...)
>>>> 
>>>> Regards, Paulo
>>>> 
>>>> 2011/11/23 Antonio Roberts <antonio at hellocatfood.com>:
>>>>> I recently bought this wireless webcam; 
>>>>> http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm
>>>>> having trouble getting it to work on Ubuntu 11.04.
>>>>> 
>>>>> I ran lsusb and got the folowing information about the
>>>>> device:
>>>>> 
>>>>> Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.
>>>>> 
>>>>> I did a Google serach for the device ID and the Linux UVC
>>>>> website (http://www.ideasonboard.org/uvc/ ) informs me that
>>>>> it matches the LogiLink Wireless Webcam (so Maplin probably
>>>>> just rebranded this!). What this website states is that
>>>>> this device should work, which it doesn't.
>>>>> 
>>>>> The problem I'm facing is that I don't get any actual video
>>>>> being streamed or shown. The built in microphone works and,
>>>>> when running Cheese, when I press the camera button on the
>>>>> webcam itself the software recognises that the button is
>>>>> pressed.
>>>>> 
>>>>> On that note, when running cheese from the terminal with
>>>>> this webcam attached I get the following error:
>>>>> 
>>>>> libv4l2: error getting pixformat: Invalid argument libv4l2:
>>>>> error setting pixformat: Input/output error
>>>>> 
>>>>> Any help is appreciated
>> 
>> _______________________________________________ Linux-uvc-devel
>> mailing list Linux-uvc-devel at lists.berlios.de 
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>> 
> 
> 
> 


- -- 
Regards,
Alexey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7TobwACgkQw8E0jNwoJm9MewCfSbCFQdf/OVUoIlmouE/DYbmI
aO4An2R8yr1Zggr9Yjk2LU0O+5qN8GXn
=kjT9
-----END PGP SIGNATURE-----


From antonio at hellocatfood.com  Mon Nov 28 18:43:50 2011
From: antonio at hellocatfood.com (Antonio Roberts)
Date: Mon, 28 Nov 2011 17:43:50 +0000
Subject: [Linux-uvc-devel] Problem with wireless webcam from Maplin
In-Reply-To: <4ED3A1C0.50100@fisher-privat.net>
References: <CAOkiBYiQaBYhuPBzt7wZDBAnd6bt_t7Sh52t415s0saUQwnTGw@mail.gmail.com>
	<CAPueXH5nsshFF1qktusehpGp8QiL4ypqtPvOS=0rb1WdUd_BaA@mail.gmail.com>
	<CAOkiBYjE6y0EuqfZy+ALOJHzGPZovc5Dx8YCZ3UYmqvJycXp6w@mail.gmail.com>
	<4ECE5270.5080500@fisher-privat.net>
	<CAOkiBYjANkxrbgmF04m7XRj2Z4ckWDzznMQ44tyKveMCE25ypQ@mail.gmail.com>
	<4ED3A1C0.50100@fisher-privat.net>
Message-ID: <CAOkiBYjdW1we8OHzbVhOo2MD-rb=8UdBFfM_vSkmhpw-NMzKkw@mail.gmail.com>

> - - if the device is not video class device, then there is no way to
> uvcvideo will know about it. (except you will force it, but there is
> no guaranty)

How do you force it?

On 28 November 2011 14:59, Alexey Fisher <bug-track at fisher-privat.net> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi,
>
> it works like this:
> - - after you connected some usb device to the host
> - - it will be checked by usb-core driver
> - - every device has some class description.
> - - if your device say, it belong to: 14 - video class, uvcvideo will
> initiate it.
> - - if the device is not video class device, then there is no way to
> uvcvideo will know about it. (except you will force it, but there is
> no guaranty)
>
> On 28.11.2011 14:43, Antonio Roberts wrote:
>> Thanks for that FAQ. I executed "lsusb -d 046d:08cb -v | grep "14
>> Video"" and I get no output
>>
>> * However * , could this be because it is only reading the
>> wireless dongle? There's no way for me to physically connect the
>> wireless webcam to my computer
>>
>> On 24 November 2011 14:19, Alexey Fisher
>> <bug-track at fisher-privat.net> wrote:
>>> Hi,
>>>
>>> Please read this FAQ: http://www.ideasonboard.org/uvc/faq/
>>>
>>> On 24.11.2011 10:49, Antonio Roberts wrote:
>>>> I've tried camorama, cheese, guvcview and loading cameras
>>>> through websites like tumblr and facebook. They recognise that
>>>> a new device is there but I get no video output
>>>>
>>>> I've just tried luvcview with "luvcview -d /dev/video2" and got
>>>> this error:
>>>>
>>>> SDL information: Video driver: x11 A window manager is
>>>> available Device information: Device path: ?/dev/video2 Stream
>>>> settings: Frame format: MJPG Unable to set format: Input/output
>>>> error Init v4L2 failed !! exit fatal
>>>>
>>>>
>>>> On 24 November 2011 09:28, Paulo Assis <pj.assis at gmail.com>
>>>> wrote:
>>>>> Hi, Have you tried any other software besides cheese?
>>>>> (guvcview, luvcview,...)
>>>>>
>>>>> Regards, Paulo
>>>>>
>>>>> 2011/11/23 Antonio Roberts <antonio at hellocatfood.com>:
>>>>>> I recently bought this wireless webcam;
>>>>>> http://www.maplin.co.uk/2.4ghz-wireless-webcam-388087 . I'm
>>>>>> having trouble getting it to work on Ubuntu 11.04.
>>>>>>
>>>>>> I ran lsusb and got the folowing information about the
>>>>>> device:
>>>>>>
>>>>>> Bus 006 Device 003: ID 0416:a91a Winbond Electronics Corp.
>>>>>>
>>>>>> I did a Google serach for the device ID and the Linux UVC
>>>>>> website (http://www.ideasonboard.org/uvc/ ) informs me that
>>>>>> it matches the LogiLink Wireless Webcam (so Maplin probably
>>>>>> just rebranded this!). What this website states is that
>>>>>> this device should work, which it doesn't.
>>>>>>
>>>>>> The problem I'm facing is that I don't get any actual video
>>>>>> being streamed or shown. The built in microphone works and,
>>>>>> when running Cheese, when I press the camera button on the
>>>>>> webcam itself the software recognises that the button is
>>>>>> pressed.
>>>>>>
>>>>>> On that note, when running cheese from the terminal with
>>>>>> this webcam attached I get the following error:
>>>>>>
>>>>>> libv4l2: error getting pixformat: Invalid argument libv4l2:
>>>>>> error setting pixformat: Input/output error
>>>>>>
>>>>>> Any help is appreciated
>>>
>>> _______________________________________________ Linux-uvc-devel
>>> mailing list Linux-uvc-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>>
>>
>>
>>
>
>
> - --
> Regards,
> Alexey
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.11 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iEYEARECAAYFAk7TobwACgkQw8E0jNwoJm9MewCfSbCFQdf/OVUoIlmouE/DYbmI
> aO4An2R8yr1Zggr9Yjk2LU0O+5qN8GXn
> =kjT9
> -----END PGP SIGNATURE-----
>



-- 
============================
antonio at hellocatfood.com
http://www.hellocatfood.com
============================


From zondolfin at gmail.com  Wed Nov 30 09:43:24 2011
From: zondolfin at gmail.com (Martin Bruse)
Date: Wed, 30 Nov 2011 09:43:24 +0100
Subject: [Linux-uvc-devel] WebCam SC-13HDL10931N
Message-ID: <CA+YGrSCEiQCn9roKnVXzV+jTZq1j3e5+Zdy6Yti53HV2Wx7qYg@mail.gmail.com>

Hello list!

I just bought Samsung 900X3A-B01SE (also known as a Samsung Series 9 with
Intel i5 sold in Sweden), and it has a webcam called "WebCam
SC-13HDL10931N" that is recognized by uvcvideo.

However, when I try to use luvcview I get

luvcview 0.2.6

SDL information:
  Video driver: x11
  A window manager is available
Device information:
  Device path:  /dev/video0
Stream settings:
  Frame format: MJPG
Unable to set format: Input/output error
 Init v4L2 failed !! exit fatal

When I tried to do

echo 2 > /sys/module/uvcvideo/parameters/quirks

and then luvcview again I got:


luvcview 0.2.6

SDL information:
  Video driver: x11
  A window manager is available
Device information:
  Device path:  /dev/video0
Stream settings:
  Frame format: MJPG
  Frame size:   640x480
  Frame rate:   30 fps
libv4l2: error turning on stream: No space left on device
Unable to start capture: No space left on device
Error grabbing
Cleanup done. Exiting ...

Which seemed a bit odd.

Just to make sure, I tried to test the video in skype at that point,
and got the same black screen I got before this entire experiment.

BUT when I after that tried luvcview again, I got the first message
again (Unable to set format: Input/output error).

Any idea how I could proceed with this? Any hope that I can avoid
implementing this damn camera myself and still get it to work? Anyone
wanting to help me implement this for a bounty? :D

regards,
//Martin


From bug-track at fisher-privat.net  Wed Nov 30 12:04:36 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 30 Nov 2011 12:04:36 +0100
Subject: [Linux-uvc-devel] WebCam SC-13HDL10931N
In-Reply-To: <CA+YGrSCEiQCn9roKnVXzV+jTZq1j3e5+Zdy6Yti53HV2Wx7qYg@mail.gmail.com>
References: <CA+YGrSCEiQCn9roKnVXzV+jTZq1j3e5+Zdy6Yti53HV2Wx7qYg@mail.gmail.com>
Message-ID: <4ED60DC4.8020608@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I got one compaq laptop with build in webcam, this webcam has same
symptoms like yours. And it not works with windows.
Can you confirm, that it is working with windows? and with what driver?
In case of my cam, widnows noticed that it works in usb low speed mode
(USB 1.1), and it is not good.

You got also "libv4l2: error turning on stream: No space left on
device" this mean it works in low speed.
So, test it under windows; check the driver; if not working, send it back!


On 30.11.2011 09:43, Martin Bruse wrote:
> Hello list!
> 
> I just bought Samsung 900X3A-B01SE (also known as a Samsung Series
> 9 with Intel i5 sold in Sweden), and it has a webcam called
> "WebCam SC-13HDL10931N" that is recognized by uvcvideo.
> 
> However, when I try to use luvcview I get
> 
> luvcview 0.2.6
> 
> SDL information: Video driver: x11 A window manager is available 
> Device information: Device path:  /dev/video0 Stream settings: 
> Frame format: MJPG Unable to set format: Input/output error Init
> v4L2 failed !! exit fatal
> 
> When I tried to do
> 
> echo 2 > /sys/module/uvcvideo/parameters/quirks
> 
> and then luvcview again I got:
> 
> 
> luvcview 0.2.6
> 
> SDL information: Video driver: x11 A window manager is available 
> Device information: Device path:  /dev/video0 Stream settings: 
> Frame format: MJPG Frame size:   640x480 Frame rate:   30 fps 
> libv4l2: error turning on stream: No space left on device Unable to
> start capture: No space left on device Error grabbing Cleanup done.
> Exiting ...
> 
> Which seemed a bit odd.
> 
> Just to make sure, I tried to test the video in skype at that
> point, and got the same black screen I got before this entire
> experiment.
> 
> BUT when I after that tried luvcview again, I got the first
> message again (Unable to set format: Input/output error).
> 
> Any idea how I could proceed with this? Any hope that I can avoid 
> implementing this damn camera myself and still get it to work?
> Anyone wanting to help me implement this for a bounty? :D
> 
> regards, //Martin _______________________________________________ 
> Linux-uvc-devel mailing list Linux-uvc-devel at lists.berlios.de 
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel


- -- 
Regards,
Alexey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7WDboACgkQw8E0jNwoJm89iwCePs82ROS461vqwikZnmabo1YJ
uxUAnAocSTOHO6j0gC+2Kyi6WlvTfOqH
=mq5S
-----END PGP SIGNATURE-----


From bug-track at fisher-privat.net  Wed Nov 30 12:09:53 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 30 Nov 2011 12:09:53 +0100
Subject: [Linux-uvc-devel] WebCam SC-13HDL10931N
In-Reply-To: <4ED60DC4.8020608@fisher-privat.net>
References: <CA+YGrSCEiQCn9roKnVXzV+jTZq1j3e5+Zdy6Yti53HV2Wx7qYg@mail.gmail.com>
	<4ED60DC4.8020608@fisher-privat.net>
Message-ID: <4ED60F01.4000400@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

For got to say:

read FAQ for trouble shooting help.


On 30.11.2011 12:04, Alexey Fisher wrote:
> I got one compaq laptop with build in webcam, this webcam has same 
> symptoms like yours. And it not works with windows. Can you
> confirm, that it is working with windows? and with what driver? In
> case of my cam, widnows noticed that it works in usb low speed
> mode (USB 1.1), and it is not good.
> 
> You got also "libv4l2: error turning on stream: No space left on 
> device" this mean it works in low speed. So, test it under windows;
> check the driver; if not working, send it back!
> 
> 
> On 30.11.2011 09:43, Martin Bruse wrote:
>> Hello list!
> 
>> I just bought Samsung 900X3A-B01SE (also known as a Samsung
>> Series 9 with Intel i5 sold in Sweden), and it has a webcam
>> called "WebCam SC-13HDL10931N" that is recognized by uvcvideo.
> 
>> However, when I try to use luvcview I get
> 
>> luvcview 0.2.6
> 
>> SDL information: Video driver: x11 A window manager is available
>>  Device information: Device path:  /dev/video0 Stream settings: 
>> Frame format: MJPG Unable to set format: Input/output error Init 
>> v4L2 failed !! exit fatal
> 
>> When I tried to do
> 
>> echo 2 > /sys/module/uvcvideo/parameters/quirks
> 
>> and then luvcview again I got:
> 
> 
>> luvcview 0.2.6
> 
>> SDL information: Video driver: x11 A window manager is available
>>  Device information: Device path:  /dev/video0 Stream settings: 
>> Frame format: MJPG Frame size:   640x480 Frame rate:   30 fps 
>> libv4l2: error turning on stream: No space left on device Unable
>> to start capture: No space left on device Error grabbing Cleanup
>> done. Exiting ...
> 
>> Which seemed a bit odd.
> 
>> Just to make sure, I tried to test the video in skype at that 
>> point, and got the same black screen I got before this entire 
>> experiment.
> 
>> BUT when I after that tried luvcview again, I got the first 
>> message again (Unable to set format: Input/output error).
> 
>> Any idea how I could proceed with this? Any hope that I can avoid
>>  implementing this damn camera myself and still get it to work? 
>> Anyone wanting to help me implement this for a bounty? :D
> 
>> regards, //Martin _______________________________________________
>>  Linux-uvc-devel mailing list Linux-uvc-devel at lists.berlios.de 
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
> 
> 
> _______________________________________________ Linux-uvc-devel
> mailing list Linux-uvc-devel at lists.berlios.de 
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel

- -- 
Regards,
Alexey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7WDwEACgkQw8E0jNwoJm8dLQCgt7PQK64jTsobctVe/59Ouyq2
JLMAoKrXkLVqSW3+R1plYjyafILnosmr
=vb1s
-----END PGP SIGNATURE-----


From zondolfin at gmail.com  Wed Nov 30 15:24:36 2011
From: zondolfin at gmail.com (Martin Bruse)
Date: Wed, 30 Nov 2011 15:24:36 +0100
Subject: [Linux-uvc-devel] WebCam SC-13HDL10931N
In-Reply-To: <CA+YGrSAaf-9eUi4v_9bgEK4_qwWPqtGbRywU0QRseQn-MW751A@mail.gmail.com>
References: <CA+YGrSCEiQCn9roKnVXzV+jTZq1j3e5+Zdy6Yti53HV2Wx7qYg@mail.gmail.com>
	<4ED60DC4.8020608@fisher-privat.net>
	<4ED60F01.4000400@fisher-privat.net>
	<CA+YGrSAaf-9eUi4v_9bgEK4_qwWPqtGbRywU0QRseQn-MW751A@mail.gmail.com>
Message-ID: <CA+YGrSACCye3HZ0+-uuPWvfp0nZ8bHd24XWPDC99WzzvOhs31Q@mail.gmail.com>

Ah, stupid of me not to check the FAQ first :O

Attached is the end of the dmesg log I created after unloading
uvcvideo, loading uvcvideo, turning on the debug messages and running
luvcview with the "no space left on device" result.

//Martin

On Wed, Nov 30, 2011 at 12:09 PM, Alexey Fisher
<bug-track at fisher-privat.net> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> For got to say:
>
> read FAQ for trouble shooting help.
>
>
> On 30.11.2011 12:04, Alexey Fisher wrote:
>> I got one compaq laptop with build in webcam, this webcam has same
>> symptoms like yours. And it not works with windows. Can you
>> confirm, that it is working with windows? and with what driver? In
>> case of my cam, widnows noticed that it works in usb low speed
>> mode (USB 1.1), and it is not good.
>>
>> You got also "libv4l2: error turning on stream: No space left on
>> device" this mean it works in low speed. So, test it under windows;
>> check the driver; if not working, send it back!
>>
>>
>> On 30.11.2011 09:43, Martin Bruse wrote:
>>> Hello list!
>>
>>> I just bought Samsung 900X3A-B01SE (also known as a Samsung
>>> Series 9 with Intel i5 sold in Sweden), and it has a webcam
>>> called "WebCam SC-13HDL10931N" that is recognized by uvcvideo.
>>
>>> However, when I try to use luvcview I get
>>
>>> luvcview 0.2.6
>>
>>> SDL information: Video driver: x11 A window manager is available
>>>  Device information: Device path:  /dev/video0 Stream settings:
>>> Frame format: MJPG Unable to set format: Input/output error Init
>>> v4L2 failed !! exit fatal
>>
>>> When I tried to do
>>
>>> echo 2 > /sys/module/uvcvideo/parameters/quirks
>>
>>> and then luvcview again I got:
>>
>>
>>> luvcview 0.2.6
>>
>>> SDL information: Video driver: x11 A window manager is available
>>>  Device information: Device path:  /dev/video0 Stream settings:
>>> Frame format: MJPG Frame size:   640x480 Frame rate:   30 fps
>>> libv4l2: error turning on stream: No space left on device Unable
>>> to start capture: No space left on device Error grabbing Cleanup
>>> done. Exiting ...
>>
>>> Which seemed a bit odd.
>>
>>> Just to make sure, I tried to test the video in skype at that
>>> point, and got the same black screen I got before this entire
>>> experiment.
>>
>>> BUT when I after that tried luvcview again, I got the first
>>> message again (Unable to set format: Input/output error).
>>
>>> Any idea how I could proceed with this? Any hope that I can avoid
>>>  implementing this damn camera myself and still get it to work?
>>> Anyone wanting to help me implement this for a bounty? :D
>>
>>> regards, //Martin _______________________________________________
>>>  Linux-uvc-devel mailing list Linux-uvc-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>>
>>
>> _______________________________________________ Linux-uvc-devel
>> mailing list Linux-uvc-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
> - --
> Regards,
> Alexey
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.11 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iEYEARECAAYFAk7WDwEACgkQw8E0jNwoJm8dLQCgt7PQK64jTsobctVe/59Ouyq2
> JLMAoKrXkLVqSW3+R1plYjyafILnosmr
> =vb1s
> -----END PGP SIGNATURE-----
> _______________________________________________
> Linux-uvc-devel mailing list
> Linux-uvc-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/linux-uvc-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111130/fce07387/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dmesg.log
Type: text/x-log
Size: 4317 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/linux-uvc-devel/attachments/20111130/fce07387/attachment.bin>

From bug-track at fisher-privat.net  Wed Nov 30 16:03:50 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 30 Nov 2011 16:03:50 +0100
Subject: [Linux-uvc-devel] WebCam SC-13HDL10931N
In-Reply-To: <CA+YGrSACCye3HZ0+-uuPWvfp0nZ8bHd24XWPDC99WzzvOhs31Q@mail.gmail.com>
References: <CA+YGrSCEiQCn9roKnVXzV+jTZq1j3e5+Zdy6Yti53HV2Wx7qYg@mail.gmail.com>
	<4ED60DC4.8020608@fisher-privat.net>
	<4ED60F01.4000400@fisher-privat.net>
	<CA+YGrSAaf-9eUi4v_9bgEK4_qwWPqtGbRywU0QRseQn-MW751A@mail.gmail.com>
	<CA+YGrSACCye3HZ0+-uuPWvfp0nZ8bHd24XWPDC99WzzvOhs31Q@mail.gmail.com>
Message-ID: <4ED645D6.7010904@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

According your dmesg, this device request 3060 B/frame bandwidth for
640x480 at 30fps for jpeg stream. it is wrong even for uncompressed stream.

Current uvcvideo do not support bandwidth correction for jpeg, but you
can enable it for raw stream. Can you please test raw-yuv?

Any way, short version: this webcam is buggy. if you wont to save the
world, send it back.

On 30.11.2011 15:24, Martin Bruse wrote:
> Ah, stupid of me not to check the FAQ first :O
> 
> Attached is the end of the dmesg log I created after unloading 
> uvcvideo, loading uvcvideo, turning on the debug messages and
> running luvcview with the "no space left on device" result.
> 
> //Martin
> 
> On Wed, Nov 30, 2011 at 12:09 PM, Alexey Fisher 
> <bug-track at fisher-privat.net> wrote: For got to say:
> 
> read FAQ for trouble shooting help.
> 
> 
> On 30.11.2011 12:04, Alexey Fisher wrote:
- -- 
Regards,
Alexey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7WRdUACgkQw8E0jNwoJm/EOACggni2H6DSxw2jeu3YqoZxZLTH
uW0AoKY3etxdYdlVv32QOlQQe9p8ckg2
=UtZU
-----END PGP SIGNATURE-----


From bug-track at fisher-privat.net  Wed Nov 30 16:16:13 2011
From: bug-track at fisher-privat.net (Alexey Fisher)
Date: Wed, 30 Nov 2011 16:16:13 +0100
Subject: [Linux-uvc-devel] [faq] test cases
Message-ID: <4ED648BD.4030307@fisher-privat.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Laurent,

here are new ideas for FAQ:

- - I got a new webcam or laptop with build in cam, but it's not
working, what should i do?

UVC (usb video class) is same kind standard class like UMS (usb mass
storage). One of good UMS examples is usb stick. If you will need to
install driver to use usb stick it will make no sense and if it is not
working on linux it is most probably broken.

Same situation is with UVC webcams. *If it is not working with modern
linux distribution or any modern linux kernel, then  this device is
most probably broken!* And if you still can, then give or send it back!

- - With app XYZ my webcam is not working, is my cam or app is broken?

there are different apps to test webcam: luvcview, guvcview, cheese,
mplayer, vlc, skype.
We prefer to test it with luvcview or guvcview.
The cams can also support different formats, yuv, jpeg, ... in this
case try different.


PS: Please add reminder on first page: read FAQ before send email.

- -- 
Regards,
Alexey
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk7WSL0ACgkQw8E0jNwoJm/ZNwCgrTLnjUTb/qX2TEeDzkhAnwHb
lgEAnA3dW/YZ2BIL9kSE46opEdupsY3I
=HD8s
-----END PGP SIGNATURE-----


